window.ccpwgl_int=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function t(){return e.default}:function t(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=64)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(30);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(66);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(34);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(35);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(72);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(73);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})});var l=r(74);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return l[e]}})});var c=r(75);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return c[e]}})});var f=r(76);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return f[e]}})});var h=r(77);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return h[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(20);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(86);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(96);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(98);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(17);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(46);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})});var l=r(47);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return l[e]}})});var c=r(131);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return c[e]}})});var f=r(24);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return f[e]}})});var h=r(137);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return h[e]}})});var p=r(29);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return p[e]}})});var d=r(28);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return d[e]}})});var v=r(21);Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return v[e]}})});var $=r(9);Object.keys($).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return $[e]}})});var m=r(139);Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return m[e]}})});var y=r(140);Object.keys(y).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return y[e]}})});var g=r(56);Object.keys(g).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return g[e]}})});var _=r(36);Object.keys(_).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return _[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.device=t.Tw2Device=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(16),o=r(4),s=r(6),u=r(40),l=r(9),c=r(81),f=t.Tw2Device=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.gl=null,this.glVersion=e.WebglVersion.NONE,this.vrDisplay=null,this.ext=null,this.debugMode=!1,this.dt=0,this.frameCounter=0,this.startTime=this.Now(),this.currentTime=this.startTime,this.previousTime=null,this.eyePosition=i.vec3.create(),this.targetResolution=i.vec4.create(),this.world=i.mat4.create(),this.view=i.mat4.create(),this.viewInverse=i.mat4.create(),this.viewTranspose=i.mat4.create(),this.projection=i.mat4.create(),this.projectionInverse=i.mat4.create(),this.projectionTranspose=i.mat4.create(),this.viewProjection=i.mat4.create(),this.viewProjectionTranspose=i.mat4.create(),this.canvas=null,this.viewportWidth=0,this.viewportHeight=0,this.viewportAspect=0,this.viewportPixelRatio="devicePixelRatio"in window?window.devicePixelRatio:1,this.effectDir="/effect.gles2/",this.mipLevelSkipCount=0,this.shaderModel="hi",this.enableAnisotropicFiltering=!0,this.alphaBlendBackBuffer=!0,this.antialiasing=!0,this.msaaSamples=0,this.wrapModes=[],this.shadowHandles=null,this.perObjectData=null,this._alphaBlendState=null,this._alphaTestState=null,this._depthOffsetState=null,this._blendTable=null,this._shadowStateBuffer=null,this._scheduled=[],this._quadBuffer=null,this._quadDecl=null,this._cameraQuadBuffer=null,this._currentRenderMode=this.RM_ANY,this._fallbackCube=null,this._fallbackTexture=null,this._blitEffect=null,this._onResize=null,this.utils=c}return n(e,[{key:"Now",value:function e(){return this.constructor.Clock.now()}},{key:"CreateDevice",value:function t(r,n){this.gl=null,this.glVersion=e.WebglVersion.NONE,this.effectDir="/effect.gles2/",n&&n.webgl2&&(this.gl=e.CreateContext(r,n,e.Webgl2ContextNames),this.gl&&(this.glVersion=e.WebglVersion.WEBGL2)),!this.gl&&(this.gl=e.CreateContext(r,n,e.WebglContextNames),this.gl&&(this.glVersion=e.WebglVersion.WEBGL)),this.ext={drawElementsInstanced:function e(){return!1},drawArraysInstanced:function e(){return!1},vertexAttribDivisor:function e(){return!1},hasInstancedArrays:function e(){return!1}};var i=this.gl;switch(this.glVersion){case e.WebglVersion.WEBGL2:this.ext={drawElementsInstanced:function e(t,r,n,a,o){i.drawElementsInstanced(t,r,n,a,o)},drawArraysInstanced:function e(t,r,n,a){i.drawArraysInstanced(t,r,n,a)},vertexAttribDivisor:function e(t,r){i.vertexAttribDivisor(t,r)},hasInstancedArrays:function e(){return!0}};break;case e.WebglVersion.WEBGL:this.GetExtension("OES_standard_derivatives"),this.GetExtension("OES_element_index_uint"),this.GetExtension("OES_texture_float"),this.GetExtension("EXT_shader_texture_lod");var a=this.GetExtension("ANGLE_instanced_arrays");a&&(this.ext={drawElementsInstanced:function e(t,r,n,i,o){a.drawElementsInstancedANGLE(t,r,n,i,o)},drawArraysInstanced:function e(t,r,n,i){a.drawArraysInstancedANGLE(t,r,n,i)},vertexAttribDivisor:function e(t,r){a.vertexAttribDivisorANGLE(t,r)},hasInstancedArrays:function e(){return!0}});break;default:return this.glVersion}i&&this.debugMode&&(this.gl=this.utils.makeDebugContext(i)),o.logger.log("webgl",{log:"warn",type:"Context created",value:this.glVersion}),this.ext.CompressedTexture=this.GetExtension("compressed_texture_s3tc"),this.ext.AnisotropicFilter=this.GetExtension("EXT_texture_filter_anisotropic"),this.ext.AnisotropicFilter&&(this.ext.AnisotropicFilter.maxAnisotropy=i.getParameter(this.ext.AnisotropicFilter.MAX_TEXTURE_MAX_ANISOTROPY_EXT));var s=this.GetExtension("CCP_shader_binary");if(s){var u=i.getParameter(this.gl.RENDERER).match(/Mali-(\w+).*/);u&&(this.effectDir="/effect.gles2.mali"+u[1]+"/",this.ext.ShaderBinary=s)}return this.alphaBlendBackBuffer=!n||void 0===n.alpha||n.alpha,this.msaaSamples=this.gl.getParameter(this.gl.SAMPLES),this.antialiasing=this.msaaSamples>1,this.canvas=r,this.Resize(),this._quadBuffer=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,this._quadBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array([1,1,0,1,1,1,-1,1,0,1,0,1,1,-1,0,1,1,0,-1,-1,0,1,0,0]),i.STATIC_DRAW),this._cameraQuadBuffer=i.createBuffer(),this._quadDecl=new l.Tw2VertexDeclaration,this._quadDecl.elements.push(new l.Tw2VertexElement(l.Tw2VertexDeclaration.Type.POSITION,0,i.FLOAT,4,0)),this._quadDecl.elements.push(new l.Tw2VertexElement(l.Tw2VertexDeclaration.Type.TEXCOORD,0,i.FLOAT,2,16)),this._quadDecl.RebuildHash(),this._alphaTestState={},this._alphaTestState.states={},this._alphaTestState.states[this.RS_ALPHATESTENABLE]=0,this._alphaTestState.states[this.RS_ALPHAREF]=-1,this._alphaTestState.states[this.RS_ALPHAFUNC]=this.CMP_GREATER,this._alphaTestState.states[this.RS_CLIPPING]=0,this._alphaTestState.states[this.RS_CLIPPLANEENABLE]=0,this._alphaTestState.dirty=!1,this._alphaBlendState={},this._alphaBlendState.states={},this._alphaBlendState.states[this.RS_SRCBLEND]=this.BLEND_SRCALPHA,this._alphaBlendState.states[this.RS_DESTBLEND]=this.BLEND_INVSRCALPHA,this._alphaBlendState.states[this.RS_BLENDOP]=this.BLENDOP_ADD,this._alphaBlendState.states[this.RS_SEPARATEALPHABLENDENABLE]=0,this._alphaBlendState.states[this.RS_BLENDOPALPHA]=this.BLENDOP_ADD,this._alphaBlendState.states[this.RS_SRCBLENDALPHA]=this.BLEND_SRCALPHA,this._alphaBlendState.states[this.RS_DESTBLENDALPHA]=this.BLEND_INVSRCALPHA,this._alphaBlendState.dirty=!1,this._depthOffsetState={},this._depthOffsetState.states={},this._depthOffsetState.states[this.RS_SLOPESCALEDEPTHBIAS]=0,this._depthOffsetState.states[this.RS_DEPTHBIAS]=0,this._depthOffsetState.dirty=!1,this.wrapModes=[],this.wrapModes[0]=0,this.wrapModes[1]=i.REPEAT,this.wrapModes[2]=i.MIRRORED_REPEAT,this.wrapModes[3]=i.CLAMP_TO_EDGE,this.wrapModes[4]=i.CLAMP_TO_EDGE,this.wrapModes[5]=i.CLAMP_TO_EDGE,this._shadowStateBuffer=new Float32Array(24),this._blendTable=[-1,i.ZERO,i.ONE,i.SRC_COLOR,i.ONE_MINUS_SRC_COLOR,i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.DST_ALPHA,i.ONE_MINUS_DST_ALPHA,i.DST_COLOR,i.ONE_MINUS_DST_COLOR,i.SRC_ALPHA_SATURATE,-1,-1,i.CONSTANT_COLOR,i.ONE_MINUS_CONSTANT_COLOR],this.glVersion}},{key:"Schedule",value:function e(t){this._scheduled.includes(t)||this._scheduled.push(t)}},{key:"OnResize",value:function e(t){this._onResize=t}},{key:"Resize",value:function e(){if(this.vrDisplay&&this.vrDisplay.isPresenting){var t=this.vrDisplay.getEyeParameters("left"),r=this.vrDisplay.getEyeParameters("right");this.canvas.width=2*Math.max(t.renderWidth,r.renderWidth),this.canvas.height=Math.max(r.renderHeight,r.renderHeight)}else this.canvas.width=this.canvas.offsetWidth*this.viewportPixelRatio,this.canvas.height=this.canvas.offsetHeight*this.viewportPixelRatio;this.viewportWidth=this.canvas.clientWidth,this.viewportHeight=this.canvas.clientHeight,this.viewportAspect=this.viewportWidth/this.viewportHeight,this._onResize&&this._onResize(this.viewportWidth,this.viewportHeight),a.store.SetVariableValue("ViewportSize",[this.viewportWidth,this.viewportHeight,this.viewportWidth,this.viewportHeight])}},{key:"Tick",value:function e(){(this.canvas.clientWidth!==this.viewportWidth||this.canvas.clientHeight!==this.viewportHeight)&&this.Resize();var t=null===this.previousTime?0:this.previousTime,r=this.Now();this.currentTime=(r-this.startTime)*.001,this.dt=null===this.previousTime?0:(r-this.previousTime)*.001,this.previousTime=r,a.store.SetVariableValue("Time",[this.currentTime,this.currentTime-Math.floor(this.currentTime),this.frameCounter,t]),s.resMan.PrepareLoop(this.dt);for(var n=0;n<this._scheduled.length;++n)!this._scheduled[n](this.dt)&&(this._scheduled.splice(n,1),--n);this.frameCounter++}},{key:"RequestAnimationFrame",value:function t(r){return this.vrDisplay?this.vrDisplay.requestAnimationFrame(r):e.RequestAnimationFrame(r)}},{key:"SetWorld",value:function e(t){i.mat4.copy(this.world,t)}},{key:"SetView",value:function e(t){i.mat4.copy(this.view,t),i.mat4.invert(this.viewInverse,this.view),i.mat4.transpose(this.viewTranspose,this.view),i.mat4.getTranslation(this.eyePosition,this.viewInverse),this.UpdateViewProjection()}},{key:"SetProjection",value:function e(t,r){i.mat4.copy(this.projection,t),i.mat4.transpose(this.projectionTranspose,this.projection),i.mat4.invert(this.projectionInverse,this.projection),this.GetTargetResolution(this.targetResolution),r&&this.UpdateViewProjection()}},{key:"UpdateViewProjection",value:function e(){i.mat4.multiply(this.viewProjection,this.projection,this.view),i.mat4.transpose(this.viewProjectionTranspose,this.viewProjection),a.store.SetVariableValue("ViewProjectionMat",this.viewProjection)}},{key:"GetTargetResolution",value:function e(t){var r=this.projection[0]?this.projection[5]/this.projection[0]:0,n=1;r>1.6&&(n=r/1.6);var i=2*Math.atan(n/this.projection[5]);return t[0]=this.viewportWidth,t[1]=this.viewportHeight,t[2]=i,t[3]=i*r,t}},{key:"GetEyePosition",value:function e(t){return i.vec3.copy(t,this.eyePosition)}},{key:"IsAlphaTestEnabled",value:function e(){return this._alphaTestState.states[this.RS_ALPHATESTENABLE]}},{key:"IsFrameBufferComplete",value:function e(t){return this.gl.checkFramebufferStatus(t)===this.gl.FRAMEBUFFER_COMPLETE}},{key:"GetExtension",value:function t(r){for(var n in e.WebglVendorPrefixes)if(e.WebglVendorPrefixes.hasOwnProperty(n)){var i=this.gl.getExtension(e.WebglVendorPrefixes[n]+r);if(i)return i}return null}},{key:"GetFallbackTexture",value:function e(){return this._fallbackTexture||(this._fallbackTexture=this.CreateSolidTexture()),this._fallbackTexture}},{key:"GetFallbackCubeMap",value:function e(){return this._fallbackCube||(this._fallbackCube=this.CreateSolidCube()),this._fallbackCube}},{key:"CreateSolidTexture",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],r=this.gl.createTexture();return this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array(t)),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.bindTexture(this.gl.TEXTURE_2D,null),r}},{key:"CreateSolidCube",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[0,0,0,0],r=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,r);for(var n=0;n<6;++n)this.gl.texImage2D(this.gl.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array(t));return this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_CUBE_MAP,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,null),r}},{key:"RenderFullScreenQuad",value:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Main";if(!t||!t.IsGood())return!1;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._quadBuffer);for(var n=0;n<t.GetPassCount(r);++n){if(t.ApplyPass(r,n),!this._quadDecl.SetDeclaration(t.GetPassInput(r,n),24))return!1;this.ApplyShadowState(),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}return!0}},{key:"RenderTexture",value:function e(t){return null===this._blitEffect&&(this._blitEffect=u.Tw2Effect.create({effectFilePath:"res:/graphics/effect/managed/space/system/blit.fx",textures:{BlitSource:""}})),this._blitEffect.parameters.BlitSource.textureRes=t,this.RenderFullScreenQuad(this._blitEffect)}},{key:"RenderCameraSpaceQuad",value:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Main";if(!t||!t.IsGood())return!1;for(var n=new Float32Array([1,1,0,1,1,1,-1,1,0,1,0,1,1,-1,0,1,1,0,-1,-1,0,1,0,0]),a=this.projectionInverse,o=0;o<4;++o){var s=n.subarray(6*o,6*o+4);i.vec4.transformMat4(s,s,a),i.vec3.scale(s,s,1/s[3]),s[3]=1}this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._cameraQuadBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,n,this.gl.STATIC_DRAW);for(var u=0;u<t.GetPassCount(r);++u){if(t.ApplyPass(r,u),!this._quadDecl.SetDeclaration(t.GetPassInput(r,u),24))return!1;this.ApplyShadowState(),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}return!0}},{key:"SetRenderState",value:function t(r,n){this._currentRenderMode=this.RM_ANY;var i=this.gl;switch(r){case this.RS_ZENABLE:n?i.enable(i.DEPTH_TEST):i.disable(i.DEPTH_TEST);return;case this.RS_ZWRITEENABLE:i.depthMask(!!n);return;case this.RS_ALPHATESTENABLE:case this.RS_ALPHAREF:case this.RS_ALPHAFUNC:case this.RS_CLIPPING:case this.RS_CLIPPLANEENABLE:this._alphaTestState[r]!==n&&(this._alphaTestState.states[r]=n,this._alphaTestState.dirty=!0);return;case this.RS_SRCBLEND:case this.RS_DESTBLEND:case this.RS_BLENDOP:case this.RS_SEPARATEALPHABLENDENABLE:case this.RS_BLENDOPALPHA:case this.RS_SRCBLENDALPHA:case this.RS_DESTBLENDALPHA:this._alphaBlendState[r]!==n&&(this._alphaBlendState.states[r]=n,this._alphaBlendState.dirty=!0);return;case this.RS_CULLMODE:switch(n){case this.CULL_NONE:i.disable(i.CULL_FACE);break;case this.CULL_CW:i.enable(i.CULL_FACE),i.cullFace(i.FRONT);break;case this.CULL_CCW:i.enable(i.CULL_FACE),i.cullFace(i.BACK)}return;case this.RS_ZFUNC:i.depthFunc(512+n-1);return;case this.RS_ALPHABLENDENABLE:n?i.enable(i.BLEND):i.disable(i.BLEND);return;case this.RS_COLORWRITEENABLE:i.colorMask((1&n)!=0,(2&n)!=0,(4&n)!=0,(8&n)!=0);return;case this.RS_SCISSORTESTENABLE:n?i.enable(i.SCISSOR_TEST):i.disable(i.SCISSOR_TEST);return;case this.RS_SLOPESCALEDEPTHBIAS:case this.RS_DEPTHBIAS:n=e.DwordToFloat(n),this._depthOffsetState[r]!==n&&(this._depthOffsetState.states[r]=n,this._depthOffsetState.dirty=!0);return}}},{key:"ApplyShadowState",value:function e(){if(this._alphaBlendState.dirty){var t=this.gl.FUNC_ADD;this._alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_SUBTRACT?t=this.gl.FUNC_SUBTRACT:this._alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_REVSUBTRACT&&(t=this.gl.FUNC_REVERSE_SUBTRACT);var r=this._blendTable[this._alphaBlendState.states[this.RS_SRCBLEND]],n=this._blendTable[this._alphaBlendState.states[this.RS_DESTBLEND]];if(this._alphaBlendState.states[this.RS_SEPARATEALPHABLENDENABLE]){var i=this.gl.FUNC_ADD;this._alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_SUBTRACT?i=this.gl.FUNC_SUBTRACT:this._alphaBlendState.states[this.RS_BLENDOP]===this.BLENDOP_REVSUBTRACT&&(i=this.gl.FUNC_REVERSE_SUBTRACT);var a=this._blendTable[this._alphaBlendState.states[this.RS_SRCBLENDALPHA]],o=this._blendTable[this._alphaBlendState.states[this.RS_DESTBLENDALPHA]];this.gl.blendEquationSeparate(t,i),this.gl.blendFuncSeparate(r,n,a,o)}else this.gl.blendEquation(t),this.gl.blendFunc(r,n);this._alphaBlendState.dirty=!1}this._depthOffsetState.dirty&&(this.gl.polygonOffset(this._depthOffsetState.states[this.RS_SLOPESCALEDEPTHBIAS],this._depthOffsetState.states[this.RS_DEPTHBIAS]),this._depthOffsetState.dirty=!1);var s=void 0,u=void 0,l=void 0;if(this.shadowHandles&&this._alphaTestState.states[this.RS_ALPHATESTENABLE]){switch(this._alphaTestState.states[this.RS_ALPHAFUNC]){case this.CMP_NEVER:s=0,u=1,l=-256;break;case this.CMP_LESS:s=0,u=-1,l=this._alphaTestState.states[this.RS_ALPHAREF]-1;break;case this.CMP_EQUAL:s=1,u=0,l=this._alphaTestState.states[this.RS_ALPHAREF];break;case this.CMP_LEQUAL:s=0,u=-1,l=this._alphaTestState.states[this.RS_ALPHAREF];break;case this.CMP_GREATER:s=0,u=1,l=-this._alphaTestState.states[this.RS_ALPHAREF]-1;break;case this.CMP_GREATEREQUAL:s=0,u=1,l=-this._alphaTestState.states[this.RS_ALPHAREF];break;default:s=0,u=0,l=1}this.gl.uniform4f(this.shadowHandles.shadowStateInt,u,l,s,0)}}},{key:"SetStandardStates",value:function e(t){if(this._currentRenderMode!==t){switch(this.gl.frontFace(this.gl.CW),t){case this.RM_OPAQUE:case this.RM_PICKABLE:this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!0),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_CULLMODE,this.CULL_CW),this.SetRenderState(this.RS_ALPHABLENDENABLE,!1),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_DECAL:this.SetRenderState(this.RS_ALPHABLENDENABLE,!1),this.SetRenderState(this.RS_ALPHATESTENABLE,!0),this.SetRenderState(this.RS_ALPHAFUNC,this.CMP_GREATER),this.SetRenderState(this.RS_ALPHAREF,127),this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!0),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_CULLMODE,this.CULL_CW),this.SetRenderState(this.RS_BLENDOP,this.BLENDOP_ADD),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_TRANSPARENT:this.SetRenderState(this.RS_CULLMODE,this.CULL_CW),this.SetRenderState(this.RS_ALPHABLENDENABLE,!0),this.SetRenderState(this.RS_SRCBLEND,this.BLEND_SRCALPHA),this.SetRenderState(this.RS_DESTBLEND,this.BLEND_INVSRCALPHA),this.SetRenderState(this.RS_BLENDOP,this.BLENDOP_ADD),this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!1),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_ADDITIVE:this.SetRenderState(this.RS_CULLMODE,this.CULL_NONE),this.SetRenderState(this.RS_ALPHABLENDENABLE,!0),this.SetRenderState(this.RS_SRCBLEND,this.BLEND_ONE),this.SetRenderState(this.RS_DESTBLEND,this.BLEND_ONE),this.SetRenderState(this.RS_BLENDOP,this.BLENDOP_ADD),this.SetRenderState(this.RS_ZENABLE,!0),this.SetRenderState(this.RS_ZWRITEENABLE,!1),this.SetRenderState(this.RS_ZFUNC,this.CMP_LEQUAL),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;case this.RM_FULLSCREEN:this.SetRenderState(this.RS_ALPHABLENDENABLE,!1),this.SetRenderState(this.RS_ALPHATESTENABLE,!1),this.SetRenderState(this.RS_CULLMODE,this.CULL_NONE),this.SetRenderState(this.RS_ZENABLE,!1),this.SetRenderState(this.RS_ZWRITEENABLE,!1),this.SetRenderState(this.RS_ZFUNC,this.CMP_ALWAYS),this.SetRenderState(this.RS_SLOPESCALEDEPTHBIAS,0),this.SetRenderState(this.RS_DEPTHBIAS,0),this.SetRenderState(this.RS_SEPARATEALPHABLENDENABLE,!1),this.SetRenderState(this.RS_COLORWRITEENABLE,15);break;default:return}this._currentRenderMode=t}}}],[{key:"DwordToFloat",value:function e(t){var r=(16711680&t)>>16,n=(4278190080&t)>>24,i=(n<<1&255|r>>7)-127,a=(127&r)<<16|(65280&t)>>8<<8|255&t;return 0===a&&-127===i?0:(1-2*(n>>7))*(1+11920928955078125e-23*a)*Math.pow(2,i)}},{key:"CreateContext",value:function e(t,r,n){n=Array.isArray(n)?n:[n];for(var i=0;i<n.length;i++)try{return t.getContext(n[i],r)}catch(a){}return null}}]),e}();f.Clock=Date;var h,p,d=void 0;f.RequestAnimationFrame=(h=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){return d||(d=[]),d.push(window.setTimeout(e,1e3/60)),d.length-1},function e(t){return h(t)}),f.CancelAnimationFrame=(p=window.cancelAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){if(d||(d=[]),void 0!==d[e])return window.clearTimeout(d[e]),d[e]=void 0,!0},function e(t){p(t)}),f.WebglVendorPrefixes=["","MOZ_","WEBKIT_","WEBGL_"],f.WebglContextNames=["webgl","experimental-webgl"],f.Webgl2ContextNames=["webgl2","experimental-webgl2"],f.WebglVersion={NONE:0,WEBGL:1,WEBGL2:2},f.prototype.RM_ANY=-1,f.prototype.RM_OPAQUE=0,f.prototype.RM_DECAL=1,f.prototype.RM_TRANSPARENT=2,f.prototype.RM_ADDITIVE=3,f.prototype.RM_DEPTH=4,f.prototype.RM_FULLSCREEN=5,f.prototype.RM_PICKABLE=6,f.prototype.RS_ZENABLE=7,f.prototype.RS_FILLMODE=8,f.prototype.RS_SHADEMODE=9,f.prototype.RS_ZWRITEENABLE=14,f.prototype.RS_ALPHATESTENABLE=15,f.prototype.RS_LASTPIXEL=16,f.prototype.RS_SRCBLEND=19,f.prototype.RS_DESTBLEND=20,f.prototype.RS_CULLMODE=22,f.prototype.RS_ZFUNC=23,f.prototype.RS_ALPHAREF=24,f.prototype.RS_ALPHAFUNC=25,f.prototype.RS_DITHERENABLE=26,f.prototype.RS_ALPHABLENDENABLE=27,f.prototype.RS_FOGENABLE=28,f.prototype.RS_SPECULARENABLE=29,f.prototype.RS_FOGCOLOR=34,f.prototype.RS_FOGTABLEMODE=35,f.prototype.RS_FOGSTART=36,f.prototype.RS_FOGEND=37,f.prototype.RS_FOGDENSITY=38,f.prototype.RS_RANGEFOGENABLE=48,f.prototype.RS_STENCILENABLE=52,f.prototype.RS_STENCILFAIL=53,f.prototype.RS_STENCILZFAIL=54,f.prototype.RS_STENCILPASS=55,f.prototype.RS_STENCILFUNC=56,f.prototype.RS_STENCILREF=57,f.prototype.RS_STENCILMASK=58,f.prototype.RS_STENCILWRITEMASK=59,f.prototype.RS_TEXTUREFACTOR=60,f.prototype.RS_WRAP0=128,f.prototype.RS_WRAP1=129,f.prototype.RS_WRAP2=130,f.prototype.RS_WRAP3=131,f.prototype.RS_WRAP4=132,f.prototype.RS_WRAP5=133,f.prototype.RS_WRAP6=134,f.prototype.RS_WRAP7=135,f.prototype.RS_CLIPPING=136,f.prototype.RS_LIGHTING=137,f.prototype.RS_AMBIENT=139,f.prototype.RS_FOGVERTEXMODE=140,f.prototype.RS_COLORVERTEX=141,f.prototype.RS_LOCALVIEWER=142,f.prototype.RS_NORMALIZENORMALS=143,f.prototype.RS_DIFFUSEMATERIALSOURCE=145,f.prototype.RS_SPECULARMATERIALSOURCE=146,f.prototype.RS_AMBIENTMATERIALSOURCE=147,f.prototype.RS_EMISSIVEMATERIALSOURCE=148,f.prototype.RS_VERTEXBLEND=151,f.prototype.RS_CLIPPLANEENABLE=152,f.prototype.RS_POINTSIZE=154,f.prototype.RS_POINTSIZE_MIN=155,f.prototype.RS_POINTSPRITEENABLE=156,f.prototype.RS_POINTSCALEENABLE=157,f.prototype.RS_POINTSCALE_A=158,f.prototype.RS_POINTSCALE_B=159,f.prototype.RS_POINTSCALE_C=160,f.prototype.RS_MULTISAMPLEANTIALIAS=161,f.prototype.RS_MULTISAMPLEMASK=162,f.prototype.RS_PATCHEDGESTYLE=163,f.prototype.RS_DEBUGMONITORTOKEN=165,f.prototype.RS_POINTSIZE_MAX=166,f.prototype.RS_INDEXEDVERTEXBLENDENABLE=167,f.prototype.RS_COLORWRITEENABLE=168,f.prototype.RS_TWEENFACTOR=170,f.prototype.RS_BLENDOP=171,f.prototype.RS_POSITIONDEGREE=172,f.prototype.RS_NORMALDEGREE=173,f.prototype.RS_SCISSORTESTENABLE=174,f.prototype.RS_SLOPESCALEDEPTHBIAS=175,f.prototype.RS_ANTIALIASEDLINEENABLE=176,f.prototype.RS_TWOSIDEDSTENCILMODE=185,f.prototype.RS_CCW_STENCILFAIL=186,f.prototype.RS_CCW_STENCILZFAIL=187,f.prototype.RS_CCW_STENCILPASS=188,f.prototype.RS_CCW_STENCILFUNC=189,f.prototype.RS_COLORWRITEENABLE1=190,f.prototype.RS_COLORWRITEENABLE2=191,f.prototype.RS_COLORWRITEENABLE3=192,f.prototype.RS_BLENDFACTOR=193,f.prototype.RS_SRGBWRITEENABLE=194,f.prototype.RS_DEPTHBIAS=195,f.prototype.RS_SEPARATEALPHABLENDENABLE=206,f.prototype.RS_SRCBLENDALPHA=207,f.prototype.RS_DESTBLENDALPHA=208,f.prototype.RS_BLENDOPALPHA=209,f.prototype.CULL_NONE=1,f.prototype.CULL_CW=2,f.prototype.CULL_CCW=3,f.prototype.CMP_NEVER=1,f.prototype.CMP_LESS=2,f.prototype.CMP_EQUAL=3,f.prototype.CMP_LEQUAL=4,f.prototype.CMP_GREATER=5,f.prototype.CMP_NOTEQUAL=6,f.prototype.CMP_GREATEREQUAL=7,f.prototype.CMP_ALWAYS=8,f.prototype.BLEND_ZERO=1,f.prototype.BLEND_ONE=2,f.prototype.BLEND_SRCCOLOR=3,f.prototype.BLEND_INVSRCCOLOR=4,f.prototype.BLEND_SRCALPHA=5,f.prototype.BLEND_INVSRCALPHA=6,f.prototype.BLEND_DESTALPHA=7,f.prototype.BLEND_INVDESTALPHA=8,f.prototype.BLEND_DESTCOLOR=9,f.prototype.BLEND_INVDESTCOLOR=10,f.prototype.BLEND_SRCALPHASAT=11,f.prototype.BLEND_BOTHSRCALPHA=12,f.prototype.BLEND_BOTHINVSRCALPHA=13,f.prototype.BLEND_BLENDFACTOR=14,f.prototype.BLEND_INVBLENDFACTOR=15,f.prototype.BLENDOP_ADD=1,f.prototype.BLENDOP_SUBTRACT=2,f.prototype.BLENDOP_REVSUBTRACT=3,f.prototype.BLENDOP_MIN=4,f.prototype.BLENDOP_MAX=5,t.device=new f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Curve=t.Tw2CurveKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}t.Tw2CurveKey=function e(){a(this,e),this._id=i.util.generateID(),this.name="",this.time=0};var o=t.Tw2Curve=function(){function e(){a(this,e),this._id=i.util.generateID(),this.name=""}return n(e,[{key:"Initialize",value:function e(){this.Sort()}},{key:"Sort",value:function e(){}},{key:"GetLength",value:function e(){return 0}},{key:"UpdateValue",value:function e(t){}}],[{key:"Compare",value:function e(t,r){return t.time<r.time?-1:t.time>r.time?1:0}},{key:"Sort",value:function t(r){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.keys;n&&n.length&&(n.sort(e.Compare),r.length=n[n.length-1].time)}},{key:"Sort2",value:function t(r){if(r.keys&&r.keys.length){r.keys.sort(e.Compare);var n=r.keys[r.keys.length-1];if(n.time>r.length){var i=r.length,a=r.endValue,o=r.endTangent;r.length=n.time,r.endValue=n.value,r.endTangent=n.leftTangent,i>0&&(n.time=i,n.value=a,n.leftTangent=o)}}}}]),e}();o.inputDimension=null,o.outputDimension=null,o.valueProperty=null,o.curveType=null,o.Key=null,o.Interpolation=null,o.Extrapolation=null,o.Type={CURVE:1,CURVE2:2,CURVE_MAYA:3,CURVE_NO_KEYS:4,SEQUENCER:100,SEQUENCER2:101},o.global={vec3_0:i.vec3.create(),vec4_0:i.vec4.create(),quat_0:i.quat.create(),quat_1:i.quat.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logger=t.Tw2Logger=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(36),a=r(0),o=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.name=e,r.display=!0,r.visible={},r.visible.log=!0,r.visible.info=!0,r.visible.debug=!0,r.visible.warn=!0,r.visible.error=!0,r.maxLogs=100,r._logs=[],r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"log",value:function e(r,n){if(n.log=t.Type[n.log?n.log.toUpperCase():"LOG"]||"log",!n.hide&&this.display&&this.visible[n.log]){var i=this.name+": {"+r+"}",a=n.msg||"";n.path&&(a+=" '"+n.path+"'","time"in n&&(a+=" in "+n.time.toFixed(3)+" secs")),(void 0!==n.value||n.type)&&(a+=" (",n.type&&(a+=n.type),n.type&&void 0!==n.value&&(a+=":"),void 0!==n.value&&(a+=n.value),a+=")"),"data"in n||"err"in n?(console.group(i),console[n.log](a),n.data&&console.debug(n.data),n.err&&console.debug(n.err.stack||n.err.toString()),console.groupEnd()):console[n.log](i,a)}return this.maxLogs?(this._logs.length>=this.maxLogs&&this._logs.splice(this.maxLogs,this._logs.length-1),this._logs.unshift(n)):this._logs=[],this.emit("log",n),n}},{key:"GetLogs",value:function e(t){return Object.assign([],void 0===t?this._logs:this._logs.splice(0,t))}},{key:"Set",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a.util.assignIfExists(this,t,["name","maxLogs","display"]),a.util.assignIfExists(this.visible,t.visible,["log","info","debug","warn","error"])}}]),t}(i.Tw2EventEmitter);t.Tw2Logger=o,o.Type={THROW:"error",ERROR:"error",WARNING:"warn",WARN:"warn",INFO:"info",LOG:"log",DEBUG:"debug"};var s=t.logger=new o("CCPWGL");i.Tw2EventEmitter.logger=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r.d(t,"ARRAY_TYPE",function(){return n}),t.setMatrixArrayType=i,t.toRadian=o,t.equals=function e(t,r){return Math.abs(t-r)<=1e-6*Math.max(1,Math.abs(t),Math.abs(r))},t.EPSILON=1e-6;let n="undefined"!=typeof Float32Array?Float32Array:Array;function i(e){n=e}t.RANDOM=Math.random;let a=Math.PI/180;function o(e){return e*a}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resMan=t.Tw2ResMan=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),a=r(16),o=r(78),s=r(37),u=t.Tw2ResMan=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.motherLode=new o.Tw2MotherLode,this.systemMirror=!1,this.maxPrepareTime=.05,this.prepareBudget=0,this.autoPurgeResources=!0,this.activeFrame=0,this.purgeTime=30,this._prepareQueue=[],this._purgeTime=0,this._purgeFrame=0,this._purgeFrameLimit=1e3,this._pendingLoads=0,this._noLoadFrames=0}return n(e,[{key:"IsLoading",value:function e(){return this._noLoadFrames<2}},{key:"Clear",value:function e(){this.motherLode.Clear()}},{key:"UnloadAndClear",value:function e(){this.motherLode.UnloadAndClear()}},{key:"PrepareLoop",value:function e(t){0===this._prepareQueue.length&&0===this._pendingLoads?this._noLoadFrames<2&&this._noLoadFrames++:this._noLoadFrames=0,this.prepareBudget=this.maxPrepareTime;for(var r=Date.now();this._prepareQueue.length;){var n=this._prepareQueue[0][0],a=this._prepareQueue[0][1],o=this._prepareQueue[0][2],s=void 0;try{s=n.Prepare(a,o)}catch(u){throw this._prepareQueue.shift(),u}if(s||(i.logger.log("res.event",{msg:"Prepared  ",path:n.path,time:(Date.now()-r)*.001,type:"prepared"}),this._prepareQueue.shift()),this.prepareBudget-=(Date.now()-r)*.001,this.prepareBudget<0)break}return this._purgeTime+=t,this._purgeTime>1&&(this.activeFrame+=1,this._purgeTime-=Math.floor(this._purgeTime),this._purgeFrame+=1,this._purgeFrame>=5&&this.autoPurgeResources&&this.motherLode.PurgeInactive(this._purgeFrame,this._purgeFrameLimit,this.purgeTime)),!0}},{key:"GetResource",value:function t(r){var n=void 0;if(r=e.NormalizePath(r),n=this.motherLode.Find(r))return n.IsPurged()&&n.Reload(),n;var o=e.GetPathExt(r);if(null===o)return i.logger.log("res.error",{log:"error",src:["Tw2ResMan","ReloadResource"],msg:"Undefined extension",type:"extension.undefined",path:r}),null;var s=a.store.GetExtension(o);return s?((n=new s).path=r,e.LoadResource(this,n)):(i.logger.log("res.error",{log:"error",src:["Tw2ResMan","ReloadResource"],msg:"Unregistered extension",type:"extension.unregistered",path:r,value:o}),null)}},{key:"GetObject",value:function t(r,n){var i={};r=e.NormalizePath(r);var a=this.motherLode.Find(r);if(a){a.AddObject(i,n);return}(a=new s.Tw2LoadingObject).path=r,a.AddObject(i,n),e.LoadResource(this,a)}},{key:"ReloadResource",value:function t(r){var n=r.path,a=this.motherLode.Find(n);return a&&!a.IsPurged()?a:(i.logger.log("res.event",{msg:"Reloading ",path:n,type:"reload"}),e.LoadResource(this,r))}}],[{key:"BuildUrl",value:function e(t){var r=t.indexOf(":/");if(-1===r)return i.logger.log("res.error",{log:"warn",src:["Tw2ResMan","BuildUrl"],msg:"Invalid path",type:"prefix.undefined",path:t}),t;var n=t.substr(0,r),o=a.store.GetPath(n);return o?o+t.substr(r+2):(i.logger.log("res.error",{log:"warn",src:["Tw2ResMan","BuildUrl"],msg:"Unregistered path",path:t,type:"prefix.unregistered",value:n}),t)}},{key:"NormalizePath",value:function e(t){return"str:/"===t.substr(0,5)||(t=t.toLowerCase()).replace("\\","/"),t}},{key:"GetPathExt",value:function e(t){if("str:/"===t.substr(0,5)){var r=t.indexOf("/",5);return -1===r?null:t.substr(5,r-5)}var n=t.lastIndexOf(".");return -1===n?null:t.substr(n+1)}},{key:"LogPathString",value:function e(t){return"str:/"===t.substr(0,5)&&t.length>64?t.substr(0,64)+"...":t}},{key:"LoadResource",value:function t(r,n){var a=n.path,o=e.BuildUrl(a);if(n._isPurged=!1,r.motherLode.Add(a,n),n.DoCustomLoad&&n.DoCustomLoad(o))return n;var s=e.CreateHttpRequest(n.requestResponseType);if(s){i.logger.log("res.event",{msg:"Requesting",path:a,type:"request"}),s.onreadystatechange=e.DoLoadResource(r,n),s.open("GET",o),n.LoadStarted();try{s.send(),r._pendingLoads++}catch(u){i.logger.log("res.error",{log:"error",src:["Tw2ResMan","LoadResource"],msg:"Error sending object HTTP request",path:a,type:"http.request",err:u})}}return n}},{key:"DoLoadResource",value:function e(t,r){return function(){var e=0;try{e=this.readyState}catch(n){i.logger.log("res.error",{log:"error",src:["Tw2ResMan","_DoLoadResource"],msg:"Communication error loading",path:r.path,type:"http.readystate",value:e}),r.LoadFinished(!1),t._pendingLoads--;return}if(4===e){if(200===this.status){var a=null,o=null;try{a=this.responseText,o=this.responseXML}catch(s){a=this.response}r.LoadFinished(!0),t._prepareQueue.push([r,a,o])}else i.logger.log("res.error",{log:"error",src:["Tw2ResMan","_DoLoadResource"],msg:"Communication error loading",path:r.path,type:"http.status",value:this.status}),r.LoadFinished(!1),r.PrepareFinished(!1);t._pendingLoads--}}}},{key:"CreateHttpRequest",value:function e(t){var r=null;if(window.XMLHttpRequest)r=new XMLHttpRequest;else if(window.ActiveXObject)try{r=new window.ActiveXObject("Msxml2.XMLHTTP")}catch(n){try{r=new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}}return r?t&&(r.responseType=t):i.logger.log("res.error",{log:"error",src:["Tw2LoadingObject","Prepare"],msg:"Could not create an XMLHTTP instance",type:"http.instance"}),r}}]),e}();t.resMan=new u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VectorParameter=t.Tw2Parameter=void 0;var n=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var s=t.Tw2Parameter=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";o(this,e),this._id=a.util.generateID(),this.name=t,this._onModified=[]}return i(e,[{key:"OnValueChanged",value:function e(t,r){for(var n=0;n<this._onModified.length;n++)this._onModified[n](this,t,r)}},{key:"AddCallback",value:function e(t){return this._onModified.includes(t)||this._onModified.push(t),!0}},{key:"RemoveCallback",value:function e(t){var r=this._onModified.indexOf(t);-1!==r&&this._onModified.splice(r,1)}},{key:"GetValue",value:function e(t){return null}},{key:"Bind",value:function e(t,r,n){return!1}},{key:"UnBind",value:function e(){}},{key:"Apply",value:function e(t,r,n){}},{key:"Copy",value:function e(t){}},{key:"Clone",value:function e(){var t=new this.constructor;return t.Copy(this,!0),t}},{key:"size",get:function e(){return this.constructor.constantBufferSize}}]),e}();s.constantBufferSize=0,t.Tw2VectorParameter=function(e){function t(e,r){o(this,t);var n=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.value=new Float32Array(n.size),n.constantBuffer=null,n.offset=null,r&&n.value.set(r),n}return function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"SetValue",value:function e(t){this.value.set(t),this.OnValueChanged()}},{key:"SetIndexValue",value:function e(t,r){if(void 0!==this.value[t]){this.value[t]!==r&&(this.value[t]=r,this.OnValueChanged());return}throw Error("Index Error")}},{key:"GetValue",value:function e(t){var r=this.constantBuffer?this.constantBuffer.subarray(this.offset,this.offset+this.size):this.value;return t?Array.from(r):new Float32Array(r)}},{key:"GetIndexValue",value:function e(t){if(void 0!==this.value[t])return this.value[t];throw Error("Index Error")}},{key:"OnValueChanged",value:function e(r,i){this.constantBuffer&&this.Apply(this.constantBuffer,this.offset),n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"OnValueChanged",this).call(this,r,i)}},{key:"Bind",value:function e(t,r,n){return!this.constantBuffer&&n>=this.size&&(this.constantBuffer=t,this.offset=r,this.Apply(t,r,n),!0)}},{key:"Unbind",value:function e(){this.constantBuffer=null}},{key:"Apply",value:function e(t,r,n){t.set(this.value,r)}},{key:"EqualsValue",value:function e(t){for(var r=0;r<this.size;r++)if(this.value[r]!==t[r])return!1;return!0}},{key:"Copy",value:function e(t,r){r&&(this.name=t.name),this.SetValue(t.GetValue())}}],[{key:"is",value:function e(t){return a.util.isArrayLike(t)&&t.length===this.constantBufferSize}}]),t}(s)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2CurveSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(19),a=t.Tw2CurveSequencer=function(e){function t(){return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,null,[{key:"Sort",value:function e(t){var r=t.functions;if(r&&r.length)for(var n=0;n<r.length;n++)r[n]&&"Sort"in r[n]&&r[n].Sort()}},{key:"Sort2",value:function e(t){var r=t.constructor.childProperties;if(r)for(var n=0;n<r.length;n++){var i=t[r[n]];i&&"Sort"in i&&i.Sort()}}}]),t}(i.Tw2Curve);a.childProperties=null,a.childArray=null,a.Operator=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(80);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(43);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveObjectSet=t.EveObjectSetItem=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}t.EveObjectSetItem=function(){function e(){a(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this._rebuildPending=!0,this._onModified=null}return n(e,[{key:"OnValueChanged",value:function e(){this._rebuildPending=!0,this._onModified&&this._onModified(this)}}]),e}();var o=t.EveObjectSet=function(){function e(){var t=this;a(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.items=[],this._visibleItems=[],this._rebuildPending=!1,this._onChildModified=function(e){return t.OnValueChanged(e)}}return n(e,[{key:"Initialize",value:function e(){this.Rebuild()}},{key:"OnValueChanged",value:function e(){this._rebuildPending=!0}},{key:"CreateItem",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=this.constructor.Item;if(r&&"create"in r){var n=r.create(t);return this.AddItem(n),n}return null}},{key:"AddItem",value:function e(t){this.items.includes(t)||(t._onModified=this._onChildModified,this.items.push(t),this.OnValueChanged())}},{key:"RemoveItem",value:function e(t){var r=this.items.indexOf(t);-1!==r&&(t._onModified=null,this.items.splice(r,1),this.OnValueChanged())}},{key:"ClearItems",value:function e(){for(var t=0;t<this.items.length;t++)this.items[t]._onModified=null;this.items=[],this.OnValueChanged()}},{key:"FindItemByID",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==t){for(var r=0;r<this.items.length;r++)if(this.items[r]._id===t)return this.items[r]}return null}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t}},{key:"Update",value:function e(t){this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function e(){}},{key:"Rebuild",value:function e(){this.constructor.RebuildItems(this),this._rebuildPending=!1}},{key:"GetBatches",value:function e(t,r,n){}},{key:"Render",value:function e(){}}],[{key:"RebuildItems",value:function e(t){t._visibleItems=[];for(var r=0;r<t.items.length;r++){var n=t.items[r];n._onModified=t._onChildModified,n.display&&(t._visibleItems.push(n),n._rebuildPending=!1)}}}]),e}();o.Item=null,o.global={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec3_2:i.vec3.create(),vec4_0:i.vec4.create(),vec4_1:i.vec4.create(),mat4_0:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(5),i=r(67),a=r(68),o=r(31),s=r(69),u=r(70),l=r(71),c=r(32),f=r(33);r.d(t,"glMatrix",function(){return n}),r.d(t,"mat2",function(){return i}),r.d(t,"mat2d",function(){return a}),r.d(t,"mat3",function(){return o}),r.d(t,"mat4",function(){return s}),r.d(t,"quat",function(){return u}),r.d(t,"vec2",function(){return l}),r.d(t,"vec3",function(){return c}),r.d(t,"vec4",function(){return f})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Resource=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(6),a=t.Tw2Resource=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.path="",this._isLoading=!1,this._isGood=!1,this._isPurged=!1,this._notifications=[],this.activeFrame=0,this.doNotPurge=0}return n(e,[{key:"IsLoading",value:function e(){return this.KeepAlive(),this._isLoading}},{key:"IsGood",value:function e(){return this.KeepAlive(),this._isGood}},{key:"IsPurged",value:function e(){return this._isPurged}},{key:"LoadStarted",value:function e(){this._isLoading=!0,this.UpdateNotifications("ReleaseCachedData")}},{key:"LoadFinished",value:function e(t){this._isLoading=!1,t||(this._isGood=!1)}},{key:"PrepareFinished",value:function e(t){this._isLoading=!1,this._isGood=t,this.UpdateNotifications("RebuildCachedData")}},{key:"SetIsGood",value:function e(t){this._isGood=t}},{key:"Unload",value:function e(){}},{key:"Reload",value:function e(){this.Unload(),i.resMan.ReloadResource(this)}},{key:"KeepAlive",value:function e(){this.activeFrame=i.resMan.activeFrame,this._isPurged&&this.Reload()}},{key:"RegisterNotification",value:function e(t){!this._notifications.includes(t)&&(this._notifications.push(t),this._isGood&&"RebuildCachedData"in t&&t.RebuildCachedData(this))}},{key:"UnregisterNotification",value:function e(t){this._notifications.splice(this._notifications.indexOf(t),1)}},{key:"UpdateNotifications",value:function e(t){for(var r=0;r<this._notifications.length;r++)t in this._notifications[r]&&this._notifications[r][t](this)}}]),e}();a.prototype.DoCustomLoad=null,a.prototype.requestResponseType=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.Tw2ParticleForce=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name=""}return n(e,[{key:"ApplyForce",value:function e(t,r,n,i,a){}},{key:"Update",value:function e(t){}}]),e}()).global={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec4_0:i.vec4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChild=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.EveChild=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.useSRT=!0,this.lowestLodVisible=2,this.staticTransform=!1,this.rotation=i.quat.create(),this.translation=i.vec3.create(),this.scaling=i.vec3.fromValues(1,1,1),this.localTransform=i.mat4.create(),this.worldTransform=i.mat4.create(),this.worldTransformLast=i.mat4.create(),this._perObjectData=null,this.isEffectChild=!0}return n(e,[{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t}},{key:"Update",value:function e(t,r){this.useSRT&&(i.quat.normalize(this.rotation,this.rotation),i.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling)),i.mat4.copy(this.worldTransformLast,this.worldTransform),i.mat4.multiply(this.worldTransform,r,this.localTransform)}},{key:"GetBatches",value:function e(t,r){}}]),e}()).global={mat4_0:i.mat4.create(),vec3_0:i.vec3.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveObject=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.EveObject=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0}return n(e,[{key:"Initialize",value:function e(){}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t}},{key:"Update",value:function e(t){}},{key:"GetBatches",value:function e(t,r){}}]),e}()).global={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec3_2:i.vec3.create(),vec3_3:i.vec3.create(),vec3_4:i.vec3.create(),vec3_5:i.vec3.create(),vec3_6:i.vec3.create(),vec3_7:i.vec3.create(),mat4_0:i.mat4.create(),mat4_1:i.mat4.create(),mat4_2:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.store=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(4),o=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._types={},this._paths={},this._variables={},this._extensions={},this._constructors={},this._dynamicPaths={},this._missing={}}return n(e,[{key:"HasPath",value:function e(t){return t&&t in this._paths}},{key:"GetPath",value:function t(r){return e.GetStoreItem(this,"paths",r)}},{key:"RegisterPath",value:function t(r,n){return!!e.SetStoreItem(this,"paths",r,n)}},{key:"RegisterPaths",value:function t(r){return e.RegisterFromObject(this,"RegisterPath",r)}},{key:"HasDynamicPath",value:function e(t){return t&&t in this._dynamicPaths}},{key:"GetDynamicPath",value:function t(r){return e.GetStoreItem(this,"dynamicPaths",r)}},{key:"RegisterDynamicPath",value:function t(r,n){return!!e.SetStoreItem(this,"dynamicPaths",r,n)}},{key:"RegisterDynamicPaths",value:function t(r){return e.RegisterFromObject(this,"RegisterDynamicPath",r)}},{key:"HasExtension",value:function e(t){return t&&t in this._extensions}},{key:"GetExtension",value:function t(r){return e.GetStoreItem(this,"extensions",r)}},{key:"RegisterExtension",value:function t(r,n){return"function"==typeof n&&!!e.SetStoreItem(this,"extensions",r,n)}},{key:"RegisterExtensions",value:function t(r){return e.RegisterFromObject(this,"RegisterExtension",r)}},{key:"HasConstructor",value:function e(t){return t&&t in this._constructors}},{key:"GetConstructor",value:function t(r){return e.GetStoreItem(this,"constructors",r)}},{key:"RegisterConstructor",value:function t(r,n){return"function"==typeof n&&!!e.SetStoreItem(this,"constructors",r,n)}},{key:"RegisterConstructors",value:function t(r){return e.RegisterFromObject(this,"RegisterConstructor",r)}},{key:"HasVariable",value:function e(t){return t&&t in this._variables}},{key:"GetVariable",value:function t(r){return e.GetStoreItem(this,"variables",r)}},{key:"GetVariableValue",value:function e(t,r){var n=this.GetVariable(t);return n&&n.GetValue?n.GetValue(r):null}},{key:"SetVariableValue",value:function e(t,r){var n=this.GetVariable(t);return n&&n.SetValue?(n.SetValue(r),!0):null}},{key:"RegisterVariable",value:function t(r,n,i){var a=this.CreateType(r,n,i);return e.SetStoreItem(this,"variables",r,a)}},{key:"RegisterVariables",value:function t(r){return e.RegisterFromObject(this,"RegisterVariable",r)}},{key:"GetType",value:function t(r){return e.GetStoreItem(this,"types",r)}},{key:"HasType",value:function e(t){return t&&t in this._types}},{key:"GetTypeByValue",value:function e(t){for(var r in this._types)if(this._types.hasOwnProperty(r)&&"is"in this._types[r]&&this._types[r].is(t))return this._types[r];return null}},{key:"CreateType",value:function e(t,r,n){return(r&&"Object"===r.constructor.name&&(n=r.Type||r.type,r=r.value),n?"string"==typeof n&&(n=this.GetType(n)):n=this.GetTypeByValue(r),"function"==typeof n)?new n(t,r):null}},{key:"RegisterType",value:function t(r,n){return"function"==typeof n&&!!e.SetStoreItem(this,"types",r,n)}},{key:"RegisterTypes",value:function t(r){return e.RegisterFromObject(this,"RegisterType",r)}},{key:"Register",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"uuid"in t&&i.util.enableUUID(t.uuid),this.RegisterPaths(t.paths),this.RegisterDynamicPaths(t.dynamicPaths),this.RegisterTypes(t.types),this.RegisterConstructors(t.constructors),this.RegisterExtensions(t.extensions),this.RegisterVariables(t.variables)}}],[{key:"GetStoreItem",value:function e(t,r,n){if("string"==typeof n){var i=t["_"+r],o=r.substring(0,r.length-1);if(i){if(n in i)return i[n];t._missing[r]||(t._missing[r]=[]),t._missing[r].includes(n)||(t._missing[r].push(n),a.logger.log("store.warning",{log:"warning",msg:"Missing "+o+": '"+n+"'"}))}}return null}},{key:"SetStoreItem",value:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=arguments[3];if("string"==typeof n&&void 0!==i){var o=t["_"+r];if(o){var s=o[n],u=r.substring(0,r.length-1);return o[n]=i,s?a.logger.log("store.registered",{log:"debug",msg:"Re-registered "+u+": '"+n+"'",data:{old_value:s,new_value:i}}):a.logger.log("store.registered",{log:"debug",msg:"Registered "+u+": '"+n+"'",hide:!0}),i}}return!1}},{key:"RegisterFromObject",value:function e(t,r,n){if(n&&r in t){n=Array.isArray(n)?n:[n];for(var i=0;i<n.length;i++)for(var a in n[i])n[i].hasOwnProperty(a)&&t[r](a,n[i][a]);return!0}return!1}}]),e}();t.store=new o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(6);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(16);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(4);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleElementDeclaration=t.Tw2ParticleElement=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1);function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}t.Tw2ParticleElement=function e(t){a(this,e),this.elementType=t.elementType,this.customName=t.customName,this.dimension=t.GetDimension(),this.usageIndex=t.usageIndex,this.usedByGPU=t.usedByGPU,this.buffer=null,this.startOffset=0,this.offset=0,this.instanceStride=0,this.vertexStride=0,this.dirty=!1},(t.Tw2ParticleElementDeclaration=function(){function e(){a(this,e),this.elementType=4,this.customName="",this.dimension=1,this.usageIndex=0,this.usedByGPU=!0}return n(e,[{key:"GetDimension",value:function t(){switch(this.elementType){case e.Type.LIFETIME:return 2;case e.Type.POSITION:case e.Type.VELOCITY:return 3;case e.Type.MASS:return 1}return this.dimension}},{key:"GetDeclaration",value:function t(){var r=void 0;switch(this.elementType){case e.Type.LIFETIME:r=i.Tw2VertexDeclaration.Type.TANGENT;break;case e.Type.POSITION:r=i.Tw2VertexDeclaration.Type.POSITION;break;case e.Type.VELOCITY:r=i.Tw2VertexDeclaration.Type.NORMAL;break;case e.Type.MASS:r=i.Tw2VertexDeclaration.Type.BINORMAL;break;default:r=i.Tw2VertexDeclaration.Type.TEXCOORD}return new i.Tw2VertexElement(r,this.usageIndex,i.device.gl.FLOAT,this.GetDimension())}}]),e}()).Type={LIFETIME:0,POSITION:1,VELOCITY:2,MASS:3,CUSTOM:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(141);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(142);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(143);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(144);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(145);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})});var l=r(146);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return l[e]}})});var c=r(147);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return c[e]}})});var f=r(148);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return f[e]}})});var h=r(149);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return h[e]}})});var p=r(150);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return p[e]}})});var d=r(151);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return d[e]}})});var v=r(152);Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return v[e]}})});var $=r(153);Object.keys($).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return $[e]}})});var m=r(154);Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return m[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(65);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(83);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(23);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(84);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(22);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(85);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(42);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(79);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RenderBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(17);t.Tw2RenderBatch=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.renderMode=i.device.RM_ANY,this.perObjectData=null}return n(e,[{key:"Commit",value:function e(t){}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(22);t.Tw2GeometryBatch=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.geometryRes=null,e.meshIx=0,e.start=0,e.count=1,e.effect=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Commit",value:function e(t){this.geometryRes&&this.effect&&this.geometryRes.RenderAreas(this.meshIx,this.start,this.count,this.effect,t)}}]),t}(i.Tw2RenderBatch)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(7);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(89);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(90);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(91);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(92);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(93);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})});var l=r(94);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return l[e]}})});var c=r(95);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return c[e]}})});var f=r(41);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return f[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RawData=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0);t.Tw2RawData=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.nextOffset=0,this.data=null,this.elements={},t&&this.DeclareFromObject(t)}return i(e,[{key:"Set",value:function e(t,r){var n=this.elements[t];this.data.set(r.length>n.size?r.subarray(0,n.size):r,n.offset)}},{key:"Get",value:function e(t){return this.elements[t].array}},{key:"GetData",value:function e(t){return this.data.subarray(this.elements[t].offset,this.elements[t].offset+this.elements[t].array.length)}},{key:"Create",value:function e(){for(var t in this.data=new Float32Array(this.nextOffset),this.elements)if(this.elements.hasOwnProperty(t)){var r=this.elements[t];if(r.array=this.data.subarray(r.offset,r.offset+r.size),null!==r.value){if(1===r.size)r.array[0]=r.value;else for(var n=0;n<r.size;n++)r.array[n]=r.value[n];r.value=null}}}},{key:"Declare",value:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.elements[t]={offset:this.nextOffset,size:r,array:null,value:n},this.nextOffset+=r}},{key:"DeclareFromObject",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];if("number"==typeof i)this.Declare(r,1,i);else if(a.util.isArrayLike(i))1===i.length&&this.Declare(r,i.length,i);else throw Error("Invalid declaration type: "+(void 0===i?"undefined":n(i)))}this.Create()}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleEmitter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);t.Tw2ParticleEmitter=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.particleSystem=null}return n(e,[{key:"Initialize",value:function e(){}},{key:"Update",value:function e(t){}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleAttributeGenerator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.Tw2ParticleAttributeGenerator=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name=""}return n(e,[{key:"Bind",value:function e(t){return!1}},{key:"Generate",value:function e(t,r,n){}}]),e}()).global={vec3_0:i.vec3.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(133);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(135);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(37);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(12);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(51);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(136);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(39);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(38);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.num={};n.biCumulative=function(e,t){if(1===t){var r=1-e;return 1-r*r*r}return 2===t?3*e*e-2*e*e*e:e*e*e},n.exponentialDecay=function(e,t,r,n,i){return t*i/n+r*(e*n-t)/(n*n)*(1-Math.pow(Math.E,-n*i/r))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function e(){let t=new n.ARRAY_TYPE(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromMat4=function e(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[4],t[4]=r[5],t[5]=r[6],t[6]=r[8],t[7]=r[9],t[8]=r[10],t},t.clone=function e(t){let r=new n.ARRAY_TYPE(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},t.copy=function e(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},t.fromValues=function e(t,r,i,a,o,s,u,l,c){let f=new n.ARRAY_TYPE(9);return f[0]=t,f[1]=r,f[2]=i,f[3]=a,f[4]=o,f[5]=s,f[6]=u,f[7]=l,f[8]=c,f},t.set=function e(t,r,n,i,a,o,s,u,l,c){return t[0]=r,t[1]=n,t[2]=i,t[3]=a,t[4]=o,t[5]=s,t[6]=u,t[7]=l,t[8]=c,t},t.identity=function e(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.transpose=function e(t,r){if(t===r){let n=r[1],i=r[2],a=r[5];t[1]=r[3],t[2]=r[6],t[3]=n,t[5]=r[7],t[6]=i,t[7]=a}else t[0]=r[0],t[1]=r[3],t[2]=r[6],t[3]=r[1],t[4]=r[4],t[5]=r[7],t[6]=r[2],t[7]=r[5],t[8]=r[8];return t},t.invert=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],c=r[7],f=r[8],h=f*s-u*c,p=-f*o+u*l,d=c*o-s*l,v=n*h+i*p+a*d;return v?(v=1/v,t[0]=h*v,t[1]=(-f*i+a*c)*v,t[2]=(u*i-a*s)*v,t[3]=p*v,t[4]=(f*n-a*l)*v,t[5]=(-u*n+a*o)*v,t[6]=d*v,t[7]=(-c*n+i*l)*v,t[8]=(s*n-i*o)*v,t):null},t.adjoint=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],c=r[7],f=r[8];return t[0]=s*f-u*c,t[1]=a*c-i*f,t[2]=i*u-a*s,t[3]=u*l-o*f,t[4]=n*f-a*l,t[5]=a*o-n*u,t[6]=o*c-s*l,t[7]=i*l-n*c,t[8]=n*s-i*o,t},t.determinant=function e(t){let r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8];return r*(c*o-s*l)+n*(-c*a+s*u)+i*(l*a-o*u)},t.multiply=i,t.translate=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=r[6],f=r[7],h=r[8],p=n[0],d=n[1];return t[0]=i,t[1]=a,t[2]=o,t[3]=s,t[4]=u,t[5]=l,t[6]=p*i+d*s+c,t[7]=p*a+d*u+f,t[8]=p*o+d*l+h,t},t.rotate=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=r[6],f=r[7],h=r[8],p=Math.sin(n),d=Math.cos(n);return t[0]=d*i+p*s,t[1]=d*a+p*u,t[2]=d*o+p*l,t[3]=d*s-p*i,t[4]=d*u-p*a,t[5]=d*l-p*o,t[6]=c,t[7]=f,t[8]=h,t},t.scale=function e(t,r,n){let i=n[0],a=n[1];return t[0]=i*r[0],t[1]=i*r[1],t[2]=i*r[2],t[3]=a*r[3],t[4]=a*r[4],t[5]=a*r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t},t.fromTranslation=function e(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=r[0],t[7]=r[1],t[8]=1,t},t.fromRotation=function e(t,r){let n=Math.sin(r),i=Math.cos(r);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromScaling=function e(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=0,t[4]=r[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromMat2d=function e(t,r){return t[0]=r[0],t[1]=r[1],t[2]=0,t[3]=r[2],t[4]=r[3],t[5]=0,t[6]=r[4],t[7]=r[5],t[8]=1,t},t.fromQuat=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=n+n,u=i+i,l=a+a,c=n*s,f=i*s,h=i*u,p=a*s,d=a*u,v=a*l,$=o*s,m=o*u,y=o*l;return t[0]=1-h-v,t[3]=f-y,t[6]=p+m,t[1]=f+y,t[4]=1-c-v,t[7]=d-$,t[2]=p-m,t[5]=d+$,t[8]=1-c-h,t},t.normalFromMat4=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],c=r[7],f=r[8],h=r[9],p=r[10],d=r[11],v=r[12],$=r[13],m=r[14],y=r[15],g=n*u-i*s,_=n*l-a*s,b=n*c-o*s,E=i*l-a*u,T=i*c-o*u,S=a*c-o*l,R=f*$-h*v,w=f*m-p*v,P=f*y-d*v,A=h*m-p*$,D=h*y-d*$,O=p*y-d*m,C=g*O-_*D+b*A+E*P-T*w+S*R;return C?(C=1/C,t[0]=(u*O-l*D+c*A)*C,t[1]=(l*P-s*O-c*w)*C,t[2]=(s*D-u*P+c*R)*C,t[3]=(a*D-i*O-o*A)*C,t[4]=(n*O-a*P+o*w)*C,t[5]=(i*P-n*D-o*R)*C,t[6]=($*S-m*T+y*E)*C,t[7]=(m*b-v*S-y*_)*C,t[8]=(v*T-$*b+y*g)*C,t):null},t.projection=function e(t,r,n){return t[0]=2/r,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},t.str=function e(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},t.frob=function e(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2))},t.add=function e(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t[4]=r[4]+n[4],t[5]=r[5]+n[5],t[6]=r[6]+n[6],t[7]=r[7]+n[7],t[8]=r[8]+n[8],t},t.subtract=a,t.multiplyScalar=function e(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=r[7]*n,t[8]=r[8]*n,t},t.multiplyScalarAndAdd=function e(t,r,n,i){return t[0]=r[0]+n[0]*i,t[1]=r[1]+n[1]*i,t[2]=r[2]+n[2]*i,t[3]=r[3]+n[3]*i,t[4]=r[4]+n[4]*i,t[5]=r[5]+n[5]*i,t[6]=r[6]+n[6]*i,t[7]=r[7]+n[7]*i,t[8]=r[8]+n[8]*i,t},t.exactEquals=function e(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]},t.equals=function e(t,r){let i=t[0],a=t[1],o=t[2],s=t[3],u=t[4],l=t[5],c=t[6],f=t[7],h=t[8],p=r[0],d=r[1],v=r[2],$=r[3],m=r[4],y=r[5],g=r[6],_=r[7],b=r[8];return Math.abs(i-p)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-d)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-v)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(s-$)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs($))&&Math.abs(u-m)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(l-y)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(c-g)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(f-_)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(_))&&Math.abs(h-b)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))};var n=r(5);function i(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=r[0],p=r[1],d=r[2],v=r[3],$=r[4],m=r[5],y=r[6],g=r[7],_=r[8];return e[0]=h*n+p*o+d*l,e[1]=h*i+p*s+d*c,e[2]=h*a+p*u+d*f,e[3]=v*n+$*o+m*l,e[4]=v*i+$*s+m*c,e[5]=v*a+$*u+m*f,e[6]=y*n+g*o+_*l,e[7]=y*i+g*s+_*c,e[8]=y*a+g*u+_*f,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e}t.mul=i,t.sub=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function e(t){var r=new n.ARRAY_TYPE(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},t.length=a,t.fromValues=o,t.copy=function e(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t},t.set=function e(t,r,n,i){return t[0]=r,t[1]=n,t[2]=i,t},t.add=function e(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t},t.subtract=s,t.multiply=u,t.divide=l,t.ceil=function e(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t[2]=Math.ceil(r[2]),t},t.floor=function e(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t[2]=Math.floor(r[2]),t},t.min=function e(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t},t.max=function e(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t},t.round=function e(t,r){return t[0]=Math.round(r[0]),t[1]=Math.round(r[1]),t[2]=Math.round(r[2]),t},t.scale=function e(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t},t.scaleAndAdd=function e(t,r,n,i){return t[0]=r[0]+n[0]*i,t[1]=r[1]+n[1]*i,t[2]=r[2]+n[2]*i,t},t.distance=c,t.squaredDistance=f,t.squaredLength=h,t.negate=function e(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t},t.inverse=function e(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t},t.normalize=p,t.dot=d,t.cross=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=n[0],u=n[1],l=n[2];return t[0]=a*l-o*u,t[1]=o*s-i*l,t[2]=i*u-a*s,t},t.lerp=function e(t,r,n,i){let a=r[0],o=r[1],s=r[2];return t[0]=a+i*(n[0]-a),t[1]=o+i*(n[1]-o),t[2]=s+i*(n[2]-s),t},t.hermite=function e(t,r,n,i,a,o){let s=o*o,u=s*(2*o-3)+1,l=s*(o-2)+o,c=s*(o-1),f=s*(3-2*o);return t[0]=r[0]*u+n[0]*l+i[0]*c+a[0]*f,t[1]=r[1]*u+n[1]*l+i[1]*c+a[1]*f,t[2]=r[2]*u+n[2]*l+i[2]*c+a[2]*f,t},t.bezier=function e(t,r,n,i,a,o){let s=1-o,u=s*s,l=o*o,c=u*s,f=3*o*u,h=3*l*s,p=l*o;return t[0]=r[0]*c+n[0]*f+i[0]*h+a[0]*p,t[1]=r[1]*c+n[1]*f+i[1]*h+a[1]*p,t[2]=r[2]*c+n[2]*f+i[2]*h+a[2]*p,t},t.random=function e(t,r){r=r||1;let i=2*n.RANDOM()*Math.PI,a=2*n.RANDOM()-1,o=Math.sqrt(1-a*a)*r;return t[0]=Math.cos(i)*o,t[1]=Math.sin(i)*o,t[2]=a*r,t},t.transformMat4=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=n[3]*i+n[7]*a+n[11]*o+n[15];return s=s||1,t[0]=(n[0]*i+n[4]*a+n[8]*o+n[12])/s,t[1]=(n[1]*i+n[5]*a+n[9]*o+n[13])/s,t[2]=(n[2]*i+n[6]*a+n[10]*o+n[14])/s,t},t.transformMat3=function e(t,r,n){let i=r[0],a=r[1],o=r[2];return t[0]=i*n[0]+a*n[3]+o*n[6],t[1]=i*n[1]+a*n[4]+o*n[7],t[2]=i*n[2]+a*n[5]+o*n[8],t},t.transformQuat=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=n[0],u=n[1],l=n[2],c=n[3],f=c*i+u*o-l*a,h=c*a+l*i-s*o,p=c*o+s*a-u*i,d=-s*i-u*a-l*o;return t[0]=f*c+-(d*s)+-(h*l)- -(p*u),t[1]=h*c+-(d*u)+-(p*s)- -(f*l),t[2]=p*c+-(d*l)+-(f*u)- -(h*s),t},t.rotateX=function e(t,r,n,i){let a=[],o=[];return a[0]=r[0]-n[0],a[1]=r[1]-n[1],a[2]=r[2]-n[2],o[0]=a[0],o[1]=a[1]*Math.cos(i)-a[2]*Math.sin(i),o[2]=a[1]*Math.sin(i)+a[2]*Math.cos(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},t.rotateY=function e(t,r,n,i){let a=[],o=[];return a[0]=r[0]-n[0],a[1]=r[1]-n[1],a[2]=r[2]-n[2],o[0]=a[2]*Math.sin(i)+a[0]*Math.cos(i),o[1]=a[1],o[2]=a[2]*Math.cos(i)-a[0]*Math.sin(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},t.rotateZ=function e(t,r,n,i){let a=[],o=[];return a[0]=r[0]-n[0],a[1]=r[1]-n[1],a[2]=r[2]-n[2],o[0]=a[0]*Math.cos(i)-a[1]*Math.sin(i),o[1]=a[0]*Math.sin(i)+a[1]*Math.cos(i),o[2]=a[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},t.angle=function e(t,r){let n=o(t[0],t[1],t[2]),i=o(r[0],r[1],r[2]);p(n,n),p(i,i);let a=d(n,i);return a>1?0:a<-1?Math.PI:Math.acos(a)},t.str=function e(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},t.exactEquals=function e(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]},t.equals=function e(t,r){let i=t[0],a=t[1],o=t[2],s=r[0],u=r[1],l=r[2];return Math.abs(i-s)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-u)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(u))&&Math.abs(o-l)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(l))};var n=r(5);function i(){let e=new n.ARRAY_TYPE(3);return e[0]=0,e[1]=0,e[2]=0,e}function a(e){let t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function o(e,t,r){let i=new n.ARRAY_TYPE(3);return i[0]=e,i[1]=t,i[2]=r,i}function s(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function u(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function l(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e}function c(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function f(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function h(e){let t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function p(e,t){let r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function d(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}t.sub=s,t.mul=u,t.div=l,t.dist=c,t.sqrDist=f,t.len=a,t.sqrLen=h;let v,$=(v=i(),function(e,t,r,n,i,a){let o,s;for(t||(t=3),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)v[0]=e[o],v[1]=e[o+1],v[2]=e[o+2],i(v,v,a),e[o]=v[0],e[o+1]=v[1],e[o+2]=v[2];return e});t.forEach=$},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function e(t){let r=new n.ARRAY_TYPE(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},t.fromValues=function e(t,r,i,a){let o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=r,o[2]=i,o[3]=a,o},t.copy=function e(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},t.set=function e(t,r,n,i,a){return t[0]=r,t[1]=n,t[2]=i,t[3]=a,t},t.add=function e(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t},t.subtract=a,t.multiply=o,t.divide=s,t.ceil=function e(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t[2]=Math.ceil(r[2]),t[3]=Math.ceil(r[3]),t},t.floor=function e(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t[2]=Math.floor(r[2]),t[3]=Math.floor(r[3]),t},t.min=function e(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t[2]=Math.min(r[2],n[2]),t[3]=Math.min(r[3],n[3]),t},t.max=function e(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t[2]=Math.max(r[2],n[2]),t[3]=Math.max(r[3],n[3]),t},t.round=function e(t,r){return t[0]=Math.round(r[0]),t[1]=Math.round(r[1]),t[2]=Math.round(r[2]),t[3]=Math.round(r[3]),t},t.scale=u,t.scaleAndAdd=function e(t,r,n,i){return t[0]=r[0]+n[0]*i,t[1]=r[1]+n[1]*i,t[2]=r[2]+n[2]*i,t[3]=r[3]+n[3]*i,t},t.distance=l,t.squaredDistance=c,t.length=f,t.squaredLength=h,t.negate=function e(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t},t.inverse=function e(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t[3]=1/r[3],t},t.normalize=p,t.dot=function e(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]},t.lerp=function e(t,r,n,i){let a=r[0],o=r[1],s=r[2],u=r[3];return t[0]=a+i*(n[0]-a),t[1]=o+i*(n[1]-o),t[2]=s+i*(n[2]-s),t[3]=u+i*(n[3]-u),t},t.random=function e(t,r){return r=r||1,t[0]=n.RANDOM(),t[1]=n.RANDOM(),t[2]=n.RANDOM(),t[3]=n.RANDOM(),p(t,t),u(t,t,r),t},t.transformMat4=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=r[3];return t[0]=n[0]*i+n[4]*a+n[8]*o+n[12]*s,t[1]=n[1]*i+n[5]*a+n[9]*o+n[13]*s,t[2]=n[2]*i+n[6]*a+n[10]*o+n[14]*s,t[3]=n[3]*i+n[7]*a+n[11]*o+n[15]*s,t},t.transformQuat=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=n[0],u=n[1],l=n[2],c=n[3],f=c*i+u*o-l*a,h=c*a+l*i-s*o,p=c*o+s*a-u*i,d=-s*i-u*a-l*o;return t[0]=f*c+-(d*s)+-(h*l)- -(p*u),t[1]=h*c+-(d*u)+-(p*s)- -(f*l),t[2]=p*c+-(d*l)+-(f*u)- -(h*s),t[3]=r[3],t},t.str=function e(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t.exactEquals=function e(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]},t.equals=function e(t,r){let i=t[0],a=t[1],o=t[2],s=t[3],u=r[0],l=r[1],c=r[2],f=r[3];return Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-f)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))};var n=r(5);function i(){let e=new n.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}function o(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e[3]=t[3]*r[3],e}function s(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e[3]=t[3]/r[3],e}function u(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function l(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(r*r+n*n+i*i+a*a)}function c(e,t){let r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2],a=t[3]-e[3];return r*r+n*n+i*i+a*a}function f(e){let t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)}function h(e){let t=e[0],r=e[1],n=e[2],i=e[3];return t*t+r*r+n*n+i*i}function p(e,t){let r=t[0],n=t[1],i=t[2],a=t[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=a*o),e}t.sub=a,t.mul=o,t.div=s,t.dist=l,t.sqrDist=c,t.len=f,t.sqrLen=h;let d,v=(d=i(),function(e,t,r,n,i,a){let o,s;for(t||(t=4),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)d[0]=e[o],d[1]=e[o+1],d[2]=e[o+2],d[3]=e[o+3],i(d,d,a),e[o]=d[0],e[o+1]=d[1],e[o+2]=d[2],e[o+3]=d[3];return e});t.forEach=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=void 0;var n,i=r(11),a=r(30);t.vec3=i.vec3,i.vec3.fromSpherical=function(e,t,r){var n=t[0],i=t[1],a=t[2];return e[0]=a*Math.sin(n)*Math.sin(i),e[1]=a*Math.cos(i),e[2]=a*Math.cos(n)*Math.sin(i),r&&(e[0]+=r[0],e[1]+=r[1],e[2]+=r[2]),e},i.vec3.getSpherical=function(e,t){var r=0,n=0,a=i.vec3.length(t);return 0!==a&&(r=Math.acos(Math.max(t[1]/a,-1)),n=Math.atan2(t[0],t[2])),e[0]=r,e[1]=n,e[2]=a,e},i.vec3.exponentialDecay=function(e,t,r,n,i,o){return e[0]=a.num.exponentialDecay(t[0],r[0],n,i,o),e[1]=a.num.exponentialDecay(t[1],r[1],n,i,o),e[2]=a.num.exponentialDecay(t[2],r[2],n,i,o),e},i.vec3.project=function(e,t,r,n){var i=t[0],a=t[1],o=t[2],s=r[0]*i+r[4]*a+r[8]*o+r[12],u=r[1]*i+r[5]*a+r[9]*o+r[13],l=r[3]*i+r[7]*a+r[11]*o+r[15];return e[0]=(s/l+1)/2*n[2]+n[0],e[1]=(1-(u/l+1)/2)*n[3]+n[1],e[2]=l,e},i.vec3.unproject=(n=void 0,function e(t,r,a,o){n||(n=i.vec4.create());var s=r[0],u=r[1],l=r[2];if(n[0]=(s-o[0])*2/o[2]-1,n[1]=(u-o[1])*2/o[3]-1,n[2]=2*l-1,n[3]=1,i.vec4.transformMat4(n,n,a),0===n[3])throw t[0]=0,t[1]=0,t[2]=0,Error("Perspective divide error");return t[0]=n[0]/n[3],t[1]=n[1]/n[3],t[2]=n[2]/n[3],t})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=void 0;var n=r(11);t.vec4=n.vec4},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=new WeakMap;(t.Tw2EventEmitter=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),i.set(this,{events:{}})}return n(e,[{key:"emit",value:function e(t,r){t=t.toLowerCase(),r&&r.__log&&(r.log=this.log(t,r.__log),delete r.__log);var n=i.get(this).events;return t in n?n[t].forEach(function(e,i){i.call(e.context,r),e.once&&n[t].delete(i)}):(n[t]=new Set,this.emit("event_added",{eventName:t})),this}},{key:"on",value:function e(t,r){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=i.get(this).events;return s[t=t.toLowerCase()]||(s[t]=new Set,s[t].add(function(){return n.emit("event_added",{eventName:t})},{once:!0})),s[t].add(r,{context:a,once:o}),this}},{key:"once",value:function e(t,r,n){return this.on(t,r,n,!0)}},{key:"off",value:function e(t,r){var n=i.get(this).events;return(t=t.toLowerCase())in n&&n[t].delete(r),this}},{key:"del",value:function e(t){var r=i.get(this).events;return(t=t.toLowerCase())in r&&(this.emit("event_removed",{eventName:t}),delete r[t]),this}},{key:"clr",value:function e(t){var r=i.get(this).events;for(var n in r)r.hasOwnProperty(n)&&r[n].has(t)&&r[n].delete(t);return this}},{key:"kill",value:function e(){return this.emit("event_kill"),i.get(this).events={},this}},{key:"log",value:function e(t,r){return this.constructor.logger&&this.constructor.logger.log(t,r),r}}]),e}()).logger=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2LoadingObject=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(6),a=r(4),o=r(12),s=r(38);(t.Tw2LoadingObject=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._redContents=null,e._inPrepare=null,e._objects=[],e._constructor=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"AddObject",value:function e(t,r){return t._loadCallback=r,this._objects.push(t),t}},{key:"Prepare",value:function e(t){if(!s.Tw2ObjectReader.IsValidXML(t)){a.logger.log("res.error",{log:"error",src:["Tw2LoadingObject","Prepare"],msg:"Invalid XML",path:this.path,type:"xml.invalid"}),this.PrepareFinished(!1);return}for(null===this._inPrepare&&(this._redContents=t,this._constructor=new s.Tw2ObjectReader(this._redContents),this._inPrepare=0);this._inPrepare<this._objects.length;){try{this._objects[this._inPrepare]._loadCallback(this._constructor.Construct())}catch(r){a.logger.log("res.error",{log:"error",src:["Tw2LoadingObject","Prepare"],msg:"Error preparing resource",path:this.path,type:"prepare",err:r})}this._inPrepare++}i.resMan.motherLode.Remove(this.path),this.PrepareFinished(!0)}}]),t}(o.Tw2Resource)).prototype.requestResponseType="arraybuffer"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ObjectReader=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),a=r(16),o=r(39),s=t.Tw2ObjectReader=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.xmlNode=t,this._inputStack=null,this._initializeObjects=null,this._ids={},this._reader=null,this._stringTable=null,this._start=null,t&&this.Initialize()}return n(e,[{key:"Initialize",value:function t(){if(!e.IsValidXML(this.xmlNode)){i.logger.log("res.error",{log:"error",src:["Tw2ObjectReader","constructor"],msg:"Invalid Binary",type:"redbin.invalid",data:this.xmlNode});return}this._reader=new o.Tw2BinaryReader(new Uint8Array(this.xmlNode)),this._reader.cursor+=6,this._stringTable=[];for(var r=this._reader.ReadUInt32(),n=0;n<r;++n){var a=this._reader.ReadUInt16();this._stringTable.push(String.fromCharCode.apply(null,this._reader.data.subarray(this._reader.cursor,this._reader.cursor+a))),this._reader.cursor+=a}this._start=this._reader.cursor}},{key:"Construct",value:function t(){return this._reader.cursor=this._start,e.ReadElement(this)}}],[{key:"IsValidXML",value:function e(t){return t&&"binred"===String.fromCharCode.apply(null,new Uint8Array(t).subarray(0,6))}},{key:"ConstructObject",value:function e(t){if("json"===t.type)return t;var r=void 0,n=a.store.GetConstructor(t.type);if(!n)throw i.logger.log("res.error",{log:"throw",src:["Tw2ObjectReader","Tw2ObjectReader.ConstructObject"],msg:"Object with undefined type",type:"xml.type",value:t.type}),Error("YAML: object with undefined type '"+t.type+"'");try{r=new n}catch(o){throw i.logger.log("res.error",{log:"throw",src:["Tw2ObjectReader","Tw2ObjectReader.ConstructObject"],msg:"Error instantiating constructor",type:"xml.type.constructor",value:t.type,err:o}),o}for(var s in t)if(t.hasOwnProperty(s)&&"type"!==s){if(void 0===r[s]&&this.DEBUG_ENABLED&&(r[s]=null),r[s]&&t[s].constructor===Object)for(var u in t[s])t[s].hasOwnProperty(u)&&(r[s][u]=t[s][u]);else r[s]=t[s]}return"Initialize"in r&&r.Initialize(),r}},{key:"ReadUint",value:function e(t,r){switch(48&r){case this.ElementSize.SMALL:return t._reader.ReadUInt8();case this.ElementSize.MEDIUM:return t._reader.ReadUInt16();default:return t._reader.ReadUInt32()}}},{key:"ReadElementData",value:function e(t,r){var n=void 0,i=void 0,a=void 0,o=void 0,s=void 0;switch(15&r){case this.ElementRawType.NULL:return null;case this.ElementRawType.BOOL:switch(48&r){case this.ElementSize.SMALL:return 0!==t._reader.ReadUInt8();case this.ElementSize.MEDIUM:return!1;default:return!0}case this.ElementRawType.INT:switch(48&r){case this.ElementSize.SMALL:return t._reader.ReadInt8();case this.ElementSize.MEDIUM:return t._reader.ReadInt16();default:return t._reader.ReadInt32()}case this.ElementRawType.UINT:return this.ReadUint(t,r);case this.ElementRawType.FLOAT:switch(48&r){case this.ElementSize.SMALL:return t._reader.ReadFloat16();case this.ElementSize.MEDIUM:return t._reader.ReadFloat32();default:throw Error("float64 values are not yet supported")}case this.ElementRawType.STRING:return n=this.ReadUint(t,r),t._stringTable[n];case this.ElementRawType.ARRAY:for(i=0,o=this.ReadUint(t,r),a=[];i<o;++i)a.push(this.ReadElement(t));return a;case this.ElementRawType.MAPPING:for(i=0,o=this.ReadUint(t,r),a={};i<o;++i)a[t._stringTable[this.ReadUint(t,r)]]=this.ReadElement(t);return a;case this.ElementRawType.OBJECT:for(i=0,o=this.ReadUint(t,r),a={};i<o;++i)a[t._stringTable[this.ReadUint(t,r)]]=this.ReadElement(t);return this.ConstructObject(a);case this.ElementRawType.TYPED_ARRAY:for(i=0,o=this.ReadUint(t,r),s=t._reader.ReadUInt8(),a=[];i<o;++i)a.push(this.ReadElementData(t,s));return s in this.TypedArrays&&(a=new this.TypedArrays[s](a)),a;case this.ElementRawType.TYPED_MAPPING:for(i=0,o=this.ReadUint(t,r),s=t._reader.ReadUInt8(),a={};i<o;++i)a[t._stringTable[this.ReadUint(t,r)]]=this.ReadElementData(t,s);return a}}},{key:"ReadElement",value:function e(t){var r=t._reader.ReadUInt8();if(r===this.REFERENCE_BIT)return t._ids[t._reader.ReadUInt16()];var n=void 0;(r&this.ID_BIT)!=0&&(n=t._reader.ReadUInt16());var i=this.ReadElementData(t,63&r);return(r&this.ID_BIT)!=0&&(t._ids[n]=i),i}}]),e}();s.ID_BIT=64,s.REFERENCE_BIT=128,s.ElementRawType={NULL:0,BOOL:1,INT:2,UINT:3,FLOAT:4,STRING:5,ARRAY:6,MAPPING:7,OBJECT:8,TYPED_ARRAY:9,TYPED_MAPPING:10},s.ElementSize={SMALL:0,MEDIUM:16,LARGE:32},s.ElementTypes={NULL:s.ElementRawType.NULL|s.ElementSize.SMALL,BOOL:s.ElementRawType.BOOL|s.ElementSize.SMALL,FALSE:s.ElementRawType.BOOL|s.ElementSize.MEDIUM,TRUE:s.ElementRawType.BOOL|s.ElementSize.LARGE,INT8:s.ElementRawType.INT|s.ElementSize.SMALL,UINT8:s.ElementRawType.UINT|s.ElementSize.SMALL,INT16:s.ElementRawType.INT|s.ElementSize.MEDIUM,UINT16:s.ElementRawType.UINT|s.ElementSize.MEDIUM,INT32:s.ElementRawType.INT|s.ElementSize.LARGE,UINT32:s.ElementRawType.UINT|s.ElementSize.LARGE,FLOAT16:s.ElementRawType.FLOAT|s.ElementSize.SMALL,FLOAT32:s.ElementRawType.FLOAT|s.ElementSize.MEDIUM,FLOAT64:s.ElementRawType.FLOAT|s.ElementSize.LARGE,SHORT_STRING:s.ElementRawType.STRING|s.ElementSize.SMALL,MEDIUM_STRING:s.ElementRawType.STRING|s.ElementSize.MEDIUM,LARGE_STRING:s.ElementRawType.STRING|s.ElementSize.LARGE,SHORT_ARRAY:s.ElementRawType.ARRAY|s.ElementSize.SMALL,MEDIUM_ARRAY:s.ElementRawType.ARRAY|s.ElementSize.MEDIUM,LARGE_ARRAY:s.ElementRawType.ARRAY|s.ElementSize.LARGE,SHORT_MAPPING:s.ElementRawType.MAPPING|s.ElementSize.SMALL,MEDIUM_MAPPING:s.ElementRawType.MAPPING|s.ElementSize.MEDIUM,LARGE_MAPPING:s.ElementRawType.MAPPING|s.ElementSize.LARGE,SHORT_OBJECT:s.ElementRawType.OBJECT|s.ElementSize.SMALL,MEDIUM_OBJECT:s.ElementRawType.OBJECT|s.ElementSize.MEDIUM,LARGE_OBJECT:s.ElementRawType.OBJECT|s.ElementSize.LARGE,SHORT_TYPED_ARRAY:s.ElementRawType.TYPED_ARRAY|s.ElementSize.SMALL,MEDIUM_TYPED_ARRAY:s.ElementRawType.TYPED_ARRAY|s.ElementSize.MEDIUM,LARGE_TYPED_ARRAY:s.ElementRawType.TYPED_ARRAY|s.ElementSize.LARGE,SHORT_TYPED_MAPPING:s.ElementRawType.TYPED_MAPPING|s.ElementSize.SMALL,MEDIUM_TYPED_MAPPING:s.ElementRawType.TYPED_MAPPING|s.ElementSize.MEDIUM,LARGE_TYPED_MAPPING:s.ElementRawType.TYPED_MAPPING|s.ElementSize.LARGE},s.TypedArrays={2:Int8Array,3:Uint8Array,18:Int16Array,19:Uint16Array,34:Int32Array,35:Uint32Array,4:Float32Array,20:Float32Array,36:Float64Array}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Tw2BinaryReader=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.cursor=0}return n(e,[{key:"ReadUInt8",value:function e(){return this.data[this.cursor++]}},{key:"ReadInt8",value:function e(){var t=this.data[this.cursor++];return t>127&&(t=t-255-1),t}},{key:"ReadUInt16",value:function e(){return this.data[this.cursor++]+(this.data[this.cursor++]<<8)}},{key:"ReadInt16",value:function e(){var t=this.data[this.cursor++]+(this.data[this.cursor++]<<8);return t>32767&&(t=t-65535-1),t}},{key:"ReadUInt32",value:function e(){return this.data[this.cursor++]+(this.data[this.cursor++]<<8)+(this.data[this.cursor++]<<16)+(this.data[this.cursor++]<<24>>>0)}},{key:"ReadInt32",value:function e(){var t=this.data[this.cursor++]+(this.data[this.cursor++]<<8)+(this.data[this.cursor++]<<16)+(this.data[this.cursor++]<<24>>>0);return t>2147483647&&(t=t-4294967295-1),t}},{key:"ReadFloat16",value:function e(){var t=this.data[this.cursor++],r=this.data[this.cursor++],n=(r>>2&31)-15,i=(3&r)<<8|t;return 0===i&&-15===n?0:(1-2*(r>>7))*(1+9765625e-10*i)*Math.pow(2,n)}},{key:"ReadFloat32",value:function e(){var t=this.data[this.cursor++],r=this.data[this.cursor++],n=this.data[this.cursor++],i=this.data[this.cursor++],a=(i<<1&255|n>>7)-127,o=(127&n)<<16|r<<8|t;return 0===o&&-127===a?0:(1-2*(i>>7))*(1+11920928955078125e-23*o)*Math.pow(2,a)}},{key:"ReadString",value:function e(){for(var t=this.data[this.cursor++],r="",n=0;n<t;++n)r+=String.fromCharCode(this.data[this.cursor++]);return r}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Effect=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(17),o=r(41);(t.Tw2Effect=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.effectFilePath="",this.effectRes=null,this.parameters={},this.techniques=[],this.samplerOverrides=[],this.autoParameter=!1,this.options={},this.shader=null}return n(e,[{key:"Initialize",value:function t(){if(""!==this.effectFilePath){this.effectFilePath=this.effectFilePath.toLowerCase();var r=e.ToEffectResPath(this.effectFilePath);this.effectRes=a.resMan.GetResource(r),this.effectRes.RegisterNotification(this)}}},{key:"IsGood",value:function e(){return null!==this.shader}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(var r in this.effectRes&&!t.includes(this.effectRes)&&t.push(this.effectRes),this.parameters)this.parameters.hasOwnProperty(r)&&"GetResources"in this.parameters[r]&&this.parameters[r].GetResources(t);return t}},{key:"RebuildCachedData",value:function e(t){this.shader=t.GetShader(this.options),this.BindParameters()}},{key:"UnBindParameters",value:function e(){for(var t in this.techniques)if(this.techniques.hasOwnProperty(t))for(var r=this.techniques[t],n=0;n<r.length;++n)for(var i=0;i<r[n].stages.length;++i)for(var a=0;a<r[n].stages[i].reroutedParameters.length;++a)r[n].stages[i].reroutedParameters[a].Unbind();this.techniques={}}},{key:"BindParameters",value:function t(){if(this.UnBindParameters(),!this.IsGood())return!1;for(var r in this.shader.techniques)if(this.shader.techniques.hasOwnProperty(r)){for(var n=this.shader.techniques[r],i=[],s=0;s<n.passes.length;++s){var u=[];u.stages=[];for(var l=0;l<n.passes[s].stages.length;++l){var c=n.passes[s].stages[l],f={};f.constantBuffer=new Float32Array(c.constantSize),f.reroutedParameters=[],f.parameters=[],f.textures=[],f.constantBuffer.set(c.constantValues);for(var h=0;h<c.constants.length;++h){var p=c.constants[h],d=p.name,v=p.Type;if(!e.ConstantIgnore.includes(d)){if(d in this.parameters){var $=this.parameters[d];$.Bind(f.constantBuffer,p.offset,p.size)?f.reroutedParameters.push($):f.parameters.push({parameter:$,constantBuffer:f.constantBuffer,offset:p.offset,size:p.size})}else if(a.store.HasVariable(d))f.parameters.push({parameter:a.store.GetVariable(d),constantBuffer:f.constantBuffer,offset:p.offset,size:p.size});else if(p.isAutoregister&&v){var m=a.store.RegisterVariable(d,void 0,v);m&&f.parameters.push({parameter:m,constantBuffer:f.constantBuffer,offset:p.offset,size:p.size})}else if(this.autoParameter&&1===p.elements){var y=f.constantBuffer.subarray(p.offset,p.offset+p.size);0===y.length?y=void 0:1===y.length&&(y=y[0]);var g=a.store.CreateType(d,y,v);g&&(this.parameters[d]=g,g.Bind(f.constantBuffer,p.offset,p.size)?f.reroutedParameters.push(g):f.parameter.push({parameter:g,constantBuffer:f.constantBuffer,offset:p.offset,size:p.size}))}}}for(var _=0;_<c.textures.length;++_){var b=c.textures[_].name,E=null;if(b in this.parameters)E=this.parameters[b];else if(a.store.HasVariable(b))E=a.store.GetVariable(b);else if(c.textures[_].isAutoregister)E=a.store.RegisterVariable(b,void 0,o.Tw2TextureParameter);else{if(!this.autoParameter)continue;E=this.parameters[b]=new o.Tw2TextureParameter(b)}for(var T={parameter:E,slot:c.textures[_].registerIndex,sampler:null},S=0;S<c.samplers.length;++S)if(c.samplers[S].registerIndex===T.slot){c.samplers[S].name in this.samplerOverrides?T.sampler=this.samplerOverrides[c.samplers[S].name].GetSampler(c.samplers[S]):T.sampler=c.samplers[S];break}0===l&&(T.slot+=12),f.textures.push(T)}u.stages.push(f)}i.push(u)}this.techniques[r]=i}return a.device.effectObserver&&a.device.effectObserver.OnEffectChanged(this),this.autoParameter=!1,!0}},{key:"ApplyPass",value:function e(t,r){if(this.IsGood()&&t in this.techniques&&!(r>=this.techniques[t].length)){this.shader.ApplyPass(t,r);for(var n=this.techniques[t][r],i=this.shader.techniques[t].passes[r],o=a.device,s=o.IsAlphaTestEnabled()&&i.shadowShaderProgram?i.shadowShaderProgram:i.shaderProgram,u=0;u<2;++u){for(var l=n.stages[u],c=0;c<l.parameters.length;++c){var f=l.parameters[c];f.parameter.Apply(f.constantBuffer,f.offset,f.size)}for(var h=0;h<l.textures.length;++h){var p=l.textures[h];p.parameter.Apply(p.slot,p.sampler,s.volumeSlices[p.sampler.registerIndex])}}var d=s.constantBufferHandles;d[0]&&o.gl.uniform4fv(d[0],n.stages[0].constantBuffer),d[7]&&o.gl.uniform4fv(d[7],n.stages[1].constantBuffer),o.perFrameVSData&&d[1]&&o.gl.uniform4fv(d[1],o.perFrameVSData.data),o.perFramePSData&&d[2]&&o.gl.uniform4fv(d[2],o.perFramePSData.data),o.perObjectData&&o.perObjectData.SetPerObjectDataToDevice(d)}}},{key:"GetPassCount",value:function e(t){return null!==this.shader&&t in this.techniques?this.techniques[t].length:0}},{key:"GetPassInput",value:function e(t,r){return null!==this.shader&&t in this.techniques&&!(r>=this.techniques[t].length)?a.device.IsAlphaTestEnabled()&&this.shader.techniques[t].passes[r].shadowShaderProgram?this.shader.techniques[t].passes[r].shadowShaderProgram.input:this.shader.techniques[t].passes[r].shaderProgram.input:null}},{key:"Render",value:function e(t){for(var r=this.GetPassCount("Main"),n=0;n<r;++n)this.ApplyPass("Main",n),t(this,n)}},{key:"GetTextures",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var r in this.parameters)if(this.parameters.hasOwnProperty(r)&&this.parameters[r]instanceof o.Tw2TextureParameter){var n=this.parameters[r].GetValue();n&&(t[r]=n)}return t}},{key:"SetTextures",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=!1;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n],a=this.parameters[n];o.Tw2TextureParameter.is(i)&&(a?a.EqualsValue(i)||(a.SetTexturePath(i),r=!0):(this.parameters[n]=new o.Tw2TextureParameter(n,i),r=!0))}return r}},{key:"GetParameters",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var r in this.parameters)!this.parameters.hasOwnProperty(r)||this.parameters[r]instanceof o.Tw2TextureParameter||(t[r]=this.parameters[r].GetValue(!0));return t}},{key:"SetParameters",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=!1;for(var n in t)if(t.hasOwnProperty(n)){var i=t[n],o=this.parameters[n];if(o)o.constructor.is(i)&&!o.EqualsValue(i)&&(this.parameters[n].SetValue(i),r=!0);else{var s=a.store.CreateType(n,i);s&&(this.parameters[n]=s,r=!0)}}return r}},{key:"SetOverrides",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=!1;for(var n in t)if(t.hasOwnProperty(n)){var i=this.parameters[n];if(i&&i instanceof o.Tw2TextureParameter){var a=!1,s=t[n];for(var u in s)if(s.hasOwnProperty(u)&&o.Tw2TextureParameter.overrideProperties.includes(u)&&s[u]!==i[u]){a=!0;break}a&&(i.SetOverrides(t[n]),r=!0)}}return r}},{key:"GetOverrides",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var r in this.parameters)if(this.parameters.hasOwnProperty(r)){var n=this.parameters[r];n&&n instanceof o.Tw2TextureParameter&&n.useAllOverrides&&(t[r]=this.parameters[r].GetOverrides())}return t}}],[{key:"ToEffectResPath",value:function e(t){return(t=t?t.substr(0,t.lastIndexOf(".")).replace("/effect/",a.device.effectDir)+".sm_"+a.device.shaderModel:"").toLowerCase()}},{key:"FromEffectResPath",value:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fx";return(t=t.substr(0,t.lastIndexOf(".")).replace(a.device.effectDir,"/effect/")+"."+r).toLowerCase()}},{key:"create",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new this;if(i.util.assignIfExists(r,t,["name","effectFilePath","display","autoParameter"]),"parameters"in t&&r.SetParameters(t.parameters),"textures"in t&&r.SetTextures(t.textures),"overrides"in t&&r.SetOverrides(t.overrides),""===r.name&&""!==t.effectFilePath){var n=t.effectFilePath;r.name=n.substring(n.lastIndexOf("/")+1,n.length)}return r.Initialize(),r}}]),e}()).ConstantIgnore=["PerFrameVS","PerObjectVS","PerFramePS","PerObjectPS","PerObjectPSInt"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TextureParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},a=r(6),o=r(2),s=r(21),u=r(7),l=r(0),c=t.Tw2TextureParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var n=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.resourcePath=r,n.useAllOverrides=!1,n.addressUMode=1,n.addressVMode=1,n.addressWMode=1,n.filterMode=2,n.mipFilterMode=2,n.maxAnisotropy=4,n.textureRes=null,n._sampler=null,r&&n.Initialize(),n}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Initialize",value:function e(){this.OnValueChanged()}},{key:"SetTexturePath",value:function e(t){this.resourcePath=t,this.OnValueChanged()}},{key:"GetValue",value:function e(){return this.isTextureAttached?null:this.resourcePath}},{key:"SetTextureRes",value:function e(t){this.textureRes!==t&&(this.resourcePath="",this.textureRes=t),this.textureRes._isAttached=!0}},{key:"OnValueChanged",value:function e(r,n){""!==this.resourcePath&&(this.resourcePath=this.resourcePath.toLowerCase(),this.textureRes=""!==this.resourcePath?a.resMan.GetResource(this.resourcePath):null),this.UpdateOverrides(),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"OnValueChanged",this).call(this,r,n)}},{key:"Apply",value:function e(t,r,n){this.textureRes&&(this.useAllOverrides&&(this._sampler.samplerType=r.samplerType,this._sampler.isVolume=r.isVolume,this._sampler.registerIndex=r.registerIndex,r=this._sampler),o.device.gl.activeTexture(o.device.gl.TEXTURE0+t),this.textureRes.Bind(r,n))}},{key:"SetOverrides",value:function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l.util.assignIfExists(this,r,t.overrideProperties),this.OnValueChanged()}},{key:"GetOverrides",value:function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return l.util.assignIfExists(r,this,t.overrideProperties),r}},{key:"UpdateOverrides",value:function e(){if(this.useAllOverrides){this._sampler=this._sampler||new s.Tw2SamplerState;var t=this._sampler;if(1===this.filterMode){switch(this.mipFilterMode){case 0:t.minFilter=o.device.gl.NEAREST;break;case 1:t.minFilter=o.device.gl.NEAREST_MIPMAP_NEAREST;break;default:t.minFilter=o.device.gl.NEAREST_MIPMAP_LINEAR}t.minFilterNoMips=o.device.gl.NEAREST,t.magFilter=o.device.gl.NEAREST}else{switch(this.mipFilterMode){case 0:t.minFilter=o.device.gl.LINEAR;break;case 1:t.minFilter=o.device.gl.LINEAR_MIPMAP_NEAREST;break;default:t.minFilter=o.device.gl.LINEAR_MIPMAP_LINEAR}t.minFilterNoMips=o.device.gl.LINEAR,t.magFilter=o.device.gl.LINEAR}t.addressU=o.device.wrapModes[this.addressUMode],t.addressV=o.device.wrapModes[this.addressVMode],t.addressW=o.device.wrapModes[this.addressWMode],t.anisotropy=this.maxAnisotropy,t.ComputeHash()}else this._sampler&&(this._sampler=null)}},{key:"EqualsValue",value:function e(t){return t.toLowerCase()===this.GetValue()}},{key:"Copy",value:function e(t,r){r&&(this.name=t.name),this.resourcePath=t.resourcePath,this.SetOverrides(t.GetOverrides)}},{key:"Clone",value:function e(){var r=new t;return r.Copy(this,!0),r}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.textureRes&&!t.includes(this.textureRes)&&t.push(this.textureRes),t}},{key:"isTextureAttached",get:function e(){return this.textureRes&&this.textureRes._isAttached}}],[{key:"is",value:function e(t){return"string"==typeof t}}]),t}(u.Tw2Parameter);c.prototype.SetValue=c.prototype.SetTexturePath,c.overrideProperties=["useAllOverrides","addressUMode","addressVMode","addressWMode","filterMode","mipFilterMode","maxAnisotropy"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SamplerState=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),a=t.Tw2SamplerState=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.registerIndex=0,this.minFilter=i.device.gl.LINEAR,this.maxFilter=i.device.gl.LINEAR,this.minFilterNoMips=i.device.gl.LINEAR,this.addressU=i.device.gl.REPEAT,this.addressV=i.device.gl.REPEAT,this.addressW=i.device.gl.REPEAT,this.anisotropy=1,this.samplerType=i.device.gl.TEXTURE_2D,this.isVolume=!1,this.hash=0}return n(e,[{key:"ComputeHash",value:function e(){this.hash=2166136261,this.hash*=16777619,this.hash^=this.minFilter,this.hash*=16777619,this.hash^=this.maxFilter,this.hash*=16777619,this.hash^=this.addressU,this.hash*=16777619,this.hash^=this.addressV,this.hash*=16777619,this.hash^=this.anisotropy}},{key:"Apply",value:function e(t){var r=this.samplerType,n=i.device;n.gl.texParameteri(r,n.gl.TEXTURE_WRAP_S,t?this.addressU:n.gl.CLAMP_TO_EDGE),n.gl.texParameteri(r,n.gl.TEXTURE_WRAP_T,t?this.addressV:n.gl.CLAMP_TO_EDGE),n.gl.texParameteri(r,n.gl.TEXTURE_MIN_FILTER,t?this.minFilter:this.minFilterNoMips),n.gl.texParameteri(r,n.gl.TEXTURE_MAG_FILTER,this.magFilter),n.ext.AnisotropicFilter&&n.enableAnisotropicFiltering&&n.gl.texParameterf(r,n.ext.AnisotropicFilter.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(this.anisotropy,n.ext.AnisotropicFilter.maxAnisotropy))}},{key:"GetFilterMode",value:function t(){return this.minFilterNoMips in e.FilterMode?e.FilterMode[this.minFilterNoMips]:2}},{key:"GetMipFilterMode",value:function t(){return this.minFilter in e.MipFilterMode?e.MipFilterMode[this.minFilter]:2}}]),e}();a.FilterMode={9728:1,9729:2},a.MipFilterMode={9728:0,9729:0,9984:1,9985:1,9986:2,9987:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VertexElement=function e(t,r,n,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.usage=t,this.usageIndex=r,this.type=n,this.elements=i,this.offset=a,this.location=null,this.customSetter=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PerObjectData=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),a=r(25);t.Tw2PerObjectData=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.perObjectVSData=null,this.perObjectPSData=null,t&&this.DeclareFromObject(t)}return n(e,[{key:"SetPerObjectDataToDevice",value:function e(t){this.perObjectVSData&&t[3]&&i.device.gl.uniform4fv(t[3],this.perObjectVSData.data),this.perObjectPSData&&t[4]&&i.device.gl.uniform4fv(t[4],this.perObjectPSData.data)}},{key:"DeclareFromObject",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.VSData&&(this.perObjectVSData=new a.Tw2RawData(t.VSData)),t.PSData&&(this.perObjectPSData=new a.Tw2RawData(t.PSData))}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(100);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(104);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(111);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(115);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(116);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(18);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(118);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(119);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(120);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(121);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(122);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(123);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})});var l=r(124);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return l[e]}})});var c=r(125);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return c[e]}})});var f=r(126);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return f[e]}})});var h=r(127);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return h[e]}})});var p=r(128);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return p[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(40);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(129);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(48);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(49);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(130);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Mesh=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(6),o=r(2);t.Tw2Mesh=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.visible={},this.visible.opaqueAreas=!0,this.visible.transparentAreas=!0,this.visible.additiveAreas=!0,this.visible.pickableAreas=!0,this.visible.decalAreas=!0,this.visible.depthAreas=!0,this.opaqueAreas=[],this.transparentAreas=[],this.additiveAreas=[],this.pickableAreas=[],this.decalAreas=[],this.depthAreas=[],this.meshIndex=0,this.geometryResPath="",this.lowDetailGeometryResPath="",this.geometryResource=null}return n(e,[{key:"Initialize",value:function e(){""!==this.geometryResPath&&(this.geometryResource=a.resMan.GetResource(this.geometryResPath))}},{key:"IsGood",value:function e(){return this.geometryResource&&this.geometryResource.IsGood()}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.includes(this.geometryResource)||t.push(this.geometryResource),i.util.perArrayChild(this.opaqueAreas,"GetResources",t),i.util.perArrayChild(this.transparentAreas,"GetResources",t),i.util.perArrayChild(this.additiveAreas,"GetResources",t),i.util.perArrayChild(this.pickableAreas,"GetResources",t),i.util.perArrayChild(this.decalAreas,"GetResources",t),i.util.perArrayChild(this.depthAreas,"GetResources",t),t}},{key:"GetBatches",value:function e(t,r,n){if(!this.IsGood()||!this.display)return!1;var i=this.constructor.GetAreaBatches;switch(t){case o.device.RM_OPAQUE:this.visible.opaqueAreas&&i(this,this.opaqueAreas,t,r,n);return;case o.device.RM_DECAL:this.visible.decalAreas&&i(this,this.opaqueAreas,t,r,n);return;case o.device.RM_TRANSPARENT:this.visible.transparentAreas&&i(this,this.transparentAreas,t,r,n);return;case o.device.RM_ADDITIVE:this.visible.transparentAreas&&i(this,this.additiveAreas,t,r,n);return;case o.device.RM_PICKABLE:this.visible.pickableAreas&&i(this,this.pickableAreas,t,r,n);return}}}],[{key:"GetAreaBatches",value:function e(t,r,n,i,a){for(var o=0;o<r.length;++o){var s=r[o];if(s.effect&&s.display){var u=new s.constructor.batchType;u.renderMode=n,u.perObjectData=a,u.geometryRes=t.geometryResource,u.meshIx=t.meshIndex,u.start=s.index,u.count=s.count,u.effect=s.effect,i.Commit(u)}}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MeshArea=void 0;var n=r(20),i=r(0);(t.Tw2MeshArea=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.effect=null,this.meshIndex=0,this.index=0,this.count=1,this.display=!0}).batchType=n.Tw2GeometryBatch},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Tw2Animation=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.animationRes=null,this.time=0,this.timeScale=1,this.cycle=!1,this.isPlaying=!1,this.callback=null,this.trackGroups=[]}return n(e,[{key:"IsFinished",value:function e(){return!this.cycle&&this.time>=this.animationRes.duration}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TextureRes=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(6),a=r(2),o=r(4),s=r(12);t.Tw2TextureRes=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.texture=null,e.isCube=!1,e.images=[],e.width=0,e.height=0,e.hasMipMaps=!1,e._facesLoaded=0,e._currentSampler=0,e._isAttached=!1,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Prepare",value:function e(r){var n=a.device,i=this.images[0].ccpGLFormat?this.images[0].ccpGLFormat:n.gl.RGBA;if("cube"===r){this.texture=n.gl.createTexture(),n.gl.bindTexture(n.gl.TEXTURE_CUBE_MAP,this.texture);var o=document.createElement("canvas");o.width=o.height=this.images[0].height;for(var s=o.getContext("2d"),u=0;u<6;++u)s.drawImage(this.images[0],u*o.width,0,o.width,o.height,0,0,o.width,o.height),n.gl.texImage2D(n.gl.TEXTURE_CUBE_MAP_POSITIVE_X+u,0,i,i,n.gl.UNSIGNED_BYTE,o);n.gl.generateMipmap(n.gl.TEXTURE_CUBE_MAP),n.gl.bindTexture(n.gl.TEXTURE_CUBE_MAP,null),this.width=o.width,this.height=o.height,this.hasMipMaps=!0,this._isAttached=!1,this.PrepareFinished(!0)}else this.texture=n.gl.createTexture(),n.gl.bindTexture(n.gl.TEXTURE_2D,this.texture),n.gl.texImage2D(n.gl.TEXTURE_2D,0,i,i,n.gl.UNSIGNED_BYTE,this.images[0]),this.hasMipMaps=t.IsPowerOfTwo(this.images[0].width)&&t.IsPowerOfTwo(this.images[0].height),this.hasMipMaps&&n.gl.generateMipmap(n.gl.TEXTURE_2D),n.gl.bindTexture(n.gl.TEXTURE_2D,null),this.width=this.images[0].width,this.height=this.images[0].height,this._isAttached=!1,this.PrepareFinished(!0);this.images=null}},{key:"DoCustomLoad",value:function e(r){var n=this,a=i.resMan.constructor.GetPathExt(r);return"cube"===a?(this.isCube=!0,r=r.substr(0,r.length-5)+".png"):this.isCube=!1,this.LoadStarted(),i.resMan._pendingLoads++,this.images=[],this.images[0]=new Image,this.images[0].crossOrigin="anonymous",this.images[0].onerror=function(){i.resMan._pendingLoads--,o.logger.log("res.error",{log:"error",src:["Tw2TextureRes","DoCustomLoad"],msg:"Error loading resource",type:"http.error",path:r}),n.LoadFinished(!1),n.PrepareFinished(!1),n.images=null},this.images[0].onload=function(){i.resMan._pendingLoads--,i.resMan._prepareQueue.push([n,a,null]),n.LoadFinished(!0)},this.images[0].src=t.AddMipLevelSkipCount(r),!0}},{key:"Unload",value:function e(){return this.texture&&(a.device.gl.deleteTexture(this.texture),this.texture=null),this._isPurged=!0,this._isGood=!1,this._isAttached=!1,!0}},{key:"Attach",value:function e(t){this.texture=t,this._isAttached=!0,this.LoadFinished(!0),this.PrepareFinished(!0)}},{key:"Bind",value:function e(t,r){var n=a.device;this.KeepAlive();var i=t.samplerType;if(i===(this.isCube?n.gl.TEXTURE_CUBE_MAP:n.gl.TEXTURE_2D)){if(!this.texture){var o=i===n.gl.TEXTURE_2D?n.GetFallbackTexture():n.GetFallbackCubeMap();n.gl.bindTexture(i,o);return}t.isVolume&&n.gl.uniform1f(r,this.height/this.width),n.gl.bindTexture(i,this.texture),t.hash!==this._currentSampler&&(t.Apply(this.hasMipMaps),this._currentSampler=t.hash)}}}],[{key:"IsPowerOfTwo",value:function e(t){return(t&t-1)==0}},{key:"AddMipLevelSkipCount",value:function e(t){var r=a.device,n=r.mipLevelSkipCount>0?"."+r.mipLevelSkipCount.toString():"";if(r.mipLevelSkipCount>0){var i=t.lastIndexOf(".");i>=0&&(t=t.substr(0,i-2)+n+t.substr(i))}return t}}]),t}(s.Tw2Resource)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Bone=void 0;var n=r(0);t.Tw2Bone=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.boneRes=null,this.localTransform=n.mat4.create(),this.worldTransform=n.mat4.create(),this.offsetTransform=n.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Model=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.modelRes=null,this.bones=[],this.bonesByName={}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Track=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.trackRes=null,this.bone=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TrackGroup=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.trackGroupRes=null,this.model=null,this.transformTracks=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RenderTarget=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2),o=r(51);t.Tw2RenderTarget=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.texture=null,this.width=null,this.height=null,this.hasDepth=null,this._frameBuffer=null,this._renderBuffer=null}return n(e,[{key:"Destroy",value:function e(){this.texture&&(a.device.gl.deleteTexture(this.texture.texture),this.texture=null),this._renderBuffer&&(a.device.gl.deleteRenderbuffer(this._renderBuffer),this._renderBuffer=null),this._frameBuffer&&(a.device.gl.deleteFramebuffer(this._frameBuffer),this._frameBuffer=null)}},{key:"Create",value:function e(t,r,n){this.Destroy(),this.texture=new o.Tw2TextureRes,this.texture.Attach(a.device.gl.createTexture()),this._frameBuffer=a.device.gl.createFramebuffer(),a.device.gl.bindFramebuffer(a.device.gl.FRAMEBUFFER,this._frameBuffer),a.device.gl.bindTexture(a.device.gl.TEXTURE_2D,this.texture.texture),a.device.gl.texImage2D(a.device.gl.TEXTURE_2D,0,a.device.gl.RGBA,t,r,0,a.device.gl.RGBA,a.device.gl.UNSIGNED_BYTE,null),a.device.gl.texParameteri(a.device.gl.TEXTURE_2D,a.device.gl.TEXTURE_MAG_FILTER,a.device.gl.LINEAR),a.device.gl.texParameteri(a.device.gl.TEXTURE_2D,a.device.gl.TEXTURE_MIN_FILTER,a.device.gl.LINEAR),a.device.gl.bindTexture(a.device.gl.TEXTURE_2D,null),this._renderBuffer=null,n&&(this._renderBuffer=a.device.gl.createRenderbuffer(),a.device.gl.bindRenderbuffer(a.device.gl.RENDERBUFFER,this._renderBuffer),a.device.gl.renderbufferStorage(a.device.gl.RENDERBUFFER,a.device.gl.DEPTH_COMPONENT16,t,r)),a.device.gl.framebufferTexture2D(a.device.gl.FRAMEBUFFER,a.device.gl.COLOR_ATTACHMENT0,a.device.gl.TEXTURE_2D,this.texture.texture,0),n&&a.device.gl.framebufferRenderbuffer(a.device.gl.FRAMEBUFFER,a.device.gl.DEPTH_ATTACHMENT,a.device.gl.RENDERBUFFER,this._renderBuffer),a.device.gl.bindRenderbuffer(a.device.gl.RENDERBUFFER,null),a.device.gl.bindFramebuffer(a.device.gl.FRAMEBUFFER,null),this.texture.width=this.width=t,this.texture.height=this.height=r,this.hasDepth=n}},{key:"Set",value:function e(){a.device.gl.bindFramebuffer(a.device.gl.FRAMEBUFFER,this._frameBuffer),a.device.gl.viewport(0,0,this.width,this.height)}},{key:"Unset",value:function e(){a.device.gl.bindFramebuffer(a.device.gl.FRAMEBUFFER,null),a.device.gl.viewport(0,0,a.device.viewportWidth,a.device.viewportHeight)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(19);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(155);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(164);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(167);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(14);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(173);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(174);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(175);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(176);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(177);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveOccluder=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1);(t.EveOccluder=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.value=1,this.sprites=[],e.init()}return n(e,[{key:"UpdateValue",value:function t(r,n){if(a.device.alphaBlendBackBuffer){var o=a.device,s=e.global,u=s.mat4_0,l=s.vec4_0;s.accumulator.Clear();for(var c=0;c<this.sprites.length;++c)this.sprites[c].UpdateViewDependentData(r),this.sprites[c].GetBatches(o.RM_DECAL,s.accumulator);a.store.SetVariableValue("OccluderValue",[(1<<2*n)/255,(2<<2*n)/255,0,0]),s.accumulator.Render(),i.mat4.multiply(u,o.viewProjection,this.sprites[0].worldTransform),i.vec4.transformMat4(l,[0,0,0,1],u);var f=(l[0]/l[3]+1)*.5,h=(l[1]/l[3]+1)*.5;i.vec4.set(l,.5,.5,0,1),i.vec4.transformMat4(l,l,u);var p=(l[0]/l[3]+1)*.5,d=(l[1]/l[3]+1)*.5;l[0]=f,l[1]=h,l[2]=p-f,l[3]=d-h,s.effect.parameters.OccluderPosition.SetValue(l)}}}],[{key:"CollectSamples",value:function e(t,r,n,i){var o=a.device,s=this.global,u=s.effect,l=s.vertexBuffer,c=s.decl;if(!u.effectRes||!u.effectRes.IsGood())return!1;u.parameters.BackBuffer.textureRes=t,u.parameters.OccluderIndex.SetValue([r,n,i]),o.SetStandardStates(o.RM_ADDITIVE),o.gl.bindBuffer(o.gl.ARRAY_BUFFER,l);for(var f=0;f<u.GetPassCount("Main");++f){if(u.ApplyPass("Main",f),c.SetDeclaration(u.GetPassInput("Main",f),16))return!1;o.ApplyShadowState(),o.gl.drawArrays(o.gl.TRIANGLES,0,1530)}return!0}},{key:"init",value:function t(){if(!e.global){var r=a.device,n=e.global={};n.mat4_0=i.mat4.create(),n.vec4_0=i.vec4.create(),n.accumulator=new a.Tw2BatchAccumulator,n.effect=a.Tw2Effect.create({name:"Occluder sampler",effectFilePath:"res:/graphics/effect/managed/space/specialfx/lensflares/collectsamples.fx",parameters:{OccluderPosition:[1,1,1,1],OccluderIndex:[1,1,1],BackBuffer:""}}),n.vertexBuffer=null,n.decl=new a.Tw2VertexDeclaration,n.decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.POSITION,0,r.gl.FLOAT,2,0)),n.decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,0,r.gl.FLOAT,2,8)),n.decl.RebuildHash();for(var o=new Float32Array(6120),s=0,u=0;u<16;++u)for(var l=0;l<16;++l){var c=(u+Math.random())/16*2-1,f=(l+Math.random())/16*2-1;o[s++]=1,o[s++]=1,o[s++]=c,o[s++]=f,o[s++]=-1,o[s++]=1,o[s++]=c,o[s++]=f,o[s++]=1,o[s++]=-1,o[s++]=c,o[s++]=f,o[s++]=-1,o[s++]=1,o[s++]=c,o[s++]=f,o[s++]=1,o[s++]=-1,o[s++]=c,o[s++]=f,o[s++]=-1,o[s++]=-1,o[s++]=c,o[s++]=f}n.vertexBuffer=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,n.vertexBuffer),r.gl.bufferData(r.gl.ARRAY_BUFFER,o,r.gl.STATIC_DRAW),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,null)}}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(15);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(183);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(184);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(185);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(186);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(62);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})});var l=r(61);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return l[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveTransform=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(15);(t.EveTransform=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.mesh=!0,e.visible.children=!0,e.mesh=null,e.curveSets=[],e.children=[],e.particleSystems=[],e.particleEmitters=[],e.modifier=t.Modifier.NONE,e.sortValueMultiplier=1,e.distanceBasedScaleArg1=.2,e.distanceBasedScaleArg2=.63,e.useDistanceBasedScale=!1,e.scaling=i.vec3.fromValues(1,1,1),e.translation=i.vec3.create(),e.rotation=i.quat.create(),e.localTransform=i.mat4.create(),e.worldTransform=i.mat4.create(),e._perObjectData=new a.Tw2BasicPerObjectData,e._perObjectData.perObjectFFEData=new a.Tw2RawData,e._perObjectData.perObjectFFEData.Declare("World",16),e._perObjectData.perObjectFFEData.Declare("WorldInverseTranspose",16),e._perObjectData.perObjectFFEData.Create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Initialize",value:function e(){i.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling)}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1];if(this.mesh&&this.mesh.GetResources(t),!r)for(var n=0;n<this.children;n++)this.children[n].GetResources(t);return t}},{key:"UpdateViewDependentData",value:function e(r){var n=a.device,o=t.global,s=o.vec3_0,u=o.vec3_1,l=o.vec3_2,c=n.viewInverse;switch(i.quat.normalize(this.rotation,this.rotation),i.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling),i.mat4.getScaling(u,r),this.modifier){case t.Modifier.BILLBOARD:case t.Modifier.SIMPLE_HALO:var f=o.vec3_3;if(i.mat4.multiply(this.worldTransform,r,this.localTransform),i.vec3.multiply(s,this.scaling,u),this.modifier===t.Modifier.SIMPLE_HALO){i.vec3.subtract(l,n.GetEyePosition(l),this.worldTransform.subarray(12)),i.vec3.normalize(f,this.worldTransform.subarray(8)),i.vec3.normalize(l,l);var h=i.vec3.dot(l,f);h<0&&(h=0),i.vec3.scale(s,s,h*h)}this.worldTransform[0]=c[0]*s[0],this.worldTransform[1]=c[1]*s[0],this.worldTransform[2]=c[2]*s[0],this.worldTransform[4]=c[4]*s[1],this.worldTransform[5]=c[5]*s[1],this.worldTransform[6]=c[6]*s[1],this.worldTransform[8]=c[8]*s[2],this.worldTransform[9]=c[9]*s[2],this.worldTransform[10]=c[10]*s[2];break;case t.Modifier.EVE_CAMERA_ROTATION:var p=o.vec3_3;i.vec3.transformMat4(p,this.translation,r),i.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,p,this.scaling),i.mat4.multiply(this.worldTransform,c,this.localTransform),this.worldTransform[12]=this.localTransform[12],this.worldTransform[13]=this.localTransform[13],this.worldTransform[14]=this.localTransform[14];break;case t.Modifier.EVE_CAMERA_ROTATION_ALIGNED:case t.Modifier.EVE_SIMPLE_HALO:var d=o.vec3_3,v=o.vec3_4,$=o.vec3_5,m=o.vec3_6,y=o.vec3_7,g=o.mat4_0,_=o.mat4_1,b=o.mat4_2;if(i.mat4.translate(this.worldTransform,r,this.translation),i.mat4.transpose(g,r),n.GetEyePosition(l),l[0]-=this.worldTransform[12],l[1]-=this.worldTransform[13],l[2]-=this.worldTransform[14],i.vec3.copy(d,l),i.vec3.transformMat4(d,d,g),i.vec3.divide(d,d,u),i.vec3.normalize(d,d),i.vec3.set(v,n.view[0],n.view[4],n.view[8]),i.vec3.transformMat4(v,v,g),i.vec3.normalize(v,v),i.vec3.cross($,d,v),i.vec3.normalize($,$),i.vec3.cross(v,$,d),_[0]=v[0],_[1]=v[1],_[2]=v[2],_[4]=$[0],_[5]=$[1],_[6]=$[2],_[8]=d[0],_[9]=d[1],_[10]=d[2],_[15]=1,i.mat4.fromQuat(b,this.rotation),i.mat4.multiply(_,_,b),this.modifier===t.Modifier.EVE_SIMPLE_HALO){i.vec3.normalize(m,this.worldTransform.subarray(8)),i.vec3.normalize(y,l);var E=-i.vec3.dot(y,m);E<0&&(E=0),i.mat4.multiply(this.worldTransform,this.worldTransform,_),i.mat4.scale(this.worldTransform,this.worldTransform,[this.scaling[0]*E,this.scaling[1]*E,this.scaling[2]*E])}else i.mat4.scale(this.worldTransform,this.worldTransform,this.scaling),i.mat4.multiply(this.worldTransform,this.worldTransform,_);break;case t.Modifier.LOOK_AT_CAMERA:var T=o.mat4_0;i.mat4.multiply(this.worldTransform,r,this.localTransform),i.mat4.lookAt(T,c.subarray(12),this.worldTransform.subarray(12),[0,1,0]),i.mat4.transpose(T,T),i.vec3.multiply(s,this.scaling,u),this.worldTransform[0]=T[0]*s[0],this.worldTransform[1]=T[1]*s[0],this.worldTransform[2]=T[2]*s[0],this.worldTransform[4]=T[4]*s[1],this.worldTransform[5]=T[5]*s[1],this.worldTransform[6]=T[6]*s[1],this.worldTransform[8]=T[8]*s[2],this.worldTransform[9]=T[9]*s[2],this.worldTransform[10]=T[10]*s[2];break;default:i.mat4.multiply(this.worldTransform,r,this.localTransform)}for(var S=0;S<this.children.length;++S)this.children[S].UpdateViewDependentData(this.worldTransform)}},{key:"Update",value:function e(t){for(var r=0;r<this.children.length;++r)this.children[r].Update(t);for(var n=0;n<this.particleEmitters.length;++n)this.particleEmitters[n].Update(t);for(var i=0;i<this.particleSystems.length;++i)this.particleSystems[i].Update(t);for(var a=0;a<this.curveSets.length;++a)this.curveSets[a].Update(t)}},{key:"GetBatches",value:function e(t,r,n){if(this.display&&(this.visible.mesh&&this.mesh&&(i.mat4.transpose(this._perObjectData.perObjectFFEData.Get("World"),this.worldTransform),i.mat4.invert(this._perObjectData.perObjectFFEData.Get("WorldInverseTranspose"),this.worldTransform),n&&(this._perObjectData.perObjectVSData=n.perObjectVSData,this._perObjectData.perObjectPSData=n.perObjectPSData),this.mesh.GetBatches(t,r,this._perObjectData)),this.visible.children))for(var a=0;a<this.children.length;++a)this.children[a].GetBatches(t,r,n)}}],[{key:"Multiply3x3",value:function e(t,r,n){n||(n=r);var i=r[0],a=r[1];return r=r[2],n[0]=t[0]*i+t[4]*a+t[8]*r,n[1]=t[1]*i+t[5]*a+t[9]*r,n[2]=t[2]*i+t[6]*a+t[10]*r,n}}]),t}(o.EveObject)).Modifier={NONE:0,BILLBOARD:1,TRANSLATE_WITH_CAMERA:2,LOOK_AT_CAMERA:3,SIMPLE_HALO:4,EVE_CAMERA_ROTATION_ALIGNED:100,EVE_BOOSTER:101,EVE_SIMPLE_HALO:102,EVE_CAMERA_ROTATION:103}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveStation=t.EveSpaceObject=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(15),s=t.EveSpaceObject=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.mesh=!0,e.visible.children=!0,e.visible.effectChildren=!0,e.visible.planeSets=!0,e.visible.spotlightSets=!0,e.visible.decals=!0,e.visible.spriteSets=!0,e.visible.overlayEffects=!0,e.visible.lineSets=!0,e.visible.killmarks=!0,e.visible.customMasks=!0,e.mesh=null,e.animation=new a.Tw2AnimationController,e.locators=[],e.spriteSets=[],e.turretSets=[],e.decals=[],e.spotlightSets=[],e.planeSets=[],e.curveSets=[],e.lineSets=[],e.overlayEffects=[],e.children=[],e.effectChildren=[],e.customMasks=[],e.lod=3,e.killCount=0,e.transform=i.mat4.create(),e.boundingSphereCenter=i.vec3.create(),e.boundingSphereRadius=0,e.shapeEllipsoidRadius=i.vec3.create(),e.shapeEllipsoidCenter=i.vec3.create(),e._perObjectData=new a.Tw2PerObjectData,e._perObjectData.perObjectVSData=new a.Tw2RawData,e._perObjectData.perObjectVSData.Declare("WorldMat",16),e._perObjectData.perObjectVSData.Declare("WorldMatLast",16),e._perObjectData.perObjectVSData.Declare("Shipdata",4),e._perObjectData.perObjectVSData.Declare("Clipdata1",4),e._perObjectData.perObjectVSData.Declare("EllipsoidRadii",4),e._perObjectData.perObjectVSData.Declare("EllipsoidCenter",4),e._perObjectData.perObjectVSData.Declare("CustomMaskMatrix0",16),e._perObjectData.perObjectVSData.Declare("CustomMaskMatrix1",16),e._perObjectData.perObjectVSData.Declare("CustomMaskData0",4),e._perObjectData.perObjectVSData.Declare("CustomMaskData1",4),e._perObjectData.perObjectVSData.Declare("JointMat",696),e._perObjectData.perObjectVSData.Create(),e._perObjectData.perObjectPSData=new a.Tw2RawData,e._perObjectData.perObjectPSData.Declare("Shipdata",4),e._perObjectData.perObjectPSData.Declare("Clipdata1",4),e._perObjectData.perObjectPSData.Declare("Clipdata2",4),e._perObjectData.perObjectPSData.Declare("ShLighting",28),e._perObjectData.perObjectPSData.Declare("CustomMaskMaterialID0",4),e._perObjectData.perObjectPSData.Declare("CustomMaskMaterialID1",4),e._perObjectData.perObjectPSData.Declare("CustomMaskTarget0",4),e._perObjectData.perObjectPSData.Declare("CustomMaskTarget1",4),e._perObjectData.perObjectPSData.Create(),e._perObjectData.perObjectVSData.Get("Shipdata")[1]=1,e._perObjectData.perObjectPSData.Get("Shipdata")[1]=1,e._perObjectData.perObjectVSData.Get("Shipdata")[3]=-10,e._perObjectData.perObjectPSData.Get("Shipdata")[3]=1,i.mat4.identity(e._perObjectData.perObjectVSData.Get("CustomMaskMatrix0")),i.mat4.identity(e._perObjectData.perObjectVSData.Get("CustomMaskMatrix1")),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Initialize",value:function e(){if(this.mesh){this.animation.SetGeometryResource(this.mesh.geometryResource);for(var t=0;t<this.decals.length;++t)this.decals[t].SetParentGeometry(this.mesh.geometryResource)}}},{key:"ResetLod",value:function e(){this.lod=3}},{key:"UpdateLod",value:function e(r){var n=i.vec3.transformMat4(t.global.vec3_0,this.boundingSphereCenter,this.transform);r.IsSphereVisible(n,this.boundingSphereRadius)?100>r.GetPixelSizeAcross(n,this.boundingSphereRadius)?this.lod=1:this.lod=2:this.lod=0}},{key:"AddCustomMask",value:function e(t,r,n,a,o,s){var u=i.mat4.fromRotationTranslationScale(i.mat4.create(),n,t,r);i.mat4.invert(u,u),i.mat4.transpose(u,u),this.customMasks.push({transform:u,maskData:i.vec4.fromValues(1,a?1:0,0,0),materialID:i.vec4.fromValues(o,0,0,0),targets:s})}},{key:"GetLocatorCount",value:function e(t){return this.FindLocatorsByPrefix(t).length}},{key:"FindLocatorJointByName",value:function e(t){var r=this.FindLocatorBoneByName(t);return r?r.worldTransform:null}},{key:"FindLocatorTransformByName",value:function e(t){var r=this.FindLocatorByName(t);return r?r.transform:null}},{key:"HasLocatorPrefix",value:function e(t){for(var r=0;r<this.locators.length;r++)if(this.locators[r].name.substring(0,t.length)===t)return!0;return!1}},{key:"FindLocatorBoneByName",value:function e(t){var r=this.animation.FindModelForMesh(0);if(r){for(var n=0;n<r.bones.length;++n)if(r.bones[n].boneRes.name===t)return r.bones[n]}return null}},{key:"FindLocatorByName",value:function e(t){for(var r=0;r<this.locators.length;r++)if(this.locators[r].name===t)return this.locators[r];return null}},{key:"FindLocatorsByPrefix",value:function e(t){for(var r=[],n=0;n<this.locators.length;n++)0===this.locators[n].name.indexOf(t)&&r.push(this.locators[n]);return r}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1];return this.mesh&&this.mesh.GetResources(t),this.animation&&this.animation.GetResources(t),i.util.perArrayChild(this.spriteSets,"GetResources",t),i.util.perArrayChild(this.turretSets,"GetResources",t),i.util.perArrayChild(this.decals,"GetResources",t),i.util.perArrayChild(this.spotlightSets,"GetResources",t),i.util.perArrayChild(this.planeSets,"GetResources",t),i.util.perArrayChild(this.lineSets,"GetResources",t),i.util.perArrayChild(this.overlayEffects,"GetResources",t),i.util.perArrayChild(this.effectChildren,"GetResources",t),r||i.util.perArrayChild(this.children,"GetResources",t),t}},{key:"UpdateViewDependentData",value:function e(){for(var t=0;t<this.children.length;++t)this.children[t].UpdateViewDependentData(this.transform);i.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this.transform),i.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMatLast"),this.transform);var r=this._perObjectData.perObjectVSData.Get("EllipsoidCenter"),n=this._perObjectData.perObjectVSData.Get("EllipsoidRadii");this.shapeEllipsoidRadius[0]>0?(r[0]=this.shapeEllipsoidCenter[0],r[1]=this.shapeEllipsoidCenter[1],r[2]=this.shapeEllipsoidCenter[2],n[0]=this.shapeEllipsoidRadius[0],n[1]=this.shapeEllipsoidRadius[1],n[2]=this.shapeEllipsoidRadius[2]):this.mesh&&this.mesh.IsGood()&&(i.vec3.subtract(r,this.mesh.geometryResource.maxBounds,this.mesh.geometryResource.minBounds),i.vec3.scale(r,r,.8660254035),i.vec3.add(n,this.mesh.geometryResource.maxBounds,this.mesh.geometryResource.minBounds),i.vec3.scale(n,n,.5));for(var a=0;a<this.customMasks.length;++a){var o=this.visible.customMasks?this.customMasks[a].targets:[0,0,0,0];this._perObjectData.perObjectVSData.Set(a?"CustomMaskMatrix1":"CustomMaskMatrix0",this.customMasks[a].transform),this._perObjectData.perObjectVSData.Set(a?"CustomMaskData1":"CustomMaskData0",this.customMasks[a].maskData),this._perObjectData.perObjectPSData.Set(a?"CustomMaskMaterialID1":"CustomMaskMaterialID0",this.customMasks[a].materialID),this._perObjectData.perObjectPSData.Set(a?"CustomMaskTarget1":"CustomMaskTarget0",o)}this.animation.animations.length&&this._perObjectData.perObjectVSData.Set("JointMat",this.animation.GetBoneMatrices(0));for(var s=0;s<this.lineSets.length;++s)this.lineSets[s].UpdateViewDependentData(this.transform)}},{key:"Update",value:function e(t){if(this.lod>0){for(var r=0;r<this.spriteSets.length;++r)this.spriteSets[r].Update(t);for(var n=0;n<this.planeSets.length;n++)this.planeSets[n].Update(t);for(var i=0;i<this.spotlightSets.length;i++)this.spotlightSets[i].Update(t);for(var a=0;a<this.children.length;++a)this.children[a].Update(t);for(var o=0;o<this.effectChildren.length;++o)this.effectChildren[o].Update(t,this.transform);for(var s=0;s<this.curveSets.length;++s)this.curveSets[s].Update(t);for(var u=0;u<this.overlayEffects.length;++u)this.overlayEffects[u].Update(t);for(var l=0;l<this.lineSets.length;l++)this.lineSets[l].Update(t);this.animation.Update(t)}}},{key:"GetBatches",value:function e(t,r){if(this.display){var n=this.visible;if(n.mesh&&this.mesh&&this.lod>0&&this.mesh.GetBatches(t,r,this._perObjectData),this.lod>1){if(n.spriteSets)for(var i=0;i<this.spriteSets.length;i++)this.spriteSets[i].GetBatches(t,r,this._perObjectData,this.transform);if(n.spotlightSets)for(var a=0;a<this.spotlightSets.length;a++)this.spotlightSets[a].GetBatches(t,r,this._perObjectData);if(n.planeSets)for(var o=0;o<this.planeSets.length;o++)this.planeSets[o].GetBatches(t,r,this._perObjectData);if(n.decals)for(var s=0;s<this.decals.length;s++)this.decals[s].GetBatches(t,r,this._perObjectData,n.killmarks?this.killCount:0);if(n.lineSets)for(var u=0;u<this.lineSets.length;u++)this.lineSets[u].GetBatches(t,r)}if(n.children)for(var l=0;l<this.children.length;l++)this.children[l].GetBatches(t,r,this._perObjectData);if(n.effectChildren)for(var c=0;c<this.effectChildren.length;c++)this.effectChildren[c].GetBatches(t,r,this._perObjectData);if(n.overlayEffects&&this.mesh&&this.mesh.IsGood())for(var f=0;f<this.overlayEffects.length;f++)this.overlayEffects[f].GetBatches(t,r,this._perObjectData,this.mesh)}}},{key:"RenderDebugInfo",value:function e(t){this.animation.RenderDebugInfo(t)}}]),t}(o.EveObject);t.EveStation=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(10);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(187);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(188);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(189);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(190);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(191);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})});var l=r(192);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return l[e]}})});var c=r(193);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return c[e]}})});var f=r(194);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return f[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.math=void 0;var n=r(1);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(57);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(172);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(45);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(0),u=p(s),l=p(n),c=p(i),f=p(a),h=p(o);function p(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}t.math=u;var d=u.vec4,v=u.mat4;l.store.Register({paths:{res:"https://developers.eveonline.com/ccpwgl/assetpath/1097993/"},extensions:{sm_hi:l.Tw2EffectRes,sm_lo:l.Tw2EffectRes,wbg:l.Tw2GeometryRes,png:l.Tw2TextureRes,cube:l.Tw2TextureRes,mp4:l.Tw2VideoRes,ogg:l.Tw2VideoRes,webm:l.Tw2VideoRes},constructors:[l,c,f,h],types:{float:l.Tw2FloatParameter,number:l.Tw2FloatParameter,texture:l.Tw2TextureParameter,vector2:l.Tw2Vector2Parameter,vector3:l.Tw2Vector3Parameter,vector4:l.Tw2Vector4Parameter,matrix4:l.Tw2MatrixParameter},variables:{WorldMat:v.create(),ViewMat:v.create(),ProjectionMat:v.create(),ViewProjectionMat:v.create(),ViewportSize:d.create(),Time:d.create(),u_DecalMatrix:v.create(),u_InvDecalMatrix:v.create(),EveSpaceSceneEnvMap:"",EnvMap1:"",EnvMap2:"",EnvMap3:"",ShadowLightness:0,OccluderValue:d.fromValues(1,1,0,0),LensflareFxOccScale:d.fromValues(1,1,0,0),LensflareFxDirectionScale:d.create()}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2BatchAccumulator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2);t.Tw2BatchAccumulator=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.batches=[],this._sortMethod=t}return n(e,[{key:"Commit",value:function e(t){this.batches.push(t)}},{key:"Clear",value:function e(){this.batches=[]}},{key:"Render",value:function t(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Main";this._sortMethod&&this.batches.sort(this._sortMethod);for(var n=0;n<this.batches.length;++n)this.batches[n]instanceof e?this.batches[n].Render(r):(this.batches[n].renderMode!==i.device.RM_ANY&&i.device.SetStandardStates(this.batches[n].renderMode),i.device.perObjectData=this.batches[n].perObjectData,this.batches[n].Commit(r))}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec2=void 0;var n=r(11);t.vec2=n.vec2},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function e(){let t=new n.ARRAY_TYPE(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},t.clone=function e(t){let r=new n.ARRAY_TYPE(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},t.copy=function e(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t},t.identity=function e(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},t.fromValues=function e(t,r,i,a){let o=new n.ARRAY_TYPE(4);return o[0]=t,o[1]=r,o[2]=i,o[3]=a,o},t.set=function e(t,r,n,i,a){return t[0]=r,t[1]=n,t[2]=i,t[3]=a,t},t.transpose=function e(t,r){if(t===r){let n=r[1];t[1]=r[2],t[2]=n}else t[0]=r[0],t[1]=r[2],t[2]=r[1],t[3]=r[3];return t},t.invert=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=n*o-a*i;return s?(s=1/s,t[0]=o*s,t[1]=-i*s,t[2]=-a*s,t[3]=n*s,t):null},t.adjoint=function e(t,r){let n=r[0];return t[0]=r[3],t[1]=-r[1],t[2]=-r[2],t[3]=n,t},t.determinant=function e(t){return t[0]*t[3]-t[2]*t[1]},t.multiply=i,t.rotate=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=r[3],u=Math.sin(n),l=Math.cos(n);return t[0]=i*l+o*u,t[1]=a*l+s*u,t[2]=-(i*u)+o*l,t[3]=-(a*u)+s*l,t},t.scale=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=r[3],u=n[0],l=n[1];return t[0]=i*u,t[1]=a*u,t[2]=o*l,t[3]=s*l,t},t.fromRotation=function e(t,r){let n=Math.sin(r),i=Math.cos(r);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t},t.fromScaling=function e(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=r[1],t},t.str=function e(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},t.frob=function e(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2))},t.LDU=function e(t,r,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,r,n]},t.add=function e(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t},t.subtract=a,t.exactEquals=function e(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]},t.equals=function e(t,r){let i=t[0],a=t[1],o=t[2],s=t[3],u=r[0],l=r[1],c=r[2],f=r[3];return Math.abs(i-u)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-c)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-f)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(f))},t.multiplyScalar=function e(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t},t.multiplyScalarAndAdd=function e(t,r,n,i){return t[0]=r[0]+n[0]*i,t[1]=r[1]+n[1]*i,t[2]=r[2]+n[2]*i,t[3]=r[3]+n[3]*i,t};var n=r(5);function i(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],l=r[2],c=r[3];return e[0]=n*s+a*u,e[1]=i*s+o*u,e[2]=n*l+a*c,e[3]=i*l+o*c,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e}t.mul=i,t.sub=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function e(){let t=new n.ARRAY_TYPE(6);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},t.clone=function e(t){let r=new n.ARRAY_TYPE(6);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r},t.copy=function e(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t},t.identity=function e(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},t.fromValues=function e(t,r,i,a,o,s){let u=new n.ARRAY_TYPE(6);return u[0]=t,u[1]=r,u[2]=i,u[3]=a,u[4]=o,u[5]=s,u},t.set=function e(t,r,n,i,a,o,s){return t[0]=r,t[1]=n,t[2]=i,t[3]=a,t[4]=o,t[5]=s,t},t.invert=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=n*o-i*a;return l?(l=1/l,t[0]=o*l,t[1]=-i*l,t[2]=-a*l,t[3]=n*l,t[4]=(a*u-o*s)*l,t[5]=(i*s-n*u)*l,t):null},t.determinant=function e(t){return t[0]*t[3]-t[1]*t[2]},t.multiply=i,t.rotate=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=Math.sin(n),f=Math.cos(n);return t[0]=i*f+o*c,t[1]=a*f+s*c,t[2]=-(i*c)+o*f,t[3]=-(a*c)+s*f,t[4]=u,t[5]=l,t},t.scale=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=n[0],f=n[1];return t[0]=i*c,t[1]=a*c,t[2]=o*f,t[3]=s*f,t[4]=u,t[5]=l,t},t.translate=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=r[3],u=r[4],l=r[5],c=n[0],f=n[1];return t[0]=i,t[1]=a,t[2]=o,t[3]=s,t[4]=i*c+o*f+u,t[5]=a*c+s*f+l,t},t.fromRotation=function e(t,r){let n=Math.sin(r),i=Math.cos(r);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},t.fromScaling=function e(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=r[1],t[4]=0,t[5]=0,t},t.fromTranslation=function e(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=r[0],t[5]=r[1],t},t.str=function e(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},t.frob=function e(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+1)},t.add=function e(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t[4]=r[4]+n[4],t[5]=r[5]+n[5],t},t.subtract=a,t.multiplyScalar=function e(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*n,t[5]=r[5]*n,t},t.multiplyScalarAndAdd=function e(t,r,n,i){return t[0]=r[0]+n[0]*i,t[1]=r[1]+n[1]*i,t[2]=r[2]+n[2]*i,t[3]=r[3]+n[3]*i,t[4]=r[4]+n[4]*i,t[5]=r[5]+n[5]*i,t},t.exactEquals=function e(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]},t.equals=function e(t,r){let i=t[0],a=t[1],o=t[2],s=t[3],u=t[4],l=t[5],c=r[0],f=r[1],h=r[2],p=r[3],d=r[4],v=r[5];return Math.abs(i-c)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-f)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(o-h)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(s-p)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-d)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(d))&&Math.abs(l-v)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(v))};var n=r(5);function i(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=r[0],c=r[1],f=r[2],h=r[3],p=r[4],d=r[5];return e[0]=n*l+a*c,e[1]=i*l+o*c,e[2]=n*f+a*h,e[3]=i*f+o*h,e[4]=n*p+a*d+s,e[5]=i*p+o*d+u,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e}t.mul=i,t.sub=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=function e(){let t=new n.ARRAY_TYPE(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.clone=function e(t){let r=new n.ARRAY_TYPE(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},t.copy=function e(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},t.fromValues=function e(t,r,i,a,o,s,u,l,c,f,h,p,d,v,$,m){let y=new n.ARRAY_TYPE(16);return y[0]=t,y[1]=r,y[2]=i,y[3]=a,y[4]=o,y[5]=s,y[6]=u,y[7]=l,y[8]=c,y[9]=f,y[10]=h,y[11]=p,y[12]=d,y[13]=v,y[14]=$,y[15]=m,y},t.set=function e(t,r,n,i,a,o,s,u,l,c,f,h,p,d,v,$,m){return t[0]=r,t[1]=n,t[2]=i,t[3]=a,t[4]=o,t[5]=s,t[6]=u,t[7]=l,t[8]=c,t[9]=f,t[10]=h,t[11]=p,t[12]=d,t[13]=v,t[14]=$,t[15]=m,t},t.identity=function e(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.transpose=function e(t,r){if(t===r){let n=r[1],i=r[2],a=r[3],o=r[6],s=r[7],u=r[11];t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=n,t[6]=r[9],t[7]=r[13],t[8]=i,t[9]=o,t[11]=r[14],t[12]=a,t[13]=s,t[14]=u}else t[0]=r[0],t[1]=r[4],t[2]=r[8],t[3]=r[12],t[4]=r[1],t[5]=r[5],t[6]=r[9],t[7]=r[13],t[8]=r[2],t[9]=r[6],t[10]=r[10],t[11]=r[14],t[12]=r[3],t[13]=r[7],t[14]=r[11],t[15]=r[15];return t},t.invert=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],c=r[7],f=r[8],h=r[9],p=r[10],d=r[11],v=r[12],$=r[13],m=r[14],y=r[15],g=n*u-i*s,_=n*l-a*s,b=n*c-o*s,E=i*l-a*u,T=i*c-o*u,S=a*c-o*l,R=f*$-h*v,w=f*m-p*v,P=f*y-d*v,A=h*m-p*$,D=h*y-d*$,O=p*y-d*m,C=g*O-_*D+b*A+E*P-T*w+S*R;return C?(C=1/C,t[0]=(u*O-l*D+c*A)*C,t[1]=(a*D-i*O-o*A)*C,t[2]=($*S-m*T+y*E)*C,t[3]=(p*T-h*S-d*E)*C,t[4]=(l*P-s*O-c*w)*C,t[5]=(n*O-a*P+o*w)*C,t[6]=(m*b-v*S-y*_)*C,t[7]=(f*S-p*b+d*_)*C,t[8]=(s*D-u*P+c*R)*C,t[9]=(i*P-n*D-o*R)*C,t[10]=(v*T-$*b+y*g)*C,t[11]=(h*b-f*T-d*g)*C,t[12]=(u*w-s*A-l*R)*C,t[13]=(n*A-i*w+a*R)*C,t[14]=($*_-v*E-m*g)*C,t[15]=(f*E-h*_+p*g)*C,t):null},t.adjoint=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=r[4],u=r[5],l=r[6],c=r[7],f=r[8],h=r[9],p=r[10],d=r[11],v=r[12],$=r[13],m=r[14],y=r[15];return t[0]=u*(p*y-d*m)-h*(l*y-c*m)+$*(l*d-c*p),t[1]=-(i*(p*y-d*m)-h*(a*y-o*m)+$*(a*d-o*p)),t[2]=i*(l*y-c*m)-u*(a*y-o*m)+$*(a*c-o*l),t[3]=-(i*(l*d-c*p)-u*(a*d-o*p)+h*(a*c-o*l)),t[4]=-(s*(p*y-d*m)-f*(l*y-c*m)+v*(l*d-c*p)),t[5]=n*(p*y-d*m)-f*(a*y-o*m)+v*(a*d-o*p),t[6]=-(n*(l*y-c*m)-s*(a*y-o*m)+v*(a*c-o*l)),t[7]=n*(l*d-c*p)-s*(a*d-o*p)+f*(a*c-o*l),t[8]=s*(h*y-d*$)-f*(u*y-c*$)+v*(u*d-c*h),t[9]=-(n*(h*y-d*$)-f*(i*y-o*$)+v*(i*d-o*h)),t[10]=n*(u*y-c*$)-s*(i*y-o*$)+v*(i*c-o*u),t[11]=-(n*(u*d-c*h)-s*(i*d-o*h)+f*(i*c-o*u)),t[12]=-(s*(h*m-p*$)-f*(u*m-l*$)+v*(u*p-l*h)),t[13]=n*(h*m-p*$)-f*(i*m-a*$)+v*(i*p-a*h),t[14]=-(n*(u*m-l*$)-s*(i*m-a*$)+v*(i*l-a*u)),t[15]=n*(u*p-l*h)-s*(i*p-a*h)+f*(i*l-a*u),t},t.determinant=function e(t){let r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],$=t[14],m=t[15];return(r*s-n*o)*(h*m-p*$)-(r*u-i*o)*(f*m-p*v)+(r*l-a*o)*(f*$-h*v)+(n*u-i*s)*(c*m-p*d)-(n*l-a*s)*(c*$-h*d)+(i*l-a*u)*(c*v-f*d)},t.multiply=i,t.translate=function e(t,r,n){let i=n[0],a=n[1],o=n[2],s,u,l,c,f,h,p,d,v,$,m,y;return r===t?(t[12]=r[0]*i+r[4]*a+r[8]*o+r[12],t[13]=r[1]*i+r[5]*a+r[9]*o+r[13],t[14]=r[2]*i+r[6]*a+r[10]*o+r[14],t[15]=r[3]*i+r[7]*a+r[11]*o+r[15]):(s=r[0],u=r[1],l=r[2],c=r[3],f=r[4],h=r[5],p=r[6],d=r[7],v=r[8],$=r[9],m=r[10],y=r[11],t[0]=s,t[1]=u,t[2]=l,t[3]=c,t[4]=f,t[5]=h,t[6]=p,t[7]=d,t[8]=v,t[9]=$,t[10]=m,t[11]=y,t[12]=s*i+f*a+v*o+r[12],t[13]=u*i+h*a+$*o+r[13],t[14]=l*i+p*a+m*o+r[14],t[15]=c*i+d*a+y*o+r[15]),t},t.scale=function e(t,r,n){let i=n[0],a=n[1],o=n[2];return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=r[3]*i,t[4]=r[4]*a,t[5]=r[5]*a,t[6]=r[6]*a,t[7]=r[7]*a,t[8]=r[8]*o,t[9]=r[9]*o,t[10]=r[10]*o,t[11]=r[11]*o,t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],t},t.rotate=function e(t,r,i,a){let o=a[0],s=a[1],u=a[2],l=Math.sqrt(o*o+s*s+u*u),c,f,h,p,d,v,$,m,y,g,_,b,E,T,S,R,w,P,A,D,O,C,I,k;return Math.abs(l)<n.EPSILON?null:(o*=l=1/l,s*=l,u*=l,c=Math.sin(i),h=1-(f=Math.cos(i)),p=r[0],d=r[1],v=r[2],$=r[3],m=r[4],y=r[5],g=r[6],_=r[7],b=r[8],E=r[9],T=r[10],S=r[11],R=o*o*h+f,w=s*o*h+u*c,P=u*o*h-s*c,A=o*s*h-u*c,D=s*s*h+f,O=u*s*h+o*c,C=o*u*h+s*c,I=s*u*h-o*c,k=u*u*h+f,t[0]=p*R+m*w+b*P,t[1]=d*R+y*w+E*P,t[2]=v*R+g*w+T*P,t[3]=$*R+_*w+S*P,t[4]=p*A+m*D+b*O,t[5]=d*A+y*D+E*O,t[6]=v*A+g*D+T*O,t[7]=$*A+_*D+S*O,t[8]=p*C+m*I+b*k,t[9]=d*C+y*I+E*k,t[10]=v*C+g*I+T*k,t[11]=$*C+_*I+S*k,r!==t&&(t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t)},t.rotateX=function e(t,r,n){let i=Math.sin(n),a=Math.cos(n),o=r[4],s=r[5],u=r[6],l=r[7],c=r[8],f=r[9],h=r[10],p=r[11];return r!==t&&(t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[4]=o*a+c*i,t[5]=s*a+f*i,t[6]=u*a+h*i,t[7]=l*a+p*i,t[8]=c*a-o*i,t[9]=f*a-s*i,t[10]=h*a-u*i,t[11]=p*a-l*i,t},t.rotateY=function e(t,r,n){let i=Math.sin(n),a=Math.cos(n),o=r[0],s=r[1],u=r[2],l=r[3],c=r[8],f=r[9],h=r[10],p=r[11];return r!==t&&(t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=o*a-c*i,t[1]=s*a-f*i,t[2]=u*a-h*i,t[3]=l*a-p*i,t[8]=o*i+c*a,t[9]=s*i+f*a,t[10]=u*i+h*a,t[11]=l*i+p*a,t},t.rotateZ=function e(t,r,n){let i=Math.sin(n),a=Math.cos(n),o=r[0],s=r[1],u=r[2],l=r[3],c=r[4],f=r[5],h=r[6],p=r[7];return r!==t&&(t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15]),t[0]=o*a+c*i,t[1]=s*a+f*i,t[2]=u*a+h*i,t[3]=l*a+p*i,t[4]=c*a-o*i,t[5]=f*a-s*i,t[6]=h*a-u*i,t[7]=p*a-l*i,t},t.fromTranslation=function e(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},t.fromScaling=function e(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=r[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function e(t,r,i){let a=i[0],o=i[1],s=i[2],u=Math.sqrt(a*a+o*o+s*s),l,c,f;return Math.abs(u)<n.EPSILON?null:(a*=u=1/u,o*=u,s*=u,l=Math.sin(r),f=1-(c=Math.cos(r)),t[0]=a*a*f+c,t[1]=o*a*f+s*l,t[2]=s*a*f-o*l,t[3]=0,t[4]=a*o*f-s*l,t[5]=o*o*f+c,t[6]=s*o*f+a*l,t[7]=0,t[8]=a*s*f+o*l,t[9]=o*s*f-a*l,t[10]=s*s*f+c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},t.fromXRotation=function e(t,r){let n=Math.sin(r),i=Math.cos(r);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromYRotation=function e(t,r){let n=Math.sin(r),i=Math.cos(r);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromZRotation=function e(t,r){let n=Math.sin(r),i=Math.cos(r);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotationTranslation=function e(t,r,n){let i=r[0],a=r[1],o=r[2],s=r[3],u=i+i,l=a+a,c=o+o,f=i*u,h=i*l,p=i*c,d=a*l,v=a*c,$=o*c,m=s*u,y=s*l,g=s*c;return t[0]=1-(d+$),t[1]=h+g,t[2]=p-y,t[3]=0,t[4]=h-g,t[5]=1-(f+$),t[6]=v+m,t[7]=0,t[8]=p+y,t[9]=v-m,t[10]=1-(f+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},t.getTranslation=function e(t,r){return t[0]=r[12],t[1]=r[13],t[2]=r[14],t},t.getScaling=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[4],s=r[5],u=r[6],l=r[8],c=r[9],f=r[10];return t[0]=Math.sqrt(n*n+i*i+a*a),t[1]=Math.sqrt(o*o+s*s+u*u),t[2]=Math.sqrt(l*l+c*c+f*f),t},t.getRotation=function e(t,r){let n=r[0]+r[5]+r[10],i=0;return n>0?(i=2*Math.sqrt(n+1),t[3]=.25*i,t[0]=(r[6]-r[9])/i,t[1]=(r[8]-r[2])/i,t[2]=(r[1]-r[4])/i):r[0]>r[5]&r[0]>r[10]?(i=2*Math.sqrt(1+r[0]-r[5]-r[10]),t[3]=(r[6]-r[9])/i,t[0]=.25*i,t[1]=(r[1]+r[4])/i,t[2]=(r[8]+r[2])/i):r[5]>r[10]?(i=2*Math.sqrt(1+r[5]-r[0]-r[10]),t[3]=(r[8]-r[2])/i,t[0]=(r[1]+r[4])/i,t[1]=.25*i,t[2]=(r[6]+r[9])/i):(i=2*Math.sqrt(1+r[10]-r[0]-r[5]),t[3]=(r[1]-r[4])/i,t[0]=(r[8]+r[2])/i,t[1]=(r[6]+r[9])/i,t[2]=.25*i),t},t.fromRotationTranslationScale=function e(t,r,n,i){let a=r[0],o=r[1],s=r[2],u=r[3],l=a+a,c=o+o,f=s+s,h=a*l,p=a*c,d=a*f,v=o*c,$=o*f,m=s*f,y=u*l,g=u*c,_=u*f,b=i[0],E=i[1],T=i[2];return t[0]=(1-(v+m))*b,t[1]=(p+_)*b,t[2]=(d-g)*b,t[3]=0,t[4]=(p-_)*E,t[5]=(1-(h+m))*E,t[6]=($+y)*E,t[7]=0,t[8]=(d+g)*T,t[9]=($-y)*T,t[10]=(1-(h+v))*T,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},t.fromRotationTranslationScaleOrigin=function e(t,r,n,i,a){let o=r[0],s=r[1],u=r[2],l=r[3],c=o+o,f=s+s,h=u+u,p=o*c,d=o*f,v=o*h,$=s*f,m=s*h,y=u*h,g=l*c,_=l*f,b=l*h,E=i[0],T=i[1],S=i[2],R=a[0],w=a[1],P=a[2];return t[0]=(1-($+y))*E,t[1]=(d+b)*E,t[2]=(v-_)*E,t[3]=0,t[4]=(d-b)*T,t[5]=(1-(p+y))*T,t[6]=(m+g)*T,t[7]=0,t[8]=(v+_)*S,t[9]=(m-g)*S,t[10]=(1-(p+$))*S,t[11]=0,t[12]=n[0]+R-(t[0]*R+t[4]*w+t[8]*P),t[13]=n[1]+w-(t[1]*R+t[5]*w+t[9]*P),t[14]=n[2]+P-(t[2]*R+t[6]*w+t[10]*P),t[15]=1,t},t.fromQuat=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=n+n,u=i+i,l=a+a,c=n*s,f=i*s,h=i*u,p=a*s,d=a*u,v=a*l,$=o*s,m=o*u,y=o*l;return t[0]=1-h-v,t[1]=f+y,t[2]=p-m,t[3]=0,t[4]=f-y,t[5]=1-c-v,t[6]=d+$,t[7]=0,t[8]=p+m,t[9]=d-$,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.frustum=function e(t,r,n,i,a,o,s){let u=1/(n-r),l=1/(a-i),c=1/(o-s);return t[0]=2*o*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*l,t[6]=0,t[7]=0,t[8]=(n+r)*u,t[9]=(a+i)*l,t[10]=(s+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*c,t[15]=0,t},t.perspective=function e(t,r,n,i,a){let o=1/Math.tan(r/2),s=1/(i-a);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(a+i)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*a*i*s,t[15]=0,t},t.perspectiveFromFieldOfView=function e(t,r,n,i){let a=Math.tan(r.upDegrees*Math.PI/180),o=Math.tan(r.downDegrees*Math.PI/180),s=Math.tan(r.leftDegrees*Math.PI/180),u=Math.tan(r.rightDegrees*Math.PI/180),l=2/(s+u),c=2/(a+o);return t[0]=l,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-((s-u)*l*.5),t[9]=(a-o)*c*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},t.ortho=function e(t,r,n,i,a,o,s){let u=1/(r-n),l=1/(i-a),c=1/(o-s);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(r+n)*u,t[13]=(a+i)*l,t[14]=(s+o)*c,t[15]=1,t},t.lookAt=function e(t,r,i,a){let o,s,u,l,c,f,h,p,d,v,$=r[0],m=r[1],y=r[2],g=a[0],_=a[1],b=a[2],E=i[0],T=i[1],S=i[2];return Math.abs($-E)<n.EPSILON&&Math.abs(m-T)<n.EPSILON&&Math.abs(y-S)<n.EPSILON?mat4.identity(t):(h=$-E,v=1/Math.sqrt(h*h+(p=m-T)*p+(d=y-S)*d),h*=v,p*=v,d*=v,o=_*d-b*p,(v=Math.sqrt(o*o+(s=b*h-g*d)*s+(u=g*p-_*h)*u))?(o*=v=1/v,s*=v,u*=v):(o=0,s=0,u=0),l=p*u-d*s,(v=Math.sqrt(l*l+(c=d*o-h*u)*c+(f=h*s-p*o)*f))?(l*=v=1/v,c*=v,f*=v):(l=0,c=0,f=0),t[0]=o,t[1]=l,t[2]=h,t[3]=0,t[4]=s,t[5]=c,t[6]=p,t[7]=0,t[8]=u,t[9]=f,t[10]=d,t[11]=0,t[12]=-(o*$+s*m+u*y),t[13]=-(l*$+c*m+f*y),t[14]=-(h*$+p*m+d*y),t[15]=1,t)},t.targetTo=function e(t,r,n,i){let a=r[0],o=r[1],s=r[2],u=i[0],l=i[1],c=i[2],f=a-n[0],h=o-n[1],p=s-n[2],d=f*f+h*h+p*p;d>0&&(f*=d=1/Math.sqrt(d),h*=d,p*=d);let v=l*p-c*h,$=c*f-u*p,m=u*h-l*f;return t[0]=v,t[1]=$,t[2]=m,t[3]=0,t[4]=h*m-p*$,t[5]=p*v-f*m,t[6]=f*$-h*v,t[7]=0,t[8]=f,t[9]=h,t[10]=p,t[11]=0,t[12]=a,t[13]=o,t[14]=s,t[15]=1,t},t.str=function e(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},t.frob=function e(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2)+Math.pow(t[3],2)+Math.pow(t[4],2)+Math.pow(t[5],2)+Math.pow(t[6],2)+Math.pow(t[7],2)+Math.pow(t[8],2)+Math.pow(t[9],2)+Math.pow(t[10],2)+Math.pow(t[11],2)+Math.pow(t[12],2)+Math.pow(t[13],2)+Math.pow(t[14],2)+Math.pow(t[15],2))},t.add=function e(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t[4]=r[4]+n[4],t[5]=r[5]+n[5],t[6]=r[6]+n[6],t[7]=r[7]+n[7],t[8]=r[8]+n[8],t[9]=r[9]+n[9],t[10]=r[10]+n[10],t[11]=r[11]+n[11],t[12]=r[12]+n[12],t[13]=r[13]+n[13],t[14]=r[14]+n[14],t[15]=r[15]+n[15],t},t.subtract=a,t.multiplyScalar=function e(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*n,t[5]=r[5]*n,t[6]=r[6]*n,t[7]=r[7]*n,t[8]=r[8]*n,t[9]=r[9]*n,t[10]=r[10]*n,t[11]=r[11]*n,t[12]=r[12]*n,t[13]=r[13]*n,t[14]=r[14]*n,t[15]=r[15]*n,t},t.multiplyScalarAndAdd=function e(t,r,n,i){return t[0]=r[0]+n[0]*i,t[1]=r[1]+n[1]*i,t[2]=r[2]+n[2]*i,t[3]=r[3]+n[3]*i,t[4]=r[4]+n[4]*i,t[5]=r[5]+n[5]*i,t[6]=r[6]+n[6]*i,t[7]=r[7]+n[7]*i,t[8]=r[8]+n[8]*i,t[9]=r[9]+n[9]*i,t[10]=r[10]+n[10]*i,t[11]=r[11]+n[11]*i,t[12]=r[12]+n[12]*i,t[13]=r[13]+n[13]*i,t[14]=r[14]+n[14]*i,t[15]=r[15]+n[15]*i,t},t.exactEquals=function e(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]&&t[6]===r[6]&&t[7]===r[7]&&t[8]===r[8]&&t[9]===r[9]&&t[10]===r[10]&&t[11]===r[11]&&t[12]===r[12]&&t[13]===r[13]&&t[14]===r[14]&&t[15]===r[15]},t.equals=function e(t,r){let i=t[0],a=t[1],o=t[2],s=t[3],u=t[4],l=t[5],c=t[6],f=t[7],h=t[8],p=t[9],d=t[10],v=t[11],$=t[12],m=t[13],y=t[14],g=t[15],_=r[0],b=r[1],E=r[2],T=r[3],S=r[4],R=r[5],w=r[6],P=r[7],A=r[8],D=r[9],O=r[10],C=r[11],I=r[12],k=r[13],x=r[14],M=r[15];return Math.abs(i-_)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(a-b)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))&&Math.abs(o-E)<=n.EPSILON*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(s-T)<=n.EPSILON*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(u-S)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(l-R)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(R))&&Math.abs(c-w)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(w))&&Math.abs(f-P)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(h-A)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(p-D)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(D))&&Math.abs(d-O)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(v-C)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(C))&&Math.abs($-I)<=n.EPSILON*Math.max(1,Math.abs($),Math.abs(I))&&Math.abs(m-k)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(k))&&Math.abs(y-x)<=n.EPSILON*Math.max(1,Math.abs(y),Math.abs(x))&&Math.abs(g-M)<=n.EPSILON*Math.max(1,Math.abs(g),Math.abs(M))};var n=r(5);function i(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],p=t[10],d=t[11],v=t[12],$=t[13],m=t[14],y=t[15],g=r[0],_=r[1],b=r[2],E=r[3];return e[0]=g*n+_*s+b*f+E*v,e[1]=g*i+_*u+b*h+E*$,e[2]=g*a+_*l+b*p+E*m,e[3]=g*o+_*c+b*d+E*y,g=r[4],_=r[5],b=r[6],E=r[7],e[4]=g*n+_*s+b*f+E*v,e[5]=g*i+_*u+b*h+E*$,e[6]=g*a+_*l+b*p+E*m,e[7]=g*o+_*c+b*d+E*y,g=r[8],_=r[9],b=r[10],E=r[11],e[8]=g*n+_*s+b*f+E*v,e[9]=g*i+_*u+b*h+E*$,e[10]=g*a+_*l+b*p+E*m,e[11]=g*o+_*c+b*d+E*y,g=r[12],_=r[13],b=r[14],E=r[15],e[12]=g*n+_*s+b*f+E*v,e[13]=g*i+_*u+b*h+E*$,e[14]=g*a+_*l+b*p+E*m,e[15]=g*o+_*c+b*d+E*y,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e[3]=t[3]-r[3],e[4]=t[4]-r[4],e[5]=t[5]-r[5],e[6]=t[6]-r[6],e[7]=t[7]-r[7],e[8]=t[8]-r[8],e[9]=t[9]-r[9],e[10]=t[10]-r[10],e[11]=t[11]-r[11],e[12]=t[12]-r[12],e[13]=t[13]-r[13],e[14]=t[14]-r[14],e[15]=t[15]-r[15],e}t.mul=i,t.sub=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=s,t.identity=function e(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},t.setAxisAngle=u,t.getAxisAngle=function e(t,r){let n=2*Math.acos(r[3]),i=Math.sin(n/2);return 0!=i?(t[0]=r[0]/i,t[1]=r[1]/i,t[2]=r[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},t.multiply=l,t.rotateX=function e(t,r,n){n*=.5;let i=r[0],a=r[1],o=r[2],s=r[3],u=Math.sin(n),l=Math.cos(n);return t[0]=i*l+s*u,t[1]=a*l+o*u,t[2]=o*l-a*u,t[3]=s*l-i*u,t},t.rotateY=function e(t,r,n){n*=.5;let i=r[0],a=r[1],o=r[2],s=r[3],u=Math.sin(n),l=Math.cos(n);return t[0]=i*l-o*u,t[1]=a*l+s*u,t[2]=o*l+i*u,t[3]=s*l-a*u,t},t.rotateZ=function e(t,r,n){n*=.5;let i=r[0],a=r[1],o=r[2],s=r[3],u=Math.sin(n),l=Math.cos(n);return t[0]=i*l+a*u,t[1]=a*l-i*u,t[2]=o*l+s*u,t[3]=s*l-o*u,t},t.calculateW=function e(t,r){let n=r[0],i=r[1],a=r[2];return t[0]=n,t[1]=i,t[2]=a,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-a*a)),t},t.slerp=c,t.invert=function e(t,r){let n=r[0],i=r[1],a=r[2],o=r[3],s=n*n+i*i+a*a+o*o,u=s?1/s:0;return t[0]=-n*u,t[1]=-i*u,t[2]=-a*u,t[3]=o*u,t},t.conjugate=function e(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=r[3],t},t.fromMat3=f,t.fromEuler=function e(t,r,n,i){let a=.5*Math.PI/180;r*=a;let o=Math.sin(r),s=Math.cos(r),u=Math.sin(n*=a),l=Math.cos(n),c=Math.sin(i*=a),f=Math.cos(i);return t[0]=o*l*f-s*u*c,t[1]=s*u*f+o*l*c,t[2]=s*l*c-o*u*f,t[3]=s*l*f+o*u*c,t},t.str=function e(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"};var n=r(5),i=r(31),a=r(32),o=r(33);function s(){let e=new n.ARRAY_TYPE(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function u(e,t,r){let n=Math.sin(r*=.5);return e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r),e}function l(e,t,r){let n=t[0],i=t[1],a=t[2],o=t[3],s=r[0],u=r[1],l=r[2],c=r[3];return e[0]=n*c+o*s+i*l-a*u,e[1]=i*c+o*u+a*s-n*l,e[2]=a*c+o*l+n*u-i*s,e[3]=o*c-n*s-i*u-a*l,e}function c(e,t,r,n){let i=t[0],a=t[1],o=t[2],s=t[3],u=r[0],l=r[1],c=r[2],f=r[3],h,p,d,v,$;return(p=i*u+a*l+o*c+s*f)<0&&(p=-p,u=-u,l=-l,c=-c,f=-f),1-p>1e-6?(v=Math.sin((1-n)*h)/(d=Math.sin(h=Math.acos(p))),$=Math.sin(n*h)/d):(v=1-n,$=n),e[0]=v*i+$*u,e[1]=v*a+$*l,e[2]=v*o+$*c,e[3]=v*s+$*f,e}function f(e,t){let r=t[0]+t[4]+t[8],n;if(r>0)n=Math.sqrt(r+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);let a=(i+1)%3,o=(i+2)%3;n=Math.sqrt(t[3*i+i]-t[3*a+a]-t[3*o+o]+1),e[i]=.5*n,n=.5/n,e[3]=(t[3*a+o]-t[3*o+a])*n,e[a]=(t[3*a+i]+t[3*i+a])*n,e[o]=(t[3*o+i]+t[3*i+o])*n}return e}let h=o.clone;t.clone=h;let p=o.fromValues;t.fromValues=p;let d=o.copy;t.copy=d;let v=o.set;t.set=v;let $=o.add;t.add=$,t.mul=l;let m=o.scale;t.scale=m;let y=o.dot;t.dot=y;let g=o.lerp;t.lerp=g;let _=o.length;t.length=_,t.len=_;let b=o.squaredLength;t.squaredLength=b,t.sqrLen=b;let E=o.normalize;t.normalize=E;let T=o.exactEquals;t.exactEquals=T;let S=o.equals;t.equals=S;let R,w,P,A=(R=a.create(),w=a.fromValues(1,0,0),P=a.fromValues(0,1,0),function(e,t,r){let n=a.dot(t,r);return n<-.999999?(a.cross(R,w,t),1e-6>a.len(R)&&a.cross(R,P,t),a.normalize(R,R),u(e,R,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(a.cross(R,t,r),e[0]=R[0],e[1]=R[1],e[2]=R[2],e[3]=1+n,E(e,e))});t.rotationTo=A;let D,O,C=(D=s(),O=s(),function(e,t,r,n,i,a){return c(D,t,i,a),c(O,r,n,a),c(e,D,O,2*a*(1-a)),e});t.sqlerp=C;let I,k=(I=i.create(),function(e,t,r,n){return I[0]=r[0],I[3]=r[1],I[6]=r[2],I[1]=n[0],I[4]=n[1],I[7]=n[2],I[2]=-t[0],I[5]=-t[1],I[8]=-t[2],E(e,f(e,I))});t.setAxes=k},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=i,t.clone=function e(t){let r=new n.ARRAY_TYPE(2);return r[0]=t[0],r[1]=t[1],r},t.fromValues=function e(t,r){let i=new n.ARRAY_TYPE(2);return i[0]=t,i[1]=r,i},t.copy=function e(t,r){return t[0]=r[0],t[1]=r[1],t},t.set=function e(t,r,n){return t[0]=r,t[1]=n,t},t.add=function e(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t},t.subtract=a,t.multiply=o,t.divide=s,t.ceil=function e(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t},t.floor=function e(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t},t.min=function e(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t},t.max=function e(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t},t.round=function e(t,r){return t[0]=Math.round(r[0]),t[1]=Math.round(r[1]),t},t.scale=function e(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t},t.scaleAndAdd=function e(t,r,n,i){return t[0]=r[0]+n[0]*i,t[1]=r[1]+n[1]*i,t},t.distance=u,t.squaredDistance=l,t.length=c,t.squaredLength=f,t.negate=function e(t,r){return t[0]=-r[0],t[1]=-r[1],t},t.inverse=function e(t,r){return t[0]=1/r[0],t[1]=1/r[1],t},t.normalize=function e(t,r){var n=r[0],i=r[1],a=n*n+i*i;return a>0&&(a=1/Math.sqrt(a),t[0]=r[0]*a,t[1]=r[1]*a),t},t.dot=function e(t,r){return t[0]*r[0]+t[1]*r[1]},t.cross=function e(t,r,n){var i=r[0]*n[1]-r[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},t.lerp=function e(t,r,n,i){var a=r[0],o=r[1];return t[0]=a+i*(n[0]-a),t[1]=o+i*(n[1]-o),t},t.random=function e(t,r){r=r||1;var i=2*n.RANDOM()*Math.PI;return t[0]=Math.cos(i)*r,t[1]=Math.sin(i)*r,t},t.transformMat2=function e(t,r,n){var i=r[0],a=r[1];return t[0]=n[0]*i+n[2]*a,t[1]=n[1]*i+n[3]*a,t},t.transformMat2d=function e(t,r,n){var i=r[0],a=r[1];return t[0]=n[0]*i+n[2]*a+n[4],t[1]=n[1]*i+n[3]*a+n[5],t},t.transformMat3=function e(t,r,n){var i=r[0],a=r[1];return t[0]=n[0]*i+n[3]*a+n[6],t[1]=n[1]*i+n[4]*a+n[7],t},t.transformMat4=function e(t,r,n){let i=r[0],a=r[1];return t[0]=n[0]*i+n[4]*a+n[12],t[1]=n[1]*i+n[5]*a+n[13],t},t.str=function e(t){return"vec2("+t[0]+", "+t[1]+")"},t.exactEquals=function e(t,r){return t[0]===r[0]&&t[1]===r[1]},t.equals=function e(t,r){let i=t[0],a=t[1],o=r[0],s=r[1];return Math.abs(i-o)<=n.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(a-s)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(s))};var n=r(5);function i(){let e=new n.ARRAY_TYPE(2);return e[0]=0,e[1]=0,e}function a(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function o(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e}function s(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e}function u(e,t){var r=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(r*r+n*n)}function l(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n}function c(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function f(e){var t=e[0],r=e[1];return t*t+r*r}t.len=c,t.sub=a,t.mul=o,t.div=s,t.dist=u,t.sqrDist=l,t.sqrLen=f;let h,p=(h=i(),function(e,t,r,n,i,a){let o,s;for(t||(t=2),r||(r=0),s=n?Math.min(n*t+r,e.length):e.length,o=r;o<s;o+=t)h[0]=e[o],h[1]=e[o+1],i(h,h,a),e[o]=h[0],e[o+1]=h[1];return e});t.forEach=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quat=void 0;var n=r(11);t.quat=n.quat,n.quat.exp=function(e,t){var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);return r?(e[0]=Math.sin(r)*t[0]/r,e[1]=Math.sin(r)*t[1]/r,e[2]=Math.sin(r)*t[2]/r,e[3]=Math.cos(r)):(e[0]=0,e[1]=0,e[2]=0,e[3]=1),e},n.quat.ln=function(e,t){var r=n.quat.length(t);if(r>1.0001||r<.99999)e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0;else if(r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])){var i=Math.atan2(r,t[3])/r;e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=0}else e[0]=0,e[1]=0,e[2]=0,e[3]=0;return e},n.quat.pow=function(e,t,r){return 1===r?n.quat.copy(e,t):(n.quat.ln(e,t),e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,n.quat.exp(e,e),e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=void 0;var n=r(11);t.mat3=n.mat3},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4=void 0;var n,i,a,o,s=r(11);t.mat4=s.mat4,s.mat4.arcFromForward=(n=void 0,function e(t,r){n||(n=s.vec3.create());var i=s.vec3.normalize(n,r);if(s.mat4.identity(t),i[2]<-.99999)return t;if(i[2]>.99999)return t[5]=-1,t[10]=-1,t;var a=(1+i[2])/(i[0]*i[0]+i[1]*i[1]);return t[0]=a*i[1]*i[1]-i[2],t[1]=-a*i[0]*i[1],t[2]=i[0],t[4]=t[1],t[5]=a*i[0]*i[0]-i[2],t[6]=i[1],t[8]=-i[0],t[9]=-i[1],t[10]=-i[2],t}),s.mat4.copyTranslation=function(e,t){return e[12]=t[12],e[13]=t[13],e[14]=t[14],e},s.mat4.fromMat3=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[4]=t[3],e[5]=t[4],e[6]=t[5],e[8]=t[6],e[9]=t[7],e[10]=t[8],e[3]=e[7]=e[11]=e[12]=e[13]=e[14]=0,e[15]=1,e},s.mat4.lookAtGL=(i=void 0,a=void 0,o=void 0,function e(t,r,n,u){return i||(i=s.vec3.create(),a=s.vec3.create(),o=s.vec3.create()),s.vec3.subtract(o,r,n),0===s.vec3.squaredLength(o)&&(o[2]=1),s.vec3.normalize(o,o),s.vec3.cross(i,u,o),0===s.vec3.squaredLength(i)&&(o[2]+=1e-4,s.vec3.cross(i,u,o)),s.vec3.normalize(i,i),s.vec3.cross(a,o,i),t[0]=i[0],t[1]=i[1],t[2]=i[2],t[4]=a[0],t[5]=a[1],t[6]=a[2],t[8]=o[0],t[9]=o[1],t[10]=o[2],t}),s.mat4.perspectiveGL=function(e,t,r,n,i){var a=Math.tan(t/360*Math.PI)*n,o=a*r;return s.mat4.frustum(e,-o,o,-a,a,n,i),e},s.mat4.setTranslation=function(e,t){return e[12]=t[0],e[13]=t[1],e[14]=t[2],e},s.mat4.setTranslationFromValues=function(e,t,r,n){return e[12]=t,e[13]=r,e[14]=n,e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noise=void 0;var n,i,a,o,s,u,l,c=r(34),f=r(35),h=t.noise={};h.turbulence=(n=[],i=[],a=[],o=!1,function e(t,r,s,u,l,h){o||function e(){for(var t=0;t<256;t++)n[t]=f.vec4.fromValues(Math.random()-.5,Math.random()-.5,Math.random()-.5,Math.random()-.5),i[t]=t;for(var r=256;--r;){var s=i[r],u=Math.floor(256*Math.random());i[r]=i[u],i[u]=s}for(var l=0;l<256;l++)i[256+l]=i[l],n[256+l]=n[l],n[512+l]=n[l];for(var h=0;h<15;++h)a[h]=c.vec3.create();o=!0}(),s+=4096,u+=4096,l+=4096;var p=Math.floor(r+=4096),d=Math.floor(s),v=Math.floor(u),$=Math.floor(l),m=r-p,y=s-d,g=u-v,_=l-$,b=(p&=255)+1,E=(d&=255)+1,T=(v&=255)+1,S=($&=255)+1,R=i[p],w=i[b],P=i[R+d],A=i[w+d],D=i[R+E],O=i[w+E],C=c.vec3.lerp(a[0],n[P+v+$],n[A+v+$],m),I=c.vec3.lerp(a[1],n[D+v+$],n[O+v+$],m),k=c.vec3.lerp(a[2],n[P+T+$],n[A+T+$],m),x=c.vec3.lerp(a[3],n[P+T+$],n[A+T+$],m),M=c.vec3.lerp(a[4],C,I,y),L=c.vec3.lerp(a[5],k,x,y),B=c.vec3.lerp(a[6],M,L,g);C=c.vec3.lerp(a[7],n[P+v+S],n[A+v+S],m),I=c.vec3.lerp(a[8],n[D+v+S],n[O+v+S],m),k=c.vec3.lerp(a[9],n[P+T+S],n[A+T+S],m),x=c.vec3.lerp(a[10],n[P+T+S],n[A+T+S],m),M=c.vec3.lerp(a[11],C,I,y),L=c.vec3.lerp(a[12],k,x,y);var F=c.vec3.lerp(a[13],M,L,g),G=c.vec3.lerp(a[14],B,F,_);return t[0]+=G[0]*h,t[1]+=G[1]*h,t[2]+=G[2]*h,t}),h.perlin1=(s=!1,u=null,l=null,function e(t){s||function e(){u=Array(514),l=Array(514);var t=0,r=0,n=0;for(t=0;t<256;t++)u[t]=t,l[t]=2*Math.random()-1;for(;--t;)n=u[t],u[t]=u[r=Math.floor(256*Math.random())],u[r]=n;for(t=0;t<258;t++)u[256+t]=u[t],l[256+t]=l[t];s=!0}();var r=t+4096,n=255&Math.floor(r),i=r-Math.floor(r),a=i*l[u[n]],o=(i-1)*l[u[n+1&255]];return a+i*i*(3-2*i)*(o-a)}),h.perlin1D=function(e,t,r,n){for(var i=0,a=e,o=1,s=0;s<n;++s)i+=h.perlin1(a)/o,o*=t,a*=r;return i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.curve={};n.evaluate=function(e,t,r,n,i){for(var a=e.knots.length,o=a-1,s=0,u=0;u<e.knots.length;++u)if(e.knots[u]>t){o=u;break}if(0===e.degree)for(var l=0;l<e.dimension;++l)r[l]=e.controls[o*e.dimension+l];else if(1===e.degree){var c=n?(o+a-1)%a:0===o?0:o-1,f=e.knots[o]-e.knots[c];f<0&&(f+=i),f>0&&(s=(t-e.knots[e.knots.length-1])/f);for(var h=0;h<e.dimension;++h)r[h]=e.controls[c*e.dimension+h]*(1-s)+e.controls[o*e.dimension+h]*s}else{var p=n?(o+a-2)%a:0===o?0:o-2,d=n?(o+a-1)%a:0===o?0:o-1,v=p*e.dimension,$=d*e.dimension,m=o*e.dimension,y=e.knots[p],g=e.knots[d],_=e.knots[o],b=e.knots[(o+1)%a];y>_&&(_+=i,b+=i,t+=i),g>_&&(_+=i,b+=i,t+=i),b<_&&(b+=i);var E,T,S=t-g,R=_-g,w=S/R,P=(t-y)/(_-y),A=P+w-w*P,D=w*(S/(b-g)),O=A-D;A=1-A;for(var C=0;C<e.dimension;++C)r[C]=A*e.controls[v+C]+O*e.controls[$+C]+D*e.controls[m+C]}},n.ag_horner1=function(e,t,r){for(var n=e[t];--t>=0;)n=r*n+e[t];return n},n.ag_zeroin2=function(e,t,r,i,a,o){var s=void 0,u=void 0,l=void 0,c=void 0,f=void 0,h=void 0,p=void 0,d=void 0,v=void 0,$=void 0,m=void 0,y=void 0;d=1192092896e-16;for(var g=!0;;)if(g&&(u=e,f=r,c=l=t-e),Math.abs(f)<Math.abs(i)&&(e=t,t=u,u=e,r=i,i=f,f=r),g=!1,h=2*d*Math.abs(t)+.5*a,s=Math.abs(p=.5*(u-t))>h&&0!==i)Math.abs(c)<h||Math.abs(r)<=Math.abs(i)?c=l=p:(y=i/r,e===u?(v=2*p*y,$=1-y):(v=y*(2*p*($=r/f)*($-(m=i/f))-(t-e)*(m-1)),$=($-1)*(m-1)*(y-1)),v>0?$=-$:v=-v,y=c,c=l,2*v<3*p*$-Math.abs(h*$)&&v<Math.abs(.5*y*$)?l=v/$:c=l=p),e=t,r=i,Math.abs(l)>h?t+=l:p>0?t+=h:t-=h,(i=n.ag_horner1(o.p,o.deg,t))*(f/Math.abs(f))>0&&(g=!0);else break;return t},n.ag_zeroin=function(e,t,r,i){var a=void 0,o=void 0;return 1192092896e-16>Math.abs(a=n.ag_horner1(i.p,i.deg,e))?e:1192092896e-16>Math.abs(o=n.ag_horner1(i.p,i.deg,t))?t:n.ag_zeroin2(e,t,a,o,r,i)},n.polyZeroes=function(e,t,r,i,a,o,s){var u=void 0,l=void 0,c=void 0,f=void 0,h=void 0,p=void 0,d=void 0,v=void 0,$=void 0,m=void 0,y=void 0,g=void 0,_=void 0,b=Array(22),E=void 0,T=Array(22),S=void 0,R=Array(22),w={p:[],deg:0};for(u=0,d=m=0,v=0;u<t+1;++u)v+=Math.abs(e[u]);if(v<=(g=(Math.abs(r)+Math.abs(a))*(t+1)*1192092896e-16))return -1;for(u=0,_=b,E=T,S=R;u<t+1;++u)_[u]=1/v*e[u];for(;Math.abs(_[t])<g;)t--;if(f=0,0===t)return f;if(1===t)s[0]=-_[0]/_[1],l=i?r<s[0]+g:r<s[0]-g,c=o?a>s[0]-g:a>s[0]+g,(f=l&&c?1:0)&&(i&&s[0]<r?s[0]=r:o&&s[0]>a&&(s[0]=a));else{for(u=1,w.p=_,w.deg=t;u<=t;u++)E[u-1]=u*_[u];if(0===(h=n.polyZeroes(E,t-1,r,0,a,0,S)).length)return 0;for(u=p=0;u<=h&&!(f>t);u++)0===u?($=r,Math.abs(y=n.ag_horner1(_,t,$))<=g&&i&&(s[f++]=r)):($=d,y=m),u===h?(d=a,p=0):d=S[u],m=n.ag_horner1(_,t,d),p?p=0:Math.abs(m)<g?(u!==h||o)&&(s[f++]=d,p=1):(y<0&&m>0||y>0&&m<0)&&(s[f++]=n.ag_zeroin($,d,0,w),f>1&&s[f-2]>=s[f-1]-g&&(s[f-2]=(s[f-2]+s[f-1])*.5,f--))}return f}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.util={};n.addToArray=function(e){for(var t=!1,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0;a<n.length;a++)-1!==e.indexOf(n[a])&&(e.push(n[a]),t=!0);return t},n.assignIfExists=function(e,t,r){if(t){r=n.toArray(r);for(var i=0;i<r.length;i++){var a=r[i];void 0!==t[a]&&(n.isTyped(e[a])?e[a].length!==t[a].length?e[a]=new e[a].constructor(t[a]):e[a].set(t[a]):n.isTyped(t[a])?e[a]=new t[a].constructor(t[a]):e[a]=t[a])}}};var i,a=null,o=(i=0,function e(){return i++}),s=function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16).toUpperCase();return function t(){var r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&a]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255]}}();n.enableUUID=function(e){if(null!==a&&e!==a)throw Error("Cannot change id generation type once used");a=e},n.generateID=function(){return null===a&&(a=!1),a?s():o()},n.get=function(e,t,r){return e&&t in e?e[t]:r},n.isArray=Array.isArray,n.isArrayLike=function(e){return!!e&&(n.isArray(e)||n.isTyped(e))},n.isVector=function(e){if(e){if(n.isTyped(e))return!0;if(n.isArray(e)){for(var t=0;t<e.length;t++)if("number"!=typeof e[t])return!1;return!0}}return!1},n.isTyped=function(e){return!!e&&!!(e.buffer instanceof ArrayBuffer&&e.BYTES_PER_ELEMENT)},n.perArrayChild=function(e,t){for(var r,n=e.length,i=arguments.length,a=Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];for(var s=0;s<n;s++)t in e&&(r=e[s])[t].apply(r,a)},n.removeFromArray=function(e){for(var t=!1,r=arguments.length,n=Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var a=0;a<n.length;a++){var o=e.indexOf(n[a]);-1!==o&&(e.splice(o,1),t=!0)}return t},n.toArray=function(e){return Array.isArray(e)?e:[e]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MotherLode=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4);t.Tw2MotherLode=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._loadedObjects={},this._errors={}}return n(e,[{key:"AddError",value:function e(t,r){this._errors[t]=this._errors[t]||[],this._errors[t].includes(r)||this._errors[t].push(r)}},{key:"GetErrors",value:function e(t){return t&&t in this._errors?Object.assign([],this._errors[t]):null}},{key:"Find",value:function e(t){return t in this._loadedObjects?this._loadedObjects[t]:null}},{key:"Add",value:function e(t,r){this._loadedObjects[t]=r}},{key:"Remove",value:function e(t){delete this._loadedObjects[t]}},{key:"Clear",value:function e(){this._loadedObjects={}}},{key:"UnloadAndClear",value:function e(){for(var t in this._loadedObjects)this._loadedObjects.hasOwnProperty(t)&&this._loadedObjects[t].Unload();this._loadedObjects={}}},{key:"PurgeInactive",value:function e(t,r,n){for(var a in this._loadedObjects)if(this._loadedObjects.hasOwnProperty(a)){var o=this._loadedObjects[a];!o.doNotPurge&&(o._isPurged&&(i.logger.log("res.event",{msg:"Unloaded  ",path:o.path,type:"purged"}),delete this._loadedObjects[a]),o._isGood&&(t-o.activeFrame)%r>=n&&o.Unload()&&(i.logger.log("res.event",{msg:"Unloaded  ",path:o.path,type:"unused"}),delete this._loadedObjects[a]))}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SamplerOverride=void 0;var n=r(2),i=r(42);t.Tw2SamplerOverride=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.addressU=0,this.addressV=0,this.addressW=0,this.filter=0,this.mipFilter=0,this.lodBias=0,this.maxMipLevel=0,this.maxAnisotropy=0;var t=null;this.GetSampler=function(e){if(!t){if((t=new i.Tw2SamplerState).registerIndex=e.registerIndex,t.name=e.name,1===this.filter){switch(this.mipFilter){case 0:t.minFilter=n.device.gl.NEAREST;break;case 1:t.minFilter=n.device.gl.NEAREST_MIPMAP_NEAREST;break;default:t.minFilter=n.device.gl.NEAREST_MIPMAP_LINEAR}t.minFilterNoMips=n.device.gl.NEAREST}else{switch(this.mipFilter){case 0:t.minFilter=n.device.gl.LINEAR;break;case 1:t.minFilter=n.device.gl.LINEAR_MIPMAP_NEAREST;break;default:t.minFilter=n.device.gl.LINEAR_MIPMAP_LINEAR}t.minFilterNoMips=n.device.gl.LINEAR}(3===this.filter||3===this.mipFilter)&&(t.anisotropy=Math.max(this.maxAnisotropy,1)),t.magFilter=1===this.filter?n.device.gl.NEAREST:n.device.gl.LINEAR,t.addressU=n.device.wrapModes[this.addressU],t.addressV=n.device.wrapModes[this.addressV],t.addressW=n.device.wrapModes[this.addressW],t.samplerType=e.samplerType,t.isVolume=e.isVolume,t.ComputeHash()}return t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VertexDeclaration=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),a=r(43);(t.Tw2VertexDeclaration=function(){function e(t,r){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.elements=[],this._elementsSorted=[],void 0!==r&&(this.stride=r),t&&this.DeclareFromObject(t)}return n(e,[{key:"RebuildHash",value:function t(){this._elementsSorted=[];for(var r=0;r<this.elements.length;++r)this._elementsSorted[r]=this.elements[r];this._elementsSorted.sort(e.CompareDeclarationElements)}},{key:"FindUsage",value:function e(t,r){for(var n=0;n<this._elementsSorted.length;++n){var i=this._elementsSorted[n];if(i.usage===t){if(i.usageIndex===r)return i;if(i.usageIndex>r)break}if(i.usage>t)break}return null}},{key:"SetDeclaration",value:function t(r,n){for(var a=0,o=0;o<r._elementsSorted.length;++o){var s=r._elementsSorted[o];if(!(s.location<0))for(;;){if(a>=this._elementsSorted.length){i.device.gl.disableVertexAttribArray(s.location),i.device.gl.vertexAttrib4f(s.location,0,0,0,0);break}var u=this._elementsSorted[a],l=e.CompareDeclarationElements(u,s);if(l>0){i.device.gl.disableVertexAttribArray(s.location),i.device.gl.vertexAttrib4f(s.location,0,0,0,0);break}if(0===l){u.customSetter?u.customSetter(s):(i.device.gl.enableVertexAttribArray(s.location),i.device.gl.vertexAttribPointer(s.location,u.elements,u.type,!1,n,u.offset));break}a++}}return!0}},{key:"SetPartialDeclaration",value:function t(r,n){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=[],u=0,l=0;l<r._elementsSorted.length;++l){var c=r._elementsSorted[l];if(!(c.location<0))for(;;){var f=this._elementsSorted[u],h=e.CompareDeclarationElements(f,c,a);if(0===h){f.customSetter?f.customSetter(c):(i.device.gl.enableVertexAttribArray(c.location),i.device.gl.vertexAttribPointer(c.location,f.elements,f.type,!1,n,f.offset),i.device.ext.vertexAttribDivisor(c.location,o),o&&s.push(c.location));break}if(h>0){o||(i.device.gl.disableVertexAttribArray(c.location),i.device.gl.vertexAttrib4f(c.location,0,0,0,0));break}if(++u>=this._elementsSorted.length)return o||(i.device.gl.disableVertexAttribArray(c.location),i.device.gl.vertexAttrib4f(c.location,0,0,0,0)),s}}return s}},{key:"ResetInstanceDivisors",value:function e(t){if(t)for(var r=0;r<t.length;++r)i.device.ext.vertexAttribDivisor(t[r],0)}},{key:"DeclareFromObject",value:function t(r){this.elements.splice(0,this.elements.length);for(var n=0,o=0;o<r.length;o++){var s=r[o],u=void 0,l=void 0,c=void 0,f=void 0,h=void 0;Array.isArray(s)?(u=s[0],l=s[1],c=s[2],f=s[3],h=s[4]):(u=s.usage,l=s.usageIndex,c=s.type,f=s.elements,h=s.offset),"string"==typeof u&&(u=e.Type[u.toUpperCase()]),"string"==typeof c&&(c=i.device.gl[c.toUpperCase()]),void 0===h&&(h=n),this.elements.push(new a.Tw2VertexElement(u,l,c,f,h)),n+=4*f}this.RebuildHash()}}],[{key:"CompareDeclarationElements",value:function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t.usage<r.usage?-1:t.usage>r.usage?1:t.usageIndex+n<r.usageIndex?-1:t.usageIndex+n>r.usageIndex?1:0}}]),e}()).Type={POSITION:0,COLOR:1,NORMAL:2,TANGENT:3,BINORMAL:4,TEXCOORD:5,BLENDWEIGHT:6,BLENDINDICES:7}},function(e,t,r){(function(t){var r=function(){void 0===e&&(e=t);var e,r=function(t){e.console&&e.console.log&&e.console.log(t)},n=function(t){e.console&&e.console.error?e.console.error(t):r(t)},i={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},bindBuffer:{2:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}},bufferData:{3:{0:!0,2:!0},4:{0:!0,2:!0},5:{0:!0,2:!0}},bufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},copyBufferSubData:{5:{0:!0,1:!0}},getBufferSubData:{3:{0:!0},4:{0:!0},5:{0:!0}},blitFramebuffer:{10:{8:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]},9:!0}},framebufferTextureLayer:{5:{0:!0,1:!0}},invalidateFramebuffer:{2:{0:!0}},invalidateSubFramebuffer:{6:{0:!0}},readBuffer:{1:{0:!0}},getInternalformatParameter:{3:{0:!0,1:!0,2:!0}},renderbufferStorageMultisample:{5:{0:!0,2:!0}},texStorage2D:{5:{0:!0,2:!0}},texStorage3D:{6:{0:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0},10:{0:!0,2:!0,6:!0,7:!0}},texImage3D:{10:{0:!0,2:!0,7:!0,8:!0},11:{0:!0,2:!0,7:!0,8:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0},10:{0:!0,6:!0,7:!0}},texSubImage3D:{11:{0:!0,8:!0,9:!0},12:{0:!0,8:!0,9:!0}},copyTexSubImage3D:{9:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0},8:{0:!0,2:!0},9:{0:!0,2:!0}},compressedTexImage3D:{8:{0:!0,2:!0},9:{0:!0,2:!0},10:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0},9:{0:!0,6:!0},10:{0:!0,6:!0}},compressedTexSubImage3D:{10:{0:!0,8:!0},11:{0:!0,8:!0},12:{0:!0,8:!0}},vertexAttribIPointer:{5:{2:!0}},drawArraysInstanced:{4:{0:!0}},drawElementsInstanced:{5:{0:!0,2:!0}},drawRangeElements:{6:{0:!0,4:!0}},readPixels:{7:{4:!0,5:!0},8:{4:!0,5:!0}},clearBufferfv:{3:{0:!0},4:{0:!0}},clearBufferiv:{3:{0:!0},4:{0:!0}},clearBufferuiv:{3:{0:!0},4:{0:!0}},clearBufferfi:{4:{0:!0}},beginQuery:{2:{0:!0}},endQuery:{1:{0:!0}},getQuery:{2:{0:!0,1:!0}},getQueryParameter:{2:{1:!0}},samplerParameteri:{3:{1:!0,2:!0}},samplerParameterf:{3:{1:!0}},getSamplerParameter:{2:{1:!0}},fenceSync:{2:{0:!0,1:{enumBitwiseOr:[]}}},clientWaitSync:{3:{1:{enumBitwiseOr:["SYNC_FLUSH_COMMANDS_BIT"]}}},waitSync:{3:{1:{enumBitwiseOr:[]}}},getSyncParameter:{2:{1:!0}},bindTransformFeedback:{2:{0:!0}},beginTransformFeedback:{1:{0:!0}},transformFeedbackVaryings:{3:{2:!0}},bindBufferBase:{3:{0:!0}},bindBufferRange:{5:{0:!0}},getIndexedParameter:{2:{0:!0}},getActiveUniforms:{3:{2:!0}},getActiveUniformBlockParameter:{3:{2:!0}}},a=null,o=null;function s(e){if(null==a)for(var t in a={},o={},e)"number"==typeof e[t]&&(a[e[t]]=t,o[t]=e[t])}function u(){if(null==a)throw"WebGLDebugUtils.init(ctx) not called"}function l(e){u();var t=a[e];return void 0!==t?"gl."+t:"/*UNKNOWN WebGL ENUM*/ 0x"+e.toString(16)}function c(e,t,r,n){var a=i[e];if(void 0!==a){var a=a[t];if(void 0!==a&&a[r]){if("object"!=typeof a[r]||void 0===a[r].enumBitwiseOr)return l(n);for(var s=a[r].enumBitwiseOr,u=0,c=[],f=0;f<s.length;++f){var h=o[s[f]];(n&h)!=0&&(u|=h,c.push(l(h)))}return u===n?c.join(" | "):l(n)}}return null===n?"null":void 0===n?"undefined":n.toString()}function f(e,t,r){e.__defineGetter__(r,function(){return t[r]}),e.__defineSetter__(r,function(e){t[r]=e})}function h(e,t){var r=e[t];return function(){var t=r.apply(e,arguments);return t}}function p(e){var t=!!e.createTransformFeedback;t&&e.bindVertexArray(null);var r=e.getParameter(e.MAX_VERTEX_ATTRIBS),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);for(var i=0;i<r;++i)e.disableVertexAttribArray(i),e.vertexAttribPointer(i,4,e.FLOAT,!1,0,0),e.vertexAttrib1f(i,0),t&&e.vertexAttribDivisor(i,0);e.deleteBuffer(n);for(var a=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),i=0;i<a;++i)e.activeTexture(e.TEXTURE0+i),e.bindTexture(e.TEXTURE_CUBE_MAP,null),e.bindTexture(e.TEXTURE_2D,null),t&&(e.bindTexture(e.TEXTURE_2D_ARRAY,null),e.bindTexture(e.TEXTURE_3D,null),e.bindSampler(i,null));if(e.activeTexture(e.TEXTURE0),e.useProgram(null),e.bindBuffer(e.ARRAY_BUFFER,null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindRenderbuffer(e.RENDERBUFFER,null),e.disable(e.BLEND),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.DITHER),e.disable(e.SCISSOR_TEST),e.blendColor(0,0,0,0),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ZERO),e.clearColor(0,0,0,0),e.clearDepth(1),e.clearStencil(-1),e.colorMask(!0,!0,!0,!0),e.cullFace(e.BACK),e.depthFunc(e.LESS),e.depthMask(!0),e.depthRange(0,1),e.frontFace(e.CCW),e.hint(e.GENERATE_MIPMAP_HINT,e.DONT_CARE),e.lineWidth(1),e.pixelStorei(e.PACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),e.UNPACK_COLORSPACE_CONVERSION_WEBGL&&e.pixelStorei(e.UNPACK_COLORSPACE_CONVERSION_WEBGL,e.BROWSER_DEFAULT_WEBGL),e.polygonOffset(0,0),e.sampleCoverage(1,!1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.stencilFunc(e.ALWAYS,0,4294967295),e.stencilMask(4294967295),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.viewport(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT),t){e.drawBuffers([e.BACK]),e.readBuffer(e.BACK),e.bindBuffer(e.COPY_READ_BUFFER,null),e.bindBuffer(e.COPY_WRITE_BUFFER,null),e.bindBuffer(e.PIXEL_PACK_BUFFER,null),e.bindBuffer(e.PIXEL_UNPACK_BUFFER,null);for(var o=e.getParameter(e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS),i=0;i<o;++i)e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,i,null);for(var s=e.getParameter(e.MAX_UNIFORM_BUFFER_BINDINGS),i=0;i<s;++i)e.bindBufferBase(e.UNIFORM_BUFFER,i,null);e.disable(e.RASTERIZER_DISCARD),e.pixelStorei(e.UNPACK_IMAGE_HEIGHT,0),e.pixelStorei(e.UNPACK_SKIP_IMAGES,0),e.pixelStorei(e.UNPACK_ROW_LENGTH,0),e.pixelStorei(e.UNPACK_SKIP_ROWS,0),e.pixelStorei(e.UNPACK_SKIP_PIXELS,0),e.pixelStorei(e.PACK_ROW_LENGTH,0),e.pixelStorei(e.PACK_SKIP_ROWS,0),e.pixelStorei(e.PACK_SKIP_PIXELS,0),e.hint(e.FRAGMENT_SHADER_DERIVATIVE_HINT,e.DONT_CARE)}for(;e.getError(););}return{init:s,mightBeEnum:function e(t){return u(),void 0!==a[t]},glEnumToString:l,glFunctionArgToString:c,glFunctionArgsToString:function e(t,r){for(var n="",i=r.length,a=0;a<i;++a)n+=(0==a?"":", ")+c(t,i,a,r[a]);return n},makeDebugContext:function e(t,r,i,a){a=a||t,s(t),r=r||function(e,t,r){for(var i="",a=r.length,o=0;o<a;++o)i+=(0==o?"":", ")+c(t,a,o,r[o]);n("WebGL error "+l(e)+" in "+t+"("+i+")")};var o={};function u(e,t){return function(){i&&i(t,arguments);var n=e[t].apply(e,arguments),s=a.getError();return 0!=s&&(o[s]=!0,r(s,t,arguments)),n}}var h={};for(var p in t)if("function"==typeof t[p]){if("getExtension"!=p)h[p]=u(t,p);else{var d=u(t,p);h[p]=function(){var n=d.apply(t,arguments);return n?e(n,r,i,a):null}}}else f(h,t,p);return h.getError=function(){for(var e in o)if(o.hasOwnProperty(e)&&o[e])return o[e]=!1,e;return t.NO_ERROR},h},makeLostContextSimulatingCanvas:function t(r){var n,i,a,o,s=[],u=[],i={},l=1,c=!1,h=[],d=0,v=0,$=!1,m=0,y={};function g(e){return"function"==typeof e?e:function(t){e.handleEvent(t)}}r.getContext=(o=r.getContext,function(){var t=o.apply(r,arguments);if(t instanceof WebGLRenderingContext||e.WebGL2RenderingContext&&t instanceof WebGL2RenderingContext){if(t!=n){if(n)throw"got different context";a=e.WebGL2RenderingContext&&t instanceof WebGL2RenderingContext,i=function e(t){for(var r in t)"function"==typeof t[r]?i[r]=P(t,r):f(i,t,r);i.getError=function(){if(w(),!c)for(var e;e=n.getError();)y[e]=!0;for(var e in y)if(y[e])return delete y[e],e;return i.NO_ERROR};var o,s,u,p,d,v,$=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"];a&&$.push("createQuery","createSampler","fenceSync","createTransformFeedback","createVertexArray");for(var m=0;m<$.length;++m){var g=$[m];i[g]=function(e){return function(){if(w(),c)return null;var r=e.apply(t,arguments);return r.__webglDebugContextLostId__=l,h.push(r),r}}(t[g])}var _=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"];a&&_.push("getInternalformatParameter","getQuery","getQueryParameter","getSamplerParameter","getSyncParameter","getTransformFeedbackVarying","getIndexedParameter","getUniformIndices","getActiveUniforms","getActiveUniformBlockParameter","getActiveUniformBlockName");for(var m=0;m<_.length;++m){var g=_[m];i[g]=function(e){return function(){return(w(),c)?null:e.apply(t,arguments)}}(i[g])}var b=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"];a&&b.push("isQuery","isSampler","isSync","isTransformFeedback","isVertexArray");for(var m=0;m<b.length;++m){var g=b[m];i[g]=function(e){return function(){return w(),!c&&e.apply(t,arguments)}}(i[g])}return i.checkFramebufferStatus=(o=i.checkFramebufferStatus,function(){return(w(),c)?i.FRAMEBUFFER_UNSUPPORTED:o.apply(t,arguments)}),i.getAttribLocation=(s=i.getAttribLocation,function(){return(w(),c)?-1:s.apply(t,arguments)}),i.getVertexAttribOffset=(u=i.getVertexAttribOffset,function(){return(w(),c)?0:u.apply(t,arguments)}),i.isContextLost=function(){return c},a&&(i.getFragDataLocation=(p=i.getFragDataLocation,function(){return(w(),c)?-1:p.apply(t,arguments)}),i.clientWaitSync=(d=i.clientWaitSync,function(){return(w(),c)?i.WAIT_FAILED:d.apply(t,arguments)}),i.getUniformBlockIndex=(v=i.getUniformBlockIndex,function(){return(w(),c)?i.INVALID_INDEX:v.apply(t,arguments)})),i}(n=t)}return i}return t});var _,b,E=function(e){s.push(g(e))},T=function(e){u.push(g(e))};function S(e){return e instanceof WebGLBuffer||e instanceof WebGLFramebuffer||e instanceof WebGLProgram||e instanceof WebGLRenderbuffer||e instanceof WebGLShader||e instanceof WebGLTexture}function R(e){for(var t=0;t<e.length;++t){var r=e[t];if(S(r))return r.__webglDebugContextLostId__==l}return!0}function w(){++v,c||d!=v||r.loseContext()}function P(e,t){var r=e[t];return function(){if(w(),!c){var t=r.apply(e,arguments);return t}}}function A(e){return{statusMessage:e,preventDefault:function(){$=!0}}}return b=(_=r).addEventListener,_.addEventListener=function(e,t,r){switch(e){case"webglcontextlost":E(t);break;case"webglcontextrestored":T(t);break;default:b.apply(_,arguments)}},r.loseContext=function(){if(!c){for(c=!0,d=0,++l;n.getError(););(function e(){for(var t=Object.keys(y),r=0;r<t.length;++r)delete y[t[r]]})(),y[n.CONTEXT_LOST_WEBGL]=!0;var e=A("context lost"),t=s.slice();setTimeout(function(){for(var n=0;n<t.length;++n)t[n](e);m>=0&&setTimeout(function(){r.restoreContext()},m)},0)}},r.restoreContext=function(){c&&u.length&&setTimeout(function(){if(!$)throw"can not restore. webglcontestlost listener did not call event.preventDefault";(function e(){for(var t=0;t<h.length;++t){var r=h[t];r instanceof WebGLBuffer?n.deleteBuffer(r):r instanceof WebGLFramebuffer?n.deleteFramebuffer(r):r instanceof WebGLProgram?n.deleteProgram(r):r instanceof WebGLRenderbuffer?n.deleteRenderbuffer(r):r instanceof WebGLShader?n.deleteShader(r):r instanceof WebGLTexture?n.deleteTexture(r):a&&(r instanceof WebGLQuery?n.deleteQuery(r):r instanceof WebGLSampler?n.deleteSampler(r):r instanceof WebGLSync?n.deleteSync(r):r instanceof WebGLTransformFeedback?n.deleteTransformFeedback(r):r instanceof WebGLVertexArrayObject&&n.deleteVertexArray(r))}})(),p(n),c=!1,v=0,$=!1;for(var e=u.slice(),t=A("context restored"),r=0;r<e.length;++r)e[r](t)},0)},r.loseContextInNCalls=function(e){if(c)throw"You can not ask a lost contet to be lost";d=v+e},r.getNumCalls=function(){return v},r.setRestoreTimeout=function(e){m=e},r},resetToInitialState:p}}();e.exports=r}).call(t,r(82))},function(module,exports){var g;g=function(){return this}();try{g=g||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(g=window)}module.exports=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ForwardingRenderBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(22);t.Tw2ForwardingRenderBatch=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.geometryProvider=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Commit",value:function e(t){this.geometryProvider&&this.geometryProvider.Render(this,t)}}]),t}(i.Tw2RenderBatch)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryLineBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(23);t.Tw2GeometryLineBatch=function(e){function t(){return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Commit",value:function e(t){this.geometryRes&&this.effect&&this.geometryRes.RenderLines(this.meshIx,this.start,this.count,this.effect,t)}}]),t}(i.Tw2GeometryBatch)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2InstancedMeshBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(23);t.Tw2InstancedMeshBatch=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.instanceMesh=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Commit",value:function e(t){this.instanceMesh&&this.effect&&this.instanceMesh.RenderAreas(this.meshIx,this.start,this.count,this.effect,t)}}]),t}(i.Tw2GeometryBatch)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(87);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(88);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2CurveSet=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);t.Tw2CurveSet=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.curves=[],this.bindings=[],this.scale=1,this.playOnLoad=!0,this.isPlaying=!1,this.scaledTime=0}return n(e,[{key:"Initialize",value:function e(){this.playOnLoad&&this.Play()}},{key:"Play",value:function e(){this.isPlaying=!0,this.scaledTime=0}},{key:"PlayFrom",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.isPlaying=!0,this.scaledTime=t}},{key:"Stop",value:function e(){this.isPlaying=!1}},{key:"Update",value:function e(t){if(this.isPlaying){this.scaledTime+=t*this.scale;for(var r=0;r<this.curves.length;++r)this.curves[r].UpdateValue(this.scaledTime);for(var n=0;n<this.bindings.length;++n)this.bindings[n].CopyValue()}}},{key:"GetMaxCurveDuration",value:function e(){for(var t=0,r=0;r<this.curves.length;++r)"GetLength"in this.curves[r]&&(t=Math.max(t,this.curves[r].GetLength()));return t}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ValueBinding=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),o=r(24);t.Tw2ValueBinding=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=a.util.generateID(),this.name="",this.sourceObject=null,this.sourceAttribute="",this._sourceElement=null,this.sourceIsArray=null,this.destinationObject=null,this.destinationAttribute="",this._destinationElement=null,this.destinationIsArray=null,this.scale=1,this.offset=a.quat.create(),this._copyFunc=null}return i(e,[{key:"Initialize",value:function t(){if(this.sourceObject&&""!==this.sourceAttribute&&this.destinationObject&&""!==this.destinationAttribute){var r=!1,i=!1,s=this.sourceAttribute.substr(-2);".x"===s||".r"===s?(r=!0,this._sourceElement=0,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".y"===s||".g"===s?(r=!0,this._sourceElement=1,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".z"===s||".b"===s?(r=!0,this._sourceElement=2,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):".w"===s||".a"===s?(r=!0,this._sourceElement=3,this.sourceAttribute=this.sourceAttribute.substr(0,this.sourceAttribute.length-2)):this.sourceObject instanceof o.Tw2Vector4Parameter&&("v1"===this.sourceAttribute?(r=!0,this._sourceElement=0,this.sourceAttribute="value"):"v2"===this.sourceAttribute?(r=!0,this._sourceElement=1,this.sourceAttribute="value"):"v3"===this.sourceAttribute?(r=!0,this._sourceElement=2,this.sourceAttribute="value"):"v4"===this.sourceAttribute&&(r=!0,this._sourceElement=3,this.sourceAttribute="value"));var u=this.destinationAttribute.substr(-2);if(".x"===u||".r"===u?(i=!0,this._destinationElement=0,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".y"===u||".g"===u?(i=!0,this._destinationElement=1,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".z"===u||".b"===u?(i=!0,this._destinationElement=2,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):".w"===u||".a"===u?(i=!0,this._destinationElement=3,this.destinationAttribute=this.destinationAttribute.substr(0,this.destinationAttribute.length-2)):this.destinationObject instanceof o.Tw2Vector4Parameter&&("v1"===this.destinationAttribute?(i=!0,this._destinationElement=0,this.destinationAttribute="value"):"v2"===this.destinationAttribute?(i=!0,this._destinationElement=1,this.destinationAttribute="value"):"v3"===this.destinationAttribute?(i=!0,this._destinationElement=2,this.destinationAttribute="value"):"v4"===this.destinationAttribute&&(i=!0,this._destinationElement=3,this.destinationAttribute="value")),this.sourceAttribute in this.sourceObject&&this.destinationAttribute in this.destinationObject)this.sourceIsArray=a.util.isArrayLike(this.sourceObject[this.sourceAttribute]),this.destinationIsArray=a.util.isArrayLike(this.destinationObject[this.destinationAttribute]),this.sourceIsArray===this.destinationIsArray&&n(this.sourceObject[this.sourceAttribute])===n(this.destinationObject[this.destinationAttribute])?this.sourceIsArray?r?i?this._copyFunc=e.CopyElementToElement:this._copyFunc=e.ReplicateElement:this.sourceObject[this.sourceAttribute].length<=this.destinationObject[this.destinationAttribute].length?this._copyFunc=e.CopyArray:16===this.sourceObject[this.sourceAttribute].length&&(this._copyFunc=e.ExtractPos):this._copyFunc=e.CopyValueToValue:this.sourceIsArray&&r&&"number"==typeof this.destinationObject[this.destinationAttribute]?this._copyFunc=e.CopyElementToValue:this.destinationIsArray&&"number"==typeof this.sourceObject[this.sourceAttribute]?i?this._copyFunc=e.CopyValueToElement:this._copyFunc=e.ReplicateValue:"number"==typeof this.sourceObject[this.sourceAttribute]&&"boolean"==typeof this.destinationObject[this.destinationAttribute]&&(this._copyFunc=e.CopyFloatToBoolean)}}},{key:"CopyValue",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this._copyFunc&&(this._copyFunc.call(this),"OnValueChanged"in this.destinationObject&&this.destinationObject.OnValueChanged(t,[this.destinationAttribute]))}}],[{key:"CopyValueToValue",value:function e(){this.destinationObject[this.destinationAttribute]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[0]}},{key:"CopyArray",value:function e(){for(var t=Math.min(this.destinationObject[this.destinationAttribute].length,this.sourceObject[this.sourceAttribute].length),r=0;r<t;++r)this.destinationObject[this.destinationAttribute][r]=this.sourceObject[this.sourceAttribute][r]*this.scale+this.offset[r]}},{key:"CopyElementToElement",value:function e(){this.destinationObject[this.destinationAttribute][this._destinationElement]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[0]}},{key:"ReplicateValue",value:function e(){for(var t=0;t<this.destinationObject[this.destinationAttribute].length;++t)this.destinationObject[this.destinationAttribute][t]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[t]}},{key:"ReplicateElement",value:function e(){for(var t=0;t<this.destinationObject[this.destinationAttribute].length;++t)this.destinationObject[this.destinationAttribute][t]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[t]}},{key:"ExtractPos",value:function e(){for(var t=0;t<this.destinationObject[this.destinationAttribute].length;++t)this.destinationObject[this.destinationAttribute][t]=this.sourceObject[this.sourceAttribute][t+12]*this.scale+this.offset[t]}},{key:"CopyElementToValue",value:function e(){this.destinationObject[this.destinationAttribute]=this.sourceObject[this.sourceAttribute][this._sourceElement]*this.scale+this.offset[0]}},{key:"CopyValueToElement",value:function e(){this.destinationObject[this.destinationAttribute][this._destinationElement]=this.sourceObject[this.sourceAttribute]*this.scale+this.offset[0]}},{key:"CopyFloatToBoolean",value:function e(){this.destinationObject[this.destinationAttribute]=0!==this.sourceObject[this.sourceAttribute]}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2FloatParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(7),a=r(0);(t.Tw2FloatParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var n=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.value=a.util.isArrayLike(r)?r[0]:r,n.constantBuffer=null,n.offset=null,n}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"SetValue",value:function e(t){this.value=t,this.OnValueChanged()}},{key:"GetValue",value:function e(){return this.value}},{key:"Apply",value:function e(t,r){t[r]=this.value}},{key:"EqualsValue",value:function e(t){return this.value===t}},{key:"Copy",value:function e(t,r){r&&(this.name=t.name),this.SetValue(t.GetValue())}}],[{key:"is",value:function e(t){return"number"==typeof t}}]),t}(i.Tw2Parameter)).size=1},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MatrixParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);(t.Tw2MatrixParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.mat4.create();return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Compose",value:function e(t,r,n){"value"in t&&(t=t.value),"value"in r&&(r=r.value),"value"in n&&(n=n.value),i.mat4.fromRotationTranslationScale(this.value,t,r,n),this.OnValueChanged()}},{key:"Decompose",value:function e(t,r,n){i.mat4.getRotation("value"in t?t.value:t,this.value),i.mat4.getTranslation("value"in r?r.value:r,this.value),i.mat4.getScaling("value"in n?n.value:n,this.value),"OnValueChanged"in t&&t.OnValueChanged(),"OnValueChanged"in r&&r.OnValueChanged(),"OnValueChanged"in n&&n.OnValueChanged()}},{key:"x",get:function e(){return this.GetIndexValue(12)},set:function e(t){this.SetIndexValue(12,t)}},{key:"y",get:function e(){return this.GetIndexValue(13)},set:function e(t){this.SetIndexValue(13,t)}},{key:"z",get:function e(){return this.GetIndexValue(14)},set:function e(t){this.SetIndexValue(14,t)}}]),t}(a.Tw2VectorParameter)).constantBufferSize=16},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TransformParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},a=r(0),o=r(7);(t.Tw2TransformParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.scaling=a.vec3.fromValues(1,1,1),r.rotationCenter=a.vec3.create(),r.rotation=a.quat.create(),r.translation=a.vec3.create(),r.transform=a.mat4.create(),r.worldTransform=a.mat4.create(),r.constantBuffer=null,r.offset=null,r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Initialize",value:function e(){this.OnValueChanged()}},{key:"GetValue",value:function e(t){return t?Array.from(this.transform):new Float32Array(this.transform)}},{key:"OnValueChanged",value:function e(r,n){a.mat4.fromRotationTranslationScaleOrigin(this.transform,this.rotation,this.translation,this.scaling,this.rotationCenter),a.mat4.transpose(this.worldTransform,this.transform),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"OnValueChanged",this).call(this,r,n)}},{key:"Bind",value:function e(t,r,n){return!this.constantBuffer&&n>=this.size&&(this.constantBuffer=t,this.offset=r,this.Apply(t,r,n),!0)}},{key:"Apply",value:function e(t,r,n){n>=this.constructor.constantBufferSize?t.set(this.worldTransform,r):t.set(this.worldTransform.subarray(0,n),r)}},{key:"Copy",value:function e(t,r){r&&(this.name=t.name),a.quat.copy(this.rotation,t.rotation),a.vec3.copy(this.translation,t.translation),a.vec3.copy(this.scaling,t.scaling),a.vec3.copy(this.rotationCenter,t.rotationCenter),this.OnValueChanged()}}]),t}(o.Tw2Parameter)).constantBufferSize=16},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VariableParameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(16),a=r(7);t.Tw2VariableParameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var n=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.variableName=r,n}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"GetValue",value:function e(t){return i.store.GetVariableValue(this.variableName,t)}},{key:"Apply",value:function e(t,r,n){this.variable&&this.variable.Apply(t,r,n)}},{key:"AddCallback",value:function e(){return!1}},{key:"Copy",value:function e(t,r){r&&(this.name=t.name),this.variableName=t.variableName}},{key:"variable",get:function e(){return i.store.GetVariable(this.variableName)}},{key:"size",get:function e(){return this.variable?this.variable.size:0}}]),t}(a.Tw2Parameter)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector2Parameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);(t.Tw2Vector2Parameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.vec2.fromValues(1,1);return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"x",get:function e(){return this.GetIndexValue(0)},set:function e(t){this.SetIndexValue(0,t)}},{key:"y",get:function e(){return this.GetIndexValue(1)},set:function e(t){this.SetIndexValue(1,t)}}]),t}(a.Tw2VectorParameter)).constantBufferSize=2},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector3Parameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);(t.Tw2Vector3Parameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.vec3.fromValues(1,1,1);return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"x",get:function e(){return this.GetIndexValue(0)},set:function e(t){this.SetIndexValue(0,t)}},{key:"y",get:function e(){return this.GetIndexValue(1)},set:function e(t){this.SetIndexValue(1,t)}},{key:"z",get:function e(){return this.GetIndexValue(2)},set:function e(t){this.SetIndexValue(2,t)}}]),t}(a.Tw2VectorParameter)).constantBufferSize=3},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector4Parameter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(7);(t.Tw2Vector4Parameter=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i.vec4.fromValues(1,1,1,1);return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"x",get:function e(){return this.GetIndexValue(0)},set:function e(t){this.SetIndexValue(0,t)}},{key:"y",get:function e(){return this.GetIndexValue(1)},set:function e(t){this.SetIndexValue(1,t)}},{key:"z",get:function e(){return this.GetIndexValue(2)},set:function e(t){this.SetIndexValue(2,t)}},{key:"w",get:function e(){return this.GetIndexValue(3)},set:function e(t){this.SetIndexValue(3,t)}}]),t}(a.Tw2VectorParameter)).constantBufferSize=4},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(97);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(44);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(25);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveBasicPerObjectData=t.Tw2BasicPerObjectData=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},a=r(2),o=r(44),s=r(25),u=t.Tw2BasicPerObjectData=function(e){function t(e){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var r=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.perObjectFFEData=null,e&&r.DeclareFromObject(e),r}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"SetPerObjectDataToDevice",value:function e(r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"SetPerObjectDataToDevice",this).call(this,r),this.perObjectFFEData&&r[5]&&a.device.gl.uniform4fv(r[5],this.perObjectFFEData.data)}},{key:"DeclareFromObject",value:function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"DeclareFromObject",this).call(this,r),r.FFEData&&(this.perObjectFFEData=new s.Tw2RawData(r.FFEData))}}]),t}(o.Tw2PerObjectData);t.EveBasicPerObjectData=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(99);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(117);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RuntimeInstanceData=function e(){this.name="",this.count=0;var t=null,r=null,o=0,s=0,u=null,l=!0;this.GetMaxInstanceCount=function(){return u?u.length:1},this.SetElementLayout=function(e){r&&(n.device.gl.deleteBuffer(r),r=null),o=0,t=new i.Tw2VertexDeclaration;for(var s=0;s<e.length;++s){var u=new a.Tw2ParticleElementDeclaration;u.elementType=e[s][0],u.dimension=e[s][2],u.usageIndex=e[s][1];var l=u.GetDeclaration();l.offset=4*o,t.elements.push(l),o+=u.dimension}t.RebuildHash()},this.SetData=function(e){t&&(s=(u=e).length,l=!0,this.UpdateData())},this.SetItemElement=function(e,r,n){if(t.elements[r].elements>1)for(var i=0;i<t.elements[r].elements;++i)u[e][r][i]=n[i];else u[e][r]=n;l=!0},this.SetItemElementRef=function(e,t,r){u[e][t]=r,l=!0},this.GetItemElement=function(e,t){return u[e][t]},this.UpdateData=function(){if(l&&t){var e,i,a,s=new Float32Array(u.length*o),c=0;for(e=0;e<u.length;++e)for(i=0;i<t.elements.length;++i)if(1===t.elements[i].elements)s[c++]=u[e][i];else for(a=0;a<t.elements[i].elements;++a)s[c++]=u[e][i][a];r||(r=n.device.gl.createBuffer()),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,r),n.device.gl.bufferData(n.device.gl.ARRAY_BUFFER,s,n.device.gl.STATIC_DRAW),n.device.gl.bindBuffer(n.device.gl.ARRAY_BUFFER,null),l=!1}},this.Unload=function(){r&&(n.device.gl.deleteBuffer(r),r=null)},this.GetInstanceBuffer=function(){return r},this.GetInstanceDeclaration=function(){return t},this.GetInstanceStride=function(){return 4*o},this.GetInstanceCount=function(){return s}};var n=r(2),i=r(9),a=r(45)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(101);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(102);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(103);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2StaticEmitter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),a=r(26);t.Tw2StaticEmitter=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.geometryResourcePath="",e.geometryResource=null,e.geometryIndex=0,e._spawned=!1,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Initialize",value:function e(){""!==this.geometryResourcePath&&(this.geometryResource=i.resMan.GetResource(this.geometryResourcePath),this.geometryResource.systemMirror=!0,this.geometryResource.RegisterNotification(this)),this._spawned=!1}},{key:"RebuildCachedData",value:function e(){this.geometryResource&&this.geometryResource.meshes.length&&!this.geometryResource.meshes[0].bufferData&&(this.geometryResource.systemMirror=!0,this.geometryResource.Reload())}},{key:"Update",value:function e(){if(!this._spawned&&this.particleSystem&&this.geometryResource&&this.geometryResource.IsGood()&&this.geometryResource.meshes.length>this.geometryIndex&&this.geometryResource.meshes[this.geometryIndex].bufferData){this._spawned=!0;for(var t=this.geometryResource.meshes[this.geometryIndex],r=this.particleSystem.elements,n=Array(r.length),a=0;a<r.length;++a){var o=r[a].GetDeclaration(),s=t.declaration.FindUsage(o.usage,o.usageIndex-8);if(null===s){i.logger.log("res.error",{log:"error",src:["Tw2StaticEmitter","Update"],msg:"Input geometry mesh lacks element required by particle system",path:this.geometryResource.path,type:"geometry.elements",data:{elementUsage:o.usage,elementUsageIndex:o.usageIndex}});return}if(s.elements<o.elements){i.logger.log("res.error",{log:"error",src:["Tw2StaticEmitter","Update"],msg:"Input geometry mesh elements do not have the required number of components",path:this.geometryResource.path,type:"geometry.elementcomponents",data:{inputCount:s.elements,elementCount:o.elements,elementUsage:o.usage,elementUsageIndex:o.usageIndex}});return}n[a]=s.offset/4}for(var u=t.bufferData.length/t.declaration.stride*4,l=0;l<u;++l){var c=this.particleSystem.BeginSpawnParticle();if(null===c)break;for(var f=0;f<this.particleSystem._elements.length;++f)for(var h=this.particleSystem._elements[f],p=0;p<h.dimension;++p)h.buffer[h.instanceStride*c+h.startOffset+p]=t.bufferData[n[f]+p+l*t.declaration.stride/4];this.particleSystem.EndSpawnParticle()}}}}]),t}(a.Tw2ParticleEmitter)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2DynamicEmitter=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(26);t.Tw2DynamicEmitter=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.rate=0,e.isValid=!1,e._accumulatedRate=0,e.generators=[],e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Initialize",value:function e(){this.Rebind()}},{key:"Update",value:function e(t){this.SpawnParticles(null,null,Math.min(t,.1))}},{key:"Rebind",value:function e(){if(this.isValid=!1,this.particleSystem){for(var t=0;t<this.generators.length;++t)if(!this.generators[t].Bind(this.particleSystem))return;this.isValid=!0}}},{key:"SpawnParticles",value:function e(t,r,n){if(this.isValid){this._accumulatedRate+=this.rate*n;var i=Math.floor(this._accumulatedRate);this._accumulatedRate-=i;for(var a=0;a<i;++a){var o=this.particleSystem.BeginSpawnParticle();if(null===o)break;for(var s=0;s<this.generators.length;++s)this.generators[s].Generate(t,r,o);this.particleSystem.EndSpawnParticle()}}}}]),t}(i.Tw2ParticleEmitter)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tr2GpuUniqueEmitter=t.Tw2GpuUniqueEmitter=void 0;var n=r(0),i=r(26),a=t.Tw2GpuUniqueEmitter=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.angle=0,e.innerAngle=0,e.drag=0,e.rate=0,e.radius=0,e.gravity=0,e.maxSpeed=0,e.minSpeed=0,e.minLifeTime=0,e.maxLifeTime=0,e.sizeVariance=0,e.attractorPosition=n.vec3.create(),e.attractorStrength=0,e.turbulenceAmplitude=0,e.turbulenceFrequency=0,e.textureIndex=0,e.sizes=n.vec3.create(),e.position=n.vec3.create(),e.color0=n.vec4.create(),e.color1=n.vec4.create(),e.color2=n.vec4.create(),e.color3=n.vec4.create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),t}(i.Tw2ParticleEmitter);t.Tr2GpuUniqueEmitter=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(105);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(106);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(107);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(108);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(109);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(110);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleAttractorForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(13);t.Tw2ParticleAttractorForce=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.magnitude=0,e.position=i.vec3.create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"ApplyForce",value:function e(t,r,n){var o=a.Tw2ParticleForce.global.vec3_0;o[0]=this.position[0]-t.buffer[t.offset],o[1]=this.position[1]-t.buffer[t.offset+1],o[2]=this.position[2]-t.buffer[t.offset+2],i.vec3.normalize(o,o),i.vec3.scale(o,o,this.magnitude),i.vec3.add(n,n,o)}}]),t}(a.Tw2ParticleForce)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleDirectForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(13);t.Tw2ParticleDirectForce=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.force=i.vec3.create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"ApplyForce",value:function e(t,r,n){i.vec3.add(n,n,this.force)}}]),t}(a.Tw2ParticleForce)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleDragForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(13);t.Tw2ParticleDragForce=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.drag=.1,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"ApplyForce",value:function e(t,r,n){n[0]+=-(r.buffer[r.offset]*this.drag),n[1]+=-(r.buffer[r.offset+1]*this.drag),n[2]+=-(r.buffer[r.offset+2]*this.drag)}}]),t}(i.Tw2ParticleForce)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleFluidDragForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(13);t.Tw2ParticleFluidDragForce=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.drag=.1,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"ApplyForce",value:function e(t,r,n,o,s){var u=a.Tw2ParticleForce.global.vec3_0,l=a.Tw2ParticleForce.global.vec3_1,c=Math.sqrt(r.buffer[r.offset]*r.buffer[r.offset]+r.buffer[r.offset+1]*r.buffer[r.offset+1]+r.buffer[r.offset+2]*r.buffer[r.offset+2]);u[0]=-(r.buffer[r.offset]*c)*this.drag,u[1]=-(r.buffer[r.offset+1]*c)*this.drag,u[2]=-(r.buffer[r.offset+2]*c)*this.drag,i.vec3.scale(l,u,o*s),l[0]+=r.buffer[r.offset],l[1]+=r.buffer[r.offset+1],l[2]+=r.buffer[r.offset+2],r.buffer[r.offset]*l[0]+r.buffer[r.offset+1]*l[1]+r.buffer[r.offset+2]*l[2]<0?(n[0]=-r.buffer[r.offset]/o/s,n[1]=-r.buffer[r.offset+1]/o/s,n[2]=-r.buffer[r.offset+2]/o/s):i.vec3.copy(n,u)}}]),t}(a.Tw2ParticleForce)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleSpring=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(13);t.Tw2ParticleSpring=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.springConstant=0,e.position=i.vec3.create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"ApplyForce",value:function e(t,r,n){n[0]+=(this.position[0]-t.buffer[t.offset])*this.springConstant,n[1]+=(this.position[1]-t.buffer[t.offset+1])*this.springConstant,n[2]+=(this.position[2]-t.buffer[t.offset+2])*this.springConstant}}]),t}(a.Tw2ParticleForce)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleTurbulenceForce=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(13);t.Tw2ParticleTurbulenceForce=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.noiseLevel=3,e.noiseRatio=.5,e.amplitude=i.vec3.fromValues(1,1,1),e.frequency=i.vec4.fromValues(1,1,1,1),e._time=0,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"ApplyForce",value:function e(t,r,n){if(0!==this.noiseLevel){for(var o=t.buffer[t.offset]*this.frequency[0],s=t.buffer[t.offset+1]*this.frequency[1],u=t.buffer[t.offset+2]*this.frequency[2],l=this._time*this.frequency[3],c=0,f=.5,h=1/this.noiseRatio,p=i.vec4.set(a.Tw2ParticleForce.global.vec4_0,0,0,0,0),d=0;d<this.noiseLevel;++d)i.noise.turbulence(p,o,s,u,l,f),c+=f,o*=h,s*=h,u*=h,l*=h,f*=this.noiseRatio;n[0]+=p[0]*this.amplitude[0]*c,n[1]+=p[1]*this.amplitude[1]*c,n[2]+=p[2]*this.amplitude[2]*c}}},{key:"Update",value:function e(t){this._time+=t}}]),t}(a.Tw2ParticleForce)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(112);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(113);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(114);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RandomIntegerAttributeGenerator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(18),o=r(27);t.Tw2RandomIntegerAttributeGenerator=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.elementType=a.Tw2ParticleElementDeclaration.Type.CUSTOM,e.customName="",e.minRange=i.vec4.create(),e.maxRange=i.vec4.create(),e._element=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Bind",value:function e(t){for(var r=0;r<t._elements.length;++r)if(t._elements[r].elementType===this.elementType&&(this.elementType!==a.Tw2ParticleElementDeclaration.Type.CUSTOM||t._elements[r].customName===this.customName))return this._element=t._elements[r],!0;return!1}},{key:"Generate",value:function e(t,r,n){for(var i=0;i<this._element.dimension;++i)this._element.buffer[this._element.instanceStride*n+this._element.startOffset+i]=Math.floor(this.minRange[i]+Math.random()*(this.maxRange[i]-this.minRange[i])+.5)}}]),t}(o.Tw2ParticleAttributeGenerator)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RandomUniformAttributeGenerator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(18),o=r(27);t.Tw2RandomUniformAttributeGenerator=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.elementType=a.Tw2ParticleElementDeclaration.Type.CUSTOM,e.customName="",e.minRange=i.vec4.create(),e.maxRange=i.vec4.create(),e._element=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Bind",value:function e(t){for(var r=0;r<t._elements.length;++r)if(t._elements[r].elementType===this.elementType&&(this.elementType!==a.Tw2ParticleElementDeclaration.Type.CUSTOM||t._elements[r].customName===this.customName))return this._element=t._elements[r],!0;return!1}},{key:"Generate",value:function e(t,r,n){for(var i=0;i<this._element.dimension;++i)this._element.buffer[this._element.instanceStride*n+this._element.startOffset+i]=this.minRange[i]+Math.random()*(this.maxRange[i]-this.minRange[i])}}]),t}(o.Tw2ParticleAttributeGenerator)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SphereShapeAttributeGenerator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(18),o=r(27);t.Tw2SphereShapeAttributeGenerator=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.minRadius=0,e.maxRadius=0,e.minPhi=0,e.maxPhi=360,e.minTheta=0,e.maxTheta=360,e.controlPosition=!0,e.controlVelocity=!0,e.minSpeed=0,e.maxSpeed=0,e.parentVelocityFactor=1,e.position=i.vec3.create(),e.rotation=i.quat.create(),e._position=null,e._velocity=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Bind",value:function e(t){this._position=null,this._velocity=null;for(var r=0;r<t._elements.length;++r)t._elements[r].elementType===a.Tw2ParticleElementDeclaration.Type.POSITION&&this.controlPosition?this._position=t._elements[r]:t._elements[r].elementType===a.Tw2ParticleElementDeclaration.Type.VELOCITY&&this.controlVelocity&&(this._velocity=t._elements[r]);return(!this.controlPosition||null!==this._position)&&(!this.controlVelocity||null!==this._velocity)}},{key:"Generate",value:function e(t,r,n){var a=(this.minPhi+Math.random()*(this.maxPhi-this.minPhi))/180*Math.PI,s=(this.minTheta+Math.random()*(this.maxTheta-this.minTheta))/180*Math.PI,u=o.Tw2ParticleAttributeGenerator.global.vec3_0;if(u[0]=Math.sin(a)*Math.cos(s),u[1]=-Math.cos(a),u[2]=Math.sin(a)*Math.sin(s),i.vec3.transformQuat(u,u,this.rotation),this._velocity){var l=this.minSpeed+Math.random()*(this.maxSpeed-this.minSpeed),c=this._velocity.instanceStride*n+this._velocity.startOffset;this._velocity.buffer[c]=u[0]*l,this._velocity.buffer[c+1]=u[1]*l,this._velocity.buffer[c+2]=u[2]*l,r&&(this._velocity.buffer[c]+=r.buffer[r.offset]*this.parentVelocityFactor,this._velocity.buffer[c+1]+=r.buffer[r.offset+1]*this.parentVelocityFactor,this._velocity.buffer[c+2]+=r.buffer[r.offset+2]*this.parentVelocityFactor)}if(this._position){i.vec3.scale(u,u,this.minRadius+Math.random()*(this.maxRadius-this.minRadius)),i.vec3.add(u,u,this.position),t&&(u[0]+=t.buffer[t.offset],u[1]+=t.buffer[t.offset+1],u[2]+=t.buffer[t.offset+2]);var f=this._position.instanceStride*n+this._position.startOffset;this._position.buffer[f]=u[0],this._position.buffer[f+1]=u[1],this._position.buffer[f+2]=u[2]}}}]),t}(o.Tw2ParticleAttributeGenerator)},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ParticleSystem=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(18);(t.Tw2ParticleSystem=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.aliveCount=0,this.maxParticleCount=0,this.emitParticleOnDeathEmitter=null,this.emitParticleDuringLifeEmitter=null,this.elements=[],this.isValid=!1,this.requiresSorting=!1,this.updateSimulation=!0,this.applyForce=!0,this.applyAging=!0,this.isGlobal=!1,this.forces=[],this.constraints=[],this.updateBoundingBox=!1,this.aabbMin=i.vec3.create(),this.aabbMax=i.vec3.create(),this.peakAliveCount=0,this.bufferDirty=!1,this._vb=null,this._declaration=null,this._stdElements=[null,null,null,null],this._elements=[],this.instanceStride=[null,null],this.vertexStride=[null,null],this.buffers=[null,null],e.init()}return n(e,[{key:"Initialize",value:function e(){this.UpdateElementDeclaration()}},{key:"UpdateElementDeclaration",value:function e(){if(this.isValid=!1,this._vb&&(a.device.gl.deleteBuffer(this._vb),this._vb=null),this._declaration=null,this.aliveCount=0,0!==this.elements.length){this._stdElements=[null,null,null,null],this._elements=[],this.instanceStride=[0,0],this.vertexStride=[0,0],this._declaration=new a.Tw2VertexDeclaration,this.buffers=[null,null];for(var t=0;t<this.elements.length;++t){var r=this.elements[t].usedByGPU?0:1,n=new o.Tw2ParticleElement(this.elements[t]);if(n.startOffset=this.vertexStride[r],n.offset=n.startOffset,this.elements[t].elementType!==o.Tw2ParticleElementDeclaration.Type.CUSTOM&&(this._stdElements[this.elements[t].elementType]=n),this.vertexStride[r]+=n.dimension,this._elements.push(n),0===r){var i=this.elements[t].GetDeclaration();i.offset=4*n.startOffset,this._declaration.elements.push(i)}}this._declaration.RebuildHash();for(var s=0;s<this._elements.length;++s){var u=this._elements[s].usedByGPU?0:1;this._elements[s].vertexStride=this.vertexStride[u]}this.instanceStride[0]=4*this.vertexStride[0],this.instanceStride[1]=4*this.vertexStride[1];for(var l=0;l<this._elements.length;++l){var c=this._elements[l].usedByGPU?0:1;this._elements[l].instanceStride=this.instanceStride[c]}this.buffers=[null,null],this.instanceStride[0]&&this.maxParticleCount&&(this.buffers[0]=new Float32Array(this.instanceStride[0]*this.maxParticleCount),this._vb=a.device.gl.createBuffer(),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,this._vb),a.device.gl.bufferData(a.device.gl.ARRAY_BUFFER,this.buffers[0].length,a.device.gl.DYNAMIC_DRAW),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,null)),this.instanceStride[1]&&(this.buffers[1]=new Float32Array(this.instanceStride[1]*this.maxParticleCount));for(var f=0;f<this._elements.length;++f){var h=this._elements[f].usedByGPU?0:1;this._elements[f].buffer=this.buffers[h]}this.requiresSorting&&(this._sortedIndexes=Array(this.maxParticleCount),this._sortedBuffer=new Float32Array(this.instanceStride[0]*this.maxParticleCount),this._distancesBuffer=new Float32Array(this.maxParticleCount)),this.isValid=!0,this.bufferDirty=!0}}},{key:"HasElement",value:function e(t){return null!==this._stdElements[t]}},{key:"GetElement",value:function e(t){return this._stdElements[t]&&(this._stdElements[t].offset=this._stdElements[t].startOffset),this._stdElements[t]}},{key:"BeginSpawnParticle",value:function e(){return!this.isValid||this.aliveCount>=this.maxParticleCount?null:this.aliveCount++}},{key:"EndSpawnParticle",value:function e(){this.bufferDirty=!0}},{key:"Update",value:function t(r){if(r=Math.min(r,.1),this.applyAging&&this.HasElement(o.Tw2ParticleElementDeclaration.Type.LIFETIME)){for(var n=this.GetElement(o.Tw2ParticleElementDeclaration.Type.LIFETIME),a=this.emitParticleOnDeathEmitter?this.GetElement(o.Tw2ParticleElementDeclaration.Type.POSITION):null,s=this.emitParticleOnDeathEmitter?this.GetElement(o.Tw2ParticleElementDeclaration.Type.VELOCITY):null,u=0;u<this.aliveCount;++u)if(n.buffer[n.offset]+=r/n.buffer[n.offset+1],n.buffer[n.offset]>1){if(this.emitParticleOnDeathEmitter&&this.emitParticleOnDeathEmitter.SpawnParticles(a,s,1),this.aliveCount--,u<this.aliveCount){for(var l=0;l<2;++l)this.buffers[l]&&this.buffers[l].set(this.buffers[l].subarray(this.instanceStride[l]*this.aliveCount,this.instanceStride[l]*this.aliveCount+this.instanceStride[l]),u*this.instanceStride[l]);--u,this.bufferDirty=!0}}else n.offset+=n.instanceStride,a&&(a.offset+=a.instanceStride),s&&(s.offset+=s.instanceStride);n.dirty=!0}var c=e.global.vec3_0;if(this.updateSimulation&&this.HasElement(o.Tw2ParticleElementDeclaration.Type.POSITION)&&this.HasElement(o.Tw2ParticleElementDeclaration.Type.VELOCITY)){for(var f=this.applyForce&&this.forces.length,h=0;h<this.forces.length;++h)this.forces[h].Update(r);for(var p=this.GetElement(o.Tw2ParticleElementDeclaration.Type.POSITION),d=this.GetElement(o.Tw2ParticleElementDeclaration.Type.VELOCITY),v=f?this.GetElement(o.Tw2ParticleElementDeclaration.Type.MASS):null,$=0;$<this.aliveCount;++$){if(f){for(var m=v?v.buffer[v.offset]:1,y=i.vec3.set(c,0,0,0),g=0;g<this.forces.length;++g)this.forces[g].ApplyForce(p,d,y,r,m);v&&i.vec3.scale(y,y,1/v.buffer[v.offset]),d.buffer[d.offset]+=y[0]*r,d.buffer[d.offset+1]+=y[1]*r,d.buffer[d.offset+2]+=y[2]*r}p.buffer[p.offset]+=d.buffer[d.offset]*r,p.buffer[p.offset+1]+=d.buffer[d.offset+1]*r,p.buffer[p.offset+2]+=d.buffer[d.offset+2]*r,this.emitParticleDuringLifeEmitter&&this.emitParticleDuringLifeEmitter.SpawnParticles(p,d,r),p.offset+=p.instanceStride,d.offset+=d.instanceStride,v&&(v.offset+=v.instanceStride)}p.dirty=!0,d.dirty=!0}if(this.updateSimulation&&this.constraints.length)for(var _=0;_<this.constraints.length;++_)this.constraints[_].ApplyConstraint(this.buffers,this.instanceStride,this.aliveCount,r);if(this.updateBoundingBox&&this.GetBoundingBox(this.aabbMin,this.aabbMax),this.emitParticleDuringLifeEmitter&&!(this.HasElement(o.Tw2ParticleElementDeclaration.Type.POSITION)&&this.HasElement(o.Tw2ParticleElementDeclaration.Type.VELOCITY))&&this.updateSimulation)for(var b=this.GetElement(o.Tw2ParticleElementDeclaration.Type.POSITION),E=this.GetElement(o.Tw2ParticleElementDeclaration.Type.VELOCITY),T=0;T<this.aliveCount;++T)this.emitParticleDuringLifeEmitter.SpawnParticles(b,E,1),b&&(b.offset+=b.instanceStride),E&&(E.offset+=E.instanceStride);for(var S=0;S<this._elements.length;++S){var R=this._elements[S];R.offset=R.startOffset,R.dirty&&(this.bufferDirty=!0,R.dirty=!1)}}},{key:"GetBoundingBox",value:function e(t,r){if(this.aliveCount&&this.HasElement(o.Tw2ParticleElementDeclaration.Type.POSITION)){var n=this.GetElement(o.Tw2ParticleElementDeclaration.Type.POSITION);t[0]=n.buffer[n.offset],t[1]=n.buffer[n.offset+1],t[2]=n.buffer[n.offset+2],r[0]=n.buffer[n.offset],r[1]=n.buffer[n.offset+1],r[2]=n.buffer[n.offset+2];for(var i=0;i<this.aliveCount;++i)t[0]=Math.min(t[0],n.buffer[n.offset]),t[1]=Math.min(t[1],n.buffer[n.offset+1]),t[2]=Math.min(t[2],n.buffer[n.offset+2]),r[0]=Math.max(r[0],n.buffer[n.offset]),r[1]=Math.max(r[1],n.buffer[n.offset+1]),r[2]=Math.max(r[2],n.buffer[n.offset+2]),n.offset+=n.instanceStride;return!0}return!1}},{key:"_Sort",value:function t(){for(var r=i.mat4.multiply(e.global.mat4_0,a.device.projection,a.device.view),n=this.GetElement(o.Tw2ParticleElementDeclaration.Type.POSITION),s=this.aliveCount,u=this._distancesBuffer,l=0;l<s;++l){var c=n.offset+n.instanceStride*l,f=n.buffer[c]-r[12],h=f*f;h+=(f=n.buffer[c+1]-r[13])*f,h+=(f=n.buffer[c+2]-r[14])*f,u[l]=h}for(var p=0;p<this.maxParticleCount;++p)this._sortedIndexes[p]=p;this._sortedIndexes.sort(function e(t,r){if(t>=s&&r>=s)return t<r?-1:t>r?1:0;if(t>=s)return 1;if(r>=s)return -1;var n=u[t],i=u[r];return n<i?1:n>i?-1:0})}},{key:"GetInstanceBuffer",value:function e(){if(0!==this.aliveCount){var t=a.device;if(this.requiresSorting&&this.HasElement(o.Tw2ParticleElementDeclaration.Type.POSITION)&&this.buffers){this._Sort();for(var r=this.instanceStride[0],n=this.buffers[0],i=0;i<this.aliveCount;++i)for(var s=i*r,u=this._sortedIndexes[i]*r,l=0;l<r;++l)this._sortedBuffer[s+l]=n[l+u];t.gl.bindBuffer(t.gl.ARRAY_BUFFER,this._vb),t.gl.bufferSubData(t.gl.ARRAY_BUFFER,0,this._sortedBuffer.subarray(0,this.vertexStride[0]*this.aliveCount)),this.bufferDirty=!1}else this.bufferDirty&&(t.gl.bindBuffer(t.gl.ARRAY_BUFFER,this._vb),t.gl.bufferSubData(t.gl.ARRAY_BUFFER,0,this.buffers[0].subarray(0,this.vertexStride[0]*this.aliveCount)),this.bufferDirty=!1);return this._vb}}},{key:"GetInstanceDeclaration",value:function e(){return this._declaration}},{key:"GetInstanceStride",value:function e(){return this.instanceStride[0]}},{key:"GetInstanceCount",value:function e(){return this.aliveCount}}],[{key:"init",value:function t(){e.global||(e.global={vec3_0:i.vec3.create(),mat4_0:i.mat4.create()})}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VariableStore=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(24);t.Tw2VariableStore=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._variables={}}return n(e,[{key:"RegisterVariableWithType",value:function e(t,r,n){return this._variables[t]=new n(t,r)}},{key:"RegisterType",value:function e(t,r){return this._variables[t]=new r(t)}},{key:"RegisterVariable",value:function t(r,n){var i=e.GetTw2ParameterType(n);return i?this.RegisterVariableWithType(r,n,i):null}}],[{key:"GetTw2ParameterType",value:function e(t){if(i.util.isArrayLike(t))switch(t.length){case 16:return a.Tw2MatrixParameter;case 4:return a.Tw2Vector4Parameter;case 3:return a.Tw2Vector3Parameter;case 2:return a.Tw2Vector2Parameter;case 1:return a.Tw2FloatParameter}else if("number"==typeof t)return a.Tw2FloatParameter;else if("string"==typeof t)return a.Tw2TextureParameter}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2BlendShapeData=void 0;var n=r(9);t.Tw2BlendShapeData=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.declaration=new n.Tw2VertexDeclaration,this.buffers=[],this.indexes=null,this.weightProxy=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryAnimation=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.duration=0,this.trackGroups=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryBone=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.Tw2GeometryBone=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.parentIndex=-1,this.position=i.vec3.create(),this.orientation=i.quat.create(),this.scaleShear=i.mat3.create(),this.localTransform=i.mat4.create(),this.worldTransform=i.mat4.create(),this.worldTransformInv=i.mat4.create()}return n(e,[{key:"UpdateTransform",value:function t(){i.mat4.fromMat3(this.localTransform,this.scaleShear),i.quat.normalize(this.orientation,this.orientation);var r=i.mat4.fromQuat(e.global.mat4_0,this.orientation);return i.mat4.multiply(this.localTransform,this.localTransform,r),this.localTransform[12]=this.position[0],this.localTransform[13]=this.position[1],this.localTransform[14]=this.position[2],this.localTransform}}]),e}()).global={mat4_0:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryCurve=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.dimension=0,this.degree=0,this.knots=null,this.controls=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryMesh=void 0;var n=r(0),i=r(9);t.Tw2GeometryMesh=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.declaration=new i.Tw2VertexDeclaration,this.areas=[],this.buffer=null,this.bufferLength=0,this.bufferData=null,this.indexes=null,this.indexData=null,this.indexType=0,this.minBounds=n.vec3.create(),this.maxBounds=n.vec3.create(),this.boundsSpherePosition=n.vec3.create(),this.boundsSphereRadius=0,this.bones=[],this.boneBindings=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryMeshArea=void 0;var n=r(0);t.Tw2GeometryMeshArea=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.start=0,this.count=0,this.minBounds=n.vec3.create(),this.maxBounds=n.vec3.create(),this.boundsSpherePosition=n.vec3.create(),this.boundsSphereRadius=0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryMeshBinding=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.mesh=null,this.bones=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Tw2GeometryModel=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.meshBindings=[],this.skeleton=null}return n(e,[{key:"FindBoneByName",value:function e(t){if(!this.skeleton)return null;for(var r=0;r<this.skeleton.bones.length;++r)if(this.skeleton.bones[r].name===t)return this.skeleton.bones[r];return null}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometrySkeleton=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.bones=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryTrackGroup=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.model=null,this.transformTracks=[]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryTransformTrack=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.position=null,this.orientation=null,this.scaleShear=null}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2InstancedMesh=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},a=r(6),o=r(0),s=r(20),u=r(48);t.Tw2InstancedMesh=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.instanceGeometryResource=null,e.instanceGeometryResPath="",e.instanceMeshIndex=0,e.minBounds=o.vec3.create(),e.maxBounds=o.vec3.create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Initialize",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Initialize",this).call(this),""!==this.instanceGeometryResPath&&(this.instanceGeometryResource=a.resMan.GetResource(this.instanceGeometryResPath))}},{key:"IsGood",value:function e(){var r=this.instanceGeometryResource,n=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"IsGood",this).call(this),a=!!r&&(!r.IsGood||r.IsGood());return n&&a}},{key:"GetResources",value:function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"GetResources",this).call(this,r),this.instanceGeometryResource&&"GetResources"in this.instanceGeometryResource&&this.instanceGeometryResource.GetResources(r),r}},{key:"RenderAreas",value:function e(t,r,n,i,a){if(this.IsGood()){var o=this.instanceGeometryResource.GetInstanceBuffer(this.instanceMeshIndex);o&&this.geometryResource.RenderAreasInstanced(t,r,n,i,a,o,this.instanceGeometryResource.GetInstanceDeclaration(this.instanceMeshIndex),this.instanceGeometryResource.GetInstanceStride(this.instanceMeshIndex),this.instanceGeometryResource.GetInstanceCount(this.instanceMeshIndex))}}}],[{key:"GetAreaBatches",value:function e(t,r,n,i,a){for(var o=0;o<r.length;++o){var u=r[o];if(u.effect&&u.display){var l=new s.Tw2InstancedMeshBatch;l.renderMode=n,l.perObjectData=a,l.instanceMesh=t,l.meshIx=u.meshIndex,l.start=u.index,l.count=u.count,l.effect=u.effect,i.Commit(l)}}}}]),t}(u.Tw2Mesh)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MeshLineArea=void 0;var n=r(20),i=r(49);(t.Tw2MeshLineArea=function(e){function t(){return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),t}(i.Tw2MeshArea)).batchType=n.Tw2GeometryLineBatch},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(50);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(132);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(52);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(53);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(54);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(55);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2AnimationController=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(28),o=r(50),s=r(52),u=r(53),l=r(54),c=r(55);(t.Tw2AnimationController=function(){function e(t){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.geometryResources=[],this.models=[],this.animations=[],this.meshBindings=[],this.loaded=!1,this.update=!0,this.pendingCommands=[],this.onPendingCleared=null,this._geometryResource=null,t&&this.SetGeometryResource(t)}return n(e,[{key:"GetAnimationsByName",value:function e(){if(!this.loaded)return null;for(var t={},r=0;r<this.animations.length;r++)t[this.animations[r].animationRes.name]=this.animations[r];return t}},{key:"GetAnimation",value:function e(t){for(var r=0;r<this.animations.length;r++)if(this.animations[r].animationRes.name===t)return this.animations[r];return null}},{key:"ResetAnimation",value:function e(t){var r=this.GetAnimation(t);if(r)return r.time=0,r.isPlaying=!1,r.callback=null,!0}},{key:"PlayAnimation",value:function e(t,r,n){if(0===this.animations.length)return this.pendingCommands.push({func:this.PlayAnimation,args:[t,r,n]}),!0;var i=this.GetAnimation(t);if(i)return i.time=0,i.isPlaying=!0,void 0!==r&&(i.cycle=r),n&&(i.callback=n),!0}},{key:"PlayAnimationFrom",value:function e(t,r,n,i){if(0===this.animations.length)return this.pendingCommands.push({func:this.PlayAnimationFrom,args:[t,r,n,i]}),!0;var a=this.GetAnimation(t);if(a)return a.time=Math.max(Math.min(r,a.animationRes.duration),0),a.isPlaying=!0,void 0!==n&&(a.cycle=n),i&&(a.callback=i),!0}},{key:"GetPlayingAnimations",value:function e(){for(var t=[],r=0;r<this.animations.length;r++)this.animations[r].isPlaying&&t.push(this.animations[r].animationRes.name);return t}},{key:"StopAnimation",value:function e(t){if(0===this.animations.length){this.pendingCommands.push({func:this.StopAnimation,args:t});return}("string"==typeof t||t instanceof String)&&(t=[t]);for(var r={},n=0;n<t.length;n++)r[t[n]]=!0;for(var i=0;i<this.animations.length;++i)this.animations[i].animationRes.name in r&&(this.animations[i].isPlaying=!1)}},{key:"StopAllAnimations",value:function e(){if(0===this.animations.length){this.pendingCommands.push({func:this.StopAllAnimations,args:null});return}for(var t=0;t<this.animations.length;++t)this.animations[t].isPlaying=!1}},{key:"StopAllAnimationsExcept",value:function e(t){if(0===this.animations.length){this.pendingCommands.push({func:this.StopAllAnimationsExcept,args:t});return}("string"==typeof t||t instanceof String)&&(t=[t]);for(var r={},n=0;n<t.length;n++)r[t[n]]=!0;for(var i=0;i<this.animations.length;++i)this.animations[i].animationRes.name in r||(this.animations[i].isPlaying=!1)}},{key:"SetGeometryResource",value:function e(t){this.models=[],this.animations=[],this.meshBindings=[];for(var r=0;r<this.geometryResources.length;++r)this.geometryResources[r].UnregisterNotification(this);this.loaded=!1,this.geometryResources=[],t&&(this.geometryResources.push(t),t.RegisterNotification(this))}},{key:"AddGeometryResource",value:function e(t){for(var r=0;r<this.geometryResources.length;++r)if(this.geometryResources[r]===t)return;this.geometryResources.push(t),t.RegisterNotification(this)}},{key:"AddAnimationsFromRes",value:function e(t){for(var r=0;r<t.animations.length;++r){for(var n=null,i=0;i<this.animations.length;++i)if(this.animations[i].animationRes===t.animations[r]){n=this.animations[r];break}n||((n=new o.Tw2Animation).animationRes=t.animations[r],this.animations.push(n));for(var a=0;a<n.animationRes.trackGroups.length;++a){for(var s=!1,u=0;u<n.trackGroups.length;++u)if(n.trackGroups[u].trackGroupRes===n.animationRes.trackGroups[a]){s=!0;break}if(!s){for(var f=null,h=0;h<this.models.length;++h)if(this.models[h].modelRes.name===n.animationRes.trackGroups[a].name){f=this.models[h];break}if(null!==f){var p=new c.Tw2TrackGroup;p.trackGroupRes=n.animationRes.trackGroups[a];for(var d=0;d<p.trackGroupRes.transformTracks.length;++d)for(var v=0;v<f.bones.length;++v)if(f.bones[v].boneRes.name===p.trackGroupRes.transformTracks[d].name){var $=new l.Tw2Track;$.trackRes=p.trackGroupRes.transformTracks[d],$.bone=f.bones[v],p.transformTracks.push($);break}n.trackGroups.push(p)}}}}}},{key:"ResetBoneTransforms",value:function t(){for(var r=0;r<this.models.length;++r)for(var n=0;n<this.models[r].bones.length;++n){var a=this.models[r].bones[n],o=a.boneRes;i.mat4.copy(a.localTransform,o.localTransform),-1!==o.parentIndex?i.mat4.multiply(a.worldTransform,a.localTransform,this.models[r].bones[a.boneRes.parentIndex].worldTransform):i.mat4.set(a.worldTransform,a.localTransform),i.mat4.identity(a.offsetTransform)}for(var s=i.mat4.identity(e.scratch.mat4_0),u=0;u<this.meshBindings.length;++u)for(var l=0;l<this.meshBindings[u].length;++l)for(var c=0;16*c<this.meshBindings[u][l].length;++c)for(var f=0;f<16;++f)this.meshBindings[u][l][16*c+f]=s[f]}},{key:"GetBoneMatrices",value:function t(r,n){if(0===this.geometryResources.length)return new Float32Array;n||(n=this.geometryResources[0]);var i=e.FindMeshBindings(this,n);return i&&r<i.length?i[r]:new Float32Array}},{key:"FindModelForMesh",value:function e(t,r){if(0===this.geometryResources.length||(r||(r=this.geometryResources[0]),!r.IsGood()))return null;for(var n=r.meshes[t],i=0;i<this.models.length;++i)for(;0<this.models[i].modelRes.meshBindings.length;++i)if(this.models[i].modelRes.meshBindings[0].mesh===n)return this.models[i];return null}},{key:"GetResources",value:function e(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=0;r<this.geometryResources.length;r++)t.includes(this.geometryResources[r])||t.push(this.geometryResources[r]);return t}},{key:"RebuildCachedData",value:function t(r){for(var n=!1,i=0;i<this.geometryResources.length;++i)if(this.geometryResources[i]===r){n=!0;break}if(n){for(var a=0;a<this.geometryResources.length;++a)if(!this.geometryResources[a].IsGood())return;for(var o=0;o<this.geometryResources.length;++o)e.DoRebuildCachedData(this,this.geometryResources[o])}}},{key:"Update",value:function t(r){if(this.models&&this.update){for(var n=0;n<this.geometryResources.length;++n)this.geometryResources[n].KeepAlive();for(var a=e.scratch,o=a.mat4_0,s=a.quat_0,u=a.vec3_0,l=a.mat3_0,c=0;c<this.animations.length;++c){var f=this.animations[c];if(f.isPlaying){var h=f.animationRes;f.time+=r*f.timeScale,f.time>h.duration&&(f.callback&&f.callback(this,f),f.cycle?f.time=f.time%h.duration:(f.isPlaying=!1,f.time=h.duration));for(var p=0;p<f.trackGroups.length;++p)for(var d=0;d<f.trackGroups[p].transformTracks.length;++d){var v=f.trackGroups[p].transformTracks[d];v.trackRes.position?i.curve.evaluate(v.trackRes.position,f.time,u,f.cycle,h.duration):u[0]=u[1]=u[2]=0,v.trackRes.orientation?(i.curve.evaluate(v.trackRes.orientation,f.time,s,f.cycle,h.duration),i.quat.normalize(s,s)):i.quat.identity(s),v.trackRes.scaleShear?i.curve.evaluate(v.trackRes.scaleShear,f.time,l,f.cycle,h.duration):i.mat3.identity(l),i.mat4.fromMat3(v.bone.localTransform,l),i.mat4.multiply(v.bone.localTransform,v.bone.localTransform,i.mat4.fromQuat(o,s)),v.bone.localTransform[12]=u[0],v.bone.localTransform[13]=u[1],v.bone.localTransform[14]=u[2]}}}for(var $=0;$<this.models.length;++$)for(var m=0;m<this.models[$].bones.length;++m){var y=this.models[$].bones[m];if(-1!==y.boneRes.parentIndex?i.mat4.multiply(y.worldTransform,this.models[$].bones[y.boneRes.parentIndex].worldTransform,y.localTransform):i.mat4.copy(y.worldTransform,y.localTransform),i.mat4.multiply(y.offsetTransform,y.worldTransform,y.boneRes.worldTransformInv),y.bindingArrays)for(var g=0;g<y.bindingArrays.length;++g)y.bindingArrays[g].array[y.bindingArrays[g].offset+0]=y.offsetTransform[0],y.bindingArrays[g].array[y.bindingArrays[g].offset+1]=y.offsetTransform[4],y.bindingArrays[g].array[y.bindingArrays[g].offset+2]=y.offsetTransform[8],y.bindingArrays[g].array[y.bindingArrays[g].offset+3]=y.offsetTransform[12],y.bindingArrays[g].array[y.bindingArrays[g].offset+4]=y.offsetTransform[1],y.bindingArrays[g].array[y.bindingArrays[g].offset+5]=y.offsetTransform[5],y.bindingArrays[g].array[y.bindingArrays[g].offset+6]=y.offsetTransform[9],y.bindingArrays[g].array[y.bindingArrays[g].offset+7]=y.offsetTransform[13],y.bindingArrays[g].array[y.bindingArrays[g].offset+8]=y.offsetTransform[2],y.bindingArrays[g].array[y.bindingArrays[g].offset+9]=y.offsetTransform[6],y.bindingArrays[g].array[y.bindingArrays[g].offset+10]=y.offsetTransform[10],y.bindingArrays[g].array[y.bindingArrays[g].offset+11]=y.offsetTransform[14]}}}},{key:"RenderDebugInfo",value:function e(t){for(var r=0;r<this.models.length;++r)for(var n=0;n<this.models[r].bones.length;++n){var i=this.models[r].bones[n];if(i.boneRes.parentIndex>=0){var a=this.models[r].bones[i.boneRes.parentIndex];t.AddLine([i.worldTransform[12],i.worldTransform[13],i.worldTransform[14]],[a.worldTransform[12],a.worldTransform[13],a.worldTransform[14]])}}}}],[{key:"AddModel",value:function e(t,r){for(var n=0;n<t.models.length;++n)if(t.models[n].modelRes.name===r.name)return null;var i=new u.Tw2Model;i.modelRes=r;var a=r.skeleton;if(null!==a)for(var o=0;o<a.bones.length;++o){var l=new s.Tw2Bone;l.boneRes=a.bones[o],i.bones.push(l),i.bonesByName[l.boneRes.name]=l}return t.models.push(i),i}},{key:"FindMeshBindings",value:function e(t,r){for(var n=0;n<t.meshBindings.length;++n)if(t.meshBindings[n].resource===r)return t.meshBindings[n];return null}},{key:"DoRebuildCachedData",value:function t(r,n){var i=[];if(n.meshes.length)for(var o=0;o<n.models.length;++o){var s=e.AddModel(r,n.models[o]);s&&i.push(s)}for(var u=0;u<r.geometryResources.length;++u)r.AddAnimationsFromRes(r.geometryResources[u]);if(0===n.models.length){for(var l=0;l<n.meshes.length;++l)a.Tw2GeometryRes.BindMeshToModel(n.meshes[l],r.geometryResources[0].models[0],n);n.models.push(r.geometryResources[0].models[0])}for(var c=0;c<n.models.length;++c){for(var f=null,h=0;h<r.models.length;++h)if(r.models[h].modelRes.name===n.models[c].name){f=r.models[h];break}if(null!==f)for(var p=0;p<n.models[c].meshBindings.length;++p){var d=n.meshes.indexOf(n.models[c].meshBindings[p].mesh),v=e.FindMeshBindings(r,n);null===v&&((v=[]).resource=n,r.meshBindings.push(v)),v[d]=new Float32Array(12*n.models[c].meshBindings[p].bones.length);for(var $=0;$<n.models[c].meshBindings[p].bones.length;++$)for(var m=0;m<f.bones.length;++m)if(f.bones[m].boneRes.name===n.models[c].meshBindings[p].bones[$].name){f.bones[m].bindingArrays||(f.bones[m].bindingArrays=[]),f.bones[m].bindingArrays[f.bones[m].bindingArrays.length]={array:v[d],offset:12*$};break}}}if(n.meshes.length&&n.models.length&&r.ResetBoneTransforms(),r.loaded=!0,r.animations.length){if(r.pendingCommands.length)for(var y=0;y<r.pendingCommands.length;++y)r.pendingCommands[y].args?r.pendingCommands[y].func.apply(r,r.pendingCommands[y].args):r.pendingCommands[y].func.apply(r);r.pendingCommands=[],r.onPendingCleared&&r.onPendingCleared(r)}}}]),e}()).scratch={vec3_0:i.vec3.create(),quat_0:i.quat.create(),mat3_0:i.mat3.create(),mat4_0:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2EffectRes=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(4),a=r(29),o=r(12),s=r(134);(t.Tw2EffectRes=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.passes=[],e.annotations={},e.permutations=[],e.offsets=[],e.reader=null,e.version=0,e.stringTable="",e.shaders={},e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Prepare",value:function e(t){this.permutations=[],this.offsets=[],this.passes=[],this.annotations={},this.reader=null,this.version=0,this.stringTable="",this.shaders={};var r=new a.Tw2BinaryReader(new Uint8Array(t)),n="";function o(){for(var e=r.ReadUInt32(),t=e;n.charCodeAt(t);)++t;return n.substr(e,t-e)}var s=r.ReadUInt32();if(s<2||s>7){i.logger.log("res.error",{log:"error",src:["Tw2EffectRes","CreateProgram"],msg:"Invalid version of effect file",type:"shader.effectversion",path:this.path,value:s}),this.PrepareFinished(!1);return}var u=void 0,l=void 0;if(s<5){if(0===(u=r.ReadUInt32())){i.logger.log("res.error",{log:"error",src:["Tw2EffectRes","CreateProgram"],msg:"File contains no compiled effects",path:this.path,type:"shader.effectheadersize",value:0}),this.PrepareFinished(!1);return}r.ReadUInt32();var c=r.ReadUInt32();r.cursor=8+12*u,l=r.ReadUInt32(),this.stringTableOffset=r.cursor,n=String.fromCharCode.apply(null,r.data.subarray(r.cursor,r.cursor+l)),r.cursor=c}else{l=r.ReadUInt32(),this.stringTableOffset=r.cursor,n=String.fromCharCode.apply(null,r.data.subarray(r.cursor,r.cursor+l)),r.cursor+=l;for(var f=r.ReadUInt8(),h=0;h<f;++h){for(var p={name:o(),defaultOption:r.ReadUInt8(),description:o(),type:r.ReadUInt8(),options:{},optionCount:r.ReadUInt8()},d=0;d<p.optionCount;++d)p.options[o()]=d;this.permutations.push(p)}if(0===(u=r.ReadUInt32())){i.logger.log("res.error",{log:"error",src:["Tw2EffectRes","CreateProgram"],msg:"File contains no compiled effects",path:this.path,type:"shader.effectheadersize",value:0}),this.PrepareFinished(!1);return}for(var v=0;v<u;++v)this.offsets.push({index:r.ReadUInt32(),offset:r.ReadUInt32(),size:r.ReadUInt32()});r.ReadUInt32(),r.cursor=r.ReadUInt32()}this.reader=r,this.version=s,this.stringTable=n,this.PrepareFinished(!0)}},{key:"GetShader",value:function e(t){if(!this.IsGood())return null;for(var r=0,n=1,a=0;a<this.permutations.length;++a){var o=this.permutations[a],u=o.defaultOption;if(t.hasOwnProperty(o.name)){var l=t[o.name];if(!o.options.hasOwnProperty(l))return i.logger.log("res.error",{log:"error",src:["Tw2EffectRes","GetShader"],msg:"Invalid shader permutation value",path:this.path,name:o.name,value:l}),null;u=o.options[l]}r+=u*n,n*=o.optionCount}if(this.shaders.hasOwnProperty(r))return this.shaders[r];this.reader.cursor=this.offsets[r].offset;var c=null;try{c=new s.Tw2Shader(this.reader,this.version,this.stringTable,this.stringTableOffset)}catch(f){return null}return this.shaders[r]=c,c}}]),t}(o.Tw2Resource)).prototype.requestResponseType="arraybuffer"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Shader=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),a=r(17),o=r(9),s=r(0),u=r(21);(t.Tw2Shader=function(){function e(t,r,n,a,l){function c(){for(var e=t.ReadUInt32(),r=e;n.charCodeAt(r);)++r;return n.substr(e,r-e)}!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.techniques={},this.annotations={};var f=i.device,h=1;r>6&&(h=t.ReadUInt8());for(var p=0;p<h;++p){var d={name:"Main",passes:[]};r>6&&(d.name=c()),this.techniques[d.name]=d;for(var v=t.ReadUInt8(),$=0;$<v;++$){var m={};m.stages=[{},{}];for(var y=t.ReadUInt8(),g=!0,_=0;_<y;++_){var b={};b.inputDefinition=new o.Tw2VertexDeclaration,b.constants=[],b.textures=[],b.samplers=[];for(var E=t.ReadUInt8(),T=t.ReadUInt8(),S=0;S<T;++S){var R=t.ReadUInt8();t.ReadUInt8();var w=t.ReadUInt8();t.ReadUInt8(),b.inputDefinition.elements[S]=new o.Tw2VertexElement(R,w,0)}b.inputDefinition.RebuildHash();var P=void 0,A=void 0,D=void 0,O=void 0;if(r<5)P=t.ReadUInt32(),A=t.data.subarray(t.cursor,t.cursor+P),t.cursor+=P,D=t.ReadUInt32(),O=t.data.subarray(t.cursor,t.cursor+D),t.cursor+=D;else{P=t.ReadUInt32();var C=t.ReadUInt32();A=n.substr(C,P),D=t.ReadUInt32(),C=t.ReadUInt32(),O=n.substr(C,D)}if(b.shader=e.CompileShader(E,"",A,l),null===b.shader)throw Error();g?(0===D?b.shadowShader=e.CompileShader(E,"\n#define PS\n",A,l):b.shadowShader=e.CompileShader(E,"",O,l),null===b.shadowShader&&(g=!1)):b.shadowShader=null,r>=3&&(t.ReadUInt32(),t.ReadUInt32(),t.ReadUInt32()),b.constantSize=0;for(var I=t.ReadUInt32(),k=0;k<I;++k){var x={};if(x.name=c(),x.offset=t.ReadUInt32()/4,x.size=t.ReadUInt32()/4,x.type=t.ReadUInt8(),x.dimension=t.ReadUInt8(),x.elements=t.ReadUInt32(),x.isSRGB=t.ReadUInt8(),x.isAutoregister=t.ReadUInt8(),b.constants[k]=x,!e.ConstantIgnore.includes(x.name)){var M=x.offset+x.size;M>b.constantSize&&(b.constantSize=M)}}var L=t.ReadUInt32()/4;if(b.constantValues=new Float32Array(L),r<5)for(var B=0;B<L;++B)b.constantValues[B]=t.ReadFloat32();else{var F=t.ReadUInt32(),G=t.cursor;t.cursor=a+F;for(var V=0;V<L;++V)b.constantValues[V]=t.ReadFloat32();t.cursor=G}b.constantSize=Math.max(b.constantSize,L);for(var N=t.ReadUInt8(),U=0;U<N;++U){var j={};j.registerIndex=t.ReadUInt8(),j.name=c(),j.type=t.ReadUInt8(),j.isSRGB=t.ReadUInt8(),j.isAutoregister=t.ReadUInt8(),b.textures.push(j)}for(var z=t.ReadUInt8(),q=0;q<z;++q){var H=t.ReadUInt8(),Y=r>=4?c():"";t.ReadUInt8();var W=t.ReadUInt8(),X=t.ReadUInt8(),K=t.ReadUInt8(),Q=t.ReadUInt8(),Z=t.ReadUInt8(),J=t.ReadUInt8();t.ReadFloat32();var ee=t.ReadUInt8();t.ReadUInt8();var et=s.quat.create();et[0]=t.ReadFloat32(),et[1]=t.ReadFloat32(),et[2]=t.ReadFloat32(),et[3]=t.ReadFloat32(),t.ReadFloat32(),t.ReadFloat32(),r<4&&t.ReadUInt8();var er=new u.Tw2SamplerState;if(er.registerIndex=H,er.name=Y,1===W){switch(K){case 0:er.minFilter=f.gl.NEAREST;break;case 1:er.minFilter=f.gl.NEAREST_MIPMAP_NEAREST;break;default:er.minFilter=f.gl.NEAREST_MIPMAP_LINEAR}er.minFilterNoMips=f.gl.NEAREST}else{switch(K){case 0:er.minFilter=f.gl.LINEAR;break;case 1:er.minFilter=f.gl.LINEAR_MIPMAP_NEAREST;break;default:er.minFilter=f.gl.LINEAR_MIPMAP_LINEAR}er.minFilterNoMips=f.gl.LINEAR}er.magFilter=1===X?f.gl.NEAREST:f.gl.LINEAR,er.addressU=f.wrapModes[Q],er.addressV=f.wrapModes[Z],er.addressW=f.wrapModes[J],(3===W||3===X||3===K)&&(er.anisotropy=Math.max(ee,1));for(var en=0;en<b.textures.length;++en)if(b.textures[en].registerIndex===er.registerIndex){er.samplerType=4===b.textures[en].type?f.gl.TEXTURE_CUBE_MAP:f.gl.TEXTURE_2D,er.isVolume=3===b.textures[en].type;break}er.ComputeHash(),b.samplers.push(er)}r>=3&&t.ReadUInt8(),m.stages[E]=b}m.states=[];for(var ei=t.ReadUInt8(),ea=0;ea<ei;++ea){var eo=t.ReadUInt32(),es=t.ReadUInt32();m.states.push({state:eo,value:es})}if(m.shaderProgram=e.CreateProgram(m.stages[0].shader,m.stages[1].shader,m,l),null===m.shaderProgram)throw Error();g?(m.shadowShaderProgram=e.CreateProgram(m.stages[0].shadowShader,m.stages[1].shadowShader,m,l),null===m.shadowShaderProgram&&(m.shadowShaderProgram=m.shaderProgram)):m.shadowShaderProgram=m.shaderProgram,d.passes[$]=m}}for(var eu=t.ReadUInt16(),el=0;el<eu;++el){for(var ec=c(),ef=[],eh=t.ReadUInt8(),ep=0;ep<eh;++ep)switch(ef[ep]={},ef[ep].name=c(),ef[ep].type=t.ReadUInt8(),ef[ep].type){case 0:ef[ep].value=0!==t.ReadUInt32();break;case 1:ef[ep].value=t.ReadInt32();break;case 2:ef[ep].value=t.ReadFloat32();break;default:ef[ep].value=c()}this.annotations[ec]=ef}}return n(e,[{key:"ApplyPass",value:function e(t,r){var n=i.device;r=this.techniques[t].passes[r];for(var a=0;a<r.states.length;++a)n.SetRenderState(r.states[a].state,r.states[a].value);n.IsAlphaTestEnabled()?(n.gl.useProgram(r.shadowShaderProgram.program),n.shadowHandles=r.shadowShaderProgram):(n.gl.useProgram(r.shaderProgram.program),n.shadowHandles=null)}},{key:"IsValidParameter",value:function e(t){return t in this.annotations}},{key:"GetParametersByGroup",value:function e(t){var r=[];for(var n in this.annotations)if(this.annotations.hasOwnProperty(n))for(var i=0;i<this.annotations[n].length;i++)"group"===this.annotations[n][i].name.toLowerCase()&&this.annotations[n][i].value.toLowerCase()===t.toLowerCase()&&r.push(n);return r}}],[{key:"CompileShader",value:function e(t,r,n,o){var s=i.device,u=s.gl.createShader(0===t?s.gl.VERTEX_SHADER:s.gl.FRAGMENT_SHADER);if(s.ext.ShaderBinary)s.ext.ShaderBinary.shaderBinary(u,n);else{var l=r+("string"==typeof n?n:String.fromCharCode.apply(null,n));l=l.substr(0,l.length-1),s.gl.shaderSource(u,l),s.gl.compileShader(u)}return s.gl.getShaderParameter(u,s.gl.COMPILE_STATUS)?u:(a.logger.log("res.error",{log:"error",src:["Tw2Shader","CompileShader"],msg:"Error compiling shader",path:o,type:"shader.compile",value:0===t?"VERTEX":"FRAGMENT",data:i.device.gl.getShaderInfoLog(u)}),null)}},{key:"CreateProgram",value:function e(t,r,n,s){var u=i.device,l={};if(l.program=u.gl.createProgram(),u.gl.attachShader(l.program,t),u.gl.attachShader(l.program,r),u.gl.linkProgram(l.program),!u.gl.getProgramParameter(l.program,u.gl.LINK_STATUS))return a.logger.log("res.error",{log:"error",src:["Tw2Shader","CreateProgram"],msg:"Error linking shaders",path:s,type:"shader.linkstatus",data:i.device.gl.getProgramInfoLog(l.program)}),null;u.gl.useProgram(l.program),l.constantBufferHandles=[];for(var c=0;c<16;++c)l.constantBufferHandles[c]=u.gl.getUniformLocation(l.program,"cb"+c);l.samplerHandles=[];for(var f=0;f<16;++f)l.samplerHandles[f]=u.gl.getUniformLocation(l.program,"s"+f),u.gl.uniform1i(l.samplerHandles[f],f);for(var h=0;h<16;++h)l.samplerHandles[h+12]=u.gl.getUniformLocation(l.program,"vs"+h),u.gl.uniform1i(l.samplerHandles[h+12],h+12);l.input=new o.Tw2VertexDeclaration;for(var p=0;p<n.stages[0].inputDefinition.elements.length;++p){var d=u.gl.getAttribLocation(l.program,"attr"+p);if(d>=0){var v=new o.Tw2VertexElement(n.stages[0].inputDefinition.elements[p].usage,n.stages[0].inputDefinition.elements[p].usageIndex);v.location=d,l.input.elements.push(v)}}l.input.RebuildHash(),l.shadowStateInt=u.gl.getUniformLocation(l.program,"ssi"),l.shadowStateFloat=u.gl.getUniformLocation(l.program,"ssf"),l.shadowStateYFlip=u.gl.getUniformLocation(l.program,"ssyf"),u.gl.uniform3f(l.shadowStateYFlip,0,0,1),l.volumeSlices=[];for(var $=0;$<n.stages[1].samplers.length;++$)n.stages[1].samplers[$].isVolume&&(l.volumeSlices[n.stages[1].samplers[$].registerIndex]=u.gl.getUniformLocation(l.program,"s"+n.stages[1].samplers[$].registerIndex+"sl"));return l}}]),e}()).ConstantIgnore=["PerFrameVS","PerObjectVS","PerFramePS","PerObjectPS"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2GeometryRes=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(2),o=r(4),s=r(29),u=r(9),l=r(12),c=r(46);(t.Tw2GeometryRes=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.meshes=[],e.minBounds=i.vec3.create(),e.maxBounds=i.vec3.create(),e.boundsSpherePosition=i.vec3.create(),e.boundsSphereRadius=0,e.models=[],e.animations=[],e.systemMirror=!1,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"GetInstanceBuffer",value:function e(t){return t<this.meshes.length?this.meshes[t].buffer:void 0}},{key:"GetInstanceDeclaration",value:function e(t){return this.meshes[t].declaration}},{key:"GetInstanceStride",value:function e(t){return this.meshes[t].declaration.stride}},{key:"GetInstanceCount",value:function e(t){return 4*this.meshes[t].bufferLength/this.meshes[t].declaration.stride}},{key:"Prepare",value:function e(r){var n=a.device,o=new s.Tw2BinaryReader(new Uint8Array(r));o.ReadUInt8();for(var u=o.ReadUInt8(),l=0;l<u;++l){var f=new c.Tw2GeometryMesh;f.name=o.ReadString();var h=t.ReadVertexBuffer(o,f.declaration);h?(f.bufferLength=h.length,f.buffer=n.gl.createBuffer(),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,f.buffer),n.gl.bufferData(n.gl.ARRAY_BUFFER,h,n.gl.STATIC_DRAW)):f.buffer=null;var p=t.ReadIndexBuffer(o);p?(f.indexes=n.gl.createBuffer(),f.indexType=2===p.BYTES_PER_ELEMENT?n.gl.UNSIGNED_SHORT:n.gl.UNSIGNED_INT,n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,f.indexes),n.gl.bufferData(n.gl.ELEMENT_ARRAY_BUFFER,p,n.gl.STATIC_DRAW)):f.indexes=null;for(var d=o.ReadUInt8(),v=0;v<d;++v)f.areas[v]=new c.Tw2GeometryMeshArea,f.areas[v].name=o.ReadString(),f.areas[v].start=o.ReadUInt32()*p.BYTES_PER_ELEMENT,f.areas[v].count=3*o.ReadUInt32(),f.areas[v].minBounds=i.vec3.fromValues(o.ReadFloat32(),o.ReadFloat32(),o.ReadFloat32()),f.areas[v].maxBounds=i.vec3.fromValues(o.ReadFloat32(),o.ReadFloat32(),o.ReadFloat32());var $=o.ReadUInt8();f.boneBindings=[];for(var m=0;m<$;++m)f.boneBindings[m]=o.ReadString();var y=o.ReadUInt16();if((y||this.systemMirror)&&(f.bufferData=h,f.indexData=p),y){f.blendShapes=[];for(var g=0;g<y;++g)f.blendShapes[g]=new c.Tw2BlendShapeData,f.blendShapes[g].name=o.ReadString(),f.blendShapes[g].buffer=t.ReadVertexBuffer(o,f.blendShapes[g].declaration),f.blendShapes[g].indexes=t.ReadIndexBuffer(o)}this.meshes[l]=f}for(var _=o.ReadUInt8(),b=0;b<_;++b){var E=new c.Tw2GeometryModel;E.name=o.ReadString(),E.skeleton=new c.Tw2GeometrySkeleton;for(var T=o.ReadUInt8(),S=0;S<T;++S){var R=new c.Tw2GeometryBone;R.name=o.ReadString();var w=o.ReadUInt8();if(R.parentIndex=o.ReadUInt8(),255===R.parentIndex&&(R.parentIndex=-1),(1&w)!=0?i.vec3.set(R.position,o.ReadFloat32(),o.ReadFloat32(),o.ReadFloat32()):i.vec3.set(R.position,0,0,0),(2&w)!=0?i.quat.set(R.orientation,o.ReadFloat32(),o.ReadFloat32(),o.ReadFloat32(),o.ReadFloat32()):i.quat.identity(R.orientation),(4&w)!=0)for(var P=0;P<9;++P)R.scaleShear[P]=o.ReadFloat32();else i.mat3.identity(R.scaleShear);E.skeleton.bones[S]=R}for(var A=0;A<E.skeleton.bones.length;++A)E.skeleton.bones[A].UpdateTransform(),-1!==E.skeleton.bones[A].parentIndex?i.mat4.multiply(E.skeleton.bones[A].worldTransform,E.skeleton.bones[E.skeleton.bones[A].parentIndex].worldTransform,E.skeleton.bones[A].localTransform):i.mat4.copy(E.skeleton.bones[A].worldTransform,E.skeleton.bones[A].localTransform),i.mat4.invert(E.skeleton.bones[A].worldTransformInv,E.skeleton.bones[A].worldTransform);for(var D=o.ReadUInt8(),O=0;O<D;++O){var C=o.ReadUInt8();C<this.meshes.length&&t.BindMeshToModel(this.meshes[C],E,this)}this.models[this.models.length]=E}for(var I=o.ReadUInt8(),k=0;k<I;++k){var x=new c.Tw2GeometryAnimation;x.name=o.ReadString(),x.duration=o.ReadFloat32();for(var M=o.ReadUInt8(),L=0;L<M;++L){var B=new c.Tw2GeometryTrackGroup;B.name=o.ReadString();for(var F=0;F<this.models.length;++F)if(this.models[F].name===B.name){B.model=this.models[F];break}for(var G=o.ReadUInt8(),V=0;V<G;++V){var N=new c.Tw2GeometryTransformTrack;if(N.name=o.ReadString(),N.orientation=t.ReadCurve(o),N.position=t.ReadCurve(o),N.scaleShear=t.ReadCurve(o),N.orientation)for(var U=0,j=0,z=0,q=0,H=0;H<N.orientation.controls.length;H+=4){var Y=N.orientation.controls[H],W=N.orientation.controls[H+1],X=N.orientation.controls[H+2],K=N.orientation.controls[H+3];U*Y+j*W+z*X+q*K<0&&(N.orientation.controls[H]=-Y,N.orientation.controls[H+1]=-W,N.orientation.controls[H+2]=-X,N.orientation.controls[H+3]=-K),U=Y,j=W,z=X,q=K}B.transformTracks[B.transformTracks.length]=N}x.trackGroups[x.trackGroups.length]=B}this.animations[this.animations.length]=x}this.PrepareFinished(!0)}},{key:"RenderAreasInstanced",value:function e(t,r,n,i,o,s,u,l,c){if(this.KeepAlive(),!this.IsGood()||!i.IsGood()||t>=this.meshes.length)return!1;var f=a.device,h=this.meshes[t],p=i.GetPassCount(o);f.gl.bindBuffer(f.gl.ELEMENT_ARRAY_BUFFER,h.indexes);for(var d=0;d<p;++d){i.ApplyPass(o,d);var v=i.GetPassInput(o,d);if(0!==v.elements.length){f.gl.bindBuffer(f.gl.ARRAY_BUFFER,h.buffer),h.declaration.SetPartialDeclaration(v,h.declaration.stride),f.gl.bindBuffer(f.gl.ARRAY_BUFFER,s);var $=u.SetPartialDeclaration(v,l,8,1);f.ApplyShadowState();for(var m=0;m<n;++m)if(m+r<h.areas.length){for(var y=h.areas[m+r],g=y.start,_=y.count;m+1<n&&(y=h.areas[m+1+r]).start===g+2*_;)_+=y.count,++m;f.ext.drawElementsInstanced(f.gl.TRIANGLES,_,h.indexType,g,c)}u.ResetInstanceDivisors($)}}return!0}},{key:"RenderAreas",value:function e(t,r,n,i,s){if(this.KeepAlive(),!this.IsGood()||!i.IsGood()||t>=this.meshes.length)return!1;var u=a.device,l=this.meshes[t]||this.meshes[0],c=i.GetPassCount(s);u.gl.bindBuffer(u.gl.ARRAY_BUFFER,l.buffer),u.gl.bindBuffer(u.gl.ELEMENT_ARRAY_BUFFER,l.indexes);for(var f=0;f<c;++f){i.ApplyPass(s,f);var h=i.GetPassInput(s,f);if(!l.declaration.SetDeclaration(h,l.declaration.stride))return o.logger.log("res.error",{log:"error",src:["Tw2GeometryRes","RenderLines"],msg:"Error binding mesh to effect",path:this.path,type:"geometry.meshbind",data:{pass:f,passInput:h,meshStride:l.declaration.stride}}),!1;u.ApplyShadowState();for(var p=0;p<n;++p)if(p+r<l.areas.length){for(var d=l.areas[p+r],v=d.start,$=d.count;p+1<n&&(d=l.areas[p+1+r]).start===v+2*$;)$+=d.count,++p;u.gl.drawElements(u.gl.TRIANGLES,$,l.indexType,v)}}return!0}},{key:"RenderLines",value:function e(t,r,n,i,s){if(this.KeepAlive(),!this.IsGood()||!i.IsGood()||t>=this.meshes.length)return!1;var u=a.device,l=this.meshes[t],c=i.GetPassCount(s);u.gl.bindBuffer(u.gl.ARRAY_BUFFER,l.buffer),u.gl.bindBuffer(u.gl.ELEMENT_ARRAY_BUFFER,l.indexes);for(var f=0;f<c;++f){i.ApplyPass(s,f);var h=i.GetPassInput(s,f);if(!l.declaration.SetDeclaration(h,l.declaration.stride))return o.logger.log("res.error",{log:"error",src:["Tw2GeometryRes","RenderLines"],msg:"Error binding mesh to effect",path:this.path,type:"geometry.meshbind",data:{pass:f,passInput:h,meshStride:l.declaration.stride}}),!1;u.ApplyShadowState();for(var p=0;p<n;++p)if(p+r<l.areas.length){for(var d=l.areas[p+r],v=d.start,$=d.count;p+1<n&&(d=l.areas[p+1+r]).start===v+2*$;)$+=d.count,++p;u.gl.drawElements(u.gl.LINES,$,l.indexType,v)}}return!0}},{key:"RenderDebugInfo",value:function e(t){if(!this.IsGood())return!1;for(var r=0;r<this.models.length;++r)if(this.models[r].skeleton)for(var n=0;n<this.models[r].skeleton.bones.length;++n){var i=this.models[r].skeleton.bones[n];if(i.parentIndex>=0){var a=this.models[r].skeleton.bones[i.parentIndex];t.AddLine([i.worldTransform[12],i.worldTransform[13],i.worldTransform[14]],[a.worldTransform[12],a.worldTransform[13],a.worldTransform[14]],[0,.7,0,1],[0,.7,0,1])}}}},{key:"Unload",value:function e(){for(var t=0;t<this.meshes.length;++t)this.meshes[t].buffer&&(a.device.gl.deleteBuffer(this.meshes[t].buffer),this.meshes[t].buffer=null),this.meshes[t].indexes&&(a.device.gl.deleteBuffer(this.meshes[t].indexes),this.meshes[t].indexes=null);return this._isPurged=!0,this._isGood=!1,!0}}],[{key:"BindMeshToModel",value:function e(t,r,n){var i=new c.Tw2GeometryMeshBinding;i.mesh=t;for(var a=0;a<i.mesh.boneBindings.length;++a){var s=i.mesh.boneBindings[a],u=r.FindBoneByName(s);u?i.bones[i.bones.length]=u:o.logger.log("res.error",{log:"error",src:["Tw2GeometryRes","BindMeshToModel"],msg:"Mesh has invalid bone name for model",path:n.path,type:"geometry.invalidbone",data:{mesh:i.mesh.name,bone:s,model:r.name}})}r.meshBindings[r.meshBindings.length]=i}},{key:"ReadVertexBuffer",value:function e(t,r){for(var n=t.ReadUInt8(),i=0,s=0;s<n;++s){var l=new u.Tw2VertexElement;l.usage=t.ReadUInt8(),l.usageIndex=t.ReadUInt8(),l.fileType=t.ReadUInt8(),l.type=a.device.gl.FLOAT,l.elements=(l.fileType>>5)+1,l.offset=4*i,r.elements[s]=l,i+=l.elements}r.RebuildHash(),r.stride=4*i;var c=t.ReadUInt32();if(0===c)return null;for(var f=new Float32Array(i*c),h=0,p=0;p<c;++p)for(var d=0;d<n;++d){var v=r.elements[d];switch(15&v.fileType){case 0:if((16&v.fileType)!=0)for(var $=0;$<v.elements;++$)f[h++]=t.ReadInt8()/127;else for(var m=0;m<v.elements;++m)f[h++]=t.ReadInt8();break;case 1:if((16&v.fileType)!=0)for(var y=0;y<v.elements;++y)f[h++]=t.ReadInt8()/32767;else for(var g=0;g<v.elements;++g)f[h++]=t.ReadInt16();break;case 2:for(var _=0;_<v.elements;++_)f[h++]=t.ReadInt32();break;case 3:for(var b=0;b<v.elements;++b)f[h++]=t.ReadFloat16();break;case 4:for(var E=0;E<v.elements;++E)f[h++]=t.ReadFloat32();break;case 8:if((16&v.fileType)!=0)for(var T=0;T<v.elements;++T)f[h++]=t.ReadUInt8()/255;else for(var S=0;S<v.elements;++S)f[h++]=t.ReadUInt8();break;case 9:if((16&v.fileType)!=0)for(var R=0;R<r.elements[d].elements;++R)f[h++]=t.ReadUInt8()/65535;else for(var w=0;w<v.elements;++w)f[h++]=t.ReadUInt16();break;case 10:for(var P=0;P<v.elements;++P)f[h++]=t.ReadUInt32();break;default:throw o.logger.log("res.error",{log:"error",src:["Tw2GeometryRes","ReadVertexBuffer"],msg:"Error loading wbg data",path:self.path,type:"geometry.filetype",value:15&v.fileType}),1}}return f}},{key:"ReadIndexBuffer",value:function e(t){var r=t.ReadUInt8(),n=t.ReadUInt32();if(0===r){for(var i=new Uint16Array(n),a=0;a<n;++a)i[a]=t.ReadUInt16();return i}for(var o=new Uint32Array(n),s=0;s<n;++s)o[s]=t.ReadUInt32();return o}},{key:"ReadCurve",value:function e(t){if(0===t.ReadUInt8())return null;var r=new c.Tw2GeometryCurve;r.dimension=t.ReadUInt8(),r.degree=t.ReadUInt8();var n=t.ReadUInt32();r.knots=new Float32Array(n);for(var i=0;i<n;++i)r.knots[i]=t.ReadFloat32();var a=t.ReadUInt32();r.controls=new Float32Array(a);for(var o=0;o<a;++o)r.controls[o]=t.ReadFloat32();return r}}]),t}(l.Tw2Resource)).prototype.requestResponseType="arraybuffer"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VideoRes=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(2),a=r(6),o=r(4),s=r(12);t.Tw2VideoRes=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.texture=null,e.video=null,e.width=0,e.height=0,e.cycle=!0,e.playOnLoad=!0,e._currentSampler=0,e._currentTime=-1,e._playable=!1,e._isPlaying=!1,e._onPlaying=null,e._onPause=null,e._onEnded=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"IsGood",value:function e(){return this.KeepAlive(),this._isGood&&this.video&&this._playable}},{key:"KeepAlive",value:function e(){this.activeFrame=a.resMan.activeFrame}},{key:"Play",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.cycle=t,this._onEnded=r,this.video&&this._playable?(this.video.loop=this.cycle,this.video.play()):this.playOnLoad=!0}},{key:"Pause",value:function e(){this.video?this.video.pause():this.playOnLoad=!1}},{key:"Prepare",value:function e(t){var r=i.device.gl;switch(t){case"mp4":case"webm":case"ogg":this.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,this.texture),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,this.video),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.bindTexture(r.TEXTURE_2D,null),this.width=this.video.width,this.height=this.video.height,this.video.loop=this.cycle,this.playOnLoad&&this.video.play(),this.PrepareFinished(!0)}}},{key:"DoCustomLoad",value:function e(t){var r=this,n=a.resMan.constructor.GetPathExt(t);return this.LoadStarted(),a.resMan._pendingLoads++,this.video=document.createElement("video"),this.video.crossOrigin="anonymous",this.video.muted=!0,this.video.onerror=function(){a.resMan._pendingLoads--,o.logger.log("res.error",{log:"error",src:["Tw2TextureRes","DoCustomLoad"],msg:"Error loading resource",type:"http.error",path:t}),r.LoadFinished(!1),r.PrepareFinished(!1),r.video=null},this.video.oncanplay=function(){r._playable=!0,r.video.oncanplay=null,a.resMan._pendingLoads--,a.resMan._prepareQueue.push([r,n,null]),r.LoadFinished(!0)},this.video.onended=function(){r._isPlaying=!1,r._onEnded&&r._onEnded(r)},this.video.onpause=function(){r._isPlaying=!1,r._onPause&&r._onPause(r)},this.video.onplaying=function(){r._isPlaying=!0,r._onPlaying&&r._onPlaying(r)},this.video.src=t,!0}},{key:"Unload",value:function e(){return this.texture&&(i.device.gl.deleteTexture(this.texture),this.texture=null),this._isPlaying=!1,this._playable=!1,this.playOnLoad=!0,this.video=null,!0}},{key:"Bind",value:function e(t){var r=i.device;this.KeepAlive();var n=t.samplerType;if(n===r.gl.TEXTURE_2D){if(!this.texture){r.gl.bindTexture(r.gl.TEXTURE_2D,r.GetFallbackTexture());return}this._currentTime=this.video.currentTime,r.gl.bindTexture(r.gl.TEXTURE_2D,this.texture),r.gl.texImage2D(r.gl.TEXTURE_2D,0,r.gl.RGBA,r.gl.RGBA,r.gl.UNSIGNED_BYTE,this.video),r.gl.bindTexture(r.gl.TEXTURE_2D,null),r.gl.bindTexture(n,this.texture),t.hash!==this._currentSampler&&(t.Apply(!1),this._currentSampler=t.hash)}}}]),t}(s.Tw2Resource)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(138);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PostProcess=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(17),a=r(56),o=r(47),s=r(28);t.Tw2PostProcess=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.width=0,this.height=0,this.texture=null,this.quadRT0=new a.Tw2RenderTarget,this.quadRT1=new a.Tw2RenderTarget,this.steps=[{effect:o.Tw2Effect.create({effectFilePath:"res:/Graphics/Effect/Managed/Space/PostProcess/ColorDownFilter4.fx",parameters:{g_texelSize:[1,1,1,1],BlitCurrent:""}}),rt:this.quadRT1,inputs:{BlitCurrent:null}},{effect:o.Tw2Effect.create({effectFilePath:"res:/Graphics/Effect/Managed/Space/PostProcess/ColorHighPassFilter.fx",parameters:{LuminanceThreshold:.85,LuminanceScale:2,BlitCurrent:""}}),rt:this.quadRT0,inputs:{BlitCurrent:this.quadRT1}},{effect:o.Tw2Effect.create({effectFilePath:"res:/Graphics/Effect/Managed/Space/PostProcess/ColorExpBlurHorizontalBig.fx",parameters:{g_texelSize:[1,1,1,1],BlitCurrent:""}}),rt:this.quadRT1,inputs:{BlitCurrent:this.quadRT0}},{effect:o.Tw2Effect.create({effectFilePath:"res:/Graphics/Effect/Managed/Space/PostProcess/ColorExpBlurVerticalBig.fx",parameters:{g_texelSize:[1,1,1,1],BlitCurrent:""}}),rt:this.quadRT0,inputs:{BlitCurrent:this.quadRT1}},{effect:o.Tw2Effect.create({effectFilePath:"res:/Graphics/Effect/Managed/Space/PostProcess/ColorUpFilter4_Add.fx",parameters:{g_texelSize:[1,1,1,1],ScalingFactor:1,BlitCurrent:"",BlitOriginal:""}}),rt:null,inputs:{BlitCurrent:this.quadRT0,BlitOriginal:null}}]}return n(e,[{key:"Render",value:function e(){var t=i.device.viewportWidth,r=i.device.viewportHeight;if(!(t<=0)&&!(r<=0)){if(null===this.texture&&(this.texture=new s.Tw2TextureRes,this.texture.Attach(i.device.gl.createTexture())),t!==this.width||r!==this.height){i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,this.texture.texture),i.device.gl.texImage2D(i.device.gl.TEXTURE_2D,0,i.device.gl.RGBA,t,r,0,i.device.gl.RGBA,i.device.gl.UNSIGNED_BYTE,null),i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,null),this.quadRT0.Create(t/4,r/4,!1),this.quadRT1.Create(t/4,r/4,!1),this.width=t,this.height=r;for(var n=0;n<this.steps.length;++n){var a=this.steps[n];for(var o in a.inputs)a.inputs.hasOwnProperty(o)&&(a.inputs[o]?a.effect.parameters[o].textureRes=a.inputs[o].texture:a.effect.parameters[o].textureRes=this.texture);if("g_texelSize"in a.effect.parameters&&"BlitCurrent"in a.inputs){var u=a.effect.parameters.g_texelSize,l=a.inputs.BlitCurrent;l?(u.value[0]=1/l.width,u.value[1]=1/l.width):(u.value[0]=1/t,u.value[1]=1/t),u.OnValueChanged()}}}i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,this.texture.texture),i.device.gl.copyTexImage2D(i.device.gl.TEXTURE_2D,0,i.device.alphaBlendBackBuffer?i.device.gl.RGBA:i.device.gl.RGB,0,0,t,r,0),i.device.gl.bindTexture(i.device.gl.TEXTURE_2D,null),i.device.SetStandardStates(i.device.RM_OPAQUE);for(var c=0;c<this.steps.length;++c){var f=this.steps[c];null!==f.rt?f.rt.Set():(i.device.gl.bindFramebuffer(i.device.gl.FRAMEBUFFER,null),i.device.gl.viewport(0,0,t,r)),i.device.RenderFullScreenQuad(f.effect)}}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Float=function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.value=0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Frustum=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.Tw2Frustum=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.planes=[i.vec4.create(),i.vec4.create(),i.vec4.create(),i.vec4.create(),i.vec4.create(),i.vec4.create()],this.viewPos=i.vec3.create(),this.viewDir=i.vec3.create(),this.halfWidthProjection=1}return n(e,[{key:"Initialize",value:function t(r,n,a,o,s){var u=e.global.mat4_0,l=o||i.mat4.invert(u,r);this.viewPos.set(l.subarray(12,14)),this.viewDir.set(l.subarray(8,10)),this.halfWidthProjection=n[0]*a*.5;var c=s||i.mat4.multiply(u,n,r);this.planes[0][0]=c[2],this.planes[0][1]=c[6],this.planes[0][2]=c[10],this.planes[0][3]=c[14],this.planes[1][0]=c[3]+c[0],this.planes[1][1]=c[7]+c[4],this.planes[1][2]=c[11]+c[8],this.planes[1][3]=c[15]+c[12],this.planes[2][0]=c[3]-c[1],this.planes[2][1]=c[7]-c[5],this.planes[2][2]=c[11]-c[9],this.planes[2][3]=c[15]-c[13],this.planes[3][0]=c[3]-c[0],this.planes[3][1]=c[7]-c[4],this.planes[3][2]=c[11]-c[8],this.planes[3][3]=c[15]-c[12],this.planes[4][0]=c[3]+c[1],this.planes[4][1]=c[7]+c[5],this.planes[4][2]=c[11]+c[9],this.planes[4][3]=c[15]+c[13],this.planes[5][0]=c[3]-c[2],this.planes[5][1]=c[7]-c[6],this.planes[5][2]=c[11]-c[10],this.planes[5][3]=c[15]-c[14];for(var f=0;f<6;++f){var h=i.vec3.length(this.planes[f]);this.planes[f][0]/=h,this.planes[f][1]/=h,this.planes[f][2]/=h,this.planes[f][3]/=h}}},{key:"IsSphereVisible",value:function e(t,r){for(var n=0;n<6;++n)if(this.planes[n][0]*t[0]+this.planes[n][1]*t[1]+this.planes[n][2]*t[2]+this.planes[n][3]<-r)return!1;return!0}},{key:"GetPixelSizeAcross",value:function t(r,n){var a=i.vec3.subtract(e.global.vec3_0,this.viewPos,r),o=i.vec3.dot(this.viewDir,a);return(o<1e-5&&(o=1e-5),n<1e-5)?0:n/o*this.halfWidthProjection*2}}]),e}()).global={vec3_0:i.vec3.create(),mat4_0:i.mat4.create()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ColorCurve=t.Tw2ColorKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(3);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function u(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2ColorKey=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec4.create(),e.left=i.vec4.create(),e.right=i.vec4.create(),e.interpolation=0,e}return u(t,e),t}(a.Tw2CurveKey),c=t.Tw2ColorCurve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.vec4.create(),e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return u(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2Curve.Sort(this)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(r,n){if(0===this.length)return i.vec4.copy(n,this.value);var a=this.keys[0],o=this.keys[this.keys.length-1];if(r>=o.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.vec4.copy(n,this.value);case t.Extrapolation.CONSTANT:return i.vec4.copy(n,o.value);case t.Extrapolation.GRADIENT:return i.vec4.scaleAndAdd(n,o.value,o.right,r-o.time);default:r%=o.time}else if(r<0||r<a.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.vec4.copy(n,this.value);case t.Extrapolation.GRADIENT:return i.vec4.scaleAndAdd(n,a.value,a.left,r*this.length-o.time);default:return i.vec4.copy(n,a.value)}for(var s=this.keys[this._currentKey],u=this.keys[this._currentKey-1];r>=s.time||r<u.time;)r<u.time&&(this._currentKey=0),this._currentKey++,s=this.keys[this._currentKey],u=this.keys[this._currentKey-1];var l=(r-u.time)/(s.time-u.time);return u.interpolation===t.Interpolation.CONSTANT?i.vec4.copy(n,u.value):(n[0]=u.value[0]*(1-l)+s.value[0]*l,n[1]=u.value[1]*(1-l)+s.value[1]*l,n[2]=u.value[2]*(1-l)+s.value[2]*l,n[3]=u.value[3]*(1-l)+s.value[3]*l,n)}}]),t}(a.Tw2Curve);c.inputDimension=4,c.ouputDimension=4,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE,c.Key=l,c.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},c.Interpolation={NONE:0,CONSTANT:1,LINEAR:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ColorCurve2=t.Tw2ColorKey2=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(3);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function u(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2ColorKey2=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec4.create(),e.leftTangent=i.vec4.create(),e.rightTangent=i.vec4.create(),e.interpolation=1,e}return u(t,e),t}(a.Tw2CurveKey),c=t.Tw2ColorCurve2=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=i.vec4.fromValues(0,0,0,1),e.currentValue=i.vec4.fromValues(0,0,0,1),e.endValue=i.vec4.fromValues(0,0,0,1),e.startTangent=i.vec4.create(),e.endTangent=i.vec4.create(),e.interpolation=1,e.keys=[],e.length=0,e}return u(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.currentValue)}},{key:"GetValueAt",value:function e(t,r){if(t=t/this.timeScale+this.timeOffset,this.length<=0||t<=0)return i.vec4.copy(r,this.startValue);if(t>this.length){if(this.cycle)t%=this.length;else if(this.reversed)return i.vec4.copy(r,this.startValue);else return i.vec4.copy(r,this.endValue)}if(this.reversed&&(t=this.length-t),0===this.keys.length)return this.Interpolate(t,null,null,r);var n=this.keys[0],a=this.keys[this.keys.length-1];if(t<=n.time)return this.Interpolate(t,null,n,r);if(t>=a.time)return this.Interpolate(t,a,null,r);for(var o=0;o+1<this.keys.length&&(n=this.keys[o],a=this.keys[o+1],!(n.time<=t)||!(a.time>t));++o);return this.Interpolate(t,n,a,r)}},{key:"Interpolate",value:function e(r,n,a,o){i.vec4.copy(o,this.startValue);var s=this.startValue,u=this.endValue,l=this.interpolation,c=this.length;return(null!==n&&(l=n.interpolation,r-=n.time),l===t.Interpolation.LINEAR)?(n&&a?(s=n.value,u=a.value,c=a.time-n.time):a?(u=a.value,c=a.time):n&&(s=n.value,c=this.length-n.time),o[0]=s[0]+(u[0]-s[0])*(r/c),o[1]=s[1]+(u[1]-s[1])*(r/c),o[2]=s[2]+(u[2]-s[2])*(r/c),o[3]=s[3]+(u[3]-s[3])*(r/c),o):o}}]),t}(a.Tw2Curve);c.inputDimension=4,c.outputDimension=4,c.valueProperty="currentValue",c.curveType=a.Tw2Curve.Type.CURVE2,c.Key=l,c.Interpolation={CONSTANT:0,LINEAR:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2EventCurve=t.Tw2EventKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(3);function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function s(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=t.Tw2EventKey=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value="",e}return s(t,e),t}(i.Tw2CurveKey),l=t.Tw2EventCurve=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value="",e.keys=[],e.extrapolation=0,e._time=0,e._currentKey=0,e._length=0,e}return s(t,e),n(t,[{key:"Sort",value:function e(){this.keys.length&&(this.keys.sort(i.Tw2Curve.Compare),this._length=this.keys[this.keys.length-1].time)}},{key:"GetLength",value:function e(){return this._length}},{key:"UpdateValue",value:function e(r){if(this._length<=0)return this.value;var n=this._time;if(this._time=r,this._time<n&&(this._currentKey=0),this.extrapolation===t.Extrapolation.CYCLE){var i=this._time%this._length;i<n&&(this._currentKey=0),this._time=i}for(;this._currentKey<this.keys.length&&this._time>=this.keys[this._currentKey].time;)this.value=this.keys[this._currentKey].value,++this._currentKey}}]),t}(i.Tw2Curve);l.dimension=1,l.outputDimension=1,l.valueProperty="value",l.curveType=i.Tw2Curve.Type.CURVE,l.Key=u,l.Extrapolation={NONE:0,CYCLE:3}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2PerlinCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(3),o=t.Tw2PerlinCurve=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.start=0,e.speed=1,e.alpha=1.1,e.beta=2,e.offset=0,e.scale=1,e.N=3,e._startOffset=100*Math.random(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"UpdateValue",value:function e(t){this.value=this.GetValueAt(t)}},{key:"GetValueAt",value:function e(t){return t-=this._startOffset,(i.noise.perlin1D(t*this.speed,this.alpha,this.beta,this.N)+1)/2*this.scale+this.offset}}]),t}(a.Tw2Curve);o.outputDimension=1,o.valueProperty="value",o.curveType=a.Tw2Curve.Type.CURVE_NO_KEYS},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2QuaternionCurve=t.Tw2QuaternionKey2=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(3);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function u(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2QuaternionKey2=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.quat.create(),e.leftTangent=i.vec4.create(),e.rightTangent=i.vec4.create(),e.interpolation=1,e}return u(t,e),t}(a.Tw2CurveKey),c=t.Tw2QuaternionCurve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=i.quat.create(),e.currentValue=i.quat.create(),e.endValue=i.quat.create(),e.startTangent=i.vec4.create(),e.endTangent=i.vec4.create(),e.interpolation=1,e.keys=[],e.length=0,e}return u(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.currentValue)}},{key:"GetValueAt",value:function e(t,r){if(t=t/this.timeScale+this.timeOffset,this.length<=0||t<=0)return r[0]=this.startValue[0],r[1]=this.startValue[1],r[2]=this.startValue[2],r;if(t>this.length){if(this.cycle)t%=this.length;else if(this.reversed)return r[0]=this.startValue[0],r[1]=this.startValue[1],r[2]=this.startValue[2],r;else return r[0]=this.endValue[0],r[1]=this.endValue[1],r[2]=this.endValue[2],r}if(this.reversed&&(t=this.length-t),0===this.keys.length)return this.Interpolate(t,null,null,r);var n=this.keys[0],i=this.keys[this.keys.length-1];if(t<=n.time)return this.Interpolate(t,null,n,r);if(t>=i.time)return this.Interpolate(t,i,null,r);for(var a=0;a+1<this.keys.length&&(n=this.keys[a],i=this.keys[a+1],!(n.time<=t)||!(i.time>t));++a);return this.Interpolate(t,n,i,r)}},{key:"Interpolate",value:function e(r,n,a,o){o[0]=this.startValue[0],o[1]=this.startValue[1],o[2]=this.startValue[2];var s=this.startValue,u=this.endValue,l=this.interpolation,c=this.length;return(null!==n&&(l=n.interpolation,r-=n.time),l===t.Interpolation.SPHERICAL_LINEAR)?(n&&a?(s=n.value,u=a.value,c=a.time-n.time):a?(u=a.value,c=a.time):n&&(s=n.value,c=this.length-n.time),i.quat.slerp(o,s,u,r/c),o):o}}]),t}(a.Tw2Curve);c.inputDimension=4,c.outputDimension=4,c.valueProperty="currentValue",c.curveType=a.Tw2Curve.Type.CURVE2,c.Key=l,c.Interpolation={CONSTANT:0,SPHERICAL_LINEAR:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RandomConstantCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(3),a=t.Tw2RandomConstantCurve=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.min=0,e.max=1,e.hold=!0,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"UpdateValue",value:function e(){this.value=this.GetValueAt()}},{key:"GetValueAt",value:function e(){return this.hold?this.value:this.min+(this.max-this.min)*Math.random()}}]),t}(i.Tw2Curve);a.outputDimension=1,a.valueProperty="value",a.curveType=i.Tw2Curve.Type.CURVE_NO_KEYS},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RigidOrientation=t.Tw2Torque=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(3);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function u(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2Torque=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.rot0=i.quat.create(),e.omega0=i.vec3.create(),e.torque=i.vec3.create(),e}return u(t,e),t}(a.Tw2CurveKey),c=t.Tw2RigidOrientation=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.name="",e.I=1,e.drag=1,e.value=i.quat.create(),e.start=0,e.states=[],e.length=0,e}return u(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2Curve.Sort(this,this.states)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(t,r){if(0===this.states.length||t<0||t<this.states[0].time)return i.quat.copy(r,this.value);var n=0;if(t>=this.states[this.states.length-1].time)n=this.states.length-1;else for(;n+1<this.states.length&&(!(t>=this.states[n].time)||!(t<this.states[n+1].time));++n);var o=a.Tw2Curve.global.vec3_0,s=a.Tw2Curve.global.quat_0,u=this.states[n];return i.vec3.exponentialDecay(o,u.omega0,u.torque,this.I,this.drag,t-u.time),i.quat.exp(s,o),i.quat.multiply(r,this.states[n].rot0,s),r}}]),t}(a.Tw2Curve);c.inputDimension=4,c.outputDimension=4,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE,c.Key=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RotationCurve=t.Tw2QuaternionKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(3);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function u(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2QuaternionKey=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.quat.create(),e.left=i.vec4.create(),e.right=i.vec4.create(),e.interpolation=5,e}return u(t,e),t}(a.Tw2CurveKey),c=t.Tw2RotationCurve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.quat.create(),e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return u(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2Curve.Sort(this)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(r,n){if(0===this.length)return i.quat.copy(n,this.value);var o=a.Tw2Curve.global,s=this.keys[0],u=this.keys[this.keys.length-1];if(r>=u.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.quat.copy(n,this.value);case t.Extrapolation.CONSTANT:return i.quat.copy(n,u.value);default:r%=u.time}else if(r<0||r<s.time)return this.extrapolation===t.Extrapolation.NONE?i.quat.copy(n,this.value):i.quat.copy(n,s.value);for(var l=this.keys[this._currentKey],c=this.keys[this._currentKey-1];r>=l.time||r<c.time;)r<c.time&&(this._currentKey=0),this._currentKey++,l=this.keys[this._currentKey],c=this.keys[this._currentKey-1];var f=(r-c.time)/(l.time-c.time);switch(c.interpolation){case t.Interpolation.CONSTANT:return i.quat.copy(n,c.value);case t.Interpolation.LINEAR:return n[0]=c.value[0]*(1-f)+l.value[0]*f,n[1]=c.value[1]*(1-f)+l.value[1]*f,n[2]=c.value[2]*(1-f)+l.value[2]*f,n[3]=c.value[3]*(1-f)+l.value[3]*f,n;case t.Interpolation.HERMITE:for(var h=i.quat.identity(o.quat_0),p=[c.value,c.right,l.left,l.value],d=3;d>0;d--){var v=i.num.biCumulative(f,d);v>1&&i.quat.multiply(n,h,p[d]),n[0]=-p[d-1][0],n[1]=-p[d-1][1],n[2]=-p[d-1][2],n[3]=p[d-1][3],i.quat.multiply(n,n,p[d]),i.quat.pow(n,n,v),i.quat.multiply(h,h,n)}return i.quat.multiply(n,h,c.value);case t.Interpolation.SLERP:return i.quat.slerp(n,c.value,l.value,f);default:return i.quat.sqlerp(n,c.value,c.right,l.left,l.value,f)}}}]),t}(a.Tw2Curve);c.outputDimention=4,c.inputDimension=4,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE,c.Child=l,c.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},c.Interpolation={NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3,SLERP:5,SQUAD:6}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ScalarCurve=t.Tw2ScalarKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(3);function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function s(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=t.Tw2ScalarKey=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.left=0,e.right=0,e.interpolation=0,e}return s(t,e),t}(i.Tw2CurveKey),l=t.Tw2ScalarCurve=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.timeScale=1,e.timeOffset=0,e.value=0,e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return s(t,e),n(t,[{key:"Sort",value:function e(){i.Tw2Curve.Sort(this)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.value=this.GetValueAt(t)}},{key:"GetValueAt",value:function e(r){if(r=r/this.timeScale-this.timeOffset,0===this.length)return this.value;var n=this.keys[0],i=this.keys[this.keys.length-1];if(r>=i.time)switch(this.extrapolation){case t.Extrapolation.NONE:return this.value;case t.Extrapolation.CONSTANT:return i.value;case t.Extrapolation.GRADIENT:return i.value+(r-i.time)*i.right;default:r%=i.time}else if(r<0||r<n.time)switch(this.extrapolation){case t.Extrapolation.NONE:return this.value;case t.Extrapolation.GRADIENT:return n.value+(r*this.length-i.time)*n.left;default:return n.value}for(var a=this.keys[this._currentKey],o=this.keys[this._currentKey-1];r>=a.time||r<o.time;)r<o.time&&(this._currentKey=0),this._currentKey++,a=this.keys[this._currentKey],o=this.keys[this._currentKey-1];var s=(r-o.time)/(a.time-o.time);switch(o.interpolation){case t.Interpolation.CONSTANT:return o.value;case t.Interpolation.LINEAR:return o.value*(1-s)+a.value*s;case t.Interpolation.HERMITE:return(2*s*s*s-3*s*s+1)*o.value+(-2*s*s*s+3*s*s)*a.value+(s*s*s-2*s*s+s)*o.right+(s*s*s-s*s)*a.left;default:var u,l=1+(Math.sqrt(o.value/a.value)-1)*Math.exp(-r/o.right);return l*l*a.value}}}]),t}(i.Tw2Curve);l.inputDimension=1,l.outputDimension=1,l.valueProperty="value",l.curveType=i.Tw2Curve.Type.CURVE,l.Key=u,l.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},l.Interpolation={NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3,CATMULROM:4}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ScalarCurve2=t.Tw2ScalarKey2=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(3);function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function s(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=t.Tw2ScalarKey2=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.leftTangent=0,e.rightTangent=0,e.interpolation=1,e}return s(t,e),t}(i.Tw2CurveKey),l=t.Tw2ScalarCurve2=function(e){function t(){a(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=0,e.currentValue=0,e.endValue=0,e.startTangent=0,e.endTangent=0,e.interpolation=1,e.keys=[],e.length=0,e}return s(t,e),n(t,[{key:"Sort",value:function e(){i.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.currentValue=this.GetValueAt(t)}},{key:"GetValueAt",value:function e(t){if(t=t/this.timeScale+this.timeOffset,this.length<=0||t<=0)return this.startValue;if(t>this.length){if(this.cycle)t%=this.length;else if(this.reversed)return this.startValue;else return this.endValue}if(this.reversed&&(t=this.length-t),0===this.keys.length)return this.Interpolate(t,null,null);var r=this.keys[0],n=this.keys[this.keys.length-1];if(t<=r.time)return this.Interpolate(t,null,r);if(t>=n.time)return this.Interpolate(t,n,null);for(var i=0;i+1<this.keys.length&&(r=this.keys[i],n=this.keys[i+1],!(r.time<=t)||!(n.time>t));++i);return this.Interpolate(t,r,n)}},{key:"Interpolate",value:function e(r,n,i){var a=this.startValue,o=this.endValue,s=this.interpolation,u=this.length;switch(null!==n&&(s=n.interpolation,r-=n.time),s){case t.Interpolation.LINEAR:return n&&i?(a=n.value,o=i.value,u=i.time-n.time):i?(o=i.value,u=i.time):n&&(a=n.value,u=this.length-n.time),a+(o-a)*(r/u);case t.Interpolation.HERMITE:var l=this.startTangent,c=this.endTangent;n&&i?(a=n.value,l=n.rightTangent,o=i.value,c=i.leftTangent,u=i.time-n.time):i?(o=i.value,c=i.leftTangent,u=i.time):n&&(a=n.value,l=n.rightTangent,u=this.length-n.time);var f=r/u,h=f*f,p=h*f,d=-2*p+3*h,v=p-h;return a*(1-d)+o*d+l*(f+v-h)+c*v;default:return this.startValue}}}]),t}(i.Tw2Curve);l.inputDimension=1,l.outputDimension=1,l.valueProperty="currentValue",l.curveType=i.Tw2Curve.Type.CURVE2,l.Key=u,l.Interpolation={CONSTANT:0,LINEAR:1,HERMITE:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2SineCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(3),a=t.Tw2SineCurve=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.offset=0,e.scale=1,e.speed=1,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"UpdateValue",value:function e(t){this.value=this.GetValueAt(t)}},{key:"GetValueAt",value:function e(t){return Math.sin(t*Math.PI*2*this.speed)*this.scale+this.offset}}]),t}(i.Tw2Curve);a.outputDimension=1,a.valueProperty="value",a.curveType=i.Tw2Curve.Type.CURVE_NO_KEYS},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector2Curve=t.Tw2Vector2Key=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(3);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function u(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2Vector2Key=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec2.create(),e.leftTangent=i.vec2.create(),e.rightTangent=i.vec2.create(),e.interpolation=1,e}return u(t,e),t}(a.Tw2CurveKey),c=t.Tw2Vector2Curve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=i.vec2.create(),e.currentValue=i.vec2.create(),e.endValue=i.vec2.create(),e.startTangent=i.vec2.create(),e.endTangent=i.vec2.create(),e.interpolation=1,e.keys=[],e.length=0,e}return u(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.currentValue)}},{key:"GetValueAt",value:function e(t,r){if(t=t/this.timeScale+this.timeOffset,this.length<=0||t<=0)return i.vec2.copy(r,this.startValue);if(t>this.length){if(this.cycle)t%=this.length;else if(this.reversed)return i.vec2.copy(r,this.startValue);else return i.vec2.copy(r,this.endValue)}if(this.reversed&&(t=this.length-t),0===this.keys.length)return this.Interpolate(t,null,null,r);var n=this.keys[0],a=this.keys[this.keys.length-1];if(t<=n.time)return this.Interpolate(t,null,n,r);if(t>=a.time)return this.Interpolate(t,a,null,r);for(var o=0;o+1<this.keys.length&&(n=this.keys[o],a=this.keys[o+1],!(n.time<=t)||!(a.time>t));++o);return this.Interpolate(t,n,a,r)}},{key:"Interpolate",value:function e(r,n,a,o){i.vec2.copy(o,this.startValue);var s=this.startValue,u=this.endValue,l=this.interpolation,c=this.length;switch(null!==n&&(l=n.interpolation,r-=n.time),l){case t.Interpolation.LINEAR:return n&&a?(s=n.value,u=a.value,c=a.time-n.time):a?(u=a.value,c=a.time):n&&(s=n.value,c=this.length-n.time),o[0]=s[0]+(u[0]-s[0])*(r/c),o[1]=s[1]+(u[1]-s[1])*(r/c),o;case t.Interpolation.HERMITE:var f=this.startTangent,h=this.endTangent;n&&a?(s=n.value,f=n.rightTangent,u=a.value,h=a.leftTangent,c=a.time-n.time):a?(u=a.value,h=a.leftTangent,c=a.time):n&&(s=n.value,f=n.rightTangent,c=this.length-n.time);var p=r/c,d=p*p,v=d*p,$=-2*v+3*d,m=1-$,y=v-d,g=p+y-d;return o[0]=s[0]*m+u[0]*$+f[0]*g+h[0]*y,o[1]=s[1]*m+u[1]*$+f[1]*g+h[1]*y,o;default:return o}}}]),t}(a.Tw2Curve);c.inputDimension=2,c.outputDimension=2,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE2,c.Key=l,c.Interpolation={CONSTANT:0,LINEAR:1,HERMITE:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2Vector3Curve=t.Tw2Vector3Key=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(3);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function u(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2Vector3Key=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec3.create(),e.leftTangent=i.vec3.create(),e.rightTangent=i.vec3.create(),e.interpolation=1,e}return u(t,e),t}(a.Tw2CurveKey),c=t.Tw2Vector3Curve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.cycle=!1,e.reversed=!1,e.timeOffset=0,e.timeScale=1,e.startValue=i.vec3.create(),e.currentValue=i.vec3.create(),e.endValue=i.vec3.create(),e.startTangent=i.vec3.create(),e.endTangent=i.vec3.create(),e.interpolation=1,e.keys=[],e.length=0,e}return u(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2Curve.Sort2(this)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.currentValue)}},{key:"GetValueAt",value:function e(t,r){if(t=t/this.timeScale+this.timeOffset,this.length<=0||t<=0)return i.vec3.copy(r,this.startValue);if(t>this.length){if(this.cycle)t%=this.length;else if(this.reversed)return i.vec3.copy(r,this.startValue);else return i.vec3.copy(r,this.endValue)}if(this.reversed&&(t=this.length-t),0===this.keys.length)return this.Interpolate(t,null,null,r);var n=this.keys[0],a=this.keys[this.keys.length-1];if(t<=n.time)return this.Interpolate(t,null,n,r);if(t>=a.time)return this.Interpolate(t,a,null,r);for(var o=0;o+1<this.keys.length&&(n=this.keys[o],a=this.keys[o+1],!(n.time<=t)||!(a.time>t));++o);return this.Interpolate(t,n,a,r)}},{key:"Interpolate",value:function e(r,n,a,o){i.vec3.copy(o,this.startValue);var s=this.startValue,u=this.endValue,l=this.interpolation,c=this.length;switch(null!==n&&(l=n.interpolation,r-=n.time),l){case t.Interpolation.LINEAR:return n&&a?(s=n.value,u=a.value,c=a.time-n.time):a?(u=a.value,c=a.time):n&&(s=n.value,c=this.length-n.time),o[0]=s[0]+(u[0]-s[0])*(r/c),o[1]=s[1]+(u[1]-s[1])*(r/c),o[2]=s[2]+(u[2]-s[2])*(r/c),o;case t.Interpolation.HERMITE:var f=this.startTangent,h=this.endTangent;n&&a?(s=n.value,f=n.rightTangent,u=a.value,h=a.leftTangent,c=a.time-n.time):a?(u=a.value,h=a.leftTangent,c=a.time):n&&(s=n.value,f=n.rightTangent,c=this.length-n.time);var p=r/c,d=p*p,v=d*p,$=-2*v+3*d,m=1-$,y=v-d,g=p+y-d;return o[0]=s[0]*m+u[0]*$+f[0]*g+h[0]*y,o[1]=s[1]*m+u[1]*$+f[1]*g+h[1]*y,o[2]=s[2]*m+u[2]*$+f[2]*g+h[2]*y,o;default:return o}}}]),t}(a.Tw2Curve);c.inputDimension=3,c.outputDimension=3,c.valueProperty="currentValue",c.curveType=a.Tw2Curve.Type.CURVE2,c.Key=l,c.Interpolation={CONSTANT:0,LINEAR:1,HERMITE:2}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VectorCurve=t.Tw2VectorKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(3);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function u(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l=t.Tw2VectorKey=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec3.create(),e.left=i.vec3.create(),e.right=i.vec3.create(),e.interpolation=0,e}return u(t,e),t}(a.Tw2CurveKey),c=t.Tw2VectorCurve=function(e){function t(){o(this,t);var e=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.vec3.create(),e.extrapolation=0,e.keys=[],e._currentKey=1,e.length=0,e}return u(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2Curve.Sort(this)}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(r,n){if(0===this.length)return i.vec3.copy(n,this.value);var a=this.keys[0],o=this.keys[this.keys.length-1];if(r>=o.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.vec3.copy(n,this.value);case t.Extrapolation.CONSTANT:return i.vec3.copy(n,o.value);case t.Extrapolation.GRADIENT:return i.vec3.scaleAndAdd(n,o.value,o.right,r-o.time);default:r%=o.time}else if(r<0||r<a.time)switch(this.extrapolation){case t.Extrapolation.NONE:return i.vec3.copy(n,this.value);case t.Extrapolation.GRADIENT:return i.vec3.scaleAndAdd(n,a.value,a.left,r*this.length-o.time);default:return i.vec3.copy(n,a.value)}for(var s=this.keys[this._currentKey],u=this.keys[this._currentKey-1];r>=s.time||r<u.time;)r<u.time&&(this._currentKey=0),this._currentKey++,s=this.keys[this._currentKey],u=this.keys[this._currentKey-1];var l=(r-u.time)/(s.time-u.time);switch(u.interpolation){case t.Interpolation.CONSTANT:return i.vec3.copy(n,u.value);case t.Interpolation.LINEAR:return n[0]=u.value[0]*(1-l)+s.value[0]*l,n[1]=u.value[1]*(1-l)+s.value[1]*l,n[2]=u.value[2]*(1-l)+s.value[2]*l,n;case t.Interpolation.HERMITE:var c=2*l*l*l-3*l*l+1,f=-2*l*l*l+3*l*l,h=l*l*l-2*l*l+l,p=l*l*l-l*l;return n[0]=c*u.value[0]+f*s.value[0]+h*u.right[0]+p*s.left[0],n[1]=c*u.value[1]+f*s.value[1]+h*u.right[1]+p*s.left[1],n[2]=c*u.value[2]+f*s.value[2]+h*u.right[2]+p*s.left[2],n;default:return n}}}]),t}(a.Tw2Curve);c.inputDimension=3,c.outputDimension=3,c.valueProperty="value",c.curveType=a.Tw2Curve.Type.CURVE,c.Key=l,c.Extrapolation={NONE:0,CONSTANT:1,GRADIENT:2,CYCLE:3},c.Interpolation={NONE:0,CONSTANT:1,LINEAR:2,HERMITE:3}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(156);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(157);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(158);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(159);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(160);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(161);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})});var l=r(162);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return l[e]}})});var c=r(163);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return c[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ColorSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(8),o=t.Tw2ColorSequencer=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.vec4.create(),e.operator=0,e.functions=[],e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function e(){for(var t=0,r=0;r<this.functions.length;++r)"GetLength"in this.functions[r]&&(t=Math.max(t,this.functions[r].GetLength()));return t}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(r,n){var o=a.Tw2CurveSequencer.global.vec4_0;if(this.operator===t.Operator.MULTIPLY){i.vec4.set(n,1,1,1,1);for(var s=0;s<this.functions.length;++s)this.functions[s].GetValueAt(r,o),i.vec4.multiply(n,n,o);return n}i.vec4.set(n,0,0,0,0);for(var u=0;u<this.functions.length;++u)this.functions[u].GetValueAt(r,o),i.vec4.add(n,n,o);return n}}]),t}(a.Tw2CurveSequencer);o.inputDimension=4,o.outputDimension=4,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER,o.childArray="functions",o.Operator={MULTIPLY:0,ADD:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2EulerRotation=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(8),o=t.Tw2EulerRotation=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.yawCurve=null,e.pitchCurve=null,e.rollCurve=null,e.currentValue=i.quat.create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function e(){var t=0;return this.yawCurve&&"GetLength"in this.yawCurve&&(t=this.yawCurve.GetLength()),this.pitchCurve&&"GetLength"in this.pitchCurve&&(t=Math.max(t,this.pitchCurve.GetLength())),this.rollCurve&&"GetLength"in this.rollCurve&&(t=Math.max(t,this.rollCurve.GetLength())),t}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.currentValue)}},{key:"GetValueAt",value:function e(t,r){var n=this.yawCurve?this.yawCurve.GetValueAt(t):0,i=this.pitchCurve?this.pitchCurve.GetValueAt(t):0,a=this.rollCurve?this.rollCurve.GetValueAt(t):0,o=Math.sin(n/2),s=Math.cos(n/2),u=Math.sin(i/2),l=Math.cos(i/2),c=Math.sin(a/2),f=Math.cos(a/2);return r[0]=o*l*c+s*u*f,r[1]=o*l*f-s*u*c,r[2]=s*l*c-o*u*f,r[3]=s*l*f+o*u*c,r}}]),t}(a.Tw2CurveSequencer);o.inputDimension=1,o.outputDimension=3,o.valueProperty="currentValue",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,o.childProperties=["yawCurve","pitchCurve","rollCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2QuaternionSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(8),o=t.Tw2QuaternionSequencer=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.quat.create(),e.functions=[],e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function e(){for(var t=0,r=0;r<this.functions.length;++r)"GetLength"in this.functions[r]&&(t=Math.max(t,this.functions[r].GetLength()));return t}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(t,r){i.quat.identity(r);for(var n=a.Tw2CurveSequencer.global.quat_0,o=0;o<this.functions.length;++o)this.functions[o].GetValueAt(t,n),i.quat.multiply(r,r,n);return r}}]),t}(a.Tw2CurveSequencer);o.inputDimension=4,o.outputDimension=4,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER,o.childArray="functions"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2RGBAScalarSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(8),o=t.Tw2RGBAScalarSequencer=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec4.create(),e.RedCurve=null,e.GreenCurve=null,e.BlueCurve=null,e.AlphaCurve=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function e(){var t=0;return this.RedCurve&&"GetLength"in this.RedCurve&&(t=this.RedCurve.GetLength()),this.GreenCurve&&"GetLength"in this.GreenCurve&&(t=Math.max(t,this.GreenCurve.GetLength())),this.BlueCurve&&"GetLength"in this.BlueCurve&&(t=Math.max(t,this.BlueCurve.GetLength())),this.AlphaCurve&&"GetLength"in this.AlphaCurve&&(t=Math.max(t,this.AlphaCurve.GetLength())),t}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(t,r){return r[0]=this.RedCurve?this.RedCurve.GetValueAt(t):0,r[1]=this.GreenCurve?this.GreenCurve.GetValueAt(t):0,r[2]=this.BlueCurve?this.BlueCurve.GetValueAt(t):0,r[3]=this.AlphaCurve?this.AlphaCurve.GetValueAt(t):0,r}}]),t}(a.Tw2CurveSequencer);o.inputDimension=1,o.outputDimension=4,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,o.childProperties=["RedCurve","GreenCurve","BlueCurve","AlphaCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2ScalarSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(8),a=t.Tw2ScalarSequencer=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=0,e.operator=0,e.functions=[],e.inMinClamp=0,e.inMaxClamp=1,e.outMinClamp=0,e.outMaxClamp=1,e.clamping=!1,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){i.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function e(){for(var t=0,r=0;r<this.functions.length;++r)"GetLength"in this.functions[r]&&(t=Math.max(t,this.functions[r].GetLength()));return t}},{key:"UpdateValue",value:function e(t){this.value=this.GetValueAt(t)}},{key:"GetValueAt",value:function e(r){var n=void 0;if(this.operator===t.Operator.MULTIPLY){n=1;for(var i=0;i<this.functions.length;++i){var a=this.functions[i].GetValueAt(r);this.clamping&&(a=Math.min(Math.max(a,this.inMinClamp),this.inMaxClamp)),n*=a}}else{n=0;for(var o=0;o<this.functions.length;++o){var s=this.functions[o].GetValueAt(r);this.clamping&&(s=Math.min(Math.max(s,this.inMinClamp),this.inMaxClamp)),n+=s}}return this.clamping&&(n=Math.min(Math.max(n,this.outMinClamp),this.outMaxClamp)),n}}]),t}(i.Tw2CurveSequencer);a.inputDimension=1,a.outputDimension=1,a.valueProperty="value",a.curveType=i.Tw2CurveSequencer.Type.SEQUENCER,a.childArray="functions",a.Operator={MULTIPLY:0,ADD:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2VectorSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(8),o=t.Tw2VectorSequencer=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.start=0,e.value=i.vec3.create(),e.operator=0,e.functions=[],e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2CurveSequencer.Sort(this)}},{key:"GetLength",value:function e(){for(var t=0,r=0;r<this.functions.length;++r)"GetLength"in this.functions[r]&&(t=Math.max(t,this.functions[r].GetLength()));return t}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(r,n){var o=a.Tw2CurveSequencer.global.vec3_0;if(this.operator===t.Operator.MULTIPLY){i.vec3.set(n,1,1,1);for(var s=0;s<this.functions.length;++s)this.functions[s].GetValueAt(r,o),i.vec3.multiply(n,n,o);return n}i.vec3.set(n,0,0,0);for(var u=0;u<this.functions.length;++u)this.functions[u].GetValueAt(r,o),i.vec3.add(n,n,o);return n}}]),t}(a.Tw2CurveSequencer);o.inputDimension=3,o.outputDimension=3,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER,o.childArray="functions",o.Operator={MULTIPLY:0,ADD:1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2XYZScalarSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(8),o=t.Tw2XYZScalarSequencer=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.vec3.create(),e.XCurve=null,e.YCurve=null,e.ZCurve=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function e(){var t=0;return this.XCurve&&"GetLength"in this.XCurve&&(t=this.XCurve.GetLength()),this.YCurve&&"GetLength"in this.YCurve&&(t=Math.max(t,this.YCurve.GetLength())),this.ZCurve&&"GetLength"in this.ZCurve&&(t=Math.max(t,this.ZCurve.GetLength())),t}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(t,r){return r[0]=this.XCurve?this.XCurve.GetValueAt(t):0,r[1]=this.YCurve?this.YCurve.GetValueAt(t):0,r[2]=this.ZCurve?this.ZCurve.GetValueAt(t):0,r}}]),t}(a.Tw2CurveSequencer);o.inputDimension=1,o.outputDimension=3,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,o.childProperties=["XCurve","YCurve","ZCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2YPRSequencer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(8),o=t.Tw2YPRSequencer=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.value=i.quat.create(),e.YawPitchRoll=i.vec3.create(),e.YawCurve=null,e.PitchCurve=null,e.RollCurve=null,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){a.Tw2CurveSequencer.Sort2(this)}},{key:"GetLength",value:function e(){var t=0;return this.YawCurve&&"GetLength"in this.YawCurve&&(t=this.YawCurve.GetLength()),this.PitchCurve&&"GetLength"in this.PitchCurve&&(t=Math.max(t,this.PitchCurve.GetLength())),this.RollCurve&&"GetLength"in this.RollCurve&&(t=Math.max(t,this.RollCurve.GetLength())),t}},{key:"UpdateValue",value:function e(t){this.GetValueAt(t,this.value)}},{key:"GetValueAt",value:function e(t,r){this.YawCurve&&(this.YawPitchRoll[0]=this.YawCurve.GetValueAt(t)),this.PitchCurve&&(this.YawPitchRoll[1]=this.PitchCurve.GetValueAt(t)),this.RollCurve&&(this.YawPitchRoll[2]=this.RollCurve.GetValueAt(t));var n=Math.sin(this.YawPitchRoll[0]/180*Math.PI/2),i=Math.cos(this.YawPitchRoll[0]/180*Math.PI/2),a=Math.sin(this.YawPitchRoll[1]/180*Math.PI/2),o=Math.cos(this.YawPitchRoll[1]/180*Math.PI/2),s=Math.sin(this.YawPitchRoll[2]/180*Math.PI/2),u=Math.cos(this.YawPitchRoll[2]/180*Math.PI/2);return r[0]=n*o*s+i*a*u,r[1]=n*o*u-i*a*s,r[2]=i*o*s-n*a*u,r[3]=i*o*u+n*a*s,r}}]),t}(a.Tw2CurveSequencer);o.inputDimension=1,o.outputDimension=4,o.valueProperty="value",o.curveType=a.Tw2CurveSequencer.Type.SEQUENCER2,o.childProperties=["YawCurve","PitchCurve","RollCurve"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(165);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(166);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2WbgTrack=a,t.Tw2WbgTransformTrack=o;var n=r(0),i=r(1);function a(){this._id=n.util.generateID(),this.name="",this.geometryResPath="",this.geometryRes=null,this.group="",this.duration=0,this.cycle=!1,this.Initialize=function(){if(this.geometryResPath){this.geometryRes=i.resMan.GetResource(this.geometryResPath);var e=this;this.geometryRes.RegisterNotification({OnResPrepared:function t(){!function e(t){if(t.name&&t.group&&t.geometryRes)for(var r=0;r<t.geometryRes.animations.length;++r)for(var n=t.geometryRes.animations[r],i=0;i<n.trackGroups.length;++i)n.trackGroups[i].name===t.group&&t._ApplyTracks(n.trackGroups[i],n.duration)}(e)}})}},this.UpdateValue=function(e){this._TracksReady()&&(this.cycle&&(e%=this.duration),e<=this.duration&&e>=0&&this._UpdateValue(e))}}function o(){this._id=n.util.generateID(),this.translation=n.vec3.create(),this.rotation=n.quat.create(),this.rotation[3]=1,this.scale=n.vec3.create();var e=null,t=null,r=null,i=n.mat4.create();this._TracksReady=function(){return e||t||r},this._ApplyTracks=function(n,i){for(var a=0;a<n.transformTracks.length;++a){var o=n.transformTracks[a];o.name===this.name&&(this.duration=i,e=o.position,t=o.orientation,r=o.scaleShear)}this.UpdateValue(0)},this._UpdateValue=function(a){e&&n.curve.evaluate(e,a,this.translation,this.cycle,this.duration),t&&(n.curve.evaluate(t,a,this.rotation,this.cycle,this.duration),n.quat.normalize(this.rotation,this.rotation)),r&&n.curve.evaluate(r,a,i,this.cycle,this.duration),this.scale[0]=i[0],this.scale[1]=i[5],this.scale[2]=i[10]}}o.prototype=new a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2TransformTrack=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1);t.Tw2TransformTrack=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.resPath="",this.res=null,this.group="",this.cycle=!1,this.duration=0,this.translation=i.vec3.create(),this.rotation=i.quat.create(),this.scale=i.vec3.fromValues(0,0,0),this.scaleShear=i.mat4.create(),this.positionCurve=null,this.orientationCurve=null,this.scaleCurve=null}return n(e,[{key:"Initialize",value:function e(){""!==this.resPath&&(this.res=a.resMan.GetResource(this.resPath))}},{key:"GetLength",value:function e(){return this.duration}},{key:"UpdateValue",value:function e(t){if(this.res&&this.res.IsGood())this.positionCurve||this.FindTracks(),this.positionCurve&&(this.cycle&&(t%=this.duration),t>this.duration||t<0||(i.curve.evaluate(this.positionCurve,t,this.translation,this.cycle,this.duration),i.curve.evaluate(this.orientationCurve,t,this.rotation,this.cycle,this.duration),i.quat.normalize(this.rotation,this.rotation),i.curve.evaluate(this.scaleCurve,t,this.scaleShear,this.cycle,this.duration),i.mat4.getScaling(this.scale,this.scaleCurve)))}},{key:"FindTracks",value:function e(){for(var t=null,r=0;r<this.res.animations.length;++r)for(var n=0;n<this.res.animations[r].trackGroups.length;++n)if(this.res.animations[r].trackGroups[n].name===this.group){this.duration=this.res.animations[r].duration,t=this.res.animations[r].trackGroups[n];break}if(t){for(var i=0;i<t.transformTracks.length;++i)if(this.name===t.transformTracks[i].name){this.positionCurve=t.transformTracks[i].position,this.orientationCurve=t.transformTracks[i].orientation,this.scaleCurve=t.transformTracks[i].scaleShear;break}}}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(168);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(169);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(170);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(171);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaEulerRotationCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(19),o=t.Tw2MayaEulerRotationCurve=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.xIndex=-1,e.yIndex=-1,e.zIndex=-1,e.animationEngine=null,e.eulerValue=i.vec3.create(),e.updateQuaternion=!1,e.quatValue=i.quat.create(),e.length=0,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){this.ComputeLength()}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){if(this.animationEngine&&(this.xIndex&&(this.eulerValue[0]=this.animationEngine.Evaluate(this.xIndex,t)),this.yIndex&&(this.yIndex===this.xIndex?this.eulerValue[1]=this.eulerValue[0]:this.eulerValue[1]=this.animationEngine.Evaluate(this.yIndex,t)),this.zIndex&&(this.zIndex===this.xIndex?this.eulerValue[2]=this.eulerValue[0]:this.eulerValue[2]=this.animationEngine.Evaluate(this.zIndex,t)),this.updateQuaternion)){var r=Math.sin(this.eulerValue[0]/2),n=Math.cos(this.eulerValue[0]/2),i=Math.sin(this.eulerValue[1]/2),a=Math.cos(this.eulerValue[1]/2),o=Math.sin(this.eulerValue[2]/2),s=Math.cos(this.eulerValue[2]/2);this.quatValue[0]=r*a*o+n*i*s,this.quatValue[1]=r*a*s-n*i*o,this.quatValue[2]=n*a*o-r*i*s,this.quatValue[3]=n*a*s+r*i*o}}},{key:"ComputeLength",value:function e(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&(this.length=0,this.xIndex>=0&&(this.length=this.animationEngine.GetLength(this.xIndex)),this.yIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.yIndex))),this.zIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.zIndex))))}}]),t}(a.Tw2Curve);o.outputDimension=3,o.valueProperty="eulerValue",o.curveType=a.Tw2Curve.Type.CURVE_MAYA},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaScalarCurve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(19),a=t.Tw2MayaScalarCurve=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.index=-1,e.animationEngine=null,e.value=0,e.length=0,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){this.ComputeLength()}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.animationEngine&&(this.value=this.animationEngine.Evaluate(this.index,t))}},{key:"ComputeLength",value:function e(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&this.index>=0&&(this.length=this.animationEngine.GetLength(this.index))}}]),t}(i.Tw2Curve);a.outputDimension=1,a.valueProperty="value",a.curveType=i.Tw2Curve.Type.CURVE_MAYA},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaVector3Curve=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(19),o=t.Tw2MayaVector3Curve=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.xIndex=-1,e.yIndex=-1,e.zIndex=-1,e.animationEngine=null,e.value=i.vec3.create(),e.length=0,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Sort",value:function e(){this.ComputeLength()}},{key:"GetLength",value:function e(){return this.length}},{key:"UpdateValue",value:function e(t){this.animationEngine&&(this.xIndex&&(this.value[0]=this.animationEngine.Evaluate(this.xIndex,t)),this.yIndex&&(this.yIndex===this.xIndex?this.value[1]=this.value[0]:this.value[1]=this.animationEngine.Evaluate(this.yIndex,t)),this.zIndex&&(this.zIndex===this.xIndex?this.value[2]=this.value[0]:this.value[2]=this.animationEngine.Evaluate(this.zIndex,t)))}},{key:"ComputeLength",value:function e(){this.animationEngine&&0!==this.animationEngine.GetNumberOfCurves()&&(this.length=0,this.xIndex>=0&&(this.length=this.animationEngine.GetLength(this.xIndex)),this.yIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.yIndex))),this.zIndex>=0&&(this.length=Math.max(this.length,this.animationEngine.GetLength(this.zIndex))))}}]),t}(a.Tw2Curve);o.outputDimension=3,o.valueProperty="value",o.curveType=a.Tw2Curve.Type.CURVE_MAYA},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tw2MayaAnimationEngine=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=t.Tw2MayaAnimationEngine=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.curves=[],this.hermiteSegments=[],this.bezierSegments=[],this._currentCurveIndex=0,this._evalCache=null}return n(e,[{key:"Evaluate",value:function t(r,n){if(this.curves.length<=r)return 0;if(this._currentCurveIndex=r,!this._evalCache){this._evalCache=Array(this.curves.length);for(var i=0;i<this._evalCache.length;++i)this._evalCache[i]=-1}var a=this.curves[r],o=a[e.AnimCurveFields.SEGMENT_OFFSET],s=null;return n<(s=a[e.AnimCurveFields.IS_WEIGHTED]?this.bezierSegments:this.hermiteSegments)[o][e.AnimSegment.TIME]?a[e.AnimCurveFields.PRE_INFINITY]===e.INFINITY?s[o][e.AnimSegment.VALUE]:this._EvaluateInfinities(a,s,o,n,!0):n>a[e.AnimCurveFields.END_TIME]?a[e.AnimCurveFields.POST_INFINITY]===e.INFINITY?a[e.AnimCurveFields.END_VALUE]:this._EvaluateInfinities(a,s,o,n,!1):this._EvaluateImpl(a,s,o,n)}},{key:"_EvaluateImpl",value:function t(r,n,i,a){var o=!1,s=null,u=null,l=void 0;if(this._evalCache[this._currentCurveIndex]>=0){if(u=i+this._evalCache[this._currentCurveIndex],this._evalCache[this._currentCurveIndex]<r[e.AnimCurveFields.NUM_SEGMENTS-1]&&a>n[u][e.AnimSegment.TIME]){if(a===n[s=i+this._evalCache[this._currentCurveIndex]+1][e.AnimSegment.TIME])return this._evalCache[this._currentCurveIndex]++,n[s][e.AnimSegment.VALUE];a<n[s][e.AnimSegment.TIME]?(l=this._evalCache[this._currentCurveIndex]+1,o=!0):s=null}else if(this._evalCache[this._currentCurveIndex]>0&&a<n[u][e.AnimSegment.TIME]){var c=i+this._evalCache[this._currentCurveIndex]-1;if(a>n[c][e.AnimSegment.TIME])l=this._evalCache[this._currentCurveIndex],o=!0;else if(a===n[c][e.AnimSegment.TIME])return this._evalCache[this._currentCurveIndex]--,n[c][e.AnimSegment.VALUE]}}if(!o){var f=this._Find(r,a,n,i);if(l=f[1],f[0]||0===l)return l===r[e.AnimCurveFields.NUM_SEGMENTS]?(l--,this._evalCache[this._currentCurveIndex]=l,r[e.AnimCurveFields.END_VALUE]):(this._evalCache[this._currentCurveIndex]=l,n[i+l][e.AnimSegment.VALUE]);if(l===r[e.AnimCurveFields.NUM_SEGMENTS]+1)return this._evalCache[this._currentCurveIndex]=0,r[e.AnimCurveFields.END_VALUE]}if(this._evalCache[this._currentCurveIndex]!==l-1&&(this._evalCache[this._currentCurveIndex]=l-1,u=i+this._evalCache[this._currentCurveIndex],null===s&&(s=i+l)),r[e.AnimCurveFields.IS_WEIGHTED]){var h=n[u];if(h[e.BezierSegment.IS_STEP])return h[e.BezierSegment.VALUE];if(h[e.BezierSegment.IS_STEP_NEXT])return null===s?r[e.AnimCurveFields.END_VALUE]:n[s][e.BezierSegment.VALUE];var p=r[e.AnimCurveFields.END_TIME];return this._evalCache[this._currentCurveIndex]+1<r[e.AnimCurveFields.NUM_SEGMENTS]&&(p=n[s][e.BezierSegment.TIME]),this._EvaluateBezier(h,a,p)}var d=n[u];return d[e.HermiteSegment.IS_STEP]?d[e.HermiteSegment.VALUE]:d[e.HermiteSegment.IS_STEP_NEXT]?null===s?r[e.AnimCurveFields.END_VALUE]:n[s][e.HermiteSegment.VALUE]:this._EvaluateHermite(d,a)}},{key:"_EvaluateInfinities",value:function e(t,r,n,i,a){throw Error("_EvaluateInfinities not implemented")}},{key:"_EvaluateHermite",value:function t(r,n){var i=n-r[e.HermiteSegment.TIME],a=r[e.HermiteSegment.COEFF];return i*(i*(i*a[0]+a[1])+a[2])+a[3]}},{key:"_EvaluateBezier",value:function t(r,n,a){var o=void 0,s=void 0;if(s=(n-r[e.BezierSegment.TIME])/(a-r[e.BezierSegment.TIME]),r[e.BezierSegment.IS_LINEAR])o=s;else{var u=i.vec4.create();u[3]=r[e.BezierSegment.COEFF][3],u[2]=r[e.BezierSegment.COEFF][2],u[1]=r[e.BezierSegment.COEFF][1],u[0]=r[e.BezierSegment.COEFF][0]-s;var l=[];o=1===i.curve.polyZeroes(u,3,0,1,1,1,l)?l[0]:0}var c=r[e.BezierSegment.POLYY];return o*(o*(o*c[3]+c[2])+c[1])+c[0]}},{key:"_Find",value:function t(r,n,i,a){var o=void 0,s=void 0,u=void 0,l=void 0,c=0;o=r[e.AnimCurveFields.NUM_SEGMENTS]+1;var f=null,h=0;if(o>0){u=0,l=o-1;do if(n<(h=(s=u+l>>1)<o-1?i[f=a+s][e.AnimSegment.TIME]:r[e.AnimCurveFields.END_TIME]))l=s-1;else{if(!(n>h))return[!0,c=s];u=s+1}while(u<=l);c=u}return[!1,c]}},{key:"GetNumberOfCurves",value:function e(){return this.curves.length}},{key:"GetLength",value:function t(r){if(r<0||r>=this.curves.length)return 0;var n=this.curves[r],i=void 0;return i=n[e.AnimCurveFields.IS_WEIGHTED]?this.bezierSegments[n[e.AnimCurveFields.SEGMENT_OFFSET]]:this.hermiteSegments[n[e.AnimCurveFields.SEGMENT_OFFSET]],n[e.AnimCurveFields.END_TIME]-i[e.AnimSegment.TIME]}}]),e}();a.AnimCurveFields={NUM_SEGMENTS:0,SEGMENT_OFFSET:1,END_TIME:2,END_VALUE:3,IN_TANGENT:4,OUT_TANGENT:5,PRE_INFINITY:6,POST_INFINITY:7,IS_WEIGHTED:8},a.AnimSegment={TIME:0,VALUE:1},a.HermiteSegment={TIME:0,VALUE:1,COEFF:2,IS_STEP:3,IS_STEP_NEXT:4},a.BezierSegment={TIME:0,VALUE:1,COEFF:2,POLYY:3,IS_STEP:4,IS_STEP_NEXT:5,IS_LINEAR:6},a.INFINITY=0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(58);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(178);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(60);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(63);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(195);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})});var u=r(196);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildBillboard=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},a=r(0),o=r(1),s=r(14);t.EveChildBillboard=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e._perObjectData=new o.Tw2BasicPerObjectData,e._perObjectData.perObjectFFEData=new o.Tw2RawData,e._perObjectData.perObjectFFEData.Declare("world",16),e._perObjectData.perObjectFFEData.Declare("worldInverseTranspose",16),e._perObjectData.perObjectFFEData.Create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"GetResources",value:function e(t){return this.mesh&&this.mesh.GetResources(t),t}},{key:"Update",value:function e(r,n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,r,n);var u=s.EveChild.global.mat4_0,l=s.EveChild.global.vec3_0;a.mat4.lookAt(u,o.device.eyePosition,this.worldTransform.subarray(12),[0,1,0]),a.mat4.transpose(u,u),a.mat4.getScaling(l,n),a.vec3.multiply(l,l,this.scaling),this.worldTransform[0]=u[0]*l[0],this.worldTransform[1]=u[1]*l[0],this.worldTransform[2]=u[2]*l[0],this.worldTransform[4]=u[4]*l[1],this.worldTransform[5]=u[5]*l[1],this.worldTransform[6]=u[6]*l[1],this.worldTransform[8]=u[8]*l[2],this.worldTransform[9]=u[9]*l[2],this.worldTransform[10]=u[10]*l[2]}},{key:"GetBatches",value:function e(t,r){this.display&&this.mesh&&(a.mat4.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),a.mat4.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform),this.mesh.GetBatches(t,r,this._perObjectData))}}]),t}(s.EveChild)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildContainer=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},a=r(14);t.EveChildContainer=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.objects=[],e.curveSets=[],e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"GetResources",value:function e(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=0;r<this.objects.length;r++)"GetResources"in this.objects[r]&&this.objects[r].GetResources(t);return t}},{key:"Update",value:function e(r,n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,r,n);for(var a=0;a<this.curveSets.length;a++)this.curveSets[a].Update(r);for(var o=0;o<this.objects.length;o++)this.objects[o].Update(r,this.worldTransform)}},{key:"GetBatches",value:function e(t,r,n){if(this.display)for(var i=0;i<this.objects.length;i++)this.objects[i].GetBatches(t,r,n)}}]),t}(a.EveChild)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildExplosion=void 0;var n=r(14);t.EveChildExplosion=function(e){function t(){return!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t),function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),t}(n.EveChild)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildMesh=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(14);t.EveChildMesh=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e.useSpaceObjectData=!0,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"GetResources",value:function e(t){return this.mesh&&this.mesh.GetResources(t),t}},{key:"GetBatches",value:function e(t,r,n){this.display&&this.mesh&&(this.useSpaceObjectData?(this._perObjectData||(this._perObjectData=new a.Tw2PerObjectData,this._perObjectData.perObjectVSData=new a.Tw2RawData,this._perObjectData.perObjectVSData.data=new Float32Array(n.perObjectVSData.data.length),this._perObjectData.perObjectVSData.data[33]=1,this._perObjectData.perObjectVSData.data[35]=1,this._perObjectData.perObjectPSData=new a.Tw2RawData,this._perObjectData.perObjectPSData.data=new Float32Array(n.perObjectPSData.data.length),this._perObjectData.perObjectPSData.data[1]=1,this._perObjectData.perObjectPSData.data[3]=1),this._perObjectData.perObjectVSData.data.set(n.perObjectVSData.data),this._perObjectData.perObjectPSData.data.set(n.perObjectPSData.data),i.mat4.transpose(this._perObjectData.perObjectVSData.data,this.worldTransform),i.mat4.transpose(this._perObjectData.perObjectVSData.data.subarray(16),this.worldTransformLast)):(this._perObjectData||(this._perObjectData=new a.Tw2BasicPerObjectData,this._perObjectData.perObjectFFEData=new a.Tw2RawData,this._perObjectData.perObjectFFEData.Declare("world",16),this._perObjectData.perObjectFFEData.Declare("worldInverseTranspose",16),this._perObjectData.perObjectFFEData.Create()),i.mat4.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),i.mat4.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform)),this.mesh.GetBatches(t,r,this._perObjectData))}}]),t}(o.EveChild)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveChildParticleSystem=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},a=r(0),o=r(1),s=r(14);t.EveChildParticleSystem=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e.particleEmitters=[],e.particleSystems=[],e._perObjectData=new o.Tw2BasicPerObjectData,e._perObjectData.perObjectFFEData=new o.Tw2RawData,e._perObjectData.perObjectFFEData.Declare("world",16),e._perObjectData.perObjectFFEData.Declare("worldInverseTranspose",16),e._perObjectData.perObjectFFEData.Create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"GetResources",value:function e(t){return this.mesh&&this.mesh.GetResources(t),t}},{key:"Update",value:function e(r,n){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,r,n);for(var a=0;a<this.particleEmitters.length;++a)this.particleEmitters[a].Update(r);for(var o=0;o<this.particleSystems.length;++o)this.particleSystems[o].Update(r)}},{key:"GetBatches",value:function e(t,r){this.display&&this.mesh&&(a.mat4.transpose(this._perObjectData.perObjectFFEData.Get("world"),this.worldTransform),a.mat4.invert(this._perObjectData.perObjectFFEData.Get("worldInverseTranspose"),this.worldTransform),this.mesh.GetBatches(t,r,this._perObjectData))}}]),t}(s.EveChild)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(179);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return n[e]}})});var i=r(180);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return i[e]}})});var a=r(59);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return a[e]}})});var o=r(181);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return o[e]}})});var s=r(182);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function t(){return s[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveLensflare=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(59);(t.EveLensflare=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.update=!0,this.doOcclusionQueries=!0,this.cameraFactor=20,this.position=i.vec3.create(),this.flares=[],this.occluders=[],this.backgroundOccluders=[],this.occlusionIntensity=1,this.backgroundOcclusionIntensity=1,this.distanceToEdgeCurves=[],this.distanceToCenterCurves=[],this.radialAngleCurves=[],this.xDistanceToCenter=[],this.yDistanceToCenter=[],this.bindings=[],this.curveSets=[],this.mesh=null,this._direction=i.vec3.create(),this._transform=i.mat4.create(),this._backBuffer=null,e.init()}return n(e,[{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.mesh&&this.mesh.GetResources(t);for(var r=0;r<this.flares.length;r++)this.flares[r].GetResources(t);return o.EveOccluder.global&&o.EveOccluder.global.effect&&!t.includes(o.EveOccluder.global.effect)&&t.push(o.EveOccluder.global.effect),t}},{key:"UpdateOccluders",value:function t(){if(this.doOcclusionQueries){var r=a.device,n=e.global;if(!n.occluderLevels[0].texture||n.occluderLevels[0].width<2*this.occluders.length)for(var i=0;i<n.occluderLevels.length;++i)n.occluderLevels[i].Create(2*this.occluders.length,1,!1);for(var s=0;s<this.flares.length;++s)"_backBuffer"in this.flares[s]&&(this.flares[s]._backBuffer.textureRes=n.occluderLevels.texture);this.occlusionIntensity=1,this.backgroundOcclusionIntensity=1,n.occluderLevels[n.occludedLevelIndex].Set(),r.SetStandardStates(r.RM_OPAQUE),r.gl.clearColor(0,0,0,1),r.gl.clear(r.gl.COLOR_BUFFER_BIT),n.occluderLevels[n.occludedLevelIndex].Unset();var u=1;r.antialiasing&&(u=r.msaaSamples,r.gl.sampleCoverage(1/u,!1));for(var l=0;l<this.occluders.length;++l)r.SetRenderState(r.RS_COLORWRITEENABLE,8),r.gl.colorMask(!1,!1,!1,!0),r.gl.clearColor(0,0,0,0),r.gl.clear(r.gl.COLOR_BUFFER_BIT),r.antialiasing&&(r.gl.enable(r.gl.SAMPLE_COVERAGE),r.gl.sampleCoverage(.25,!1)),this.occluders[l].UpdateValue(this._transform,l),r.antialiasing&&r.gl.disable(r.gl.SAMPLE_COVERAGE),n.backBuffer.texture||n.backBuffer.Attach(r.gl.createTexture()),r.gl.bindTexture(r.gl.TEXTURE_2D,n.backBuffer.texture),(n.backBuffer.width!==r.viewportWidth||n.backBuffer.height!==r.viewportHeight)&&(r.gl.texImage2D(r.gl.TEXTURE_2D,0,r.gl.RGBA,r.viewportWidth,r.viewportHeight,0,r.gl.RGBA,r.gl.UNSIGNED_BYTE,null),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MAG_FILTER,r.gl.LINEAR),r.gl.texParameteri(r.gl.TEXTURE_2D,r.gl.TEXTURE_MIN_FILTER,r.gl.LINEAR),n.backBuffer.width=r.viewportWidth,n.backBuffer.height=r.viewportHeight),r.gl.copyTexImage2D(r.gl.TEXTURE_2D,0,r.alphaBlendBackBuffer?r.gl.RGBA:r.gl.RGB,0,0,n.backBuffer.width,n.backBuffer.height,0),r.gl.bindTexture(r.gl.TEXTURE_2D,null),n.occluderLevels[n.occludedLevelIndex].Set(),o.EveOccluder.CollectSamples(n.backBuffer,l,n.occluderLevels[0].width/2,u),n.occluderLevels[n.occludedLevelIndex].Unset();r.antialiasing&&r.gl.sampleCoverage(1,!1),n.occluderLevels[(n.occludedLevelIndex+1)%n.occluderLevels.length].Set();var c=new Uint8Array(4*n.occluderLevels[0].width);r.gl.readPixels(0,0,2,1,r.gl.RGBA,r.gl.UNSIGNED_BYTE,c),n.occluderLevels[(n.occludedLevelIndex+1)%n.occluderLevels.length].Unset(),this.occlusionIntensity=1;for(var f=0;f<2*n.occluderLevels[0].width;f+=4)this.occlusionIntensity*=c[f+1]?c[f]/c[f+1]:1;this.backgroundOcclusionIntensity=this.occlusionIntensity,a.store.SetVariableValue("LensflareFxOccScale",[this.occlusionIntensity,this.occlusionIntensity,0,0]),n.occludedLevelIndex=(n.occludedLevelIndex+1)%n.occluderLevels.length}}},{key:"GetBatches",value:function t(r,n,o){if(this.display){var s=i.vec4.set(e.global.vec4_0,0,0,1,0);if(i.vec4.transformMat4(s,s,a.device.viewInverse),!(0>i.vec3.dot(s,this._direction))){for(var u=0;u<this.flares.length;++u)this.flares[u].GetBatches(r,n,o);this.mesh&&this.mesh.GetBatches(r,n,o)}}}},{key:"PrepareRender",value:function t(){if(this.display){var r=e.global,n=r.vec4_0,o=r.vec3_0,s=i.mat4.identity(r.mat4_0),u=r.vec3_2,l=r.vec3_3,c=r.vec3_1,f=r.vec4_1;i.vec3.transformMat4(o,[0,0,0],a.device.viewInverse),0===i.vec3.length(this.position)?i.vec3.negate(c,o):(i.vec3.negate(c,this.position),i.vec3.normalize(this._direction,c)),i.vec4.transformMat4(n,[0,0,1,0],a.device.viewInverse),i.vec3.scaleAndAdd(u,o,n,-this.cameraFactor),i.vec3.negate(l,this._direction),i.mat4.arcFromForward(this._transform,l),i.mat4.setTranslation(this._transform,u),i.mat4.scale(s,s,[this.occlusionIntensity,this.occlusionIntensity,1]);var h=this._direction;a.store.SetVariableValue("LensflareFxDirectionScale",[h[0],h[1],h[2],1]),i.vec4.set(f,h[0],h[1],h[2],0),i.vec4.transformMat4(f,f,a.device.view),i.vec4.transformMat4(f,f,a.device.projection),f[0]/=f[3],f[1]/=f[3];for(var p=1-Math.min(1-Math.abs(f[0]),1-Math.abs(f[1])),d=Math.sqrt(f[0]*f[0]+f[1]*f[1]),v=Math.atan2(f[1],f[0])+Math.PI,$=0;$<this.distanceToEdgeCurves.length;++$)this.distanceToEdgeCurves[$].UpdateValue(p);for(var m=0;m<this.distanceToCenterCurves.length;++m)this.distanceToCenterCurves[m].UpdateValue(d);for(var y=0;y<this.radialAngleCurves.length;++y)this.radialAngleCurves[y].UpdateValue(v);for(var g=0;g<this.xDistanceToCenter.length;++g)this.xDistanceToCenter[g].UpdateValue(f[0]+10);for(var _=0;_<this.yDistanceToCenter.length;++_)this.yDistanceToCenter[_].UpdateValue(f[1]+10);for(var b=0;b<this.bindings.length;++b)this.bindings[b].CopyValue();for(var E=0;E<this.flares.length;++E)this.flares[E].UpdateViewDependentData(this._transform)}}}],[{key:"init",value:function t(){if(!e.global){var r=e.global={};r.vec3_0=i.vec3.create(),r.vec3_1=i.vec3.create(),r.vec3_2=i.vec3.create(),r.vec3_3=i.vec3.create(),r.vec4_0=i.vec4.create(),r.vec4_1=i.vec4.create(),r.mat4_0=i.mat4.create(),r.backBuffer=new a.Tw2TextureRes,r.backBuffer.width=0,r.backBuffer.height=0,r.backBuffer.hasMipMaps=!1,r.occludedLevelIndex=0,r.occluderLevels=[new a.Tw2RenderTarget,new a.Tw2RenderTarget,new a.Tw2RenderTarget,new a.Tw2RenderTarget]}}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveMeshOverlayEffect=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),a=r(0);t.EveMeshOverlayEffect=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=a.util.generateID(),this.name="",this.display=!0,this.visible={},this.visible.opaqueEffects=!0,this.visible.decalEffects=!0,this.visible.transparentEffects=!0,this.visible.additiveEffects=!0,this.visible.distortionEffects=!1,this.update=!0,this.curveSet=null,this.opaqueEffects=[],this.decalEffects=[],this.transparentEffects=[],this.additiveEffects=[],this.distortionEffects=[]}return n(e,[{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return a.util.perArrayChild(this.opaqueEffects,"GetResources",t),a.util.perArrayChild(this.decalEffects,"GetResources",t),a.util.perArrayChild(this.transparentEffects,"GetResources",t),a.util.perArrayChild(this.additiveEffects,"GetResources",t),a.util.perArrayChild(this.distortionEffects,"GetResources",t),t}},{key:"Update",value:function e(t){this.update&&this.curveSet&&this.curveSet.Update(t)}},{key:"GetBatches",value:function e(t,r,n,a){if(this.display&&a&&a.IsGood())for(var o=this.GetEffects(t),s=0;s<o.length;s++){var u=new i.Tw2GeometryBatch;u.renderMode=t,u.perObjectData=n,u.geometryRes=a.geometryResource,u.meshIx=a.meshIndex,u.start=0,u.count=a.geometryResource.meshes[a.meshIndex].areas.length,u.effect=o[s],r.Commit(u)}}},{key:"GetEffects",value:function e(t){if(this.display)switch(t){case i.device.RM_OPAQUE:if(this.visible.opaqueEffects)return this.opaqueEffects;break;case i.device.RM_TRANSPARENT:if(this.visible.transparentEffects)return this.transparentEffects;break;case i.device.RM_ADDITIVE:if(this.visible.additiveEffects)return this.additiveEffects;break;case i.device.RM_DECAL:if(this.visible.decalEffects)return this.decalEffects}return[]}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveStretch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1);(t.EveStretch=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.update=!0,this.curveSets=[],this.source=null,this.dest=null,this.sourceObject=null,this.destObject=null,this.stretchObject=null,this.length=new a.Tw2Float,this._time=0,this._useTransformsForStretch=!1,this._sourcePosition=i.vec3.create(),this._destinationPosition=i.vec3.create(),this._displaySourceObject=!0,this._sourceTransform=null,this._displayDestObject=!0,this._useTransformsForStretch=!1,this._isNegZForward=!1,e.init()}return n(e,[{key:"SetSourcePosition",value:function e(t){this._useTransformsForStretch=!1,this._sourcePosition=t}},{key:"SetDestinationPosition",value:function e(t){this._destinationPosition=t}},{key:"SetSourceTransform",value:function e(t){this._useTransformsForStretch=!0,this._sourceTransform=t}},{key:"SetIsNegZForward",value:function e(t){this._isNegZForward=t}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.source&&this.source.GetResources&&this.source.GetResources(t),this.dest&&this.dest.GetResources&&this.dest.GetResources(t),this.sourceObject&&this.sourceObject.GetResources&&this.sourceObject.GetResources(t),this.destObject&&this.destObject.GetResources&&this.destObject.GetResources(t),this.stretchObject&&this.stretchObject.GetResources&&this.stretchObject.GetResources(t),t}},{key:"UpdateViewDependentData",value:function t(){if(this.display){var r=e.global,n=i.vec3.subtract(r.vec3_0,this._destinationPosition,this._sourcePosition),a=i.mat4.identity(r.mat4_0),o=i.vec3.set(r.vec3_1,0,0,0),s=i.vec3.set(r.vec3_2,0,0,0),u=i.mat4.identity(r.mat4_1),l=i.vec3.length(n);i.vec3.normalize(n,n),this._useTransformsForStretch?(i.mat4.rotateX(a,a,-Math.PI/2),i.mat4.multiply(a,this._sourceTransform,a)):(Math.abs(n[1])>.9?s[2]=1:s[1]=1,i.vec3.cross(o,s,n),i.vec3.normalize(o,o),i.vec3.cross(s,n,o),a[0]=o[0],a[1]=o[1],a[2]=o[2],a[4]=-n[0],a[5]=-n[1],a[6]=-n[2],a[8]=s[0],a[9]=s[1],a[10]=s[2]),this.destObject&&this._displayDestObject&&(i.mat4.setTranslation(a,this._destinationPosition),this.destObject.UpdateViewDependentData(a)),this.sourceObject&&this._displaySourceObject&&(this._useTransformsForStretch?(i.mat4.identity(a),i.mat4.rotateX(a,a,-Math.PI/2),i.mat4.multiply(a,this._sourceTransform,a)):i.mat4.setTranslation(a,this._sourcePosition),this.sourceObject.UpdateViewDependentData(a)),this.stretchObject&&(this._useTransformsForStretch?(i.mat4.identity(a),i.mat4.scale(a,a,[1,1,l]),i.mat4.multiply(a,this._sourceTransform,a)):(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[4]=s[0],a[5]=s[1],a[6]=s[2],a[8]=-n[0],a[9]=-n[1],a[10]=-n[2],this._isNegZForward&&(l=-l),i.mat4.scale(u,u,[1,1,l]),i.mat4.multiply(a,a,u)),this.stretchObject.UpdateViewDependentData(a))}}},{key:"Update",value:function t(r){for(var n=0;n<this.curveSets.length;++n)this.curveSets[n].Update(r);this._time+=r,this.source?this.source.GetValueAt(this._time,this._sourcePosition):this._useTransformsForStretch&&(this._sourcePosition[0]=this._sourceTransform[12],this._sourcePosition[1]=this._sourceTransform[13],this._sourcePosition[2]=this._sourceTransform[14]),this.dest&&this.source.GetValueAt(this._time,this._destinationPosition);var a=i.vec3.subtract(e.global.vec3_0,this._destinationPosition,this._sourcePosition);this.length.value=i.vec3.length(a),i.vec3.normalize(a,a),this.sourceObject&&this._displaySourceObject&&this.sourceObject.Update(r),this.stretchObject&&this.stretchObject.Update(r),this.destObject&&this._displayDestObject&&this.destObject.Update(r)}},{key:"GetBatches",value:function e(t,r,n){this.display&&(this.sourceObject&&this._displaySourceObject&&this.sourceObject.GetBatches(t,r,n),this.destObject&&this._displayDestObject&&this.destObject.GetBatches(t,r,n),this.stretchObject&&this.stretchObject.GetBatches(t,r,n))}}],[{key:"init",value:function t(){e.global||(e.global={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec3_2:i.vec3.create(),mat4_0:i.mat4.create(),mat4_1:i.mat4.create()})}}]),e}()).global=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveTurretFiringFX=t.EvePerMuzzleData=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var o=t.EvePerMuzzleData=function e(){a(this,e),this._id=i.util.generateID(),this.started=!1,this.readyToStart=!1,this.muzzlePositionBone=null,this.muzzleTransform=i.mat4.create(),this.muzzlePosition=this.muzzleTransform.subarray(12,15),this.currentStartDelay=0,this.constantDelay=0,this.elapsedTime=0};t.EveTurretFiringFX=function(){function e(){a(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.stretch=[],this.useMuzzleTransform=!1,this.isFiring=!1,this.isLoopFiring=!1,this.firingDelay1=0,this.firingDelay2=0,this.firingDelay3=0,this.firingDelay4=0,this.firingDelay5=0,this.firingDelay6=0,this.firingDelay7=0,this.firingDelay8=0,this.endPosition=i.vec3.create(),this._firingDuration=0,this._perMuzzleData=[]}return n(e,[{key:"Initialize",value:function e(){this._firingDuration=this.GetCurveDuration();for(var t=0;t<this.stretch.length;++t)this._perMuzzleData[t]=new o;this._perMuzzleData.length>0&&(this._perMuzzleData[0].constantDelay=this.firingDelay1),this._perMuzzleData.length>1&&(this._perMuzzleData[1].constantDelay=this.firingDelay2),this._perMuzzleData.length>2&&(this._perMuzzleData[2].constantDelay=this.firingDelay3),this._perMuzzleData.length>3&&(this._perMuzzleData[3].constantDelay=this.firingDelay4),this._perMuzzleData.length>4&&(this._perMuzzleData[4].constantDelay=this.firingDelay5),this._perMuzzleData.length>5&&(this._perMuzzleData[5].constantDelay=this.firingDelay6),this._perMuzzleData.length>6&&(this._perMuzzleData[6].constantDelay=this.firingDelay7),this._perMuzzleData.length>7&&(this._perMuzzleData[7].constantDelay=this.firingDelay8)}},{key:"GetCurveDuration",value:function e(){for(var t=0,r=0;r<this.stretch.length;++r)for(var n=this.stretch[r],i=0;i<n.curveSets.length;++i)t=Math.max(t,n.curveSets[i].GetMaxCurveDuration());return t}},{key:"GetPerMuzzleEffectCount",value:function e(){return this.stretch.length}},{key:"SetMuzzleBoneID",value:function e(t,r){this._perMuzzleData[t].muzzlePositionBone=r}},{key:"GetMuzzleTransform",value:function e(t){return this._perMuzzleData[t].muzzleTransform}},{key:"PrepareFiring",value:function e(t){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=0;n<this.stretch.length;++n)r<0||r===n?(this._perMuzzleData[n].currentStartDelay=t+this._perMuzzleData[n].constantDelay,this._perMuzzleData[n].started=!1,this._perMuzzleData[n].readyToStart=!1,this._perMuzzleData[n].elapsedTime=0):(this._perMuzzleData[n].currentStartDelay=Number.MAX_VALUE,this._perMuzzleData[n].started=!1,this._perMuzzleData[n].readyToStart=!1,this._perMuzzleData[n].elapsedTime=0);this.isFiring=!0}},{key:"StartMuzzleEffect",value:function e(t){for(var r=this.stretch[t],n=0;n<r.curveSets.length;++n){var i=r.curveSets[n];switch(i.name){case"play_start":case"play_loop":i.PlayFrom(-this._perMuzzleData[t].currentStartDelay);break;case"play_stop":i.Stop()}}this._perMuzzleData[t].started=!0,this._perMuzzleData[t].readyToStart=!1}},{key:"StopFiring",value:function e(){for(var t=0;t<this.stretch.length;++t){for(var r=this.stretch[t],n=0;n<r.curveSets.length;++n){var i=r.curveSets[n];switch(i.name){case"play_start":case"play_loop":i.Stop();break;case"play_stop":i.Play()}}this._perMuzzleData[t].started=!1,this._perMuzzleData[t].readyToStart=!1,this._perMuzzleData[t].currentStartDelay=0,this._perMuzzleData[t].elapsedTime=0}this.isFiring=!1}},{key:"GetResources",value:function e(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=0;r<this.stretch.length;r++)this.stretch[r].GetResources(t);return t}},{key:"UpdateViewDependentData",value:function e(){for(var t=0;t<this.stretch.length;++t)this.stretch[t].UpdateViewDependentData()}},{key:"Update",value:function e(t){for(var r=0;r<this.stretch.length;++r)this._perMuzzleData[r].started&&(this._perMuzzleData[r].elapsedTime+=t),(this._perMuzzleData[r].elapsedTime<this._firingDuration||this.isLoopFiring)&&this.isFiring&&(this._perMuzzleData[r].started?(this.useMuzzleTransform?this.stretch[r].SetSourceTransform(this._perMuzzleData[r].muzzleTransform):this.stretch[r].SetSourcePosition(this._perMuzzleData[r].muzzlePosition),this.stretch[r].SetDestinationPosition(this.endPosition),this.stretch[r].SetIsNegZForward(!0)):(this._perMuzzleData[r].readyToStart?(this.StartMuzzleEffect(r),this._perMuzzleData[r].currentStartDelay=0,this._perMuzzleData[r].elapsedTime=0):this._perMuzzleData[r].currentStartDelay-=t,this._perMuzzleData[r].currentStartDelay<=0&&(this._perMuzzleData[r].readyToStart=!0))),this.stretch[r].Update(t)}},{key:"GetBatches",value:function e(t,r,n){if(this.display&&this.isFiring)for(var i=0;i<this.stretch.length;++i)this._perMuzzleData[i].started&&(this._firingDuration>=this._perMuzzleData[i].elapsedTime||this.isLoopFiring)&&this.stretch[i].GetBatches(t,r,n)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveEffectRoot=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(15);t.EveEffectRoot=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.curveSets=[],e.effectChildren=[],e.duration=0,e.scaling=i.vec3.fromValues(1,1,1),e.rotation=i.quat.create(),e.translation=i.vec3.create(),e.localTransform=i.mat4.create(),e.rotationTransform=i.mat4.create(),e.boundingSphereCenter=i.vec3.create(),e.boundingSphereRadius=0,e._perObjectData=new a.Tw2PerObjectData,e._perObjectData.perObjectVSData=new a.Tw2RawData,e._perObjectData.perObjectVSData.Declare("WorldMat",16),e._perObjectData.perObjectVSData.Declare("WorldMatLast",16),e._perObjectData.perObjectVSData.Declare("Shipdata",4),e._perObjectData.perObjectVSData.Declare("Clipdata1",4),e._perObjectData.perObjectVSData.Declare("EllipsoidRadii",4),e._perObjectData.perObjectVSData.Declare("EllipsoidCenter",4),e._perObjectData.perObjectVSData.Declare("CustomMaskMatrix0",16),e._perObjectData.perObjectVSData.Declare("CustomMaskMatrix1",16),e._perObjectData.perObjectVSData.Declare("CustomMaskData0",4),e._perObjectData.perObjectVSData.Declare("CustomMaskData1",4),e._perObjectData.perObjectVSData.Declare("JointMat",696),e._perObjectData.perObjectVSData.Create(),e._perObjectData.perObjectPSData=new a.Tw2RawData,e._perObjectData.perObjectPSData.Declare("Shipdata",4),e._perObjectData.perObjectPSData.Declare("Clipdata1",4),e._perObjectData.perObjectPSData.Declare("Clipdata2",4),e._perObjectData.perObjectPSData.Declare("ShLighting",28),e._perObjectData.perObjectPSData.Declare("CustomMaskMaterialID0",4),e._perObjectData.perObjectPSData.Declare("CustomMaskMaterialID1",4),e._perObjectData.perObjectPSData.Declare("CustomMaskTarget0",4),e._perObjectData.perObjectPSData.Declare("CustomMaskTarget1",4),e._perObjectData.perObjectPSData.Create(),e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Start",value:function e(){for(var t=0;t<this.curveSets.length;++t)this.curveSets[t].Play()}},{key:"Stop",value:function e(){for(var t=0;t<this.curveSets.length;++t)this.curveSets[t].Stop()}},{key:"GetResources",value:function e(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=0;r<this.effectChildren.length;++r)this.effectChildren[r].GetResources(t);return t}},{key:"Update",value:function e(t){i.quat.normalize(this.rotation,this.rotation),i.mat4.fromRotationTranslationScale(this.localTransform,this.rotation,this.translation,this.scaling);for(var r=0;r<this.curveSets.length;++r)this.curveSets[r].Update(t);for(var n=0;n<this.effectChildren.length;++n)this.effectChildren[n].Update(t,this.localTransform)}},{key:"GetBatches",value:function e(t,r){if(this.display)for(var n=0;n<this.effectChildren.length;++n)this.effectChildren[n].GetBatches(t,r,this._perObjectData)}}]),t}(o.EveObject)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveMissile=t.EveMissileWarhead=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(15);function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var u=t.EveMissileWarhead=function(e){function t(){s(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.mesh=null,e.spriteSet=null,e.state=t.State.READY,e.time=0,e.durationEjectPhase=0,e.startEjectVelocity=0,e.acceleration=1,e.maxExplosionDistance=40,e.impactSize=0,e.impactDuration=.6,e.pathOffset=i.vec3.create(),e.transform=i.mat4.create(),e.velocity=i.vec3.create(),e._perObjectData=new a.Tw2PerObjectData,e._perObjectData.perObjectVSData=new a.Tw2RawData,e._perObjectData.perObjectVSData.Declare("WorldMat",16),e._perObjectData.perObjectVSData.Declare("WorldMatLast",16),e._perObjectData.perObjectVSData.Declare("Shipdata",4),e._perObjectData.perObjectVSData.Declare("Clipdata1",4),e._perObjectData.perObjectVSData.Create(),e._perObjectData.perObjectPSData=new a.Tw2RawData,e._perObjectData.perObjectPSData.Declare("Shipdata",4),e._perObjectData.perObjectPSData.Declare("Clipdata1",4),e._perObjectData.perObjectPSData.Declare("Clipdata2",4),e._perObjectData.perObjectPSData.Create(),e._perObjectData.perObjectVSData.Get("Shipdata")[1]=1,e._perObjectData.perObjectPSData.Get("Shipdata")[1]=1,e._perObjectData.perObjectVSData.Get("Shipdata")[3]=-10,e._perObjectData.perObjectPSData.Get("Shipdata")[3]=1,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Initialize",value:function e(){this.spriteSet&&this.spriteSet.UseQuads(!0)}},{key:"Launch",value:function e(r){i.mat4.copy(this.transform,r),this.velocity[0]=r[8]*this.startEjectVelocity,this.velocity[1]=r[9]*this.startEjectVelocity,this.velocity[2]=r[10]*this.startEjectVelocity,this.time=0,this.state=t.State.IN_FLIGHT}},{key:"Clone",value:function e(){var r=new t;return r.mesh=this.mesh,r.spriteSet=this.spriteSet,r}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.mesh&&this.mesh.GetResources(t),this.spriteSet&&this.spriteSet.GetResources(t)}},{key:"UpdateViewDependentData",value:function e(){this.display&&this.state!==t.State.DEAD&&(i.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this.transform),i.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMatLast"),this.transform))}},{key:"Update",value:function e(r,n,a){if(this.state===t.State.IN_FLIGHT){var o=t.global,s=i.mat4.getTranslation(o.vec3_0,this.transform),u=o.vec3_1,l=o.vec3_2,c=o.vec3_3;this.time+=r,this.time>this.durationEjectPhase?(i.vec3.subtract(s,this.velocity,n),i.vec3.lerp(s,s,n,1-Math.exp(-(.9999*r))),i.mat4.setTranslation(this.transform,s),i.vec3.subtract(u,a,s),i.vec3.length(u)<this.maxExplosionDistance&&(console.log(s,u),this.state=t.State.DEAD)):(i.vec3.scale(u,this.velocity,r),this.transform[12]+=u[0],this.transform[13]+=u[1],this.transform[14]+=u[2]);var f=i.vec3.normalize(u,this.velocity);.99>Math.abs(f[0])?i.vec3.cross(l,f,[1,0,0]):i.vec3.cross(l,f,[0,1,0]),i.vec3.normalize(l,l),i.vec3.cross(c,l,f),this.transform[0]=l[0],this.transform[1]=l[1],this.transform[2]=l[2],this.transform[4]=c[0],this.transform[5]=c[1],this.transform[6]=c[2],this.transform[8]=f[0],this.transform[9]=f[1],this.transform[10]=f[2]}this.spriteSet&&this.spriteSet.Update(r)}},{key:"GetBatches",value:function e(r,n){this.display&&this.mesh&&this.state!==t.State.DEAD&&(this.mesh&&this.mesh.GetBatches(r,n,this._perObjectData),this.spriteSet&&this.spriteSet.GetBatches(r,n,this._perObjectData,this.transform))}}]),t}(o.EveObject);u.State={READY:0,IN_FLIGHT:1,DEAD:2},t.EveMissile=function(){function e(){s(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.warheads=[],this.curveSets=[],this.speed=1,this.position=i.vec3.create(),this.target=i.vec3.create(),this.boundingSphereCenter=i.vec3.create(),this.boundingSphereRadius=0,this.warheadExplosionCallback=null,this.missileFinishedCallback=null,e.init()}return n(e,[{key:"Launch",value:function e(t,r,n){if(i.vec3.copy(this.position,t),i.vec3.copy(this.target,n),this.warheads.length>r.length)this.warheads.splice(r.length);else for(;this.warheads.length<r.length;)this.warheads.push(this.warheads[0].Clone());for(var a=0;a<this.warheads.length;++a)this.warheads[0].Launch(r[a])}},{key:"GetResources",value:function e(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=0;r<this.warheads.length;++r)this.warheads[r].GetResources(t)}},{key:"UpdateViewDependentData",value:function e(){for(var t=0;t<this.warheads.length;++t)this.warheads[t].UpdateViewDependentData()}},{key:"Update",value:function e(t){var r=i.vec3.subtract(u.global.vec3_0,this.target,this.position),n=i.vec3.length(r);n>.1&&(i.vec3.normalize(r,r),i.vec3.scale(r,r,Math.min(t*this.speed,n)),i.vec3.add(this.position,this.position,r));for(var a=0;a<this.curveSets.length;++a)this.curveSets[a].Update(t);for(var o=!1,s=0;s<this.warheads.length;++s){var l=this.warheads[s].state;this.warheads[s].Update(t,this.position,this.target),l!==u.State.DEAD&&this.warheads[s].state===u.State.DEAD&&(this.warheadExplosionCallback&&this.warheadExplosionCallback(this.warheads[s]),o=!0)}if(o&&this.missileFinishedCallback){for(var c=0;c<this.warheads.length;++c)if(this.warheads[c].state!==u.State.DEAD)return;this.missileFinishedCallback(this)}}},{key:"GetBatches",value:function e(t,r){if(this.display)for(var n=0;n<this.warheads.length;++n)this.warheads[n].GetBatches(t,r)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EvePlanet=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(1),o=r(61),s=r(15);t.EvePlanet=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.highDetail=new o.EveTransform,e.effectHeight=new a.Tw2Effect,e.heightMap=new a.Tw2RenderTarget,e.zOnlyModel=null,e.itemID=0,e.heightMapResPath1="",e.heightMapResPath2="",e.heightDirty=!1,e.lockedResources=[],e.watchedResources=[],e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),i(t,[{key:"Create",value:function e(r,n,i,o,s){var u=this;this.itemID=r,this.heightMapResPath1=o,this.heightMapResPath2=s,this.highDetail.children=[],this.heightDirty=!0,a.resMan.GetObject(n,function(e){return t.MeshLoaded(u,e)}),a.resMan.GetObject("res:/dx9/model/worldobject/planet/planetzonly.red",function(e){return u.zOnlyModel=e}),i&&a.resMan.GetObject(i,function(e){return u.highDetail.children.push(e)})}},{key:"GetPlanetResources",value:function e(t,r,i){if(!r.includes(t)){if(r.push(t),t&&"undefined"!==n(t.doNotPurge)){i.push(t);return}for(var a in t)t.hasOwnProperty(a)&&"object"===n(t[a])&&this.GetPlanetResources(t[a],r,i)}}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.highDetail&&this.highDetail.GetResources(t),this.effectHeight&&this.effectHeight.GetResources(t),t}},{key:"UpdateViewDependentData",value:function e(t){this.highDetail.UpdateViewDependentData(t),this.zOnlyModel&&(this.zOnlyModel.translation=this.highDetail.translation,this.zOnlyModel.scaling=this.highDetail.scaling,this.zOnlyModel.UpdateViewDependentData(t))}},{key:"Update",value:function e(t){this.highDetail.Update(t)}},{key:"GetBatches",value:function e(t,r){if(this.display&&this.heightDirty&&this.watchedResources.length&&""!==this.heightMapResPath1){for(var n=0;n<this.watchedResources.length;++n)if(this.watchedResources[n]&&!this.watchedResources[n].IsGood())return;this.watchedResources=[],this.heightMap.Set(),a.device.SetStandardStates(a.device.RM_FULLSCREEN),a.device.gl.clearColor(0,0,0,0),a.device.gl.clear(a.device.gl.COLOR_BUFFER_BIT),a.device.RenderFullScreenQuad(this.effectHeight),this.heightMap.Unset(),this.heightDirty=!1;for(var i=0;i<this.lockedResources.length;++i)this.lockedResources[i].doNotPurge--;var o=this.highDetail.children[0].mesh,s=null;o.transparentAreas.length?s=o.transparentAreas[0].effect:o.opaqueAreas.length&&(s=o.opaqueAreas[0].effect),s&&(s.parameters.HeightMap.textureRes=this.heightMap.texture)}this.display&&this.highDetail.GetBatches(t,r)}},{key:"GetZOnlyBatches",value:function e(t,r){this.display&&this.zOnlyModel&&this.zOnlyModel.GetBatches(t,r)}}],[{key:"MeshLoaded",value:function e(t,r){t.highDetail.children.unshift(r),t.lockedResources=[],t.GetPlanetResources(t.highDetail,[],t.lockedResources);var n=t.highDetail.children[0].mesh,i=null,o=void 0;for(var s in o=(o=n.transparentAreas.length?(i=n.transparentAreas[0].effect).effectFilePath:n.opaqueAreas.length?(i=n.opaqueAreas[0].effect).effectFilePath:"res:/Graphics/Effect/Managed/Space/Planet/EarthlikePlanet.fx").replace(".fx","BlitHeight.fx"),t.watchedResources=[],i.parameters)i.parameters.hasOwnProperty(s)&&(t.effectHeight.parameters[s]=i.parameters[s],"textureRes"in i.parameters[s]&&t.watchedResources.push(i.parameters[s].textureRes));for(var u=0;u<t.highDetail.children[0].children.length;++u)if(n=t.highDetail.children[0].children[u].mesh){if(i=null,n.transparentAreas.length)i=n.transparentAreas[0].effect;else{if(!n.opaqueAreas.length)continue;i=n.opaqueAreas[0].effect}for(var l in i.parameters)i.parameters.hasOwnProperty(l)&&(t.effectHeight.parameters[l]=i.parameters[l],"textureRes"in i.parameters[l]&&t.watchedResources.push(i.parameters[l].textureRes))}var c=new a.Tw2TextureParameter("NormalHeight1",t.heightMapResPath1);c.Initialize(),t.watchedResources.push(c.textureRes),t.lockedResources.push(c.textureRes),t.effectHeight.parameters.NormalHeight1=c;var f=new a.Tw2TextureParameter("NormalHeight2",t.heightMapResPath2);f.Initialize(),t.watchedResources.push(f.textureRes),t.lockedResources.push(f.textureRes),t.effectHeight.parameters.NormalHeight2=f,t.effectHeight.parameters.Random=new a.Tw2FloatParameter("Random",t.itemID%100),t.effectHeight.parameters.TargetTextureHeight=new a.Tw2FloatParameter("TargetTextureHeight",1024),t.effectHeight.effectFilePath=o,t.effectHeight.Initialize(),t.heightDirty=!0,t.heightMap.Create(2048,1024,!1),t.watchedResources.push(t.effectHeight.effectRes);for(var h=0;h<t.lockedResources.length;++h)t.lockedResources[h].doNotPurge++,t.lockedResources[h].IsPurged()&&t.lockedResources[h].Reload()}}]),t}(s.EveObject)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveShip=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var a=Object.getPrototypeOf(t);if(null===a)return;return e(a,r,n)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(n)},a=r(62);t.EveShip=function(e){function t(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,t);var e=function e(t,r){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return r&&("object"==typeof r||"function"==typeof r)?r:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible.turretSets=!0,e.visible.boosters=!0,e.boosters=null,e.turretSets=[],e.boosterGain=1,e}return!function e(t,r){if("function"!=typeof r&&null!==r)throw TypeError("Super expression must either be null or a function, not "+typeof r);t.prototype=Object.create(r&&r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(t,r):t.__proto__=r)}(t,e),n(t,[{key:"Initialize",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Initialize",this).call(this),this.boosters&&this.RebuildBoosterSet()}},{key:"RebuildBoosterSet",value:function e(){this.boosters&&this.boosters.UpdateItemsFromLocators(this.FindLocatorsByPrefix("locator_booster"))}},{key:"RebuildTurretPositions",value:function e(){for(var t=0;t<this.turretSets.length;t++)this.RebuildTurretSet(t)}},{key:"RebuildTurretSet",value:function e(t){if(void 0!==this.turretSets[t]){for(var r=this.turretSets[t],n=r.locatorName,i=this.GetLocatorCount(n),a=[],o=0;o<i;++o){var s=n+String.fromCharCode(97+o),u=this.FindLocatorByName(s);u&&(u.FindBone(this.animation),a.push(u))}r.UpdateItemsFromLocators(a)}}},{key:"GetResources",value:function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1];i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"GetResources",this).call(this,r,n);for(var a=0;a<this.turretSets.length;a++)this.turretSets[a].GetResources(r);return this.boosters&&this.boosters.GetResources(r),r}},{key:"UpdateViewDependentData",value:function e(){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"UpdateViewDependentData",this).call(this);for(var r=0;r<this.turretSets.length;++r)this.turretSets[r].UpdateViewDependentData()}},{key:"Update",value:function e(r){i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"Update",this).call(this,r),this.boosters&&(this.boosters._locatorRebuildPending&&this.RebuildBoosterSet(),this.boosters.Update(r,this.transform));for(var n=0;n<this.turretSets.length;++n)this.turretSets[n]._locatorRebuildPending&&this.RebuildTurretSet(n),this.turretSets[n].Update(r,this.transform)}},{key:"GetBatches",value:function e(r,n){if(this.display&&(i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"GetBatches",this).call(this,r,n),this._perObjectData.perObjectVSData.Get("Shipdata")[0]=this.boosterGain,this._perObjectData.perObjectPSData.Get("Shipdata")[0]=this.boosterGain,this.boosters&&this.visible.boosters&&this.boosters.GetBatches(r,n,this._perObjectData),this.visible.turretSets)){if(this.lod>1)for(var a=0;a<this.turretSets.length;++a)this.turretSets[a].GetBatches(r,n,this._perObjectData,this.visible.firingEffects);else if(this.visible.firingEffects)for(var o=0;o<this.turretSets.length;++o)this.turretSets[o].firingEffect&&this.turretSets[o].firingEffect.GetBatches(r,n,this._perObjectData)}}}]),t}(a.EveSpaceObject)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveBoosterSet=t.EveBoosterSetItem=t.EveBoosterBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(10);function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function l(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.EveBoosterBatch=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.boosters=null,e}return l(t,e),n(t,[{key:"Commit",value:function e(t){this.boosters.Render(t)}}]),t}(a.Tw2RenderBatch),f=t.EveBoosterSetItem=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.glow=!0,e.visible.symHalo=!0,e.visible.halo=!0,e.visible.trail=!0,e.visible.customValues=!1,e.locatorName=null,e.updateFromLocator=!1,e.seed=7*Math.random(),e.wavePhase=Math.random(),e.atlas0=0,e.atlas1=0,e.transform=i.mat4.create(),e.customValues=null,e}return l(t,e),n(t,[{key:"GetPosition",value:function e(t){return i.mat4.getTranslation(t,this.transform)}},{key:"GetDirection",value:function e(t){i.vec3.set(t,this.transform[8],this.transform[9],this.transform[10]),i.vec3.normalize(t,t);var r=this.GetScale();return r<3&&i.vec3.scale(t,t,r/3),t}},{key:"GetScale",value:function e(){var t=this.transform;return Math.max(i.vec3.length([t[0],t[1],t[2]]),i.vec3.length([t[4],t[5],t[6]]))}}],[{key:"create",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new this;return i.util.assignIfExists(r.visible,t.visible,["glow","symHalo","halo","trail"]),i.util.assignIfExists(r,t,["name","display","seed","wavePhase","transform","locatorName","updateFromLocator","atlas0","atlas1"]),r}}]),t}(o.EveObjectSetItem),h=t.EveBoosterSet=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.glows=!0,e.visible.symHalos=!0,e.visible.halos=!0,e.visible.trails=!0,e.effect=null,e.glows=null,e.alwaysOn=!0,e.maxVel=250,e.glowDistance=2.5,e.glowScale=1,e.glowColor=i.vec4.create(),e.warpGlowColor=i.vec4.create(),e.haloDistance=3.01,e.haloScaleX=1,e.haloScaleY=1,e.haloColor=i.vec4.create(),e.warpHaloColor=i.vec4.create(),e.symHaloDistance=3,e.symHaloScale=1,e.trailColor=i.vec4.create(),e.trailSize=i.vec4.create(),e._parentTransform=i.mat4.create(),e._positions=null,e._decl=new a.Tw2VertexDeclaration,e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.POSITION,0,a.device.gl.FLOAT,3,0)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,0,a.device.gl.FLOAT,2,12)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,1,a.device.gl.FLOAT,4,20)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,2,a.device.gl.FLOAT,4,36)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,3,a.device.gl.FLOAT,4,52)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,4,a.device.gl.FLOAT,4,68)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,5,a.device.gl.FLOAT,4,84)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,6,a.device.gl.FLOAT,1,100)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,7,a.device.gl.FLOAT,2,104)),e._decl.RebuildHash(),e._perObjectData=new a.Tw2PerObjectData,e._perObjectData.perObjectVSData=new a.Tw2RawData,e._perObjectData.perObjectVSData.Declare("WorldMat",16),e._perObjectData.perObjectVSData.Declare("Shipdata",4),e._perObjectData.perObjectVSData.Create(),e._locatorRebuildPending=!0,e}return l(t,e),n(t,[{key:"FindItemByLocatorName",value:function e(t){for(var r=0;r<this.items.length;r++)if(this.items[r].locatorName&&this.items[r].locatorName===t)return this.items[r];return null}},{key:"UpdateItemsFromLocators",value:function e(t){for(var r=Array.from(this.items),n=0;n<t.length;n++){var a=t[n],o=a.name,s=a.transform,u=a.atlasIndex0,l=a.atlasIndex1,c=this.FindItemByLocatorName(o);c?(r.splice(r.indexOf(c),1),c.updateFromLocator&&(i.mat4.copy(c.transform,s),c.atlas0=u,c.atlas1=l,c.OnValueChanged())):this.CreateItem({name:o,locatorName:o,updateFromLocator:!0,atlas0:u,atlas1:l,transform:s})}for(var f=0;f<r.length;f++)null!==r[f].locatorName&&(this.RemoveItem(r[f]),f--);this._locatorRebuildPending=!1,this._rebuildPending&&this.Rebuild()}},{key:"RebuildItemsFromLocators",value:function e(){this._locatorRebuildPending=!0}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(t),this.glows&&this.glows.effect.GetResources(t),t}},{key:"Update",value:function e(t,r){i.mat4.copy(this._parentTransform,r),this._rebuildPending&&this.Rebuild(),this.glows&&this.glows.Update(t)}},{key:"Unload",value:function e(){this._positions&&(a.device.gl.deleteBuffer(this._positions),this._positions=null),this.glows&&this.glows.Unload()}},{key:"Rebuild",value:function e(){this.constructor.RebuildItems(this);var r=this._visibleItems.length;if(this._rebuildPending=!1,r){for(var n=a.device,i=t._box,o=new Float32Array(r*i.length*168),s=[0,3,1,3,2,1],u=0,l=0;l<r;++l)for(var c=this._visibleItems[l],f=0;f<i.length;++f)for(var h=0;h<s.length;++h)o[u++]=i[f][s[h]][0],o[u++]=i[f][s[h]][1],o[u++]=i[f][s[h]][2],o[u++]=0,o[u++]=0,o.set(c.transform,u),u+=16,o[u++]=0,o[u++]=1,o[u++]=1,o[u++]=1,o[u++]=c.wavePhase,o[u++]=c.atlas0,o[u++]=c.atlas1;this._positions=n.gl.createBuffer(),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,this._positions),n.gl.bufferData(n.gl.ARRAY_BUFFER,o,n.gl.STATIC_DRAW),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,null),this._positions.count=36*r,this.glows&&this.glows.Rebuild()}}},{key:"GetBatches",value:function e(t,r,n){if(this.display&&t===a.device.RM_ADDITIVE&&this._positions&&this._visibleItems.length){if(this.effect){var o=new c;i.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),this._parentTransform),this._perObjectData.perObjectVSData.Set("Shipdata",n.perObjectVSData.Get("Shipdata")),this._perObjectData.perObjectPSData=n.perObjectPSData,o.perObjectData=this._perObjectData,o.boosters=this,o.renderMode=a.device.RM_ADDITIVE,r.Commit(o)}this.glows&&this.glows.GetBoosterGlowBatches(t,r,n,this._parentTransform,n.perObjectVSData.Get("Shipdata")[0],0)}}},{key:"Render",value:function e(t){if(!this.effect||!this.effect.IsGood())return!1;a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,this._positions);for(var r=0;r<this.effect.GetPassCount(t);++r){if(this.effect.ApplyPass(t,r),!this._decl.SetDeclaration(this.effect.GetPassInput(t,r),112))return!1;a.device.ApplyShadowState(),a.device.gl.drawArrays(a.device.gl.TRIANGLES,0,this._positions.count)}return!0}}],[{key:"RebuildItems",value:function e(r){var n=r.glows,a=t.global,o=a.vec3_0;n&&n.ClearItems(),r._visibleItems=[];for(var s=0;s<r.items.length;s++){var u=r.items[s];if(u._onModified=r._onChildModified,u.display){if(r._visibleItems.push(u),n){var l=u.customValues&&u.customValues.display?u.customValues:r,c=u.GetPosition(a.vec3_1),f=u.GetDirection(a.vec3_2),h=u.GetScale();r.visible.glows&&u.visible.glow&&n.CreateItem({name:u.name+"_glow",position:i.vec3.subtract(o,c,i.vec3.scale(o,f,l.glowDistance)),blinkRate:u.seed,blinkPhase:u.seed,minScale:l.glowScale*h,maxScale:l.glowScale*h,color:l.glowColor,warpColor:l.warpGlowColor}),r.visible.symHalos&&u.visible.symHalo&&n.CreateItem({name:u.name+"_symHalo",position:i.vec3.subtract(o,c,i.vec3.scale(o,f,l.symHaloDistance)),blinkRate:u.seed,blinkPhase:u.seed+1,minScale:l.symHaloScale*h,maxScale:l.symHaloScale*h,color:l.haloColor,warpColor:l.warpHaloColor}),r.visible.halos&&u.visible.halo&&n.CreateItem({name:u.name+"_halo",position:i.vec3.subtract(o,c,i.vec3.scale(o,f,l.haloDistance)),blinkRate:u.seed,blinkPhase:u.seed+1,minScale:l.haloScaleX*h,maxScale:l.haloScaleY*h,color:l.haloColor,warpColor:l.warpHaloColor})}u._rebuildPending=!1}}}}]),t}(o.EveObjectSet);h.Item=f,h._box=[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],[[-1,-1,-1],[-1,1,-1],[1,1,-1],[1,-1,-1]],[[-1,-1,0],[-1,1,0],[-1,1,-1],[-1,-1,-1]],[[1,-1,0],[1,-1,-1],[1,1,-1],[1,1,0]],[[-1,-1,0],[-1,-1,-1],[1,-1,-1],[1,-1,0]],[[-1,1,0],[1,1,0],[1,1,-1],[-1,1,-1]]]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveCurveLineSet=t.EveCurveLineSetItem=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(10);function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function l(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.EveCurveLineSetItem=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.type=t.Type.INVALID,e.position1=i.vec3.create(),e.color1=i.vec4.fromValues(1,1,1,1),e.position2=i.vec3.create(),e.color2=i.vec4.fromValues(1,1,1,1),e.intermediatePosition=i.vec3.create(),e.width=1,e.multiColor=i.vec4.fromValues(0,0,0,1),e.multiColorBorder=-1,e.overlayColor=i.vec4.fromValues(0,0,0,1),e.animationSpeed=0,e.animationScale=1,e.numOfSegments=1,e}return l(t,e),n(t,[{key:"ChangeColor",value:function e(t,r){i.vec3.copy(this.color1,t),i.vec3.copy(this.color2,r),this.OnValueChanged()}},{key:"ChangeWidth",value:function e(t){this.width=t,this.OnValueChanged()}},{key:"ChangeCartesian",value:function e(t,r,n){i.vec3.copy(this.position1,t),i.vec3.copy(this.position2,r),i.vec3.copy(this.intermediatePosition,n),this.OnValueChanged()}},{key:"ChangePositionCartesian",value:function e(t,r){i.vec3.copy(this.position1,t),i.vec3.copy(this.position2,r),this.OnValueChanged()}},{key:"ChangeIntermediateCartesian",value:function e(t){i.vec3.copy(this.intermediatePosition,t),this.OnValueChanged()}},{key:"ChangeSpherical",value:function e(t,r,n,a){i.vec3.fromSpherical(this.position1,t,a),i.vec3.fromSpherical(this.position2,r,a),i.vec3.fromSpherical(this.intermediatePosition,n,a),this.OnValueChanged()}},{key:"ChangePositionSpherical",value:function e(t,r,n){i.vec3.fromSpherical(this.position1,t,n),i.vec3.fromSpherical(this.position2,r,n),this.OnValueChanged()}},{key:"ChangeIntermediateSpherical",value:function e(t,r){i.vec3.fromSpherical(this.intermediatePosition,t,r),this.OnValueChanged()}},{key:"ChangeMultiColor",value:function e(t,r){i.vec4.copy(this.multiColor,t),this.multiColorBorder=r,this.OnValueChanged()}},{key:"ChangeAnimation",value:function e(t,r,n){i.vec4.copy(this.overlayColor,t),this.animationSpeed=r,this.animationScale=n,this.OnValueChanged()}},{key:"ChangeSegmentation",value:function e(r){this.type!==t.Type.STRAIGHT&&(this.numOfSegments=r,this.OnValueChanged())}}],[{key:"create",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new this;return i.util.assignIfExists(r,t,["name","display","type","position1","color1","position2","color2","intermediatePosition","width","multiColor","multiColorBorder","overlayColor","animationSpeed","animationScale","numOfSegments"]),r}}]),t}(o.EveObjectSetItem);c.Type={INVALID:0,STRAIGHT:1,SPHERED:2,CURVED:3},c.DEFAULT_CURVED_SEGMENTS=20,c.DEFAULT_SPHERED_SEGEMENTS=20;var f=t.EveCurveLineSet=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.lineEffect=a.Tw2Effect.create({effectFilePath:"res:/Graphics/Effect/Managed/Space/SpecialFX/Lines3D.fx",textures:{TexMap:"res:/texture/global/white.dds.0.png",OverlayTexMap:"res:/texture/global/white.dds.0.png"}}),e.pickEffect=null,e.lineWidthFactor=1,e.additive=!1,e.pickable=!0,e.depthOffset=0,e.translation=i.vec3.create(),e.rotation=i.quat.create(),e.scaling=i.vec3.fromValues(1,1,1),e.transform=i.mat4.create(),e.parentTransform=i.mat4.create(),e._vertexSize=26,e._vbSize=0,e._vb=null,e._perObjectData=new a.Tw2PerObjectData,e._perObjectData.perObjectVSData=new a.Tw2RawData,e._perObjectData.perObjectVSData.Declare("WorldMat",16),e._perObjectData.perObjectVSData.Create(),e._perObjectData.perObjectPSData=new a.Tw2RawData,e._perObjectData.perObjectPSData.Declare("WorldMat",16),e._perObjectData.perObjectPSData.Create(),e._decl=new a.Tw2VertexDeclaration,e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.POSITION,0,a.device.gl.FLOAT,3,0)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,0,a.device.gl.FLOAT,4,12)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,1,a.device.gl.FLOAT,4,28)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,2,a.device.gl.FLOAT,3,44)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.COLOR,0,a.device.gl.FLOAT,4,56)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.COLOR,1,a.device.gl.FLOAT,4,72)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.COLOR,2,a.device.gl.FLOAT,4,88)),e._decl.stride=4*e._vertexSize,e._decl.RebuildHash(),t.init(),e}return l(t,e),n(t,[{key:"Initialize",value:function e(){this.OnValueChanged(),this.Rebuild()}},{key:"AddStraightLine",value:function e(t,r,n,i,a){return this.CreateItem({type:c.Type.STRAIGHT,position1:t,position2:r,color1:i,color2:a,width:n})}},{key:"AddCurvedLineCrt",value:function e(t,r,n,i,a,o){return this.CreateItem({type:c.Type.CURVED,position1:t,position2:r,intermediatePosition:n,color1:a,color2:o,width:i,numOfSegments:c.DEFAULT_CURVED_SEGMENTS})}},{key:"AddCurvedLineSph",value:function e(r,n,a,o,s,u,l){var f=t.global;return this.CreateItem({type:c.Type.CURVED,position1:i.vec3.fromSpherical(f.vec3_0,r,a),position2:i.vec3.fromSpherical(f.vec3_1,n,a),intermediatePosition:i.vec3.fromSpherical(f.vec3_2,o,a),color1:u,color2:l,width:s,numOfSegments:c.DEFAULT_CURVED_SEGMENTS})}},{key:"AddSpheredLineCrt",value:function e(t,r,n,i,a,o){return this.CreateItem({type:c.Type.SPHERED,position1:t,position2:r,intermediatePosition:n,color1:a,color2:o,width:i,numOfSegments:c.DEFAULT_SPHERED_SEGEMENTS})}},{key:"AddSpheredLineSph",value:function e(r,n,a,o,s,u,l){var f=t.global;return this.CreateItem({type:c.Type.SPHERED,position1:i.vec3.fromSpherical(f.vec3_0,r,a),position2:i.vec3.fromSpherical(f.vec3_1,n,a),intermediatePosition:i.vec3.fromSpherical(f.vec3_2,o,a),color1:u,color2:l,width:s,numOfSegments:c.DEFAULT_SPHERED_SEGEMENTS})}},{key:"OnValueChanged",value:function e(){i.mat4.fromRotationTranslationScale(this.transform,this.rotation,this.translation,this.scaling),this._rebuildPending=!0}},{key:"UpdateViewDependentData",value:function e(t){i.mat4.copy(this.parentTransform,t)}},{key:"Update",value:function e(){this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function e(){this._vb&&(a.device.gl.deleteBuffer(this._vb),this._vb=null)}},{key:"Rebuild",value:function e(){t.RebuildItems(this),this._vb=null,this._vbSize=this.lineCount,this._rebuildPending=!1;var r=this._visibleItems.length;if(r){for(var n=t.global,o=new Float32Array(6*this._vbSize*this._vertexSize),s=n.vec3_0,u=n.vec3_1,l=n.vec3_2,f=n.vec3_3,h=n.vec3_4,p=n.vec3_5,d=n.vec3_6,v=n.mat4_0,$=n.vec3_7,m=n.vec3_8,y=n.vec3_9,g=n.vec3_10,_=n.vec4_0,b=n.vec4_1,E=0,T=void 0,S=0;S<r;++S){var R=this._visibleItems[S];switch(R.type){case c.Type.INVALID:break;case c.Type.STRAIGHT:t.WriteLineVerticesToBuffer(this,R.position1,R.color1,0,R.position2,R.color2,1,S,o,E),E+=6*this._vertexSize;break;case c.Type.SPHERED:i.vec3.subtract(s,R.position1,R.intermediatePosition),i.vec3.subtract(u,R.position2,R.intermediatePosition),i.vec3.normalize(l,s),i.vec3.normalize(f,u),i.vec3.cross(h,s,u);var w=Math.acos(i.vec3.dot(l,f))/R.numOfSegments;i.mat4.identity(v),i.mat4.rotate(v,v,w,h),i.vec3.copy($,s),i.vec4.copy(_,R.color1);for(var P=0;P<this.lines[S].numOfSegments;++P){var A=(P+1)/R.numOfSegments;i.vec3.transformMat4(m,$,v),b[0]=R.color1[0]*(1-A)+R.color2[0]*A,b[1]=R.color1[1]*(1-A)+R.color2[1]*A,b[2]=R.color1[2]*(1-A)+R.color2[2]*A,b[3]=R.color1[3]*(1-A)+R.color2[3]*A,i.vec3.add(y,$,R.intermediatePosition),i.vec3.add(g,m,R.intermediatePosition),t.WriteLineVerticesToBuffer(this,y,_,P/R.numOfSegments,g,b,A,S,o,E),E+=6*this._vertexSize,T=$,$=m,m=T,T=_,_=b,b=T}break;case c.Type.CURVED:i.vec3.subtract(p,R.intermediatePosition,R.position1),i.vec3.subtract(d,R.position2,R.intermediatePosition),i.vec3.copy(y,R.position1),i.vec3.copy(_,R.color1);for(var D=0;D<R.numOfSegments;++D){var O=(D+1)/R.numOfSegments;i.vec3.hermite(g,R.position1,p,R.position2,d,O),b[0]=R.color1[0]*(1-O)+R.color2[0]*O,b[1]=R.color1[1]*(1-O)+R.color2[1]*O,b[2]=R.color1[2]*(1-O)+R.color2[2]*O,b[3]=R.color1[3]*(1-O)+R.color2[3]*O,t.WriteLineVerticesToBuffer(this,y,_,D/R.numOfSegments,g,b,O,S,o,E),E+=6*this._vertexSize,T=y,y=g,g=T,T=_,_=b,b=T}}}this._vb=a.device.gl.createBuffer(),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,this._vb),a.device.gl.bufferData(a.device.gl.ARRAY_BUFFER,o,a.device.gl.STATIC_DRAW),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,null)}}},{key:"GetBatches",value:function e(r,n){if(this.display&&this._vb){var o=void 0;switch(r){case a.device.RM_TRANSPARENT:if(this.additive||!this.lineEffect)return;o=this.lineEffect;break;case a.device.RM_ADDITIVE:if(!this.additive||!this.lineEffect)return;o=this.lineEffect;break;case a.device.RM_PICKABLE:if(!this.pickable||!this.pickEffect)return;o=this.pickEffect}var s=new a.Tw2ForwardingRenderBatch,u=t.global.mat4_0;i.mat4.multiply(u,this.transform,this.parentTransform),i.mat4.transpose(this._perObjectData.perObjectVSData.Get("WorldMat"),u),i.mat4.transpose(this._perObjectData.perObjectPSData.Get("WorldMat"),u),s.perObjectData=this._perObjectData,s.geometryProvider=this,s.renderMode=r,s.effect=o,n.Commit(s)}}},{key:"Render",value:function e(t,r){if(!t.effect||!t.effect.IsGood())return!1;a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,this._vb);for(var n=t.effect.GetPassCount(r),i=0;i<n;++i){t.effect.ApplyPass(r,i);var o=t.effect.GetPassInput(r,i);if(!this._decl.SetDeclaration(o,this._decl.stride))return!1;a.device.ApplyShadowState(),a.device.gl.drawArrays(a.device.gl.TRIANGLES,0,6*this._vbSize)}return!0}},{key:"lines",get:function e(){return this.items},set:function e(t){this.items=t}},{key:"lineCount",get:function e(){for(var t=0,r=0;r<this.items.length;r++)this.items[r].type!==c.Type.INVALID&&(t+=this.items[r].numOfSegments);return t}}],[{key:"FillColorVertices",value:function e(t,r,n){return r[n++]=t.multiColor[0],r[n++]=t.multiColor[1],r[n++]=t.multiColor[2],r[n++]=t.multiColor[3],r[n++]=t.overlayColor[0],r[n++]=t.overlayColor[1],r[n++]=t.overlayColor[2],r[n++]=t.overlayColor[3],n}},{key:"WriteLineVerticesToBuffer",value:function e(r,n,i,a,o,s,u,l,c,f){var h=r.items[l];c[f++]=n[0],c[f++]=n[1],c[f++]=n[2],c[f++]=o[0]-n[0],c[f++]=o[1]-n[1],c[f++]=o[2]-n[2],c[f++]=-r.lineWidthFactor*h.width,c[f++]=0,c[f++]=a,c[f++]=h.multiColorBorder,c[f++]=u-a,c[f++]=h.animationSpeed,c[f++]=h.animationScale,c[f++]=l,c[f++]=i[0],c[f++]=i[1],c[f++]=i[2],c[f++]=i[3],f=t.FillColorVertices(h,c,f),c[f++]=n[0],c[f++]=n[1],c[f++]=n[2],c[f++]=o[0]-n[0],c[f++]=o[1]-n[1],c[f++]=o[2]-n[2],c[f++]=r.lineWidthFactor*h.width,c[f++]=0,c[f++]=a,c[f++]=h.multiColorBorder,c[f++]=u-a,c[f++]=h.animationSpeed,c[f++]=h.animationScale,c[f++]=l,c[f++]=i[0],c[f++]=i[1],c[f++]=i[2],c[f++]=i[3],f=t.FillColorVertices(h,c,f),c[f++]=o[0],c[f++]=o[1],c[f++]=o[2],c[f++]=n[0]-o[0],c[f++]=n[1]-o[1],c[f++]=n[2]-o[2],c[f++]=-r.lineWidthFactor*h.width,c[f++]=1,c[f++]=u,c[f++]=h.multiColorBorder,c[f++]=u-a,c[f++]=h.animationSpeed,c[f++]=h.animationScale,c[f++]=l,c[f++]=s[0],c[f++]=s[1],c[f++]=s[2],c[f++]=s[3],f=t.FillColorVertices(h,c,f),c[f++]=n[0],c[f++]=n[1],c[f++]=n[2],c[f++]=o[0]-n[0],c[f++]=o[1]-n[1],c[f++]=o[2]-n[2],c[f++]=r.lineWidthFactor*h.width,c[f++]=0,c[f++]=a,c[f++]=h.multiColorBorder,c[f++]=u-a,c[f++]=h.animationSpeed,c[f++]=h.animationScale,c[f++]=l,c[f++]=i[0],c[f++]=i[1],c[f++]=i[2],c[f++]=i[3],f=t.FillColorVertices(h,c,f),c[f++]=o[0],c[f++]=o[1],c[f++]=o[2],c[f++]=n[0]-o[0],c[f++]=n[1]-o[1],c[f++]=n[2]-o[2],c[f++]=r.lineWidthFactor*h.width,c[f++]=1,c[f++]=u,c[f++]=h.multiColorBorder,c[f++]=u-a,c[f++]=h.animationSpeed,c[f++]=h.animationScale,c[f++]=l,c[f++]=s[0],c[f++]=s[1],c[f++]=s[2],c[f++]=s[3],f=t.FillColorVertices(h,c,f),c[f++]=o[0],c[f++]=o[1],c[f++]=o[2],c[f++]=n[0]-o[0],c[f++]=n[1]-o[1],c[f++]=n[2]-o[2],c[f++]=-r.lineWidthFactor*h.width,c[f++]=1,c[f++]=u,c[f++]=h.multiColorBorder,c[f++]=u-a,c[f++]=h.animationSpeed,c[f++]=h.animationScale,c[f++]=l,c[f++]=s[0],c[f++]=s[1],c[f++]=s[2],c[f++]=s[3],t.FillColorVertices(h,c,f)}},{key:"init",value:function e(){t.global||(t.global={vec3_0:i.vec3.create(),vec3_1:i.vec3.create(),vec3_2:i.vec3.create(),vec3_3:i.vec3.create(),vec3_4:i.vec3.create(),vec3_5:i.vec3.create(),vec3_6:i.vec3.create(),vec3_7:i.vec3.create(),vec3_8:i.vec3.create(),vec3_9:i.vec3.create(),vec3_10:i.vec3.create(),vec4_0:i.vec4.create(),vec4_1:i.vec4.create(),mat4_0:i.mat4.create()})}}]),t}(o.EveObjectSet);f.global=null,f.Item=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveLocator=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0);(t.EveLocator=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this.name="",this.transform=i.mat4.create(),this.atlasIndex0=null,this.atlasIndex1=null,this.bone=null}return n(e,[{key:"FindBone",value:function e(t){this.bone=null;var r=t.FindModelForMesh(0);if(r){for(var n=0;n<r.bones.length;++n)if(r.bones[n].boneRes.name===this.name){this.bone=r.bones[n];break}}return this.bone}}]),e}()).Prefix={AUDIO:"locator_audio",ATTACH:"locator_attach",BOOSTER:"locator_booster",TURRET:"locator_turret",XL_TURRET:"locator_xl"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EvePlaneSet=t.EvePlaneSetItem=t.EvePlaneSetBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(10);function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function l(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.EvePlaneSetBatch=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.planeSet=null,e}return l(t,e),n(t,[{key:"Commit",value:function e(t){this.planeSet.Render(t)}}]),t}(a.Tw2RenderBatch),f=t.EvePlaneSetItem=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.boneIndex=0,e.groupIndex=-1,e.maskAtlasID=0,e.position=i.vec3.create(),e.scaling=i.vec3.fromValues(1,1,1),e.rotation=i.quat.create(),e.transform=i.mat4.create(),e.color=i.vec4.fromValues(1,1,1,1),e.layer1Transform=i.vec4.fromValues(1,1,0,0),e.layer2Transform=i.vec4.fromValues(1,1,0,0),e.layer1Scroll=i.vec4.create(),e.layer2Scroll=i.vec4.create(),e}return l(t,e),n(t,null,[{key:"create",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new this;return i.util.assignIfExists(r,t,["name","display","boneIndex","groupIndex","maskAtlasID","position","scaling","rotation","transform","color","layer1Transform","layer2Transform","layer1Scroll","layer2Scroll"]),r}}]),t}(o.EveObjectSetItem);(t.EvePlaneSet=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.effect=null,e.hideOnLowQuality=!1,e._time=0,e._vertexBuffer=null,e._indexBuffer=null,e._decl=new a.Tw2VertexDeclaration,e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,0,a.device.gl.FLOAT,4,0)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,1,a.device.gl.FLOAT,4,16)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,2,a.device.gl.FLOAT,4,32)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.COLOR,0,a.device.gl.FLOAT,4,48)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,3,a.device.gl.FLOAT,4,64)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,4,a.device.gl.FLOAT,4,80)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,5,a.device.gl.FLOAT,4,96)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,6,a.device.gl.FLOAT,4,112)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,7,a.device.gl.FLOAT,3,128)),e._decl.RebuildHash(),e}return l(t,e),n(t,[{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(t),t}},{key:"Update",value:function e(t){this._time+=t,this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function e(){this._vertexBuffer&&(a.device.gl.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(a.device.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}},{key:"Rebuild",value:function e(){this.Unload(),t.RebuildItems(this),this._rebuildPending=!1;var r=this._visibleItems.length;if(r){for(var n=t.global.mat4_0,o=new Float32Array(4*r*35),s=0;s<r;++s){var u=this._visibleItems[s],l=4*s*35;o[l+35-3]=0,o[l+35+35-3]=1,o[l+70+35-3]=2,o[l+105+35-3]=3;for(var c=i.mat4.fromRotationTranslationScale(n,u.rotation,u.position,u.scaling),f=0;f<4;++f){var h=l+35*f;o[h]=c[0],o[h+1]=c[4],o[h+2]=c[8],o[h+3]=c[12],o[h+4]=c[1],o[h+5]=c[5],o[h+6]=c[9],o[h+7]=c[13],o[h+8]=c[2],o[h+9]=c[6],o[h+10]=c[10],o[h+11]=c[14],o[h+12]=u.color[0],o[h+13]=u.color[1],o[h+14]=u.color[2],o[h+15]=u.color[3],o[h+16]=u.layer1Transform[0],o[h+17]=u.layer1Transform[1],o[h+18]=u.layer1Transform[2],o[h+19]=u.layer1Transform[3],o[h+20]=u.layer2Transform[0],o[h+21]=u.layer2Transform[1],o[h+22]=u.layer2Transform[2],o[h+23]=u.layer2Transform[3],o[h+24]=u.layer1Scroll[0],o[h+25]=u.layer1Scroll[1],o[h+26]=u.layer1Scroll[2],o[h+27]=u.layer1Scroll[3],o[h+28]=u.layer2Scroll[0],o[h+29]=u.layer2Scroll[1],o[h+30]=u.layer2Scroll[2],o[h+31]=u.layer2Scroll[3],o[h+33]=u.boneIndex,o[h+34]=u.maskAtlasID}}this._vertexBuffer=a.device.gl.createBuffer(),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,this._vertexBuffer),a.device.gl.bufferData(a.device.gl.ARRAY_BUFFER,o,a.device.gl.STATIC_DRAW),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,null);for(var p=new Uint16Array(6*r),d=0;d<r;++d){var v=6*d,$=4*d;p[v]=$,p[v+1]=$+2,p[v+2]=$+1,p[v+3]=$,p[v+4]=$+3,p[v+5]=$+2}this._indexBuffer=a.device.gl.createBuffer(),a.device.gl.bindBuffer(a.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),a.device.gl.bufferData(a.device.gl.ELEMENT_ARRAY_BUFFER,p,a.device.gl.STATIC_DRAW),a.device.gl.bindBuffer(a.device.gl.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=6*r}}},{key:"GetBatches",value:function e(t,r,n){if(this.display&&t===a.device.RM_ADDITIVE&&this._indexBuffer&&this._visibleItems.length){var i=new c;i.renderMode=a.device.RM_ADDITIVE,i.planeSet=this,i.perObjectData=n,r.Commit(i)}}},{key:"Render",value:function e(t){if(!this.effect||!this.effect.IsGood())return!1;a.device.SetStandardStates(a.device.RM_ADDITIVE),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,this._vertexBuffer),a.device.gl.bindBuffer(a.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer);for(var r=0;r<this.effect.GetPassCount(t);++r){if(this.effect.ApplyPass(t,r),!this._decl.SetDeclaration(this.effect.GetPassInput(t,r),140))return!1;a.device.ApplyShadowState(),a.device.gl.drawElements(a.device.gl.TRIANGLES,this._indexBuffer.count,a.device.gl.UNSIGNED_SHORT,0)}return!0}},{key:"planes",get:function e(){return this.items},set:function e(t){this.items=t}}]),t}(o.EveObjectSet)).Item=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpaceObjectDecal=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1);t.EveSpaceObjectDecal=function(){function e(){!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.decalEffect=null,this.pickEffect=null,this.parentGeometry=null,this.parentBoneIndex=-1,this.groupIndex=-1,this.pickable=!0,this.position=i.vec3.create(),this.rotation=i.quat.create(),this.scaling=i.vec3.create(),this.decalMatrix=i.mat4.create(),this.invDecalMatrix=i.mat4.create(),this.indexBuffer=[],this._indexBuffer=null,this._perObjectData=new a.Tw2PerObjectData,this._perObjectData.perObjectVSData=new a.Tw2RawData,this._perObjectData.perObjectVSData.Declare("worldMatrix",16),this._perObjectData.perObjectVSData.Declare("invWorldMatrix",16),this._perObjectData.perObjectVSData.Declare("decalMatrix",16),this._perObjectData.perObjectVSData.Declare("invDecalMatrix",16),this._perObjectData.perObjectVSData.Declare("parentBoneMatrix",16),this._perObjectData.perObjectVSData.Create(),this._perObjectData.perObjectPSData=new a.Tw2RawData,this._perObjectData.perObjectPSData.Declare("displayData",4),this._perObjectData.perObjectPSData.Declare("shipData",12),this._perObjectData.perObjectPSData.Create(),i.mat4.identity(this._perObjectData.perObjectVSData.Get("parentBoneMatrix"))}return n(e,[{key:"Initialize",value:function e(){this.SetIndexBuffer(this.indexBuffer)}},{key:"OnValueChanged",value:function e(){if(!this._indexBuffer&&this.indexBuffer){var t=new Uint16Array(this.indexBuffer);this._indexBuffer=a.device.gl.createBuffer(),a.device.gl.bindBuffer(a.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),a.device.gl.bufferData(a.device.gl.ELEMENT_ARRAY_BUFFER,t,a.device.gl.STATIC_DRAW)}i.mat4.fromRotationTranslationScale(this.decalMatrix,this.rotation,this.position,this.scaling),i.mat4.invert(this.invDecalMatrix,this.decalMatrix)}},{key:"SetParentGeometry",value:function e(t){this.parentGeometry=t}},{key:"SetIndexBuffer",value:function e(t){this.indexBuffer=t,this.Unload(),this.OnValueChanged()}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.parentGeometry&&!t.includes(this.parentGeometry)&&t.push(this.parentGeometry),this.decalEffect&&this.decalEffect.GetResources(t),this.pickEffect&&this.pickEffect.GetResources(t),t}},{key:"Unload",value:function e(){this._indexBuffer&&(a.device.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}},{key:"GetBatches",value:function e(t,r,n,o){var s=void 0;switch(t){case a.device.RM_DECAL:s=this.decalEffect;break;case a.device.RM_PICKABLE:s=this.pickable?this.pickEffect:null}if(this.display&&s&&s.IsGood()&&this.indexBuffer.length&&this.parentGeometry&&this.parentGeometry.IsGood()){var u=new a.Tw2ForwardingRenderBatch;if(this._perObjectData.perObjectVSData.Set("worldMatrix",n.perObjectVSData.Get("WorldMat")),this.parentBoneIndex>=0){var l=n.perObjectVSData.Get("JointMat"),c=12*this.parentBoneIndex;if(l[c]||l[c+4]||l[c+8]){var f=this._perObjectData.perObjectVSData.Get("parentBoneMatrix");f[0]=l[c],f[1]=l[c+4],f[2]=l[c+8],f[3]=0,f[4]=l[c+1],f[5]=l[c+5],f[6]=l[c+9],f[7]=0,f[8]=l[c+2],f[9]=l[c+6],f[10]=l[c+10],f[11]=0,f[12]=l[c+3],f[13]=l[c+7],f[14]=l[c+11],f[15]=1,i.mat4.transpose(f,f)}}i.mat4.invert(this._perObjectData.perObjectVSData.Get("invWorldMatrix"),this._perObjectData.perObjectVSData.Get("worldMatrix")),i.mat4.transpose(this._perObjectData.perObjectVSData.Get("decalMatrix"),this.decalMatrix),i.mat4.transpose(this._perObjectData.perObjectVSData.Get("invDecalMatrix"),this.invDecalMatrix),this._perObjectData.perObjectPSData.Get("displayData")[0]=o||0,this._perObjectData.perObjectPSData.Set("shipData",n.perObjectPSData.data),u.perObjectData=this._perObjectData,u.geometryProvider=this,u.renderMode=t,u.effect=s,r.Commit(u)}}},{key:"Render",value:function e(t,r){var n=this.parentGeometry.meshes[0].indexes,i=this.parentGeometry.meshes[0].areas[0].start,o=this.parentGeometry.meshes[0].areas[0].count,s=this.parentGeometry.meshes[0].indexType;a.store.SetVariableValue("u_DecalMatrix",this.decalMatrix),a.store.SetVariableValue("u_InvDecalMatrix",this.invDecalMatrix),this.parentGeometry.meshes[0].indexes=this._indexBuffer,this.parentGeometry.meshes[0].areas[0].start=0,this.parentGeometry.meshes[0].areas[0].count=this.indexBuffer.length,this.parentGeometry.meshes[0].indexType=a.device.gl.UNSIGNED_SHORT,this.parentGeometry.RenderAreas(0,0,1,t.effect,r),this.parentGeometry.meshes[0].indexes=n,this.parentGeometry.meshes[0].areas[0].start=i,this.parentGeometry.meshes[0].areas[0].count=o,this.parentGeometry.meshes[0].indexType=s}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpotlightSet=t.EveSpotlightSetItem=t.EveSpotlightSetBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(10);function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function l(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.EveSpotlightSetBatch=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.spotlightSet=null,e}return l(t,e),n(t,[{key:"Commit",value:function e(t){this.spotlightSet.RenderCones(t),this.spotlightSet.RenderGlow(t)}}]),t}(a.Tw2RenderBatch),f=t.EveSpotlightSetItem=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.transform=i.mat4.create(),e.coneColor=i.vec4.create(),e.spriteColor=i.vec4.create(),e.flareColor=i.vec4.create(),e.spriteScale=i.vec3.fromValues(1,1,1),e.boosterGainInfluence=0,e.boneIndex=0,e.groupIndex=-1,e.coneIntensity=0,e.spriteIntensity=0,e.flareIntensity=0,e}return l(t,e),n(t,null,[{key:"create",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new this;return i.util.assignIfExists(r,t,["name","display","boosterGainInfluence","boneIndex","groupIndex","coneIntensity","spriteIntensity","flareIntensity","transform","coneColor","spriteColor","flareColor","spriteScale"]),r}}]),t}(o.EveObjectSetItem);(t.EveSpotlightSet=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.coneEffect=null,e.glowEffect=null,e._coneVertexBuffer=null,e._spriteVertexBuffer=null,e._indexBuffer=null,e._decl=new a.Tw2VertexDeclaration,e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.COLOR,0,a.device.gl.FLOAT,4,0)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,0,a.device.gl.FLOAT,4,16)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,1,a.device.gl.FLOAT,4,32)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,2,a.device.gl.FLOAT,4,48)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,3,a.device.gl.FLOAT,3,64)),e._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,4,a.device.gl.FLOAT,3,76)),e._decl.RebuildHash(),e}return l(t,e),n(t,[{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.coneEffect&&this.coneEffect.GetResources(t),this.glowEffect&&this.glowEffect.GetResources(t),t}},{key:"Unload",value:function e(){this._coneVertexBuffer&&(a.device.gl.deleteBuffer(this._coneVertexBuffer),this._coneVertexBuffer=null),this._spriteVertexBuffer&&(a.device.gl.deleteBuffer(this._spriteVertexBuffer),this._spriteVertexBuffer=null),this._indexBuffer&&(a.device.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null)}},{key:"Rebuild",value:function e(){this.Unload(),t.RebuildItems(this),this._rebuildPending=!1;var r=this._visibleItems.length;if(r){for(var n=a.device,i=[1,0,2,3],o=new Float32Array(352*r),s=0;s<r;++s)for(var u=this._visibleItems[s],l=0;l<4;++l)for(var c=0;c<4;++c){var f=(16*s+4*l+c)*22;o[f]=u.coneColor[0]*u.coneIntensity,o[f+1]=u.coneColor[1]*u.coneIntensity,o[f+2]=u.coneColor[2]*u.coneIntensity,o[f+3]=u.coneColor[3],o[f+4]=u.transform[0],o[f+5]=u.transform[4],o[f+6]=u.transform[8],o[f+7]=u.transform[12],o[f+8]=u.transform[1],o[f+9]=u.transform[5],o[f+10]=u.transform[9],o[f+11]=u.transform[13],o[f+12]=u.transform[2],o[f+13]=u.transform[6],o[f+14]=u.transform[10],o[f+15]=u.transform[14],o[f+16]=1,o[f+17]=1,o[f+18]=1,o[f+19]=4*l+i[c],o[f+20]=u.boneIndex,o[f+21]=u.boosterGainInfluence?255:0}this._coneVertexBuffer=n.gl.createBuffer(),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,this._coneVertexBuffer),n.gl.bufferData(n.gl.ARRAY_BUFFER,o,n.gl.STATIC_DRAW),this._coneVertexBuffer.count=24*r;for(var h=new Float32Array(176*r),p=[1,0,2,3],d=0;d<r;++d)for(var v=this._visibleItems[d],$=0;$<2;++$)for(var m=0;m<4;++m){var y=(8*d+4*$+m)*22;$%2==0?(h[y]=v.spriteColor[0]*v.spriteIntensity,h[y+1]=v.spriteColor[1]*v.spriteIntensity,h[y+2]=v.spriteColor[2]*v.spriteIntensity,h[y+3]=v.spriteColor[3],h[y+16]=v.spriteScale[0],h[y+17]=1,h[y+18]=1):(h[y]=v.flareColor[0]*v.flareIntensity,h[y+1]=v.flareColor[1]*v.flareIntensity,h[y+2]=v.flareColor[2]*v.flareIntensity,h[y+3]=v.flareColor[3],h[y+16]=1,h[y+17]=v.spriteScale[1],h[y+18]=v.spriteScale[2]),h[y+4]=v.transform[0],h[y+5]=v.transform[4],h[y+6]=v.transform[8],h[y+7]=v.transform[12],h[y+8]=v.transform[1],h[y+9]=v.transform[5],h[y+10]=v.transform[9],h[y+11]=v.transform[13],h[y+12]=v.transform[2],h[y+13]=v.transform[6],h[y+14]=v.transform[10],h[y+15]=v.transform[14],h[y+19]=4*$+p[m],h[y+20]=v.boneIndex,h[y+21]=v.boosterGainInfluence?255:0}this._spriteVertexBuffer=n.gl.createBuffer(),n.gl.bindBuffer(n.gl.ARRAY_BUFFER,this._spriteVertexBuffer),n.gl.bufferData(n.gl.ARRAY_BUFFER,h,n.gl.STATIC_DRAW),this._spriteVertexBuffer.count=12*r;for(var g=new Uint16Array(24*r),_=0;_<4*r;++_){var b=6*_,E=4*_;g[b]=E,g[b+1]=E+1,g[b+2]=E+2,g[b+3]=E+2,g[b+4]=E+3,g[b+5]=E}this._indexBuffer=n.gl.createBuffer(),n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),n.gl.bufferData(n.gl.ELEMENT_ARRAY_BUFFER,g,n.gl.STATIC_DRAW),n.gl.bindBuffer(n.gl.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=r}}},{key:"GetBatches",value:function e(t,r,n){if(this.display&&t===a.device.RM_ADDITIVE&&this._indexBuffer&&this._indexBuffer.count){var i=new c;i.renderMode=a.device.RM_ADDITIVE,i.spotlightSet=this,i.perObjectData=n,r.Commit(i)}}},{key:"RenderCones",value:function e(r){return t.Render(this,this.coneEffect,r,this._coneVertexBuffer)}},{key:"RenderGlow",value:function e(r){return t.Render(this,this.glowEffect,r,this._spriteVertexBuffer)}},{key:"spotlightItems",get:function e(){return this.items},set:function e(t){this.items=t}}],[{key:"Render",value:function e(t,r,n,i){if(!r||!r.IsGood()||!i)return!1;a.device.SetStandardStates(a.device.RM_ADDITIVE),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,i),a.device.gl.bindBuffer(a.device.gl.ELEMENT_ARRAY_BUFFER,t._indexBuffer);for(var o=0;o<r.GetPassCount(n);++o){if(r.ApplyPass(n,o),!t._decl.SetDeclaration(r.GetPassInput(n,o),88))return!1;a.device.ApplyShadowState(),a.device.gl.drawElements(a.device.gl.TRIANGLES,i.count,a.device.gl.UNSIGNED_SHORT,0)}return!0}}]),t}(o.EveObjectSet)).Item=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpriteSet=t.EveSpriteSetItem=t.EveSpriteSetBatch=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(10);function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function l(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c=t.EveSpriteSetBatch=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.boosterGlow=!1,e.spriteSet=null,e.world=null,e.boosterGain=0,e.warpIntensity=0,e}return l(t,e),n(t,[{key:"Commit",value:function e(t){this.boosterGlow?this.spriteSet.RenderBoosterGlow(t,this.world,this.boosterGain,this.warpIntensity):this.spriteSet.Render(t,this.world,this.perObjectData)}}]),t}(a.Tw2RenderBatch),f=t.EveSpriteSetItem=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.position=i.vec3.create(),e.blinkRate=0,e.blinkPhase=0,e.minScale=1,e.maxScale=1,e.falloff=0,e.color=i.vec4.create(),e.warpColor=i.vec4.create(),e.boneIndex=0,e.groupIndex=-1,e}return l(t,e),n(t,null,[{key:"create",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new this;return i.util.assignIfExists(r,t,["name","display","blinkRate","blinkPhase","minScale","maxScale","falloff","boneIndex","groupIndex","position","color","warpColor"]),r}}]),t}(o.EveObjectSetItem);(t.EveSpriteSet=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];s(this,t);var n=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.effect=null,n.useQuads=null,n.isSkinned=null,n._time=0,n._vertexBuffer=null,n._indexBuffer=null,n._instanceBuffer=null,n._decl=n._decl=new a.Tw2VertexDeclaration,n._vdecl=new a.Tw2VertexDeclaration,n._vdecl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,5,a.device.gl.FLOAT,1,0)),n._vdecl.RebuildHash(),n.UseQuads(e,r),n}return l(t,e),n(t,[{key:"UseQuads",value:function e(t,r){this.useQuads!==t&&(this.useQuads=t,this.isSkinned=r,this._decl.elements.splice(0,this._decl.elements.length),t?(this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.POSITION,0,a.device.gl.FLOAT,3,0)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,0,a.device.gl.FLOAT,4,12)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,1,a.device.gl.FLOAT,2,28)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.COLOR,0,a.device.gl.FLOAT,4,36)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.COLOR,1,a.device.gl.FLOAT,4,52))):(this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,5,a.device.gl.FLOAT,2,0)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.POSITION,0,a.device.gl.FLOAT,3,8)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.COLOR,0,a.device.gl.FLOAT,3,20)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,0,a.device.gl.FLOAT,1,32)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,1,a.device.gl.FLOAT,1,36)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,2,a.device.gl.FLOAT,1,40)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,3,a.device.gl.FLOAT,1,44)),this._decl.elements.push(new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,4,a.device.gl.FLOAT,1,48))),this._decl.RebuildHash(),this._rebuildPending=!0)}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.effect&&this.effect.GetResources(t),t}},{key:"Update",value:function e(t){this._time+=t,this._rebuildPending&&this.Rebuild()}},{key:"Unload",value:function e(){this._vertexBuffer&&(a.device.gl.deleteBuffer(this._vertexBuffer),this._vertexBuffer=null),this._indexBuffer&&(a.device.gl.deleteBuffer(this._indexBuffer),this._indexBuffer=null),this._instanceBuffer&&(a.device.gl.deleteBuffer(this._instanceBuffer),this._instanceBuffer=null)}},{key:"Rebuild",value:function e(){this.constructor.RebuildItems(this),this._rebuildPending=!1;var t=this._visibleItems.length;if(t){var r=a.device;if(this.useQuads){this._vertexBuffer=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,this._vertexBuffer),r.gl.bufferData(r.gl.ARRAY_BUFFER,new Float32Array([0,1,2,2,3,0]),r.gl.STATIC_DRAW),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,null),this._instanceBuffer=r.gl.createBuffer();return}for(var n=new Float32Array(4*t*13),i=0;i<t;++i){var o=this._visibleItems[i],s=4*i*13;n[s]=0,n[s+13]=1,n[s+26]=2,n[s+39]=3;for(var u=0;u<4;++u){var l=s+13*u;n[l+1]=o.boneIndex,n[l+2]=o.position[0],n[l+3]=o.position[1],n[l+4]=o.position[2],n[l+5]=o.color[0],n[l+6]=o.color[1],n[l+7]=o.color[2],n[l+8]=o.blinkPhase,n[l+9]=o.blinkRate,n[l+10]=o.minScale,n[l+11]=o.maxScale,n[l+12]=o.falloff}}this._vertexBuffer=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,this._vertexBuffer),r.gl.bufferData(r.gl.ARRAY_BUFFER,n,r.gl.STATIC_DRAW),r.gl.bindBuffer(r.gl.ARRAY_BUFFER,null);for(var c=new Uint16Array(6*t),f=0;f<t;++f){var h=6*f,p=4*f;c[h]=p,c[h+1]=p+2,c[h+2]=p+1,c[h+3]=p,c[h+4]=p+3,c[h+5]=p+2}this._indexBuffer=r.gl.createBuffer(),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer),r.gl.bufferData(r.gl.ELEMENT_ARRAY_BUFFER,c,r.gl.STATIC_DRAW),r.gl.bindBuffer(r.gl.ELEMENT_ARRAY_BUFFER,null),this._indexBuffer.count=6*t}}},{key:"GetBatches",value:function e(t,r,n,i){if(this.display&&t===a.device.RM_ADDITIVE&&this._vertexBuffer&&this._visibleItems.length){var o=new c;o.world=i,o.renderMode=a.device.RM_ADDITIVE,o.spriteSet=this,o.perObjectData=n,r.Commit(o)}}},{key:"GetBoosterGlowBatches",value:function e(t,r,n,i,o,s){if(this.display&&t===a.device.RM_ADDITIVE&&this._vertexBuffer&&this._visibleItems.length){var u=new c;u.boosterGlow=!0,u.world=i,u.boosterGain=o,u.warpIntensity=s,u.renderMode=a.device.RM_ADDITIVE,u.spriteSet=this,u.perObjectData=n,r.Commit(u)}}},{key:"Render",value:function e(t,r,n){if(this.useQuads)return this.RenderQuads(t,r,n);if(!this.effect||!this.effect.IsGood()||!this._indexBuffer)return!1;a.device.SetStandardStates(a.device.RM_ADDITIVE),a.device.gl.bindBuffer(a.device.gl.ARRAY_BUFFER,this._vertexBuffer),a.device.gl.bindBuffer(a.device.gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer);for(var i=0;i<this.effect.GetPassCount(t);++i){if(this.effect.ApplyPass(t,i),!this._decl.SetDeclaration(this.effect.GetPassInput(t,i),52))return!1;a.device.ApplyShadowState(),a.device.gl.drawElements(a.device.gl.TRIANGLES,this._indexBuffer.count,a.device.gl.UNSIGNED_SHORT,0)}return!0}},{key:"RenderBoosterGlow",value:function e(t,r,n,s){if(!this.effect||!this.effect.IsGood()||!this._instanceBuffer)return!1;var u=a.device,l=o.EveObjectSet.global.vec3_0,c=this._visibleItems.length,f=new Float32Array(17*c);u.SetStandardStates(u.RM_ADDITIVE);for(var h=0,p=0;p<c;++p){var d=this._visibleItems[p];i.vec3.transformMat4(l,d.position,r),f[h++]=l[0],f[h++]=l[1],f[h++]=l[2],f[h++]=r[8],f[h++]=d.blinkPhase,f[h++]=r[9],f[h++]=d.minScale,f[h++]=d.maxScale,f[h++]=r[10],f[h++]=d.color[0],f[h++]=d.color[1],f[h++]=d.color[2],f[h++]=n,f[h++]=d.warpColor[0],f[h++]=d.warpColor[1],f[h++]=d.warpColor[2],f[h++]=s}u.gl.bindBuffer(u.gl.ARRAY_BUFFER,this._instanceBuffer),u.gl.bufferData(u.gl.ARRAY_BUFFER,f,u.gl.DYNAMIC_DRAW);for(var v=0;v<this.effect.GetPassCount(t);++v){this.effect.ApplyPass(t,v);var $=this.effect.GetPassInput(t,v);u.gl.bindBuffer(u.gl.ARRAY_BUFFER,this._vertexBuffer),this._vdecl.SetPartialDeclaration($,4),u.gl.bindBuffer(u.gl.ARRAY_BUFFER,this._instanceBuffer);var m=this._decl.SetPartialDeclaration($,68,0,1);u.ApplyShadowState(),u.ext.drawArraysInstanced(u.gl.TRIANGLES,0,6,c),this._decl.ResetInstanceDivisors(m)}return!0}},{key:"RenderQuads",value:function e(t,r,n){if(!this.effect||!this.effect.IsGood()||!this._instanceBuffer)return!1;var s=a.device,u=this._visibleItems.length,l=new Float32Array(17*u),c=o.EveObjectSet.global.vec3_0,f=n.perObjectVSData.Get("JointMat");s.SetStandardStates(s.RM_ADDITIVE);for(var h=0,p=0;p<u;++p){var d=this._visibleItems[p];if(this.isSkinned){var v=12*d.boneIndex;c[0]=f[v]*d.position[0]+f[v+1]*d.position[1]+f[v+2]*d.position[2]+f[v+3],c[1]=f[v+4]*d.position[0]+f[v+5]*d.position[1]+f[v+6]*d.position[2]+f[v+7],c[2]=f[v+8]*d.position[0]+f[v+9]*d.position[1]+f[v+10]*d.position[2]+f[v+11],i.vec3.transformMat4(c,c,r)}else i.vec3.transformMat4(c,d.position,r);l[h++]=c[0],l[h++]=c[1],l[h++]=c[2],l[h++]=1,l[h++]=d.blinkPhase,l[h++]=d.blinkRate,l[h++]=d.minScale,l[h++]=d.maxScale,l[h++]=d.falloff,l[h++]=d.color[0],l[h++]=d.color[1],l[h++]=d.color[2],l[h++]=1,l[h++]=d.warpColor[0],l[h++]=d.warpColor[1],l[h++]=d.warpColor[2],l[h++]=1}s.gl.bindBuffer(s.gl.ARRAY_BUFFER,this._instanceBuffer),s.gl.bufferData(s.gl.ARRAY_BUFFER,l,s.gl.DYNAMIC_DRAW);for(var $=0;$<this.effect.GetPassCount(t);++$){this.effect.ApplyPass(t,$);var m=this.effect.GetPassInput(t,$);s.gl.bindBuffer(s.gl.ARRAY_BUFFER,this._vertexBuffer),this._vdecl.SetPartialDeclaration(m,4),s.gl.bindBuffer(s.gl.ARRAY_BUFFER,this._instanceBuffer);var y=this._decl.SetPartialDeclaration(m,68,0,1);s.ApplyShadowState(),s.ext.drawArraysInstanced(s.gl.TRIANGLES,0,6,u),this._decl.ResetInstanceDivisors(y)}return!0}},{key:"sprites",get:function e(){return this.items},set:function e(t){this.items=t}}]),t}(o.EveObjectSet)).Item=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveTurretSet=t.EveTurretSetItem=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=r(10);function s(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&("object"==typeof t||"function"==typeof t)?t:e}function l(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var c,f,h=t.EveTurretSetItem=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.bone=null,e.locatorName=null,e.updateFromLocator=!1,e.canFireWhenHidden=!1,e.position=i.vec3.create(),e.rotation=i.quat.create(),e._localTransform=i.mat4.create(),e._localRotation=i.quat.create(),e}return l(t,e),n(t,[{key:"UpdateTransforms",value:function e(){i.mat4.fromRotationTranslation(this._localTransform,this.rotation,this.position),this.bone?(i.mat4.multiply(this._localTransform,this.bone.offsetTransform,this._localTransform),i.mat4.getRotation(this._localRotation,this._localTransform)):i.quat.copy(this._localRotation,this.rotation)}}],[{key:"create",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new this;return i.util.assignIfExists(r,t,["name","display","locatorName","updateFromLocator","position","rotation","bone","canFireWhenHidden"]),r.UpdateTransforms(),r}}]),t}(o.EveObjectSetItem),p=t.EveTurretSet=function(e){function t(){s(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.visible={},e.visible.turrets=!0,e.visible.firingEffects=!0,e.activeAnimation=new a.Tw2AnimationController,e.inactiveAnimation=new a.Tw2AnimationController,e.geometryResPath="",e.geometryResource=null,e.turretEffect=null,e.firingEffectResPath="",e.firingEffect=null,e.fireCallback=null,e.fireCallbackPending=!1,e.state=t.State.IDLE,e.bottomClipHeight=0,e.locatorName="",e.sysBoneHeight=0,e.hasCyclingFiringPos=!1,e.targetPosition=i.vec3.create(),e.parentMatrix=i.mat4.create(),e.boundingSphere=i.quat.create(),e._activeTurret=-1,e._recheckTimeLeft=0,e._currentCyclingFiresPos=0,e._perObjectDataActive=new a.Tw2PerObjectData,e._perObjectDataActive.perObjectVSData=new a.Tw2RawData,e._perObjectDataActive.perObjectVSData.Declare("baseCutoffData",4),e._perObjectDataActive.perObjectVSData.Declare("turretSetData",4),e._perObjectDataActive.perObjectVSData.Declare("shipMatrix",16),e._perObjectDataActive.perObjectVSData.Declare("turretTranslation",96),e._perObjectDataActive.perObjectVSData.Declare("turretRotation",96),e._perObjectDataActive.perObjectVSData.Declare("turretPoseTransAndRot",576),e._perObjectDataActive.perObjectVSData.Create(),e._perObjectDataInactive=new a.Tw2PerObjectData,e._perObjectDataInactive.perObjectVSData=new a.Tw2RawData,e._perObjectDataInactive.perObjectVSData.Declare("baseCutoffData",4),e._perObjectDataInactive.perObjectVSData.Declare("turretSetData",4),e._perObjectDataInactive.perObjectVSData.Declare("shipMatrix",16),e._perObjectDataInactive.perObjectVSData.Declare("turretTranslation",96),e._perObjectDataInactive.perObjectVSData.Declare("turretRotation",96),e._perObjectDataInactive.perObjectVSData.Declare("turretPoseTransAndRot",576),e._perObjectDataInactive.perObjectVSData.Create(),e._locatorRebuildPending=!0,e}return l(t,e),n(t,[{key:"Initialize",value:function e(){var t=this;this.turretEffect&&""!==this.geometryResPath&&(this.geometryResource=a.resMan.GetResource(this.geometryResPath),this.activeAnimation.SetGeometryResource(this.geometryResource),this.inactiveAnimation.SetGeometryResource(this.geometryResource),this.geometryResource&&this.geometryResource.RegisterNotification(this)),""!==this.firingEffectResPath&&a.resMan.GetObject(this.firingEffectResPath,function(e){return t.firingEffect=e}),this.Rebuild()}},{key:"InitializeFiringEffect",value:function e(){if(this.firingEffect&&this.geometryResource&&this.geometryResource.models.length)for(var r=this.geometryResource.models[0],n=0;n<this.firingEffect.GetPerMuzzleEffectCount();++n)this.firingEffect.SetMuzzleBoneID(n,r.FindBoneByName(t.positionBoneSkeletonNames[n]))}},{key:"GetClosestTurret",value:function e(){for(var r=-1,n=-2,a=t.global,o=a.vec3_0,s=a.vec4_0,u=a.vec4_1,l=0;l<this.items.length;++l){var c=this.items[l];if(c.display||c.canFireWhenHidden){u[0]=c._localTransform[12],u[1]=c._localTransform[13],u[2]=c._localTransform[14],u[3]=1,i.vec4.transformMat4(u,u,this.parentMatrix),i.vec3.subtract(o,this.targetPosition,u),i.vec3.normalize(o,o),i.vec4.set(s,0,1,0,0),i.vec4.transformMat4(s,s,c._localTransform),i.vec4.transformMat4(s,s,this.parentMatrix);var f=i.vec3.dot(s,o);f>n&&(r=this.items.indexOf(c),n=f)}}return r}},{key:"EnterStateDeactive",value:function e(){var r=this;this.state!==t.State.INACTIVE&&this.state!==t.State.PACKING&&(this.turretEffect?(this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.activeAnimation.PlayAnimation("Pack",!1,function(){r.state=t.State.INACTIVE,r.activeAnimation.PlayAnimation("Inactive",!0)}),this.inactiveAnimation.PlayAnimation("Pack",!1,function(){r.state=t.State.INACTIVE,r.inactiveAnimation.PlayAnimation("Inactive",!0)}),this.state=t.State.PACKING):this.state=t.State.INACTIVE,this._activeTurret=-1,this.firingEffect&&this.firingEffect.StopFiring())}},{key:"EnterStateIdle",value:function e(){var r=this;this.state!==t.State.IDLE&&this.state!==t.State.UNPACKING&&(this.turretEffect?(this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.state===t.State.FIRING?(this.activeAnimation.PlayAnimation("Active",!0),this.inactiveAnimation.PlayAnimation("Active",!0)):(this.activeAnimation.PlayAnimation("Deploy",!1,function(){r.state=t.State.IDLE,r.activeAnimation.PlayAnimation("Active",!0)}),this.inactiveAnimation.PlayAnimation("Deploy",!1,function(){r.state=t.State.IDLE,r.inactiveAnimation.PlayAnimation("Active",!0)})),this.state=t.State.UNPACKING):this.state=t.State.IDLE,this._activeTurret=-1,this.firingEffect&&this.firingEffect.StopFiring())}},{key:"EnterStateFiring",value:function e(){var r=this;if(!this.turretEffect||this.state===t.State.FIRING){t.DoStartFiring(this),this.turretEffect&&this.activeAnimation.PlayAnimation("Fire",!1,function(){r.activeAnimation.PlayAnimation("Active",!0)});return}this.activeAnimation.StopAllAnimations(),this.inactiveAnimation.StopAllAnimations(),this.state===t.State.INACTIVE?(this.activeAnimation.PlayAnimation("Deploy",!1,function(){t.DoStartFiring(r),r.activeAnimation.PlayAnimation("Fire",!1,function(){r.activeAnimation.PlayAnimation("Active",!0)})}),this.inactiveAnimation.PlayAnimation("Deploy",!1,function(){r.inactiveAnimation.PlayAnimation("Active",!0)}),this.state=t.State.UNPACKING):(t.DoStartFiring(this),this.activeAnimation.PlayAnimation("Fire",!1,function(){r.activeAnimation.PlayAnimation("Active",!0)}),this.inactiveAnimation.PlayAnimation("Active",!0))}},{key:"RebuildCachedData",value:function e(){for(var r=new a.Tw2VertexElement(a.Tw2VertexDeclaration.Type.TEXCOORD,1,a.device.gl.FLOAT,2),n=this.geometryResource.meshes,i=this.activeAnimation,o=this.inactiveAnimation,s=0;s<n.length;++s)n[s].declaration.elements.push(r),n[s].declaration.RebuildHash();switch(this.state){case t.State.INACTIVE:i.PlayAnimation("Inactive",!0),o.PlayAnimation("Inactive",!0);break;case t.State.IDLE:i.PlayAnimation("Active",!0),o.PlayAnimation("Active",!0);break;case t.State.FIRING:i.PlayAnimation("Fire",!1,function(){return i.PlayAnimation("Active",!0)}),o.PlayAnimation("Active",!0);break;case t.State.PACKING:this.EnterStateIdle();break;case t.State.UNPACKING:this.EnterStateDeactive()}}},{key:"FindItemByLocatorName",value:function e(t){for(var r=0;r<this.items.length;r++)if(this.items[r].locatorName===t)return this.items[r];return null}},{key:"UpdateItemsFromLocators",value:function e(r){for(var n=t.global,a=Array.from(this.items),o=n.mat4_0,s=0;s<r.length;s++){var u=r[s],l=u.name,c=u.transform,f=u.bone,h=void 0===f?null:f,p=this.FindItemByLocatorName(l);p?a.splice(a.indexOf(p),1):p=this.CreateItem({name:l,locatorName:l,updateFromLocator:!0}),p.updateFromLocator&&(p.bone=h,i.mat4.copy(o,c),i.vec3.normalize(o.subarray(0,3),o.subarray(0,3)),i.vec3.normalize(o.subarray(4,7),o.subarray(4,7)),i.vec3.normalize(o.subarray(8,11),o.subarray(8,11)),i.mat4.getRotation(p.rotation,o),i.mat4.getTranslation(p.position,o),p.OnValueChanged())}for(var d=0;d<a.length;d++)a[d].locatorName&&(this.RemoveItem(a[d]),d--);this._locatorRebuildPending=!1,this._rebuildPending&&this.Rebuild()}},{key:"RebuildItemsFromLocators",value:function e(){this._locatorRebuildPending=!0}},{key:"GetResources",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.geometryResource&&!t.includes(this.geometryResource)&&t.push(this.geometryResource),this.turretEffect&&this.turretEffect.GetResources(t),this.firingEffect&&this.firingEffect.GetResources(t),t}},{key:"UpdateViewDependentData",value:function e(){this.firingEffect&&this.firingEffect.UpdateViewDependentData()}},{key:"Update",value:function e(r,n){if(this._rebuildPending&&this.Rebuild(),this.turretEffect&&(this.activeAnimation.Update(r),this.inactiveAnimation.Update(r)),i.mat4.copy(this.parentMatrix,n),this.firingEffect&&this._visibleItems.length){if(-1!==this._activeTurret){this.firingEffect.isLoopFiring&&this.state===t.State.FIRING&&(this._recheckTimeLeft-=r,this._recheckTimeLeft<=0&&t.DoStartFiring(this));var a=this.items[this._activeTurret];if(this.activeAnimation.models.length)for(var o=this.activeAnimation.models[0].bonesByName,s=0;s<this.firingEffect.GetPerMuzzleEffectCount();++s){var u=o[t.positionBoneSkeletonNames[s]].worldTransform,l=this.firingEffect.GetMuzzleTransform(s);i.mat4.multiply(l,a._localTransform,u),i.mat4.multiply(l,l,n)}else for(var c=0;c<this.firingEffect.GetPerMuzzleEffectCount();++c)i.mat4.multiply(this.firingEffect.GetMuzzleTransform(c),n,a._localTransform);if(this.fireCallbackPending){if(this.fireCallback){for(var f=[],h=0;h<this.firingEffect.GetPerMuzzleEffectCount();++h)f.push(this.firingEffect.GetMuzzleTransform(h));this.fireCallback(this,f)}this.fireCallbackPending=!1}}i.vec3.copy(this.firingEffect.endPosition,this.targetPosition),this.firingEffect.Update(r)}}},{key:"GetBatches",value:function e(r,n,i,o){if(this.turretEffect&&this.geometryResource&&this.display&&this._visibleItems.length){if(r===a.device.RM_OPAQUE&&this.visible.turrets){var s=this.inactiveAnimation.GetBoneMatrices(0);if(0!==s.length){t.UpdatePerObjectData(this,this._perObjectDataInactive.perObjectVSData,s),this._perObjectDataInactive.perObjectPSData=i.perObjectPSData;var u=new a.Tw2ForwardingRenderBatch;if(u.renderMode=r,u.renderActive=!1,u.perObjectData=this._perObjectDataInactive,u.geometryProvider=this,n.Commit(u),this.state===t.State.FIRING){var l=this.activeAnimation.GetBoneMatrices(0);if(0!==l.length){t.UpdatePerObjectData(this,this._perObjectDataActive.perObjectVSData,l,!0),this._perObjectDataActive.perObjectPSData=i.perObjectPSData;var c=new a.Tw2ForwardingRenderBatch;c.renderActive=!0,c.perObjectData=this._perObjectDataActive,c.geometryProvider=this,n.Commit(c)}}}}this.GetFiringEffectBatches(r,n,i,o)}}},{key:"GetFiringEffectBatches",value:function e(t,r,n,i){this.firingEffect&&this.display&&this._visibleItems.length&&this.visible.firingEffects&&!i&&this.firingEffect.GetBatches(t,r,n)}},{key:"Render",value:function e(r,n){if(!this.turretEffect||!this.turretEffect.IsGood()||!this._visibleItems.length)return!1;for(var i=0,o=function e(t){a.device.gl.disableVertexAttribArray(t.location),a.device.gl.vertexAttrib2f(t.location,i,i)},s=0;s<this.geometryResource.meshes.length;++s)this.geometryResource.meshes[s].declaration.FindUsage(a.Tw2VertexDeclaration.Type.TEXCOORD,1).customSetter=o;for(var u=0;i<this.items.length;++i)if(this.items[i].display){var l=this.state===t.State.FIRING&&i===this._activeTurret;r.renderActive===l&&(this.geometryResource.RenderAreas(0,0,1,this.turretEffect,n),u++)}return!!u}},{key:"turrets",get:function e(){return this.items},set:function e(t){this.items=t}}],[{key:"RebuildItems",value:function e(t){t._visibleItems=[];for(var r=0;r<t.items.length;r++){var n=t.items[r];n._onModified=t._onChildModified,n.display&&(t._visibleItems.push(n),n._rebuildPending&&(n.UpdateTransforms(),n._rebuildPending=!1))}}},{key:"UpdatePerObjectData",value:function e(r,n,a,o){i.mat4.transpose(n.Get("shipMatrix"),r.parentMatrix);var s=a.length/12;n.Get("turretSetData")[0]=s,n.Get("baseCutoffData")[0]=r.bottomClipHeight;for(var u=n.Get("turretTranslation"),l=n.Get("turretRotation"),c=n.Get("turretPoseTransAndRot"),f=0;f<r._visibleItems.length;++f){for(var h=r._visibleItems[f],p=0;p<s;++p)c[(f*s+p)*8]=a[12*p+3],c[(f*s+p)*8+1]=a[12*p+7],c[(f*s+p)*8+2]=a[12*p+11],c[(f*s+p)*8+3]=1,t.mat3x4toquat(a,p,c,(f*s+p)*2+1);h.bone&&!o&&h.UpdateTransforms(),u[4*f]=h._localTransform[12],u[4*f+1]=h._localTransform[13],u[4*f+2]=h._localTransform[14],u[4*f+3]=1,l[4*f]=h.rotation[0],l[4*f+1]=h.rotation[1],l[4*f+2]=h.rotation[2],l[4*f+3]=h.rotation[3]}}},{key:"DoStartFiring",value:function e(r){r.hasCyclingFiringPos&&(r._currentCyclingFiresPos=1-r._currentCyclingFiresPos),r.firingEffect&&r.firingEffect.PrepareFiring(0,r.hasCyclingFiringPos?r._currentCyclingFiresPos:-1),r._activeTurret=r.GetClosestTurret(),r.state=t.State.FIRING,r._recheckTimeLeft=2,r.fireCallback&&(r.fireCallbackPending=!0)}}]),t}(o.EveObjectSet);p.mat3x4toquat=(c=void 0,f=void 0,function e(t,r,n,a){c||(c=i.mat4.create(),f=i.quat.create()),r*=12,a*=4,c[0]=t[r],c[1]=t[r+4],c[2]=t[r+8],c[3]=0,c[4]=t[r+1],c[5]=t[r+5],c[6]=t[r+9],c[7]=0,c[8]=t[r+2],c[9]=t[r+6],c[10]=t[r+10],c[11]=0,c[12]=t[r+3],c[13]=t[r+7],c[14]=t[r+11],c[15]=1,i.mat4.getRotation(f,c),n[a]=f[0],n[a+1]=f[1],n[a+2]=f[2],n[a+3]=f[3]}),p.Item=h,p.State={INACTIVE:0,IDLE:1,FIRING:2,PACKING:2,UNPACKING:4},p.worldNames=["turretWorld0","turretWorld1","turretWorld2"],p.positionBoneSkeletonNames=["Pos_Fire01","Pos_Fire02","Pos_Fire03","Pos_Fire04","Pos_Fire05","Pos_Fire06","Pos_Fire07","Pos_Fire08"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSpaceScene=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(0),a=r(1),o=t.EveSpaceScene=function(){function e(){var t=this;!function e(t,r){if(!(t instanceof r))throw TypeError("Cannot call a class as a function")}(this,e),this._id=i.util.generateID(),this.name="",this.display=!0,this.visible={},this.visible.lensflares=!0,this.visible.objects=!0,this.visible.planets=!0,this.visible.fog=!0,this.visible.clearColor=!0,this.visible.environmentReflection=!0,this.visible.environmentDiffuse=!0,this.visible.environmentBlur=!0,Object.defineProperty(this.visible,"environment",{get:function e(){return t.backgroundRenderingEnabled},set:function e(r){t.backgroundRenderingEnabled=r?1:0}}),this.lensflares=[],this.objects=[],this.planets=[],this.nebulaIntensity=1,this.ambientColor=i.quat.fromValues(.25,.25,.25,1),this.backgroundEffect=null,this.backgroundRenderingEnabled=1,this.clearColor=i.vec4.fromValues(0,0,0,0),this.lodEnabled=!1,this.fogStart=0,this.fogEnd=0,this.fogMax=0,this.fogType=0,this.fogBlur=0,this.fogColor=i.vec4.fromValues(.25,.25,.25,1),this.sunDirection=i.vec3.fromValues(1,-1,1),this.sunDiffuseColor=i.vec4.fromValues(1,1,1,1),this.envMapScaling=i.vec3.fromValues(1,1,1),this.envMapRotation=i.quat.create(),this.envMapResPath="",this.envMap1ResPath="",this.envMap2ResPath="",this.envMap3ResPath="",this.envMapRes=null,this.envMap1Res=null,this.envMap2Res=null,this.envMap3Res=null,this.renderDebugInfo=!1,this._debugHelper=null,this._batches=new a.Tw2BatchAccumulator,this._perFrameVS=new a.Tw2RawData,this._perFrameVS.Declare("ViewInverseTransposeMat",16),this._perFrameVS.Declare("ViewProjectionMat",16),this._perFrameVS.Declare("ViewMat",16),this._perFrameVS.Declare("ProjectionMat",16),this._perFrameVS.Declare("ShadowViewMat",16),this._perFrameVS.Declare("ShadowViewProjectionMat",16),this._perFrameVS.Declare("EnvMapRotationMat",16),this._perFrameVS.Declare("SunData.DirWorld",4),this._perFrameVS.Declare("SunData.DiffuseColor",4),this._perFrameVS.Declare("FogFactors",4),this._perFrameVS.Declare("TargetResolution",4),this._perFrameVS.Declare("ViewportAdjustment",4),this._perFrameVS.Declare("MiscSettings",4),this._perFrameVS.Create(),this._perFramePS=new a.Tw2RawData,this._perFramePS.Declare("ViewInverseTransposeMat",16),this._perFramePS.Declare("ViewMat",16),this._perFramePS.Declare("EnvMapRotationMat",16),this._perFramePS.Declare("SunData.DirWorld",4),this._perFramePS.Declare("SunData.DiffuseColor",4),this._perFramePS.Declare("SceneData.AmbientColor",3),this._perFramePS.Declare("SceneData.NebulaIntensity",1),this._perFramePS.Declare("SceneData.FogColor",4),this._perFramePS.Declare("ViewportOffset",2),this._perFramePS.Declare("ViewportSize",2),this._perFramePS.Declare("TargetResolution",4),this._perFramePS.Declare("ShadowMapSettings",4),this._perFramePS.Declare("ShadowCameraRange",4),this._perFramePS.Declare("ProjectionToView",2),this._perFramePS.Declare("FovXY",2),this._perFramePS.Declare("MiscSettings",4),this._perFramePS.Create(),e.init()}return n(e,[{key:"Initialize",value:function e(){this.SetEnvMapPath(0,this.envMapResPath),this.SetEnvMapPath(1,this.envMap1ResPath),this.SetEnvMapPath(2,this.envMap2ResPath),this.SetEnvMapPath(3,this.envMap3ResPath)}},{key:"SetEnvMapReflection",value:function e(t){this.SetEnvMapPath(0,t)}},{key:"SetEnvMapDiffuse",value:function e(t){this.SetEnvMapPath(1,t)}},{key:"SetEnvMapBlur",value:function e(t){this.SetEnvMapPath(2,t)}},{key:"SetEnvMapPath",value:function e(t,r){var n=this,i=function e(t,r,i){return t=t.toLowerCase(),n[r]=t,n[i]=""===t?null:a.resMan.GetResource(t),!0};switch(t){case 0:return i(r,"envMapResPath","envMapRes");case 1:return i(r,"envMap1ResPath","envMap1Res");case 2:return i(r,"envMap2ResPath","envMap2Res");case 3:return i(r,"envMap3ResPath","envMap3Res")}return!1}},{key:"EnableLod",value:function e(t){if(this.lodEnabled=t,!t)for(var r=0;r<this.objects.length;++r)this.objects[r].ResetLod&&this.objects[r].ResetLod()}},{key:"KeepAlive",value:function e(){for(var t=this.GetResources(),r=0;r<t.length;r++)t[r].KeepAlive()}},{key:"GetResources",value:function e(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1],n=0;n<this.lensflares.length;n++)this.lensflares[n].GetResources(t);if(this.backgroundEffect&&this.backgroundEffect.GetResources(t),this.envMapRes&&!t.includes(this.envMapRes)&&t.push(this.envMapRes),this.envMap1Res&&!t.includes(this.envMap1Res)&&t.push(this.envMapRes),this.envMap2Res&&!t.includes(this.envMap2Res)&&t.push(this.envMapRes),this.envMap3Res&&!t.includes(this.envMap3Res)&&t.push(this.envMapRes),!r){for(var i=0;i<this.planets.length;i++)this.planets[i].GetResources(t);for(var a=0;a<this.objects.length;a++)"GetResources"in this.objects[a]&&this.objects[a].GetResources(t)}return t}},{key:"Update",value:function e(t){for(var r=0;r<this.planets.length;++r)"Update"in this.planets[r]&&this.planets[r].Update(t);for(var n=0;n<this.objects.length;++n)"Update"in this.objects[n]&&this.objects[n].Update(t)}},{key:"RenderBatches",value:function e(t,r){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._batches,i=0;i<r.length;++i)"GetBatches"in r[i]&&r[i].GetBatches(t,n)}},{key:"Render",value:function t(){this.ApplyPerFrameData();var r=a.device,n=e.global,o=i.mat4.identity(n.mat4_ID),s=this.visible;if(s.environment&&this.backgroundEffect&&(r.SetStandardStates(r.RM_FULLSCREEN),r.RenderCameraSpaceQuad(this.backgroundEffect)),s.planets&&this.planets.length){var u=i.mat4.copy(n.mat4_0,r.projection),l=i.mat4.copy(n.mat4_1,r.projection);l[10]=1e11/(1e4-1e11),l[14]=1e15/(1e4-1e11),r.SetProjection(l,!0),this.ApplyPerFrameData();for(var c=0;c<this.planets.length;++c)this.planets[c].UpdateViewDependentData&&this.planets[c].UpdateViewDependentData(o);this._batches.Clear(),r.gl.depthRange(.9,1),this.RenderBatches(r.RM_OPAQUE,this.planets),this.RenderBatches(r.RM_DECAL,this.planets),this.RenderBatches(r.RM_TRANSPARENT,this.planets),this.RenderBatches(r.RM_ADDITIVE,this.planets),this._batches.Render(),r.SetProjection(u,!0),this.ApplyPerFrameData(),r.gl.depthRange(0,.9)}if(this.lodEnabled){n.frustum.Initialize(r.view,r.projection,r.viewportWidth,r.viewInverse,r.viewProjection);for(var f=0;f<this.objects.length;++f)this.objects[f].UpdateLod&&this.objects[f].UpdateLod(n.frustum)}if(s.objects)for(var h=0;h<this.objects.length;++h)this.objects[h].UpdateViewDependentData&&this.objects[h].UpdateViewDependentData(o);if(s.lensflares)for(var p=0;p<this.lensflares.length;++p)this.lensflares[p].PrepareRender();if(this._batches.Clear(),s.planets)for(var d=0;d<this.planets.length;++d)this.planets[d].GetZOnlyBatches(r.RM_OPAQUE,this._batches);if(s.objects&&(this.RenderBatches(r.RM_OPAQUE,this.objects),this.RenderBatches(r.RM_DECAL,this.objects),this.RenderBatches(r.RM_TRANSPARENT,this.objects),this.RenderBatches(r.RM_ADDITIVE,this.objects)),s.lensflares)for(var v=0;v<this.lensflares.length;++v)this.lensflares[v].GetBatches(r.RM_ADDITIVE,this._batches);if(this._batches.Render(),s.lensflares)for(var $=0;$<this.lensflares.length;++$)this.lensflares[$].UpdateOccluders();if(this.renderDebugInfo&&e.DebugRenderer){this._debugHelper||(this._debugHelper=new e.DebugRenderer);for(var m=0;m<this.objects.length;++m)this.objects[m].RenderDebugInfo&&this.objects[m].RenderDebugInfo(this._debugHelper);this._debugHelper.Render()}}},{key:"ApplyPerFrameData",value:function t(){var r=a.device,n=e.global,o=n.mat4_2,s=n.vec3_0,u=this.visible;i.mat4.fromQuat(o,this.envMapRotation),i.mat4.scale(o,o,this.envMapScaling),i.mat4.transpose(o,o),i.vec3.negate(s,this.sunDirection),i.vec3.normalize(s,s);var l=this.fogEnd-this.fogStart;1e-5>Math.abs(l)&&(l=1e-5);var c=1/l,f=this._perFrameVS;f.Set("FogFactors",[this.fogEnd*c,c,this.visible.fog?this.fogMax:0,1]),f.Set("ViewportAdjustment",[1,1,1,1]),f.Set("MiscSettings",[r.currentTime,0,r.viewportWidth,r.viewportHeight]),f.Set("SunData.DirWorld",s),f.Set("SunData.DiffuseColor",this.sunDiffuseColor),f.Set("TargetResolution",r.targetResolution),f.Set("ViewInverseTransposeMat",r.viewInverse),f.Set("ViewProjectionMat",r.viewProjectionTranspose),f.Set("ViewMat",r.viewTranspose),f.Set("ProjectionMat",r.projectionTranspose),f.Set("EnvMapRotationMat",o),r.perFrameVSData=f;var h=this._perFramePS;h.Set("ViewInverseTransposeMat",r.viewInverse),h.Set("ViewMat",r.viewTranspose),h.Set("EnvMapRotationMat",o),h.Set("SunData.DirWorld",s),h.Set("SunData.DiffuseColor",this.sunDiffuseColor),h.Set("SceneData.AmbientColor",this.ambientColor),h.Set("MiscSettings",[r.currentTime,this.fogType,this.fogBlur,1]),h.Set("SceneData.FogColor",this.fogColor),h.Set("FovXY",[r.targetResolution[3],r.targetResolution[2]]),h.Set("ShadowMapSettings",[1,1,0,0]),h.Set("TargetResolution",r.targetResolution),h.Get("SceneData.NebulaIntensity")[0]=this.nebulaIntensity,h.Get("ViewportSize")[0]=r.viewportWidth,h.Get("ViewportSize")[1]=r.viewportHeight,h.Get("ShadowCameraRange")[0]=1,h.Get("ProjectionToView")[0]=-r.projection[14],h.Get("ProjectionToView")[1]=-r.projection[10]-1,r.perFramePSData=h;var p=this.envMapRes&&u.environmentReflection?this.envMapRes:n.emptyTexture,d=this.envMap1Res&&u.environmentDiffuse?this.envMap1Res:n.emptyTexture,v=this.envMap2Res&&u.environmentBlur?this.envMap2Res:n.emptyTexture,$=this.envMap3Res?this.envMap3Res:n.emptyTexture;a.store.GetVariable("EveSpaceSceneEnvMap").SetTextureRes(p),a.store.GetVariable("EnvMap1").SetTextureRes(d),a.store.GetVariable("EnvMap2").SetTextureRes(v),a.store.GetVariable("EnvMap3").SetTextureRes($)}}],[{key:"init",value:function t(){e.global||(e.global={vec3_0:i.vec3.create(),vec4_0:i.vec4.create(),mat4_0:i.mat4.create(),mat4_1:i.mat4.create(),mat4_2:i.mat4.create(),mat4_ID:i.mat4.create(),frustum:new a.Tw2Frustum,emptyTexture:a.resMan.GetResource("res:/texture/global/black.dds.0.png")})}}]),e}();o.global=null,o.DebugRenderer="Tw2DebugRenderer"in window?window.Tw2DebugRenderer:null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EveSOF=function e(){var t=null,r=null;function l(e,t,r){return t in e?e[t]:r}function c(e){return e?l(t.generic,"shaderPrefixAnimated",""):l(t.generic,"shaderPrefix","")}function f(e,t,r,n,i){var a=null;if(l(n,"resPathInsert","").length&&(a=n.resPathInsert),"respathinsert"in i&&1===i.respathinsert.length){if("none"===i.respathinsert[0])return e;a=i.respathinsert[0]}if("MaterialMap"===t||"PaintMaskMap"===t||"PmdgMap"===t){var o=e.lastIndexOf("/"),s=e;if(o>=0&&(s=e.substr(0,o+1)+a+"/"+e.substr(o+1)),(o=s.lastIndexOf("_"))>=0){s=s.substr(0,o)+"_"+a+s.substr(o);var u=l(r,"textureOverrides",{});if(t in u&&n.name in u[t])return s}}return e}function h(e,t){var r=c(t),n=(e="/"+e).lastIndexOf("/");return e.substr(0,n+1)+r+e.substr(n+1)}function p(e,t){for(var r=0;r<e.length;++r)if(t.substr(0,e[r].length)===e[r])return r;return null}function d(e,r,n,i){var a,o,s,u;return"mesh"in n&&null!==(o=p(a=t.generic.materialPrefixes,e))&&o<n.mesh.length&&(l(r,"blockedMaterials",0)&1<<o)==0&&(s=l(t.material,n.mesh[o],null))?(u=e.substr(a[o].length),l(s.parameters,u,void 0)):(o=p(a=t.generic.patternMaterialPrefixes,e),"pattern"in n&&null!==o&&1+o<n.pattern.length&&(s=l(t.material,n.pattern[1+o],null))||null!==o&&(s=l(t.material,i.defaultPatternLayer1MaterialName,null)))?(u=e.substr(a[o].length),l(s.parameters,u,void 0)):void 0}function v(e){switch(e){case 2:return 4;case 1:return 3;default:return 1}}function $(e,r,n,a,o,s,u,c){for(var p=l(n,r,[]),$=0;$<p.length;++$){var m=p[$],y=new i.Tw2Effect;y.effectFilePath=t.generic.areaShaderLocation+h(c||m.shader,n.isSkinned);for(var g=l(l(t.generic.areaShaders,m.shader,{}),"parameters",[]),_=0;_<g.length;++_){var b=g[_],E=d(b,m,u,o);(E=(E=(E=(E=E||l(l(l(t.generic.hullAreas,m.name,{}),"parameters",{}),b))||l(l(l(o.hullAreas,m.name,{}),"parameters",{}),b))||l(l(l(a.areas,m.name,{}),"parameters",{}),b))||l(l(m,"parameters",{}),b))&&(y.parameters[b]=new i.Tw2Vector4Parameter(b,E))}var T=l(m,"textures",[]);for(_ in T)if(T.hasOwnProperty(_)){var S=T[_];S=f(S,_,m,a,u),y.parameters[_]=new i.Tw2TextureParameter(_,S)}for(_=0;_<s.layers.length;++_)if(s.layers[_]&&!(s.layers[_].textureName in y.parameters)){var R=new i.Tw2TextureParameter(s.layers[_].textureName);R.resourcePath=s.layers[_].textureResFilePath,R.useAllOverrides=!0,R.addressUMode=v(l(s.layers[_],"projectionTypeU",0)),R.addressVMode=v(l(s.layers[_],"projectionTypeV",0)),R.Initialize(),y.parameters[s.layers[_].textureName]=R}var w=l(l(t.generic.areaShaders,m.shader,{}),"defaultTextures",{});for(var P in w)!w.hasOwnProperty(P)||P in y.parameters||(y.parameters[P]=new i.Tw2TextureParameter(P,w[P]));y.Initialize();var A=new i.Tw2MeshArea;A.name=m.name,A.effect=y,A.index=l(m,"index",0),A.count=l(m,"count",1),e.push(A)}}function m(e,t,r){r in t&&(e[r]=t[r])}var y=!1,g=[];function _(e){for(var f=e.split(":"),h={},p=3;p<f.length;++p){var d=f[p].split("?");h[d[0]]=d[1].split(";")}var v,y,g,_,b,E,T,S=t.hull[f[0]],R=t.faction[f[1]],w=t.race[f[2]],P=new(2===l(S,"buildClass",0)?u.EveSpaceObject:u.EveShip),A=function e(r,n,i){var a={patterns:[],layers:[]};if("pattern"in i){for(var o={},s=0;s<t.pattern.length;++s)if(t.pattern[s].name===i.pattern[0]){o=t.pattern[s];break}var u=l(o,"layer1",null);u&&a.layers.push(u),(u=l(o,"layer2",null))&&a.layers.push(u);for(var c=l(o,"projections",[]),f=0;f<c.length;++f)c[f].name===r.name&&((u=l(o=c[f],"transformLayer1",null))&&a.patterns.push(u),(u=l(o,"transformLayer2",null))&&a.patterns.push(u))}else l(r,"defaultPattern")&&(o=l(r,"defaultPattern",{}),(u=l(o,"transformLayer1",null))&&a.patterns.push(u),(u=l(o,"transformLayer2",null))&&a.patterns.push(u),o=l(n,"defaultPattern",{}),(u=l(o,"layer1",null))&&a.layers.push(u),(u=l(o,"layer2",null))&&a.layers.push(u));return a}(S,w,h);v=P,y=S,g=R,_=w,b=h,E=A,(T=new i.Tw2Mesh).geometryResPath=y.geometryResFilePath,v.boundingSphereCenter[0]=y.boundingSphere[0],v.boundingSphereCenter[1]=y.boundingSphere[1],v.boundingSphereCenter[2]=y.boundingSphere[2],v.boundingSphereRadius=y.boundingSphere[3],$(l(T,"opaqueAreas",[]),"opaqueAreas",y,g,_,E,b),$(l(T,"transparentAreas",[]),"transparentAreas",y,g,_,E,b),$(l(T,"additiveAreas",[]),"additiveAreas",y,g,_,E,b),$(l(T,"decalAreas",[]),"decalAreas",y,g,_,E,b),$(l(T,"depthAreas",[]),"depthAreas",y,g,_,E,b),T.Initialize(),v.mesh=T,"shapeEllipsoidCenter"in y&&(v.shapeEllipsoidCenter=y.shapeEllipsoidCenter),"shapeEllipsoidRadius"in y&&(v.shapeEllipsoidRadius=y.shapeEllipsoidRadius),function e(t,r){for(var i=0;i<r.patterns.length;++i)if(r.patterns[i]&&r.layers[i]){var a=r.patterns[i],o=r.layers[i];t.AddCustomMask(l(a,"position",n.vec3.create()),l(a,"scaling",n.vec3.fromValues(1,1,1)),l(a,"rotation",n.quat.create()),l(a,"isMirrored",!1),l(o,"materialSource",0),n.vec4.fromValues(l(o,"isTargetMtl1",!0)?1:0,l(o,"isTargetMtl2",!0)?1:0,l(o,"isTargetMtl3",!0)?1:0,l(o,"isTargetMtl4",!0)?1:0))}}(P,A),function e(r,a,s){for(var u=l(a,"hullDecals",[]),f=0;f<u.length;++f){var h=u[f],p=null,d="group"+l(h,"groupIndex",-1);if(s.decals&&d in s.decals&&(p=s.decals[d]),!p||p.isVisible){var v=new i.Tw2Effect;if(p&&p.shader&&p.shader.length)v.effectFilePath=t.generic.decalShaderLocation+"/"+c(!1)+p.shader;else{if(!h.shader||!h.shader.length)continue;v.effectFilePath=t.generic.decalShaderLocation+"/"+c(!1)+h.shader}var $=l(h,"parameters",{});for(var m in $)$.hasOwnProperty(m)&&(v.parameters[m]=new i.Tw2Vector4Parameter(m,$[m]));var y=l(h,"textures",{});for(m in y)y.hasOwnProperty(m)&&(v.parameters[m]=new i.Tw2TextureParameter(m,y[m]));if(p){var g=l(p,"parameters",{});for(m in g)g.hasOwnProperty(m)&&(v.parameters[m]=new i.Tw2Vector4Parameter(m,g[m]));var _=l(p,"textures",{});for(m in _)!_.hasOwnProperty(m)||m in v.parameters||(v.parameters[m]=new i.Tw2TextureParameter(m,_[m]))}var b=l(l(t.generic.decalShaders,h.shader,{}),"defaultTextures",{});for(var E in b)!b.hasOwnProperty(E)||E in v.parameters||(v.parameters[E]=new i.Tw2TextureParameter(E,b[E]));v.Initialize();var T=new o.EveSpaceObjectDecal;n.vec3.copy(T.position,l(h,"position",[0,0,0])),n.quat.copy(T.rotation,l(h,"rotation",[0,0,0,1])),n.vec3.copy(T.scaling,l(h,"scaling",[1,1,1])),T.parentBoneIndex=l(h,"boneIndex",-1),T.indexBuffer=new Uint16Array(h.indexBuffer),T.decalEffect=v,T.name=l(u[f],"name",""),"groupIndex"in u[f]&&(T.groupIndex=u[f].groupIndex),T.Initialize(),r.decals.push(T)}}}(P,S,R),function e(t,i,a){for(var s=l(i,"spriteSets",[]),u=l(a,"spriteSets",{}),c=0;c<s.length;++c){var f=new o.EveSpriteSet(!0,!!(i.isSkinned&&s[c].skinned));f.name=l(s[c],"name",""),f.effect=r;for(var h=l(s[c],"items",[]),p=0;p<h.length;++p)if("group"+l(h[p],"groupIndex",-1) in u){var d=new o.EveSpriteSetItem;d.blinkPhase=l(h[p],"blinkPhase",0),d.blinkRate=l(h[p],"blinkRate",.1),d.boneIndex=l(h[p],"boneIndex",0),d.falloff=l(h[p],"falloff",0),d.maxScale=l(h[p],"maxScale",10),d.minScale=l(h[p],"minScale",1),d.name=l(h[p],"name",""),d.groupIndex=l(h[p],"groupIndex",-1),n.vec3.copy(d.position,l(h[p],"position",[0,0,0]));var v=u["group"+d.groupIndex];v&&(d.groupName=v.name,"color"in v&&n.vec4.copy(d.color,v.color)),f.sprites.push(d)}f.Initialize(),t.spriteSets.push(f)}}(P,S,R),function e(t,r,a){for(var s=l(r,"spotlightSets",[]),u=l(a,"spotlightSets",{}),c=0;c<s.length;++c){var f=new o.EveSpotlightSet;f.name=l(s[c],"name",""),f.coneEffect=new i.Tw2Effect,f.glowEffect=new i.Tw2Effect,s[c].skinned?(f.coneEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_spotlightcone.fx",f.glowEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_spotlightglow.fx"):(f.coneEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/spotlightcone.fx",f.glowEffect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/spotlightglow.fx"),f.coneEffect.parameters.TextureMap=new i.Tw2TextureParameter("TextureMap",s[c].coneTextureResPath),f.glowEffect.parameters.TextureMap=new i.Tw2TextureParameter("TextureMap",s[c].glowTextureResPath),f.coneEffect.parameters.zOffset=new i.Tw2FloatParameter("zOffset",l(s[c],"zOffset",0)),f.coneEffect.Initialize(),f.glowEffect.Initialize();for(var h=l(s[c],"items",[]),p=0;p<h.length;++p){var d=new o.EveSpotlightSetItem;d.name=l(h[p],"name",""),d.groupIndex=l(h[p],"groupIndex",-1),d.boneIndex=l(h[p],"boneIndex",0),d.boosterGainInfluence=l(h[p],"boosterGainInfluence",0),d.coneIntensity=l(h[p],"coneIntensity",0),d.spriteIntensity=l(h[p],"spriteIntensity",0),d.flareIntensity=l(h[p],"flareIntensity",0);var v=u["group"+d.groupIndex];v&&(n.vec4.copy(d.coneColor,l(v,"coneColor",[0,0,0,0])),n.vec4.copy(d.spriteColor,l(v,"spriteColor",[0,0,0,0])),n.vec4.copy(d.flareColor,l(v,"flareColor",[0,0,0,0]))),n.vec3.copy(d.spriteScale,l(h[p],"spriteScale",[1,1,1])),"transform"in h[p]?n.mat4.copy(d.transform,h[p].transform):n.mat4.identity(d.transform),f.spotlightItems.push(d)}f.Initialize(),t.spotlightSets.push(f)}}(P,S,R),function e(t,r,a){for(var s=l(r,"planeSets",[]),u=l(a,"planeSets",{}),c=0;c<s.length;++c){var f=new o.EvePlaneSet;f.name=l(s[c],"name",""),f.effect=new i.Tw2Effect,s[c].skinned?f.effect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/skinned_planeglow.fx":f.effect.effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/planeglow.fx",f.effect.parameters.Layer1Map=new i.Tw2TextureParameter("Layer1Map",s[c].layer1MapResPath),f.effect.parameters.Layer2Map=new i.Tw2TextureParameter("Layer2Map",s[c].layer2MapResPath),f.effect.parameters.MaskMap=new i.Tw2TextureParameter("MaskMap",s[c].maskMapResPath),f.effect.parameters.PlaneData=new i.Tw2Vector4Parameter("PlaneData",l(s[c],"planeData",[1,0,0,0])),f.effect.Initialize();for(var h=l(s[c],"items",[]),p=0;p<h.length;++p){var d=new o.EvePlaneSetItem;m(d,h[p],"groupIndex"),m(d,h[p],"name"),d.boneIndex=l(h[p],"boneIndex",-1),d.maskAtlasID=l(h[p],"maskMapAtlasIndex",0),n.vec3.copy(d.position,l(h[p],"position",[0,0,0])),n.quat.copy(d.rotation,l(h[p],"rotation",[0,0,0,1])),n.vec3.copy(d.scaling,l(h[p],"scaling",[1,1,1])),n.vec4.copy(d.color,l(h[p],"color",[0,0,0,0])),n.vec4.copy(d.layer1Transform,l(h[p],"layer1Transform",[0,0,0,0])),n.vec4.copy(d.layer1Scroll,l(h[p],"layer1Scroll",[0,0,0,0])),n.vec4.copy(d.layer2Transform,l(h[p],"layer2Transform",[0,0,0,0])),n.vec4.copy(d.layer2Scroll,l(h[p],"layer2Scroll",[0,0,0,0]));var v=u["group"+l(h[p],"groupIndex",-1)];v&&n.vec4.copy(d.color,l(v,"color",[0,0,0,0])),f.planes.push(d)}f.Initialize(),t.planeSets.push(f)}}(P,S,R),function e(t,r,a){if("booster"in r){var s=new o.EveBoosterSet,u=r.booster,c=l(a,"booster",{});m(s,c,"glowScale"),m(s,c,"symHaloScale"),m(s,c,"haloScaleX"),m(s,c,"haloScaleY"),m(s,c,"haloColor"),n.vec4.copy(s.glowColor,l(c,"glowColor",[0,0,0,0])),n.vec4.copy(s.warpGlowColor,l(c,"warpGlowColor",[0,0,0,0])),n.vec4.copy(s.warpHaloColor,l(c,"warpHalpColor",[0,0,0,0])),n.vec4.copy(s.trailColor,l(c,"trailColor",[0,0,0,0])),n.vec4.copy(s.trailSize,l(c,"trailSize",[0,0,0,0])),s.effect=new i.Tw2Effect,s.effect.effectFilePath="res:/Graphics/Effect/Managed/Space/Booster/BoosterVolumetric.fx",s.effect.parameters.NoiseFunction0=new i.Tw2FloatParameter("NoiseFunction0",l(c.shape0,"noiseFunction",0)),s.effect.parameters.NoiseSpeed0=new i.Tw2FloatParameter("NoiseSpeed0",l(c.shape0,"noiseSpeed",0)),s.effect.parameters.NoiseAmplitudeStart0=new i.Tw2Vector4Parameter("NoiseAmplitudeStart0",l(c.shape0,"noiseAmplitureStart",[0,0,0,0])),s.effect.parameters.NoiseAmplitudeEnd0=new i.Tw2Vector4Parameter("NoiseAmplitudeEnd0",l(c.shape0,"noiseAmplitureEnd",[0,0,0,0])),s.effect.parameters.NoiseFrequency0=new i.Tw2Vector4Parameter("NoiseFrequency0",l(c.shape0,"noiseFrequency",[0,0,0,0])),s.effect.parameters.Color0=new i.Tw2Vector4Parameter("Color0",l(c.shape0,"color",[0,0,0,0])),s.effect.parameters.NoiseFunction1=new i.Tw2FloatParameter("NoiseFunction1",l(c.shape1,"noiseFunction",0)),s.effect.parameters.NoiseSpeed1=new i.Tw2FloatParameter("NoiseSpeed1",l(c.shape1,"noiseSpeed",0)),s.effect.parameters.NoiseAmplitudeStart1=new i.Tw2Vector4Parameter("NoiseAmplitudeStart1",l(c.shape1,"noiseAmplitureStart",[0,0,0,0])),s.effect.parameters.NoiseAmplitudeEnd1=new i.Tw2Vector4Parameter("NoiseAmplitudeEnd1",l(c.shape1,"noiseAmplitureEnd",[0,0,0,0])),s.effect.parameters.NoiseFrequency1=new i.Tw2Vector4Parameter("NoiseFrequency1",l(c.shape1,"noiseFrequency",[0,0,0,0])),s.effect.parameters.Color1=new i.Tw2Vector4Parameter("Color1",l(c.shape1,"color",[0,0,0,0])),s.effect.parameters.WarpNoiseFunction0=new i.Tw2FloatParameter("WarpNoiseFunction0",l(c.warpShape0,"noiseFunction",0)),s.effect.parameters.WarpNoiseSpeed0=new i.Tw2FloatParameter("WarpNoiseSpeed0",l(c.warpShape0,"noiseSpeed",0)),s.effect.parameters.WarpNoiseAmplitudeStart0=new i.Tw2Vector4Parameter("WarpNoiseAmplitudeStart0",l(c.warpShape0,"noiseAmplitureStart",[0,0,0,0])),s.effect.parameters.WarpNoiseAmplitudeEnd0=new i.Tw2Vector4Parameter("WarpNoiseAmplitudeEnd0",l(c.warpShape0,"noiseAmplitureEnd",[0,0,0,0])),s.effect.parameters.WarpNoiseFrequency0=new i.Tw2Vector4Parameter("WarpNoiseFrequency0",l(c.warpShape0,"noiseFrequency",[0,0,0,0])),s.effect.parameters.WarpColor0=new i.Tw2Vector4Parameter("WarpColor0",l(c.warpShape0,"color",[0,0,0,0])),s.effect.parameters.WarpNoiseFunction1=new i.Tw2FloatParameter("WarpNoiseFunction1",l(c.warpShape1,"noiseFunction",0)),s.effect.parameters.WarpNoiseSpeed1=new i.Tw2FloatParameter("WarpNoiseSpeed1",l(c.warpShape1,"noiseSpeed",0)),s.effect.parameters.WarpNoiseAmplitudeStart1=new i.Tw2Vector4Parameter("WarpNoiseAmplitudeStart1",l(c.warpShape1,"noiseAmplitureStart",[0,0,0,0])),s.effect.parameters.WarpNoiseAmplitudeEnd1=new i.Tw2Vector4Parameter("WarpNoiseAmplitudeEnd1",l(c.warpShape1,"noiseAmplitureEnd",[0,0,0,0])),s.effect.parameters.WarpNoiseFrequency1=new i.Tw2Vector4Parameter("WarpNoiseFrequency1",l(c.warpShape1,"noiseFrequency",[0,0,0,0])),s.effect.parameters.WarpColor1=new i.Tw2Vector4Parameter("WarpColor1",l(c.warpShape1,"color",[0,0,0,0])),s.effect.parameters.ShapeAtlasSize=new i.Tw2Vector4Parameter("ShapeAtlasSize",[l(c,"shapeAtlasHeight",0),l(c,"shapeAtlasCount",0),0,0]),s.effect.parameters.BoosterScale=new i.Tw2Vector4Parameter("BoosterScale",l(c,"scale",[1,1,1,1])),s.effect.parameters.ShapeMap=new i.Tw2TextureParameter("ShapeMap",c.shapeAtlasResPath),s.effect.parameters.GradientMap0=new i.Tw2TextureParameter("GradientMap0",c.gradient0ResPath),s.effect.parameters.GradientMap1=new i.Tw2TextureParameter("GradientMap1",c.gradient1ResPath),s.effect.parameters.NoiseMap=new i.Tw2TextureParameter("ShapeMap","res:/Texture/Global/noise32cube_volume.dds.0.png"),s.effect.Initialize(),s.glows=new o.EveSpriteSet(!0),s.glows.effect=new i.Tw2Effect,s.glows.effect.effectFilePath="res:/Graphics/Effect/Managed/Space/Booster/BoosterGlowAnimated.fx",s.glows.effect.parameters.DiffuseMap=new i.Tw2TextureParameter("DiffuseMap","res:/Texture/Particle/whitesharp.dds.0.png"),s.glows.effect.parameters.NoiseMap=new i.Tw2TextureParameter("NoiseMap","res:/Texture/global/noise.dds.0.png"),s.glows.effect.Initialize();for(var f=l(u,"items",[]),h=0;h<f.length;++h){var p=new o.EveLocator;p.name="locator_booster_"+(h+1),"transform"in f[h]?n.mat4.copy(p.transform,f[h].transform):n.mat4.identity(p.transform),p.atlasIndex0=l(f[h],"atlasIndex0",0),p.atlasIndex1=l(f[h],"atlasIndex1",0),t.locators.push(p)}s.Initialize(),t.boosters=s}}(P,S,w),function e(t,r){for(var i=l(r,"locatorTurrets",[]),a=0;a<i.length;++a){var s=new o.EveLocator;s.name=i[a].name,"transform"in i[a]?n.mat4.copy(s.transform,i[a].transform):n.mat4.identity(s.transform),t.locators.push(s)}}(P,S);var D=function e(t,r){for(var n=[],o=null,s=l(r,"animations",[]),u=0;u<s.length;++u)if(-1!==l(s[u],"id",-1)&&-1!==l(s[u],"startRate",-1)){o||(o=new i.Tw2CurveSet);var c=new a.Tw2ScalarCurve2;c.keys.push(new a.Tw2ScalarKey2),c.keys.push(new a.Tw2ScalarKey2),c.keys[0].value=l(s[u],"startRate",-1),c.keys[1].time=1,c.keys[1].value=l(s[u],"endRate",-1),c.Initialize(),o.curves.push(c),t.curveSets.push(o),n[l(s[u],"id",-1)]=c}return o&&o.Initialize(),[o,n]}(P,S);return function e(t,r,a,o){function s(e){return function(r){r.isEffectChild?t.effectChildren.push(r):t.children.push(r),n.vec3.copy(r.translation,l(e,"translation",[0,0,0])),n.quat.copy(r.rotation,l(e,"rotation",[0,0,0,1])),n.vec3.copy(r.scaling,l(e,"scaling",[1,1,1]));var s=l(e,"id",-1);-1!==s&&o[s]&&function e(t,r,n){for(var a=0;a<t.particleEmitters.length;++a)if("rate"in t.particleEmitters[a]){var o=new i.Tw2ValueBinding;o.sourceObject=n,o.sourceAttribute="currentValue",o.destinationObject=t.particleEmitters[a],o.destinationAttribute="rate",o.Initialize(),r.bindings.push(o)}for(a=0;a<t.children.length;++a)e(t.children[a],r,n)}(r,a,o[s])}}for(var u=l(r,"children",[]),c=0;c<u.length;++c)i.resMan.GetObject(u[c].redFilePath,s(u[c]))}(P,S,D[0],D[1]),function e(t,r,n,a,o,u){for(var c=l(r,"instancedMeshes",[]),f=0;f<c.length;++f){var h=c[f],p=new i.Tw2InstancedMesh;p.instanceGeometryResPath=h.instanceGeometryResPath,p.geometryResPath=h.geometryResPath,p.Initialize(),$(l(p,"opaqueAreas",[]),"opaqueAreas",r,n,a,u,o,h.shader);var d=new s.EveChildMesh;d.mesh=p,t.effectChildren.push(d)}}(P,S,R,w,h,A),P.Initialize(),P}function b(e,r,n){for(var i=-1,a=0;a<t.generic.materialPrefixes.length;++a)e.substr(0,t.generic.materialPrefixes[a].length)===t.generic.materialPrefixes[a]&&(i=a,e=e.substr(t.generic.materialPrefixes[a].length));if(-1!==i){var o=l(r,"materialUsageMtl"+(i+1),i);if(o>=0&&o<t.generic.materialPrefixes.length&&(e=t.generic.materialPrefixes[o]+e)in n.parameters)return n.parameters[e]}}this.LoadData=function(e){null===t?(e&&g.push(e),y||((r=new i.Tw2Effect).effectFilePath="res:/graphics/effect/managed/space/spaceobject/fx/blinkinglightspool.fx",r.parameters.MainIntensity=new i.Tw2FloatParameter("MainIntensity",1),r.parameters.GradientMap=new i.Tw2TextureParameter("GradientMap","res:/texture/particle/whitesharp_gradient.dds.0.png"),r.Initialize(),i.resMan.GetObject("res:/dx9/model/spaceobjectfactory/data.red",function(e){t=e;for(var r=0;r<g.length;++r)g[r]();g=[]}),y=!0)):e&&e()},this.BuildFromDNA=function(e,r){if(null===t)this.LoadData(function(){var t=_(e);r&&r(t)});else{var n=_(e);r&&r(n)}};var E=[0,0,0,0];function T(e,t,r,n){switch(n){case"overridable":return t||r||E;case"half_overridable":if(e.indexOf("GlowColor")>=0)return r||E;return t||r||E;case"not_overridable":case"half_overridable_2":return r||E}return E}function S(e,r,a){var o=t.faction[r],s=t.faction[a],u=null;o&&o.areas&&"hull"in o.areas&&(u=o.areas.hull);var l=null;if(s&&s.areas&&"hull"in s.areas&&(l=s.areas.hull),(u||l)&&e.turretEffect){var c=e.turretEffect.parameters;for(var f in c)if(c.hasOwnProperty(f)){if(c[f].constructor.prototype!==i.Tw2Vector4Parameter.prototype)continue;var h=null,p=null;u&&(h=b(f,o,u)),l&&(p=b(f,o,u)),n.vec4.copy(c[f].value,T(f,h,p,e.turretEffect.name))}e.turretEffect.BindParameters()}}function R(e){if("all"===e)return t;var r={};for(var n in t[e])t[e].hasOwnProperty(n)&&(r[n]=t[e][n].description||"");return r}this.SetupTurretMaterial=function(e,r,n,i){null===t?this.LoadData(function(){S(e,r,n),i&&i()}):(S(e,r,n),i&&i())},this.GetHullNames=function(e){this.LoadData(function(){e(R("hull"))})},this.GetFactionNames=function(e){this.LoadData(function(){e(R("faction"))})},this.GetRaceNames=function(e){this.LoadData(function(){e(R("race"))})},this.GetSofData=function(e){this.LoadData(function(){e(R("all"))})}};var n=r(0),i=r(1),a=r(57),o=r(63),s=r(58),u=r(60)}]);